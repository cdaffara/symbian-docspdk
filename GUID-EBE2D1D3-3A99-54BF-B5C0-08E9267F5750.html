<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Creating a DirectGDI Adaptation"/>
<meta name="abstract" content="This topic provides information about creating a DirectGDI adaptation."/>
<meta name="description" content="This topic provides information about creating a DirectGDI adaptation."/>
<meta name="DC.Relation" scheme="URI" content="GUID-7B511CC2-CE38-5888-AF12-3568BEB416A6.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E89F034F-C807-5FF9-B06B-F7CCD2441041.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7B511CC2-CE38-5888-AF12-3568BEB416A6.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CD4B8ECA-AFE7-593C-B095-5D642EA2EC61.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E9C6DBBF-1910-595D-94A1-67664CF7B7A6.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-22E46647-D677-5A47-A7E0-E1E0AE736B27.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Creating a DirectGDI Adaptation</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2384330 id2385294 id2386803 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html">Graphics Guide</a> &gt; <a href="GUID-E89F034F-C807-5FF9-B06B-F7CCD2441041.html" title="The Graphics Device Interface (GDI) collection provides important functionality within the Graphics subsystem. The functionality includes graphics device abstraction, linear digital differential analysis, font description and information, printer devices abstraction, line breaking and text rendering.">Graphics Device Interface (GDI) Collection</a> &gt; <a href="GUID-7B511CC2-CE38-5888-AF12-3568BEB416A6.html" title="The DirectGDI Interface component forms the Hardware Adaptation Interface (HAI) part of the DirectGDI framework, which enables graphics hardware accelerated rendering.">DirectGDI Interface Component</a> &gt; </div>
<h1 class="topictitle1">Creating
a DirectGDI Adaptation</h1>
<div><p>This topic provides information about creating a DirectGDI adaptation. </p>

<p><strong>Target audience</strong>: Device creators. </p>

<div class="note"><span class="notetitle">Note:</span> DirectGDI is deprecated in Symbian^3.</div>

<div class="section" id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-A08F6D35-01A5-4548-8134-5300ECC0AC36"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-A08F6D35-01A5-4548-8134-5300ECC0AC36"><!-- --></a><h2 class="sectiontitle">Required background</h2> <p>This
topic assumes an understanding of the material contained in the following: </p>
 <ul>
<li id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-81CDAB03-A761-5784-BC92-61248F317444"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-81CDAB03-A761-5784-BC92-61248F317444"><!-- --></a><p><a href="GUID-CD4B8ECA-AFE7-593C-B095-5D642EA2EC61.html" title="This topic provides an introduction to the DirectGDI component. DirectGDI provides a graphics context that can be hardware accelerated, and allows an asynchronous interface.">DirectGDI
Component Overview</a>  </p>
 </li>

<li id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-FAA72B71-BD87-5796-BDE2-EE739D01CC97"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-FAA72B71-BD87-5796-BDE2-EE739D01CC97"><!-- --></a><p><a href="GUID-E9C6DBBF-1910-595D-94A1-67664CF7B7A6.html" title="The DirectGDI Interface component provides a Hardware Adaptation Interface (HAI), which separates the generic and adaptation parts of the DirectGDI functionality. This HAI defines a set of interfaces that are implemented by device creators in order to provide the API functionality.">DirectGDI
Interface Component Overview</a>  </p>
 </li>

<li id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-66E61F77-3E30-5134-8712-3AD63F9E35CC"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-66E61F77-3E30-5134-8712-3AD63F9E35CC"><!-- --></a><p><a href="GUID-22E46647-D677-5A47-A7E0-E1E0AE736B27.html">DirectGDI
Adaptation Overview</a>  </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-9EA9C05C-919C-48B5-AE77-412CD316DF19"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-9EA9C05C-919C-48B5-AE77-412CD316DF19"><!-- --></a><h2 class="sectiontitle">Packaging the
DLL</h2> <p>When packaging the adaptation, the following rules apply: </p>
 <ul>
<li id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-C56B01DF-0C5E-511E-B0E6-842DC1643F4D"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-C56B01DF-0C5E-511E-B0E6-842DC1643F4D"><!-- --></a><p>The DirectGDI adaptation
must be packaged as a DLL with the name <strong>directgdiadapter.dll</strong>. </p>
 </li>

<li id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-823E502D-A732-5F3D-98C8-F1AA790028FB"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-823E502D-A732-5F3D-98C8-F1AA790028FB"><!-- --></a><p>The second and third
UIDs must be <samp class="codeph">0x1000008D</samp> and <samp class="codeph">0x102858E9</samp>,
respectively. </p>
 </li>

<li id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-9D1E5C7F-B9C6-5954-9B72-92D97172D977"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-9D1E5C7F-B9C6-5954-9B72-92D97172D977"><!-- --></a><p>All capabilities except
TCB (Trusted Computing Base) are required. </p>
 </li>

<li id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-3D0E73B9-8D09-5923-93CD-6ABED9FAE91D"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-3D0E73B9-8D09-5923-93CD-6ABED9FAE91D"><!-- --></a><p>The <samp class="codeph">NOEXPORTLIBRARY</samp> keyword
must be used in the MMP file to prevent the generation of LIB/DSO files during
the build process. </p>
 </li>

</ul>
 <p>Here is a snippet of an example MMP file: </p>
 <pre class="codeblock" id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-01137A07-7723-5D31-ABB6-A9B86B047139"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-01137A07-7723-5D31-ABB6-A9B86B047139"><!-- --></a>TARGET directgdiadapter.dll
TARGETTYPE DLL
CAPABILITY All -Tcb
UID 0x1000008D 0x102858E9
VENDORID &lt;Your vendor ID in hex&gt;
NOEXPORTLIBRARY</pre>
 <p>The reference adaptation component has several
implementations for different configurations. These have different names and
the one that is to be used in the device is renamed to <span class="filepath">directgdiadapter.dll</span> during
the ROM building process. You may want to use a similar approach. See <a href="GUID-946E64D6-3E5D-5264-AD5D-29D3AD296543.html" title="The Graphics package contains a number of adaptation and customization components. These are called adaptations in this topic. Symbian provides implementations of these components. However, device creators can create their own implementationsâ€”for example, to take advantage of the specific hardware that is available in a particular device. This topic describes how to select adaptations for inclusion in a ROM.">Selection of Adaptations</a> for
more information. </p>
 <p>Because the DirectGDI Adaptation component is optional,
the <a href="GUID-A2E07A3C-B3A8-50B9-BD60-F1F01795FA24.html" title="The DirectGDI component provides a graphics context that can be hardware accelerated, and allows an asynchronous interface.">DirectGDI component</a> provides
a <strong>stub implementation</strong> for platform security reasons. When a functional
adaptation is not present, the stub implementation is compiled into a DLL
called <span class="filepath">directgdiadapter.dll</span> and is installed in the ROM
in order to prevent a SIS file installing a rogue DLL with this name. </p>
 </div>

<div class="section" id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-7B23C611-51FE-47E3-8F8D-0D1696132046"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-7B23C611-51FE-47E3-8F8D-0D1696132046"><!-- --></a><h2 class="sectiontitle">The exported
function</h2> <p>The DirectGDI adaptation DLL is a polymorphic interface
DLL that must export a single function at ordinal position one. The function
that must be exported is <a href="GUID-1E407D78-0FD3-30F2-BDC5-B531F34D4A27.html#GUID-1E407D78-0FD3-30F2-BDC5-B531F34D4A27__GUID-0E41EA26-2DF7-3AB5-AC06-20EB080A6596"><span class="apiname">CDirectGdiDriverInternal::New()</span></a>.
Here is its definition in the stub implementation: </p>
 <pre class="codeblock" id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-C0E2A910-2B63-56BF-A745-AE6198E221DE"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-C0E2A910-2B63-56BF-A745-AE6198E221DE"><!-- --></a>EXPORT_C TInt CDirectGdiDriverInternal::New(CDirectGdiDriverInternal*&amp; aInternal, RLibrary /*aLibrary*/)
    {
    aInternal = NULL;
    return KErrNotSupported;
    }</pre>
 <p>This simply returns <a href="GUID-F89DA3F0-2A48-3F9B-8F08-29350E92D0E4.html"><span class="apiname">KErrNotSupported</span></a> to
indicate that the DirectGDI functionality is not supported. This is because,
as mentioned above, the stub implementation is used for platform security
reasons when no functional DirectGDI adaptation is present. </p>
 <p>In a functional
implementation, the function must create a new instance of the class that
is derived from <a href="GUID-1E407D78-0FD3-30F2-BDC5-B531F34D4A27.html"><span class="apiname">CDirectGdiDriverInternal</span></a> and return it
in the pointer argument. </p>
 </div>

<div class="section" id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-2E9B5826-9CED-466C-8AB5-C6E386AA7744"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-2E9B5826-9CED-466C-8AB5-C6E386AA7744"><!-- --></a><h2 class="sectiontitle">Implementing
the interfaces</h2> <p>The <a href="GUID-E9C6DBBF-1910-595D-94A1-67664CF7B7A6.html" title="The DirectGDI Interface component provides a Hardware Adaptation Interface (HAI), which separates the generic and adaptation parts of the DirectGDI functionality. This HAI defines a set of interfaces that are implemented by device creators in order to provide the API functionality.">DirectGDI
Interface</a> component provides a Hardware Adaptation Interface (HAI),
which separates the generic and adaptation parts of the DirectGDI framework.
The component defines a set of interfaces for which the adaptation must provide
an implementation. As long as the implementation conforms to the interface
specifications and contracts, you are free to write the adaptation as you
see fit. </p>
 <p> <strong>Driver adapter</strong>. You must create a concrete driver
adapter class that implements all the pure virtual functions of <a href="GUID-1E407D78-0FD3-30F2-BDC5-B531F34D4A27.html"><span class="apiname">CDirectGdiDriverInternal</span></a>.
This driver adapter is a singleton class. A single instance can be created
for each process or each thread that uses the DirectGDI API, depending on
your requirements. The driver adapter is responsible for creating and destroying
drawing engines, and creating and destroying implementations of <a href="GUID-66A0A534-7BB6-304F-9A5E-17A125DA916F.html"><span class="apiname">RDirectGdiDrawableSource</span></a> and <a href="GUID-8F7C2E3C-3DF6-3C76-85C0-04922A99E9D0.html"><span class="apiname">RDirectGdiImageTarget</span></a>. </p>
 <p> <strong>Engine adapter</strong>. You must create a concrete engine adapter
class that implements the <a href="GUID-97E3E8DD-A2DA-3961-96E3-41AEAFFDD275.html"><span class="apiname">MDirectGdiEngine</span></a> interface. A
concrete engine adapter instance is created for each instance of <a href="GUID-09AFDE10-489E-3215-B821-DE7B2D31A007.html"><span class="apiname">CDirectGdiContext</span></a>.
The engine adapter performs the actual drawing and blitting routines that
enable rendering to an <a href="GUID-8F7C2E3C-3DF6-3C76-85C0-04922A99E9D0.html"><span class="apiname">RDirectGdiImageTarget</span></a> instance.
Because DirectGDI is a replacement for BitGDI, the behaviour of the engine
adapter must match the behaviour of BitGDI as far as possible. If an exact
match is not possible, the behaviour must be as close as possible. </p>
 <p>In
addition, you must create implementations of adaptation-specific resources
that correspond to the following handle classes: </p>
 <ul>
<li id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-7E672B36-9E55-5DB2-9C18-75C065B99F08"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-7E672B36-9E55-5DB2-9C18-75C065B99F08"><!-- --></a><p> <a href="GUID-8F7C2E3C-3DF6-3C76-85C0-04922A99E9D0.html"><span class="apiname">RDirectGdiImageTarget</span></a>  </p>
 </li>

<li id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-5EEF64D2-B049-56DA-8411-104B3F726C4F"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-5EEF64D2-B049-56DA-8411-104B3F726C4F"><!-- --></a><p> <a href="GUID-66A0A534-7BB6-304F-9A5E-17A125DA916F.html"><span class="apiname">RDirectGdiDrawableSource</span></a>  </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-456AD066-04AC-42E5-853F-7C581B72402A"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-456AD066-04AC-42E5-853F-7C581B72402A"><!-- --></a><h2 class="sectiontitle">Extension interfaces</h2> <p>The <a href="GUID-0C7CD826-95FD-3DD2-9394-3A20316C9C61.html#GUID-0C7CD826-95FD-3DD2-9394-3A20316C9C61__GUID-B1BFB404-4778-32FD-80B6-E909FE9E5687"><span class="apiname">CDirectGdiDriver::GetInterface()</span></a> function provides an optional mechanism for DirectGDI adaptations to extend
the HAI by defining extension interfaces. The DirectGDI client can access
these by using the <a href="GUID-0C7CD826-95FD-3DD2-9394-3A20316C9C61.html#GUID-0C7CD826-95FD-3DD2-9394-3A20316C9C61__GUID-B1BFB404-4778-32FD-80B6-E909FE9E5687"><span class="apiname">CDirectGdiDriver::GetInterface()</span></a> method. </p>
 </div>

<div class="section" id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-AF6C6E59-16F4-4BBE-A59B-6EDF1C2748AC"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-AF6C6E59-16F4-4BBE-A59B-6EDF1C2748AC"><!-- --></a><h2 class="sectiontitle">Performance
considerations</h2> <p>Sometimes the requirements of graphics hardware
mean that images and glyphs must be converted from one format to another (for
example, from <a href="GUID-683A1D42-2764-3EB7-BD19-9E12559199AB.html"><span class="apiname">CFbsBitmap</span></a> to <samp class="codeph">VGImage</samp>) every
time they are drawn. In these circumstances, you may want to consider introducing
a caching mechanism to store the converted images and glyphs in order to reduce
unnecessary format conversions. </p>
 </div>

<div class="section" id="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-CD79B79F-5566-40E5-BB73-693BA8F95EBC"><a name="GUID-EBE2D1D3-3A99-54BF-B5C0-08E9267F5750__GUID-CD79B79F-5566-40E5-BB73-693BA8F95EBC"><!-- --></a><h2 class="sectiontitle">Conformance
testing</h2> <p>DirectGDI should produce output that is comparable to BitGDI.
You can test your DirectGDI adaptation by using the DirectGDI test suite.
This compares test images created using all of the <a href="GUID-40D3BA6E-24FB-34AD-99D0-1119458C1E7F.html"><span class="apiname">CDirectGDIContext</span></a> APIs
with those generated using BitGDI. Fine tuning the adaptation to match the
BitGDI reference images as closely as possible ensures a continued look and
feel. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-7B511CC2-CE38-5888-AF12-3568BEB416A6.html" title="The DirectGDI Interface component forms the Hardware Adaptation Interface (HAI) part of the DirectGDI framework, which enables graphics hardware accelerated rendering.">DirectGDI Interface Component</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-CD4B8ECA-AFE7-593C-B095-5D642EA2EC61.html" title="This topic provides an introduction to the DirectGDI component. DirectGDI provides a graphics context that can be hardware accelerated, and allows an asynchronous interface.">DirectGDI
Overview</a></div>
<div><a href="GUID-E9C6DBBF-1910-595D-94A1-67664CF7B7A6.html" title="The DirectGDI Interface component provides a Hardware Adaptation Interface (HAI), which separates the generic and adaptation parts of the DirectGDI functionality. This HAI defines a set of interfaces that are implemented by device creators in order to provide the API functionality.">DirectGDI
Interface Component                 Overview</a></div>
<div><a href="GUID-22E46647-D677-5A47-A7E0-E1E0AE736B27.html">DirectGDI
Adaptation Overview</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>