<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Deriving from COpenFontFile"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-762A665F-43D0-53ED-B698-0CBD3AC46391.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B798C19D-4030-564A-A208-D84738259D72.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-89AD2E29-DF29-5B2B-9894-B7ECD62854F4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F477E82D-2929-5C69-BF6D-A69A61AC9EA5.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1CF78E25-8C83-5812-AE6F-8612B3F9CDA9.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Deriving from COpenFontFile</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547"><a name="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2535736 id2535744 id2535786 id2535806 id2535827 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html">Text and Localization Guide</a> &gt; <a href="GUID-762A665F-43D0-53ED-B698-0CBD3AC46391.html" title="The Font and Text Services Collection contains the Font Store and related plug-ins and the Text Rendering component. Application developers can select fonts from the Font Store. Device creators can create and add fonts.">Font and Text Services Collection</a> &gt; <a href="GUID-B798C19D-4030-564A-A208-D84738259D72.html" title="The Font Store is encapsulated by the Font and Bitmap Server. It represents all of the fonts stored as files in the file system. Font files may be of the native Symbian bitmap format or they may require rasterising into bitmaps. Font rasterisers are ECOM plug-ins to the Font Store.">Font Store Component</a> &gt; <a href="GUID-89AD2E29-DF29-5B2B-9894-B7ECD62854F4.html">Font Store Tutorials</a> &gt; <a href="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html" title="This section provides instructions for creating a font rasterizer. The code examples in this tutorial are take from the FreeType font rasterizer.">Writing a Font Rasterizer Plug-in Tutorial</a> &gt; </div>
<h1 class="topictitle1">Deriving from COpenFontFile</h1>
<div><div class="section"><h2 class="sectiontitle">Overview</h2> <p>Write a class derived from <samp class="codeph">COpenFontFile</samp> to manage a file of the font format supported by the DLL. An object of this type is created by <samp class="codeph">COpenFontRasterizer::NewFontFile()</samp>. </p>
 <p>To derive from <samp class="codeph">COpenFontFile</samp>: </p>
 <ul><li id="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-C27C30FC-9E0B-5033-9C34-2BDF008D5BE1"><a name="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-C27C30FC-9E0B-5033-9C34-2BDF008D5BE1"><!-- --></a><p>Provide implementations for <samp class="codeph">COpenFontFile</samp>'s two pure virtual functions: <samp class="codeph">GetNearestFontInPixelsL()</samp> and <samp class="codeph">HasUnicodeCharacterL()</samp>. These are discussed further in the following sections. </p>
 </li>
 <li id="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-FBD8C9FB-8F2F-5235-80E1-12ECF77CD86C"><a name="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-FBD8C9FB-8F2F-5235-80E1-12ECF77CD86C"><!-- --></a><p>During construction call the base class constructor, passing it the arguments <samp class="codeph">aUid</samp> and <samp class="codeph">aFileName</samp> supplied to <samp class="codeph">COpenFontRasterizer::NewFontFileL()</samp>. </p>
 </li>
 <li id="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-12B0A396-10DC-5369-BF10-52EFD862BBBC"><a name="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-12B0A396-10DC-5369-BF10-52EFD862BBBC"><!-- --></a><p>During construction, extract the attributes of each font in the font file into a <samp class="codeph">TOpenFontFaceAttrib</samp>. Then add the attributes for each typeface to the typeface array â€” using <samp class="codeph">COpenFontFile::AddFaceL()</samp>. </p>
 </li>
 </ul>
 </div>
 <div class="section"><h2 class="sectiontitle">Implementing GetNearestFontInPixelsL()</h2> <p>This function is called by the Font and Bitmap server to retrieve the font (from the font file) which most closely matches a given font specification. The freetype implementation is given below: </p>
 <pre class="codeblock" id="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-D87B9618-C570-5A48-9F12-75D19C24F9C2"><a name="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-D87B9618-C570-5A48-9F12-75D19C24F9C2"><!-- --></a>void CFreeTypeFontFile::GetNearestFontInPixelsL(RHeap* aHeap,
          COpenFontSessionCacheList* aSessionCacheList,
          const TOpenFontSpec&amp; aFontSpec,
          TInt aPixelWidth,
          TInt aPixelHeight, COpenFont*&amp; aFont,
          TOpenFontSpec&amp; aActualFontSpec)
    {
    // Use the standard matcher.
    TInt face_index = 0;
    if (GetNearestFontHelper(aFontSpec,aPixelWidth,aPixelHeight,face_index,aActualFontSpec))
        {
        aFont = CFreeTypeFont::NewL(aHeap,aSessionCacheList,this,face_index,
                                    aActualFontSpec.Height(),
                                    aActualFontSpec.WidthFactor(),
                                    aActualFontSpec.SlantFactor());
        }
    }
</pre>
 <p>To implement this function: </p>
 <ul><li id="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-9FE18079-8FED-5850-9FE3-022AE20C6794"><a name="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-9FE18079-8FED-5850-9FE3-022AE20C6794"><!-- --></a><p>Call the helper function <a href="GUID-FC62EDD7-A3F7-3611-A899-CA5F17BB2EEE.html#GUID-FC62EDD7-A3F7-3611-A899-CA5F17BB2EEE__GUID-FA4C5FC6-8F49-3E11-8982-685C5E0AF6F0"><span class="apiname">COpenFontFile::GetNearestFontHelper()</span></a>, passing it <samp class="codeph">aDesiredFontSpec</samp>, <samp class="codeph">aPixelWidth</samp>, <samp class="codeph">aPixelHeight</samp>, <samp class="codeph">aActualFontSpec</samp>, and the index of the typeface to search for a match. Note that a font file may contain several typefaces, which are accessed by this index. </p>
 <p>This helper function searches the typeface array for the closest matching font and returns <samp class="codeph">ETrue</samp> if a match is found. It also retrieves the matching font's specification into <samp class="codeph">aActualFontSpec</samp>. </p>
 <p>Note that the typeface array must be populated from the font file during construction of the <samp class="codeph">COpenFontFile</samp> derived object. </p>
 </li>
 <li id="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-7FFE0B31-4625-53FB-80FA-0A56CD318FD0"><a name="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-7FFE0B31-4625-53FB-80FA-0A56CD318FD0"><!-- --></a><p>If a valid match was obtained from the helper function (i.e. if it returned <samp class="codeph">ETrue</samp>) create a new <samp class="codeph">COpenFont</samp> object using the specification <samp class="codeph">aActualFontSpec</samp>. Pass the two arguments, <samp class="codeph">aHeap</samp> and <samp class="codeph">aSessionCacheList</samp> to the <samp class="codeph">COpenFont</samp> constructor. </p>
 <p>The new object should be returned in <samp class="codeph">aFont</samp>. </p>
 </li>
 <li id="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-CEEDEC6A-8F1A-5FB6-A2DE-2A657810C437"><a name="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-CEEDEC6A-8F1A-5FB6-A2DE-2A657810C437"><!-- --></a><p>If no match is found, <samp class="codeph">aFont</samp> should be set to NULL. </p>
 </li>
 </ul>
 </div>
 <div class="section"><h2 class="sectiontitle">Implementing HasUnicodeCharacterL()</h2> <p> <samp class="codeph">HasUnicodeCharacterL()</samp> is called by the Font and Bitmap Server to test whether a font contains a particular Unicode character. The prototype is: </p>
 <pre class="codeblock" id="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-DEB16CCF-0E1C-59CA-8EC8-4A0F38ADDF31"><a name="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547__GUID-DEB16CCF-0E1C-59CA-8EC8-4A0F38ADDF31"><!-- --></a>virtual TBool HasUnicodeCharacterL(TInt aFaceIndex,TInt aCode) const = 0; </pre>
 <p>Implementations must return <samp class="codeph">ETrue</samp> if the character <samp class="codeph">aCode</samp>, which is always a Unicode value, exists in the typeface. There are no other constraints on the way this function is implemented. </p>
 </div>
 </div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html" title="This section provides instructions for creating a font rasterizer. The code examples in this tutorial are take from the FreeType font rasterizer.">Writing a Font Rasterizer Plug-in Tutorial</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-F477E82D-2929-5C69-BF6D-A69A61AC9EA5.html">Creating a
                Font Rasterizer Plug-in</a></div>
<div><a href="GUID-1CF78E25-8C83-5812-AE6F-8612B3F9CDA9.html">Deriving from
                COpenFontRasterizer</a></div>
<div><a href="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C.html">Deriving from
                COpenFont</a></div>
<div><a href="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395.html">Deriving from
                COpenFontRasterizerContext</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>