<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Client Tutorial"/>
<meta name="abstract" content="Explains how to use the MMC Controller interfaces to use MMC hardware."/>
<meta name="description" content="Explains how to use the MMC Controller interfaces to use MMC hardware."/>
<meta name="DC.Relation" scheme="URI" content="GUID-79B2CF91-FB95-5E7C-81CC-235A6A660D88.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CFD2236E-7775-5532-89CD-7D0E1E219FD8.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2F114BC9-9B5D-5989-9CF3-37A43377DC58.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-79B2CF91-FB95-5E7C-81CC-235A6A660D88.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Client Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2400576 id2400607 id2400622 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-CFD2236E-7775-5532-89CD-7D0E1E219FD8.html" title="Provides an overview of generic driver support.">Generic Driver Support</a> &gt; <a href="GUID-2F114BC9-9B5D-5989-9CF3-37A43377DC58.html" title="Provides the physical device drivers, called media drivers, and associated libraries that manage storage media hardware.">Media Drivers</a> &gt; <a href="GUID-79B2CF91-FB95-5E7C-81CC-235A6A660D88.html" title="The MMC Controller provides kernel extensions that manages access to the MultiMediaCard hardware on behalf of media drivers or any other device driver.">MMC Controller</a> &gt; </div>
<h1 class="topictitle1">Client
Tutorial</h1>
<div><p>Explains how to use the MMC Controller interfaces to use MMC hardware.</p>

<div class="section" id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-388CEB1C-BA81-593F-81D3-C0BD72A405E0"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-388CEB1C-BA81-593F-81D3-C0BD72A405E0"><!-- --></a><h2 class="sectiontitle">Client interfaces</h2> <p>The
following diagram shows the relationship between the Controller and its clients,
and also shows aspects of the relationship between the constituent parts.
In this case, the client is the MultiMediaCard driver, although in general
this could be some other device driver. </p>
<div class="fignone" id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-FF02FE34-4E77-42DE-89BC-4D789E6A310D"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-FF02FE34-4E77-42DE-89BC-4D789E6A310D"><!-- --></a>
<img src="GUID-6597A895-37D5-51D1-86B3-E74F6E845899_d0e401779_href.png"/>
</div>
 <p>The session is used to pass commands either to the entire stack,
i.e. a broadcast command, or to individual cards in the stack. </p>
 <p>The
session provides access to the stack of cards, via a pointer to a stack object,
the <samp class="codeph">iStackP</samp> private member. The session is used to pass commands
either to the entire stack, i.e. a broadcast command, or to individual cards
in the stack. An individual card can be accessed via a pointer to the card
object, the <samp class="codeph">iCardP</samp> private member. The card objects, <a href="GUID-913FA896-4237-3E47-996F-547E325550AD.html"><span class="apiname">TMMCCard</span></a> types,
are data members of the card array object, <a href="GUID-A460F779-52AB-3ED0-AF13-41B9BC5B2A71.html"><span class="apiname">TMMCardArray</span></a>,
which, in turn is a data member of the stack object. </p>
 </div>

<div class="section" id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-A0B4E830-24DD-5C9C-A76B-CD1DE372A9FE"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-A0B4E830-24DD-5C9C-A76B-CD1DE372A9FE"><!-- --></a><h2 class="sectiontitle">Using the MultiMediaCard
stack</h2> <p>Clients of the MMC Controller such as the MMC Media Driver
uses the MMC Controller as follows: </p>
 <ul>
<li id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-F4C2C756-5793-59BE-9DAB-E7960B4E5F8D"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-F4C2C756-5793-59BE-9DAB-E7960B4E5F8D"><!-- --></a><p>requests a pointer to
the stack object, through which the client can obtain pointers to the individual
card objects and interrogate the cards, finding out their media type, capacity,
and capability (via the card’s <a href="GUID-C6858312-FC9A-34C9-B442-557F7558B5C4.html"><span class="apiname">TCSD</span></a> object), and whether
the card is present or ready. </p>
 </li>

<li id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-592769F9-B9B0-583E-A76C-DF8EB0A5A4B2"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-592769F9-B9B0-583E-A76C-DF8EB0A5A4B2"><!-- --></a><p>creates a session object,
an instance of the <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html"><span class="apiname">DMMCSession</span></a> class, providing a callback
function for its constructor. The callback is encapsulated as a <a href="GUID-F59F1805-95FB-3BDD-97A5-4FD6048DE2E8.html"><span class="apiname">TMMCCallBack</span></a> object. </p>
 </li>

<li id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-66E909B9-8B32-5036-BCAA-486A7F047BBD"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-66E909B9-8B32-5036-BCAA-486A7F047BBD"><!-- --></a><p>initiates the session
with the pointer to the stack object: <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html#GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A__GUID-72859BCF-4979-37F3-BF32-45181F64755F"><span class="apiname">DMMCSession::SetStack()</span></a> . </p>
 </li>

</ul>
 <p>The client interacts with the stack in the following manner: </p>
 <a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-AE800793-AEF9-5F11-9CF2-A6FEB6827265"><!-- --></a><ol id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-AE800793-AEF9-5F11-9CF2-A6FEB6827265">
<li id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-2957F643-771C-5279-821F-875843F42CAC"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-2957F643-771C-5279-821F-875843F42CAC"><!-- --></a><p>it sets the session
up with the pointer to the card object, by calling <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html#GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A__GUID-60FAAA31-A5E1-3DCF-93AE-459BCC8C9730"><span class="apiname">DMMCSession::SetCard()</span></a>. </p>
 </li>

<li id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-4B117791-3B0D-552F-81AC-85D0905EEB91"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-4B117791-3B0D-552F-81AC-85D0905EEB91"><!-- --></a><p>it sets the session
up to do a specific job, such as a MultiMediaCard macro command, or a lower
level card command, using the API provided by <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html"><span class="apiname">DMMCSession</span></a>. </p>
 </li>

<li id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-0F43C846-6E62-5539-99E1-1DBCF4E911CE"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-0F43C846-6E62-5539-99E1-1DBCF4E911CE"><!-- --></a><p>it presents the session
to the stack for execution, by calling <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html#GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A__GUID-8DA6B49E-FED0-3E83-8D2F-EA7B61C28015"><span class="apiname">DMMCSession::Engage()</span></a>. </p>
 </li>

<li id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-BF673228-633B-5E99-9396-0CE6ABE3360E"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-BF673228-633B-5E99-9396-0CE6ABE3360E"><!-- --></a><p>On completion, the stack
calls the client’s callback function. The client then can repeat the cycle
from step 1 or 2. </p>
 </li>

</ol>
 <p>The client can override the default bus configuration settings, i.e.
change the bus clock, enable retries, change time-out values, restore defaults
etc., using the session's stack configuration object, <a href="GUID-89631250-7D11-3E89-9785-7DF779B2AB38.html"><span class="apiname">TMmCStackConfig</span></a>,
although in practice, there is rarely a need to do this. </p>
 </div>

<div class="section" id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-6638C350-37FE-5CF7-AF0B-0EF763936DF3"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-6638C350-37FE-5CF7-AF0B-0EF763936DF3"><!-- --></a><h2 class="sectiontitle">Locking the
MultiMediaCard stack</h2> <p>The <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html"><span class="apiname">DMMCSession</span></a> API includes
general lower level functions to issue any single command or series of commands
including those currently unknown to the controller. This allows application
specific commands to be supported. It also allows the controller to support
new commands introduced in later versions of the specification (e.g. commands
to support I/O cards). </p>
 <p>When issuing a series of application specific
commands, the client will want to lock the stack, preventing any other client
from generating bus activity during this period. This is accomplished by calling <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html#GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A__GUID-BA7DE143-BDE0-31DB-8C85-1073F0D6175C"><span class="apiname">DMMCSession::SetupCIMLockStack()</span></a> and
then engaging that session. If successful, the stack will be locked until <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html#GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A__GUID-5F153F42-9527-3561-AB05-B36DD28201A1"><span class="apiname">DMMCSession::UnlockStack()</span></a> is
called. </p>
 <p>As it may take time for the controller to lock the stack for
that session, the mechanism for locking the stack involves submitting a session
even though no bus activity results. If this session completes successfully
then the stack is locked. The client can then go ahead and invoke its series
of commands - configuring that same session object as necessary each time
and submitting it. </p>
 </div>

<div class="section" id="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-4B239C05-3CCF-4FB5-BD11-DA7DFF52DA95"><a name="GUID-B6F0C909-6E58-584E-9270-8066337FCE0F__GUID-4B239C05-3CCF-4FB5-BD11-DA7DFF52DA95"><!-- --></a><h2 class="sectiontitle">See also</h2> <p> <a href="GUID-9573F7B9-76E9-5DCB-A498-C0DE59606911.html" title="Describes the technology, architecture, and behaviour of the MMC Controller.">Concepts</a> </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-79B2CF91-FB95-5E7C-81CC-235A6A660D88.html" title="The MMC Controller provides kernel extensions that manages access to the MultiMediaCard hardware on behalf of media drivers or any other device driver.">MMC Controller</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>