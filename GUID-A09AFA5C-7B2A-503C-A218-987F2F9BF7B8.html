<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="Adding attachments to messages"/>
<meta name="abstract" content="The messaging framework allows you to add attachments to messages."/>
<meta name="description" content="The messaging framework allows you to add attachments to messages."/>
<meta name="DC.Relation" scheme="URI" content="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B394A824-8745-505E-8429-8B9B6D418387.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-DD27A452-8B0F-5C6D-A2E6-FC21145468B6.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1963A487-D6A7-4225-8D0C-EC5FAB746854.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-54AB166A-8B24-5065-92AD-5FC1BF3ED89C.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Adding attachments to messages</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2404348 id2404397 id2404434 id2404652 id2404730 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html">Messaging Middleware Guide</a> &gt; <a href="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html">Messaging Framework</a> &gt; <a href="GUID-B394A824-8745-505E-8429-8B9B6D418387.html">Message Server and Store</a> &gt; <a href="GUID-DD27A452-8B0F-5C6D-A2E6-FC21145468B6.html">Message Server and Store Tutorials</a> &gt; <a href="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html" title="The MMsvAttachmentManager interface is used to create, add, modify and remove message attachments.">Messaging Attachments Tutorial</a> &gt; </div>
<h1 class="topictitle1">Adding
attachments to messages</h1>
<div><p>The messaging framework allows you to add attachments to messages. </p>

<div class="section" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-DCEBCACA-CABD-59C7-A172-2BBA58ACA037"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-DCEBCACA-CABD-59C7-A172-2BBA58ACA037"><!-- --></a><p>A message attachment,
once it has been created, must be added to its message in a separate procedure
explained in this document. </p>
 </div>

<a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-A4D8D1D3-5A11-5107-9A4C-55BAB1837024"><!-- --></a><ol id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-A4D8D1D3-5A11-5107-9A4C-55BAB1837024"><li class="stepexpand" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-EB4005D6-C444-5FA7-BEEB-C8C2D795D1D6"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-EB4005D6-C444-5FA7-BEEB-C8C2D795D1D6"><!-- --></a><span/><br/>
 Create an active object implementation. All the <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html"><span class="apiname">MMsvAttachmentManager</span></a> functions
that modify attachments for an entry are asynchronous, so a request must be
called with an active object implementation. 
 <pre class="codeblock" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-7104871F-A46F-5E98-9C17-CB555D374D02"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-7104871F-A46F-5E98-9C17-CB555D374D02"><!-- --></a>//* Active object request function to add an attachment.
Arguments:
aEntry -  entry to make attachment for
aAttachPath -  path of file to attach
aSize - size of attachment in bytes 
*/

void CFoo::AttachFileL(CMsvEntry&amp; aEntry, const TFileName&amp; aAttachPath, TInt aSize)
    { 
...
    // Wait for request to complete
    User::WaitForRequest(status);
        
    CleanupStack::PopAndDestroy(store);    
    }

</pre>
 
</li>
<li class="stepexpand" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-43BF419C-2571-506A-A4F0-B33EAB231394"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-43BF419C-2571-506A-A4F0-B33EAB231394"><!-- --></a><span>Get the details
of the message to which you want to add an attachment using <a href="GUID-85BBE389-81F7-3E2F-A789-446D9BE2CC49.html#GUID-85BBE389-81F7-3E2F-A789-446D9BE2CC49__GUID-1864B96D-CB22-3EE1-8E73-023F12C68CB0"><span class="apiname">CMsvEntry::EditStoreL()</span></a>. </span>
 This function returns <a href="GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE.html"><span class="apiname">CMsvStore</span></a> in writable mode. 
 <pre class="codeblock" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-0CF9F084-CA32-5E2B-90A9-C962BED421D2"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-0CF9F084-CA32-5E2B-90A9-C962BED421D2"><!-- --></a>    // Get store   
    CMsvStore* store = aEntry.EditStoreL();
    CleanupStack::PushL(store);
</pre>
 
</li>
<li class="stepexpand" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-D202696D-6ECF-5F0A-AB3F-6BA939911EAB"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-D202696D-6ECF-5F0A-AB3F-6BA939911EAB"><!-- --></a><span>Get an <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html"><span class="apiname">MMsvAttachmentManager</span></a> attachment
manager for the message entry, using <a href="GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE.html#GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE__GUID-73CE27F3-855B-3F87-AE11-4B4F2B8F8825"><span class="apiname">CMsvStore::AttachmentManagerL()</span></a>. </span>
 <pre class="codeblock" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-4DD6C7CB-BB2F-5953-9D15-BA0EA4DA08A6"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-4DD6C7CB-BB2F-5953-9D15-BA0EA4DA08A6"><!-- --></a>    // Get attachment manager from the entry's store     
    MMsvAttachmentManager&amp; attManager = store-&gt;AttachmentManagerL();    
</pre>
 
</li>
<li class="stepexpand" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-77E5F564-264F-524F-8DEA-C22AB05504B2"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-77E5F564-264F-524F-8DEA-C22AB05504B2"><!-- --></a><span/><br/>
 Create a new attachment attributes object using the <a href="GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F.html#GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F__GUID-CB0C9E14-A0D3-340A-929D-8B2C3BC11300"><span class="apiname">CMsvAttachment::NewL()</span></a> function. 
 <pre class="codeblock" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-5FA4C954-39F0-5EC6-BF51-B352FE03883C"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-5FA4C954-39F0-5EC6-BF51-B352FE03883C"><!-- --></a>    // Create a new attachment attributes object    
    CMsvAttachment* attachment = CMsvAttachment::NewL(CMsvAttachment::EMsvFile);    
    CleanupStack::PushL(attachment);    
</pre>
 
</li>
<li class="stepexpand" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-4405D256-83F8-554B-A39B-05E273D47E76"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-4405D256-83F8-554B-A39B-05E273D47E76"><!-- --></a><span/><br/>
 Set the attachments name and size attributes using the functions of
the <a href="GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F.html"><span class="apiname">CMsvAttachment</span></a> class. 
 <pre class="codeblock" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-0ED897B3-BBC3-5FD0-8602-574F58DA287F"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-0ED897B3-BBC3-5FD0-8602-574F58DA287F"><!-- --></a>    // Set the attachment name and size attributes    
    TParse fparse;    
    User::LeaveIfError(fparse.Set(aAttachPath,NULL,NULL));    
    attachment-&gt;SetAttachmentNameL(fparse.NameAndExt());    
    attachment-&gt;SetSize(aSize);
</pre>
 
</li>
<li class="stepexpand" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-BF384C85-B97E-585E-BDFA-57132E11BE5B"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-BF384C85-B97E-585E-BDFA-57132E11BE5B"><!-- --></a><span/><br/>
 Add the attachment using any of the following functions: 

<a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-9412CD8C-D6C6-5245-A9D2-55A51636A028"><!-- --></a><ol type="a" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-9412CD8C-D6C6-5245-A9D2-55A51636A028">
<li class="substepexpand" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-EE27135A-9ACB-5BCE-B21C-C283756343D7"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-EE27135A-9ACB-5BCE-B21C-C283756343D7"><!-- --></a><span/><br/>
 For copied attachments, use the <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD__GUID-283B631D-0166-30F9-BBA3-CA364DB66B45"><span class="apiname">MMsvAttachmentManager::AddAttachmentL()</span></a> function. 
</li>

<li class="substepexpand" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-6EEC55E5-0D9E-596B-924D-CAA207E64F3D"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-6EEC55E5-0D9E-596B-924D-CAA207E64F3D"><!-- --></a><span/><br/>
 For linked attachments, use the <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD__GUID-D11BB466-2529-3C49-AFAB-810806376478"><span class="apiname">MMsvAttachmentManager::AddLinkedAttachmentL()</span></a> function. 
</li>

</ol>

  Note: For OBEX MTM, to add headers to an attachment, use the <a href="GUID-F4577312-35AC-32DE-AE0E-45BB0E0A761F.html#GUID-F4577312-35AC-32DE-AE0E-45BB0E0A761F__GUID-B1806BF9-78F5-31A2-AD51-D9B163EA62D6"><span class="apiname">CObexHeaderList::ExportToAttachmentL()</span></a> function.
Headers can be retrieved using the <a href="GUID-F4577312-35AC-32DE-AE0E-45BB0E0A761F.html#GUID-F4577312-35AC-32DE-AE0E-45BB0E0A761F__GUID-1BD1998A-7C9C-32CF-AD6B-CB96358A0438"><span class="apiname">CObexHeaderList::ImportFromAttachmentL()</span></a> function. 
 <pre class="codeblock" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-81899562-C23C-5737-A08E-6FDD157CDBA0"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-81899562-C23C-5737-A08E-6FDD157CDBA0"><!-- --></a>    TRequestStatus status;
         
    // Ownership of attachment will transfer to attachManager    
    CleanupStack::Pop(attachment);
    // Add the attachment    
    attManager.AddAttachmentL(aAttachPath, attachment, status);    
</pre>
 
</li>
<li class="stepexpand" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-05B4EF20-8994-582B-9C7E-3A27141BAD08"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-05B4EF20-8994-582B-9C7E-3A27141BAD08"><!-- --></a><span/><br/>
 Commit the store. 
</li>
</ol>

<div class="section" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-8D1AA546-5150-5778-A716-B2933EEDF028"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-8D1AA546-5150-5778-A716-B2933EEDF028"><!-- --></a><p>You now have an
attachment added to its message. </p>
 </div>

<div class="section" id="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-FD541AE4-7474-5CBB-AC0D-6987D6B0F9AE"><a name="GUID-A09AFA5C-7B2A-503C-A218-987F2F9BF7B8__GUID-FD541AE4-7474-5CBB-AC0D-6987D6B0F9AE"><!-- --></a><p>You can now retrieve
and modify the message attachment. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html" title="The MMsvAttachmentManager interface is used to create, add, modify and remove message attachments.">Messaging Attachments Tutorial</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-54AB166A-8B24-5065-92AD-5FC1BF3ED89C.html">Messaging
Framework Overview</a></div>
</div>
<div class="relinfo"><strong>Related information</strong><br/>
<div><a href="GUID-1963A487-D6A7-4225-8D0C-EC5FAB746854.html">Attachment
Tutorial</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>