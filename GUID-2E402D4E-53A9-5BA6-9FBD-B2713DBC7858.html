<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Peripheral Power Domains"/>
<meta name="abstract" content="A peripheral power domain can be defined as being a peripheral, or group of peripherals, whose power supply can be controlled independently from the rest of the device, but not independently from other peripherals within the same power domain."/>
<meta name="description" content="A peripheral power domain can be defined as being a peripheral, or group of peripherals, whose power supply can be controlled independently from the rest of the device, but not independently from other peripherals within the same power domain."/>
<meta name="DC.Relation" scheme="URI" content="GUID-3773A78D-F491-52EB-AA1D-201636497F28.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A91C6359-E547-51AD-AA8C-45BCAFBA98AC.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3773A78D-F491-52EB-AA1D-201636497F28.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Peripheral Power Domains</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858"><a name="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2399872 id2400380 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-A91C6359-E547-51AD-AA8C-45BCAFBA98AC.html" title="EKA2 is the principal Hardware and Kernel Services module. It manages the CPU and memory resources of a phone, and provides an architecture for device drivers to manage other hardware resources.">Kernel Architecture (EKA2)</a> &gt; <a href="GUID-3773A78D-F491-52EB-AA1D-201636497F28.html" title="This topic describes how to implement a power controller in a base port.">Power Management Tutorials</a> &gt; </div>
<h1 class="topictitle1">Peripheral
Power Domains</h1>
<div><p>A peripheral power domain can be defined as being a peripheral,
or group of peripherals, whose power supply can be controlled independently
from the rest of the device, but not independently from other peripherals
within the same power domain. </p>

<p>Power domains depend on the physical wiring of a device, and this must
be taken into account by the base port. They are usually manipulated when
peripherals or groups of peripherals transition between the <em>Operational
Power</em> and <em>Off</em> states. </p>

<p>The following diagram is an example of such an arrangement. </p>

<div class="fignone" id="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858__GUID-A9CA379B-F3B9-550C-9BDC-C072BFCA642D"><a name="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858__GUID-A9CA379B-F3B9-550C-9BDC-C072BFCA642D"><!-- --></a><span class="figcap">Figure 1. Example of peripheral power domains</span>

<img src="GUID-A568F9D3-58E3-58D6-8A6E-4EC6BEC41A4D_d0e393668_href.png"/>
</div>

<p>To reduce power leakage, it may be useful to cut the power supply to an
area or a group of peripherals in the ASIC or the hardware platform, when
all peripherals on that peripheral power domain have moved to the <em>Off</em> state. </p>

<p>In the arrangement shown here, when all peripherals on a power domain have
been powered down, the power supply to that domain can be cut off, using the
RESn signal. </p>

<p>A suggested implementation would have peripheral power domains modelled
by a <a href="GUID-10105403-AF16-3908-AE9E-96CF2A03AD3A.html"><span class="apiname">MPowerInput</span></a> reference counted object, and controlled
using the <a href="GUID-10105403-AF16-3908-AE9E-96CF2A03AD3A.html#GUID-10105403-AF16-3908-AE9E-96CF2A03AD3A__GUID-2BCA5312-43D9-3763-9636-3B2EB046D2C1"><span class="apiname">MPowerInput::Use()</span></a> and <a href="GUID-10105403-AF16-3908-AE9E-96CF2A03AD3A.html#GUID-10105403-AF16-3908-AE9E-96CF2A03AD3A__GUID-606ECD77-A5F7-3408-9B63-C68C0A7B73C6"><span class="apiname">MPowerInput::Release()</span></a> interfaces
that would enable the domain on request. The peripheral driver’s request on
that power resource would only be changed when entering the <em>Operational
Power</em> state from the <em>Off</em> state, or when entering or exiting the <em>Off</em> states.
In other words, a peripheral power domain should only be turned off when all
peripherals in that domain have transitioned to their <em>Off</em> state. </p>

<p>This is a suggested definition for a peripheral power domain class. </p>

<pre class="codeblock" id="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858__GUID-49E76C4B-F162-5735-8499-3198071111CD"><a name="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858__GUID-49E76C4B-F162-5735-8499-3198071111CD"><!-- --></a>class PeripheralPowerDomain : public MPowerInput
    {
public:
    void InitPowerDomain();        // (optional) handles any initialisation
    void Use();                    // implementation of pure virtual
    void Release()                // implementation of pure virtual
    TUint GetCount();
private:
    TInt TurnSupplyOn();        // re-establishes power supply to this domain (asynch)
    TInt TurnSupplyOff();        // cuts power supply to this domain 
    };
      </pre>

<p>The <samp class="codeph">Use()</samp> and <samp class="codeph">Release()</samp> functions implement
a usage count. Peripheral drivers for peripherals on that domain will call
these functions whenever their power handler’s <samp class="codeph">PowerUp()</samp> and <samp class="codeph">PowerDown()</samp> member
functions are called, respectively. If the usage count is 0 and <samp class="codeph">Use()</samp> is
called, it should call <samp class="codeph">TurnSupplyOn()</samp>. If <samp class="codeph">Release()</samp> is
called and the usage count is decremented to 0, <samp class="codeph">TurnSupplyOff()</samp> is
called. </p>

<p>Often, re-establishing the power supply to a power domain is a lengthy
operation and should be modelled by an asynchronous operation. In that case <samp class="codeph">TurnSupplyOn()</samp> should
be able to sleep the thread in which this function is called until the power
supply is stable. </p>

<p>We recommend that peripheral power domains are defined as part of, and
accessed through, a resource manager object as suggested in the discussion
of <a href="GUID-3B6544CD-FA6E-5AB2-AA63-61186F52167D.html" title="This topic explains how power resources were controlled in older releases of Symbian platform. For later releases see the Power Resource Manager documentation.">Controllable Power
Resources</a>. Extending the original <a href="GUID-3B6544CD-FA6E-5AB2-AA63-61186F52167D.html#GUID-3B6544CD-FA6E-5AB2-AA63-61186F52167D__GUID-37A4098A-5E44-5744-BCE1-CDC8B876E654">A
suggested implementation of a resource manager</a> would give us: </p>

<pre class="codeblock" id="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858__GUID-F4D57698-C77F-5CD0-BF7B-FCBECD96F64F"><a name="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858__GUID-F4D57698-C77F-5CD0-BF7B-FCBECD96F64F"><!-- --></a>class ResourceManager
    {
public:    
    void InitResources();                        // called by your Asic::Init3()/Asic::Init1()
    void Modify(TUint aSetMask, TUint aClrMask); // only 32 simple Resources can be managed
    TBool GetResourceState(TUint aResBitMask);   // only 1 bit set on this mask, returns On/Off
public:
    (MPowerInput-derived) iSharedResource1;      // 1 per shared resource
    (MPowerInput-derived) iSharedResource2;
    ...
    PeripheralPowerDomain iPeripheralPowerDomain1;
    PeripheralPowerDomain iPeripheralPowerDomain2;
    PeripheralPowerDomain iPeripheralPowerDomain3;
    ...
    };
      </pre>

<p>where <samp class="codeph">InitResources()</samp> could call each <samp class="codeph">PeripheralPowerDomain::InitPowerDomain()</samp>. </p>

<p>Peripheral power domains may also be a useful concept when transitioning
peripherals to low power mode after peripheral inactivity detection. It is
only after all peripherals on a peripheral power domain have requested moving
the resource to the level corresponding to low power that the resource level
can be changed. This is exemplified again in the block diagram above: when
all peripherals in a domain have requested transitioning to low power (using
a <samp class="codeph">ReleaseToLevel()</samp> -type call) the power supply level to
that power domain can be set to VLowPwr. </p>

<p>The following base port software architecture diagram could be used to
address control of the peripheral power domains shown in the hardware block
diagram above: </p>

<div class="fignone" id="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858__GUID-2C8E6AF1-D82A-5539-96C3-921D9B3E2846"><a name="GUID-2E402D4E-53A9-5BA6-9FBD-B2713DBC7858__GUID-2C8E6AF1-D82A-5539-96C3-921D9B3E2846"><!-- --></a><span class="figcap">Figure 2. Base port software architecture diagram</span>

<img src="GUID-C3CE35FF-240E-5385-9088-38EF926ABB7B_d0e393781_href.png"/>
</div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-3773A78D-F491-52EB-AA1D-201636497F28.html" title="This topic describes how to implement a power controller in a base port.">Power Management Tutorials</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>