<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="Cleanup Strategy Tutorial"/>
<meta name="abstract" content="This tutorial describes the cleanup strategy and provides details on alternative cleanup strategies."/>
<meta name="description" content="This tutorial describes the cleanup strategy and provides details on alternative cleanup strategies."/>
<meta name="DC.Relation" scheme="URI" content="GUID-D33EB877-CCCB-527B-8AFC-4A8385C55E78.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-324107D1-6E0B-56DD-BDC0-7296F688A9CF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-28AD51DC-C101-5E6E-9EC3-C2B61400D8CD.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D60B55FA-D8C1-559A-9D99-48845BE32A6C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D33EB877-CCCB-527B-8AFC-4A8385C55E78.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B007634D-4D55-528A-8B85-6120C633AC8B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A18153C0-230C-51FB-9384-A48BB4E42F03.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Cleanup Strategy Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865"><a name="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2381103 id2383459 id2384051 id2384059 id2384120 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html">Generic OS Services Guide</a> &gt; <a href="GUID-324107D1-6E0B-56DD-BDC0-7296F688A9CF.html">Low Level Libraries and Frameworks</a> &gt; <a href="GUID-28AD51DC-C101-5E6E-9EC3-C2B61400D8CD.html">Generic Usability Library</a> &gt; <a href="GUID-D60B55FA-D8C1-559A-9D99-48845BE32A6C.html" title="The EUser High Level (EUserHL) library is a general purpose user library that provides a usability layer to hide away some of the complexities of the Symbian platform. This section lists the concepts, the overview and the tutorials that helps the Symbian Developers understand the importance of the EUserHL library.">EUser High Level Library</a> &gt; <a href="GUID-D33EB877-CCCB-527B-8AFC-4A8385C55E78.html" title="The EUser High Level Library tutorials are meant to discuss the usage of the LString and resource management class implementation.">EUser High Level Library Tutorials</a> &gt; </div>
<h1 class="topictitle1">Cleanup
Strategy Tutorial</h1>
<div><p>This tutorial describes the cleanup strategy and provides details
on alternative cleanup strategies. </p>

<div class="p"><p>Before you start, you must: </p>
 <ul>
<li id="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-18CD0776-EEA9-56AF-9E5F-E5101BB88643"><a name="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-18CD0776-EEA9-56AF-9E5F-E5101BB88643"><!-- --></a><p> <strong>Deafult cleanup
strategies:</strong> These are based on a template-based implementation of the
strategy design pattern. </p>
 </li>

<li id="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-598FF730-0C91-51C4-B9AA-16B74137BB6E"><a name="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-598FF730-0C91-51C4-B9AA-16B74137BB6E"><!-- --></a><p> <strong>Alternative cleanup
strategies:</strong> These can be specified as an optional template parameter of
the class templates for automatic resource management. </p>
 </li>

</ul>
 </div>

<div class="section"><p>Cleanup strategy is based on a template-based implementation of
the Strategy design pattern. The strategy design pattern is one of the most
popular, highly recommended design patterns. The vast majority of the competent
C++ developers are already familiar with the strategy (Policy) design pattern
and Policy-based design, which should improve the usability of these class
templates. </p>
 <p>Each
resource management class has a default cleanup strategy that is invoked when
the managing object goes out of scope. It is however possible to define an
alternative cleanup strategy when constructing the managing object. It is
also possible to define a custom cleanup strategy using the <a href="GUID-CE0F22BA-8789-3659-87C4-164EB5862B4C.html"><span class="apiname">DEFINE_CLEANUP_FUNCTION</span></a> macro. </p>
 <p> <strong>Note:</strong> Although
the examples below use LCleanedupX classes, the method for definfing how the
object is cleaned up is equally applicable to LManagedX classes. </p>
 <p>An
example code snippet is given below: </p>
 <pre class="codeblock" id="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-DE45C250-C8C5-5210-B53C-D9256F00194B"><a name="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-DE45C250-C8C5-5210-B53C-D9256F00194B"><!-- --></a>
//Class definition of trivial R-Class
class RSimple
    {
public:

    RSimple(){iData = NULL;}

    void Open(TInt aValue)
        {
        iData = new(ELeave) TInt(aValue);
        }

    //Cleanup function – frees resource
    void Close()
        {
        delete iData;
        iData = NULL;
        }

    //Cleanup function – frees resource
    void Free()
        {
        delete iData;
        iData = NULL;
        }

    //Cleanup function – frees resource
    void ReleaseData()
        {
        delete iData;
        iData = NULL;
        }

    //static cleanup function – frees aRSimple resources
    static void Cleanup(TAny* aRSimple)
        {
        static_cast RSimple* (aRSimple)-&gt;Close();
        }
private:
    Tint* iData;

    };

</pre>
 <p>The above RSimple class has three cleanup member functions,
Close, Free and ReleaseData. </p>
 <p>Each resource management class has a
default cleanup strategy that is invoked when the managing object goes out
of scope. The default cleanup strategy is dependent on the managing type.
Consider the example code snippet below: </p>
 <p> <strong>Note:</strong> Although the
examples below use LManagedX classes, the method for defining a custom cleanup
strategy is equally applicable to LCleanedupX classes. </p>
 <pre class="codeblock" id="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-7D4F639F-3BEA-59CD-BA75-DF1C25175BA3"><a name="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-7D4F639F-3BEA-59CD-BA75-DF1C25175BA3"><!-- --></a>
class CTicker : public CBase
    {
public:
    void Tick() { ++iTicks; }
    void Tock() { ++iTocks; }

    void Zap() { delete this; }

public:
    TInt iTicks;
    TInt iTocks;
    };


class CManagedUserSinglePhase : public CBase
    {
public:
    . . .

    ~CManagedUserSinglePhase()
        {
        // The iTicker manager will automatically delete the CTicker
        // The iTimer manager will automatically Close() the RTimer
        }

    . . .
private:
    // We have to use LManagedXxx for fields, not LCleanedupXxx
    LManagedPtr CTicker iTicker;
    LManagedHandle RTimer iTimer;
    };
</pre>
 <p>The default cleanup strategy for an LManagedPtr is to delete
the pointer and this is the action taken in the destructor for CManagedUserSinglePhase. </p>
 <p>Alternate
cleanup strategies are pre-defined in <span class="filepath">emanaged.h</span> file.
It is also possible to define a custom alternate cleanup strategy that can
be passed as the second template parameter to the constructor of an LManagedX
or LCleanedupX object. </p>
 <p>Although the examples below use LManagedX classes,
the method for defining an alternate cleanup strategy is equally applicable
to LCleanedupX classes. </p>
 <p>The default cleanup strategy is to call <a href="GUID-91F3C4E0-5687-366D-9D50-D710E763F0CF.html#GUID-91F3C4E0-5687-366D-9D50-D710E763F0CF__GUID-29E73AC7-D397-3237-ABF9-C93C0AD39543"><span class="apiname">CTicker::Zap()</span></a> function.
It is possible however to define a custom alternate cleanup strategy as shown
below: </p>
 <pre class="codeblock" id="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-5B268C52-2708-50CF-8070-0896C8CE80C0"><a name="GUID-3799F0DA-B99C-55BB-B44F-63B971DF1865__GUID-5B268C52-2708-50CF-8070-0896C8CE80C0"><!-- --></a>
// Defines a custom pointer cleanup policy that calls the Zap member
template &lt;class T&gt;
class TTickerZap 
    {
public:
    static void Cleanup(T* aPtr)
        {
        // The general template/class scaffolding remains the same
        // for all custom cleanups, just this cleanup body varies
        aPtr-&gt;Zap();
        test.Printf(_L("Zapped CTicker\n"));
        }
    };
</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-D33EB877-CCCB-527B-8AFC-4A8385C55E78.html" title="The EUser High Level Library tutorials are meant to discuss the usage of the LString and resource management class implementation.">EUser High Level Library Tutorials</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-B007634D-4D55-528A-8B85-6120C633AC8B.html">EUser High
Level Overview</a></div>
<div><a href="GUID-A18153C0-230C-51FB-9384-A48BB4E42F03.html" title="The support for custom cleanup strategies is based on a template-based implementation of the Strategy design pattern. Cleanup strategies can be specified as an optional template parameter of the class templates for automatic resource management.">Clean-up
Strategy</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>