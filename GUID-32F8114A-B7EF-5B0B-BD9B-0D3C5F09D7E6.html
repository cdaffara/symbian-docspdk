<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Attachment Support"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A60C4549-9FAA-496A-B743-D395A461B61F.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F22B8035-CD08-4181-B03A-759E92CA967B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-00631ED2-1B7F-5FC4-9E81-4B6DF7946631.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A60C4549-9FAA-496A-B743-D395A461B61F.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Attachment Support</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2858252 id2858283 id2858368 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-F22B8035-CD08-4181-B03A-759E92CA967B.html">Organizer Guide</a> &gt; <a href="GUID-00631ED2-1B7F-5FC4-9E81-4B6DF7946631.html">Calendar Guide</a> &gt; <a href="GUID-A60C4549-9FAA-496A-B743-D395A461B61F.html">Tutorials</a> &gt; </div>
<h1 class="topictitle1"> Attachment Support</h1>
<div><div class="section"><h2 class="sectiontitle">Overview</h2> <p>A calendar entry has any number of attachments associated with it. These attachments are URI or file attachments. See the <a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalAttachment</span></a> in-source documentation for more details about attachments. </p>
 <p>The <a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalAttachment</span></a> class allows access to the attachment content itself and associated metadata. This can be either a URI (RFC 3986) or a file attachment, which must be specified on creation. A URI attachment requires a descriptor containing the URI. </p>
 <p>A file attachment can be specified as either a descriptor containing the binary data or as a file handle. Attachment data (URI and binary data) cannot be changed once an attachment has been created. This does not include metadata properties that are modifiable through the <a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalAttachment</span></a> APIs. </p>
 <p>File attachments may also have only a content ID on creation. This is true in cases when a vCalendar or iCalendar (RFC 2445) is imported as part of a message. The content ID refers to the attachment file located elsewhere in the message. The attachment data must be set using <a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalAttachment::SetResourceL()</span></a> before the attachment can be stored. </p>
 </div>
 <div class="section"><h2 class="sectiontitle">Use Cases</h2> <p>This section describes the following use cases: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-14E8B83C-6F63-56C4-A672-5A50B4CAD381"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-14E8B83C-6F63-56C4-A672-5A50B4CAD381"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-AC5D827C-359B-5F97-8F2C-7BC6B5AA3EB3">Add an attachment to a calendar entry from a file handle</a>  </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-B415BB85-7942-51BE-A969-F9C55E9694E6"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-B415BB85-7942-51BE-A969-F9C55E9694E6"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-8529CEF3-8863-59F7-8CF6-365270F4E11D">Add an attachment to a calendar entry from binary data</a>  </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-BBCD52DC-BEB9-5745-8D5F-B3D39135D4C5"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-BBCD52DC-BEB9-5745-8D5F-B3D39135D4C5"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-505A8D56-F4BD-5606-85DF-2578F5BC3B94">Add a URI attachment to calendar entry</a>  </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-6A40BA58-7B5B-5A0D-94B0-52B9590E4ADB"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-6A40BA58-7B5B-5A0D-94B0-52B9590E4ADB"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-4527435C-4FB8-5A43-B873-01207745A191">Create an email message with a calendar entry and attachment</a>  </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-5B9408E7-B79D-58D1-9D1F-39E3CA4C43D6"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-5B9408E7-B79D-58D1-9D1F-39E3CA4C43D6"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-35BC5CE7-05B2-5BA9-91BD-07028A2BE37D">Receive an email message with a calendar entry and attachment</a>  </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-ACAA17AB-EC1C-5200-A6DA-A0945B95029C"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-ACAA17AB-EC1C-5200-A6DA-A0945B95029C"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-6FDD80AE-5AB7-5E52-814E-A7AD16FEECE3"> Fetch a calendar attachment as binary data</a>  </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-08DA481D-E2BB-5520-923C-09C5BABC60BE"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-08DA481D-E2BB-5520-923C-09C5BABC60BE"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D6388AA9-4DAA-5E32-827C-0CC49C6F0646">Fetch a file handle of a calendar attachment</a>  </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D6803691-9933-5C00-BCAD-F04E6BE533FB"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D6803691-9933-5C00-BCAD-F04E6BE533FB"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-41FECE9A-E430-5220-9E6E-3CEB7EE3962C">Remove an attachment from a calendar entry</a>  </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D86300DF-B77E-50CA-9A2E-09D1F55FCA75"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D86300DF-B77E-50CA-9A2E-09D1F55FCA75"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-F3236480-45BF-51A0-9DA6-146AD1449F98">List all file attachments in order of size</a>  </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-422B9A83-B4D8-5312-8D94-224DD6943BF2"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-422B9A83-B4D8-5312-8D94-224DD6943BF2"><!-- --></a><p><a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-ECB0F0B7-69FE-5CA5-819F-28742012F05C"> Do not export file attachments within vCalendar / iCalendar if they are above a certain size</a>  </p>
 </li>
 </ul>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-AC5D827C-359B-5F97-8F2C-7BC6B5AA3EB3"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-AC5D827C-359B-5F97-8F2C-7BC6B5AA3EB3"><!-- --></a><h2 class="sectiontitle">Add an attachment to a calendar entry from a file handle</h2> <p>This use case is intended for a Calendar UI application if there is an option to attach a file to a calendar entry. To add a file attachment to a calendar entry, using a file handle: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-5A19E44A-71C6-5297-B1E7-BC29E2C8530C"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-5A19E44A-71C6-5297-B1E7-BC29E2C8530C"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-FEA617A2-3CAF-5C68-9248-1DD5F50C17D6"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-FEA617A2-3CAF-5C68-9248-1DD5F50C17D6"><!-- --></a><p>Fetch a calendar entry. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-CA8EFD63-B26F-5D10-9070-9E312530F19F"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-CA8EFD63-B26F-5D10-9070-9E312530F19F"><!-- --></a><p>Create a file of any type and obtain its file handle. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-590D4AED-E1DE-5008-A4CA-987FFF4FD8BC"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-590D4AED-E1DE-5008-A4CA-987FFF4FD8BC"><!-- --></a><p>Add the file to the calendar entry (see example code below). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-DAEF0579-B54F-5CDC-9484-D2B646DE7C74"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-DAEF0579-B54F-5CDC-9484-D2B646DE7C74"><!-- --></a><p>Store the calendar entry. When the entry is stored the file is moved to the calendar store. </p>
 </li>
 </ol>
 <p> <strong>Example code: </strong>  </p>
 <p>Preconditions: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-3E6BD495-2394-5E96-8E27-51206D9969FB"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-3E6BD495-2394-5E96-8E27-51206D9969FB"><!-- --></a><p> <em>iFs</em> is an open session to the file server (RFs). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-2DAB2C25-F341-5DE3-B484-611F1CDBB4DF"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-2DAB2C25-F341-5DE3-B484-611F1CDBB4DF"><!-- --></a><p> <em>attachmentFileName</em> is the file name of the attachment to be added (a descriptor). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-6A9A9709-3182-50C8-948F-55EEA818A040"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-6A9A9709-3182-50C8-948F-55EEA818A040"><!-- --></a><p> <em>label</em> is a label name to be given to the attachment (a descriptor). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-0244A06A-688B-5E25-ACF5-3AFB340CFFAF"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-0244A06A-688B-5E25-ACF5-3AFB340CFFAF"><!-- --></a><p> <em>calEntry</em> is a calendar entry (<a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalEntry</span></a>) to which the attachment is added, on the cleanup stack. </p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-DF927A16-1794-53AC-8206-DE3B5D6258A9"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-DF927A16-1794-53AC-8206-DE3B5D6258A9"><!-- --></a>
User::LeaveIfError(iFs.ShareProtected());
RFile fileHandle;
fileHandle.Open(iFs, attachmentFileName, EFileWrite);
CleanupClosePushL(fileHandle);
// create attachment and add to calendar entry
CCalAttachment* attachment = CCalAttachment::NewFileL(fileHandle);
CleanupStack::PopAndDestroy(&amp;fileHandle);
CleanupStack::PushL(attachment);
// set attachment properties
attachment-&gt;SetLabelL(label);
...
calEntry-&gt;AddAttachmentL(*attachment); // calEntry takes ownership
CleanupStack::Pop(attachment);
</pre>
 <p>Note that the file selected is moved to the Calendar store and no longer exists in its current location. In effect the Calendar takes ownership of it. </p>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-8529CEF3-8863-59F7-8CF6-365270F4E11D"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-8529CEF3-8863-59F7-8CF6-365270F4E11D"><!-- --></a><h2 class="sectiontitle">Add an attachment to a calendar entry from binary data</h2> <p>This use case is intended for a messaging or sync application when importing a calendar entry that has an attachment as binary data. </p>
 <p>To add a file attachment to a calendar entry from binary data: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-245D6927-C45B-5F60-9AD0-C6BA40B029C8"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-245D6927-C45B-5F60-9AD0-C6BA40B029C8"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A4E37DA8-5071-59F8-9CF9-8E9550B36075"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A4E37DA8-5071-59F8-9CF9-8E9550B36075"><!-- --></a><p>Fetch a calendar entry. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-9918F234-E8E6-593E-B12F-322D2B35B0AF"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-9918F234-E8E6-593E-B12F-322D2B35B0AF"><!-- --></a><p>Fetch the binary data of the attachment. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-C8FDE825-16D2-569C-BEC9-3B846418DF62"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-C8FDE825-16D2-569C-BEC9-3B846418DF62"><!-- --></a><p>Add the binary data to the calendar entry (see example code below). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E373AF7C-EDFC-56E2-B0A0-60F0ACD9C609"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E373AF7C-EDFC-56E2-B0A0-60F0ACD9C609"><!-- --></a><p>Store the calendar entry. When the entry is stored the attachment is added to the calendar store. </p>
 </li>
 </ol>
 <p> <strong>Example code:</strong>  </p>
 <p>Preconditions: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-06C3257A-BC26-59F7-851B-21DA97475FE2"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-06C3257A-BC26-59F7-851B-21DA97475FE2"><!-- --></a><p> <em>binaryData</em> is the binary data of the attachment to be added (an 8-bit descriptor). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-03CC01F9-2719-52A2-B44F-119B632EF887"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-03CC01F9-2719-52A2-B44F-119B632EF887"><!-- --></a><p> <em>label</em> is a label name to be given to the attachment (a descriptor). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-618031F1-8F30-55C7-AB37-462324E881E4"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-618031F1-8F30-55C7-AB37-462324E881E4"><!-- --></a><p> <em>calEntry</em> is a calendar entry (<a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalEntry</span></a>) to which the attachment is added, on the cleanup stack. </p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-12C5BFF1-F271-5624-AA8D-D5187C91CB4B"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-12C5BFF1-F271-5624-AA8D-D5187C91CB4B"><!-- --></a>CCalAttachment* attachment = CCalAttachment::NewFileL(binaryData);
CleanupStack::PushL(attachment); 
// set attachment properties
attachment-&gt;SetLabelL(label);
...
calEntry-&gt;AddAttachmentL(*attachment); // calEntry takes ownership
CleanupStack::Pop(attachment);</pre>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-505A8D56-F4BD-5606-85DF-2578F5BC3B94"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-505A8D56-F4BD-5606-85DF-2578F5BC3B94"><!-- --></a><h2 class="sectiontitle">Add a URI attachment to calendar entry</h2> <p>This use case could happen in a sync application when importing a calendar entry, or in a Calendar UI application if a user selects a URI to attach to a calendar entry. </p>
 <p>To add a URI attachment to a calendar entry: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-BA79150C-F82D-559B-8107-BF40338C4EA6"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-BA79150C-F82D-559B-8107-BF40338C4EA6"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A00B4541-3178-5EF2-A312-54535E2390DC"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A00B4541-3178-5EF2-A312-54535E2390DC"><!-- --></a><p>Fetch a calendar entry. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-B3DD72D0-7876-5D8E-8CD5-603804D7B9E5"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-B3DD72D0-7876-5D8E-8CD5-603804D7B9E5"><!-- --></a><p>Get the URI as an 8-bit descriptor. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-85ADA54F-D158-5539-8DC9-64E06718F540"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-85ADA54F-D158-5539-8DC9-64E06718F540"><!-- --></a><p>Add the URI to the calendar entry (see example code below). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-5A7EF89C-678A-506E-946B-FFAA190B5027"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-5A7EF89C-678A-506E-946B-FFAA190B5027"><!-- --></a><p>Store the calendar entry. </p>
 </li>
 </ol>
 <p> <strong>Example code:</strong>  </p>
 <p>Preconditions: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-01BC1013-62F9-5C88-9A1C-05AEADD28D1A"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-01BC1013-62F9-5C88-9A1C-05AEADD28D1A"><!-- --></a><p> <em>uriAttachment</em> is the URI link of the attachment to be added (an 8-bit descriptor). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-97B3673F-5455-5027-82C5-C68743034201"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-97B3673F-5455-5027-82C5-C68743034201"><!-- --></a><p> <em>label</em> is a label name to be given to the attachment (a descriptor). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-130FB7D5-4F3D-5FA7-8F63-D35C1B75764B"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-130FB7D5-4F3D-5FA7-8F63-D35C1B75764B"><!-- --></a><p> <em>calEntry</em> is a calendar entry (<a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalEntry</span></a>) to which the attachment is added, on the cleanup stack. </p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-1B7C279D-779E-5E45-B661-1D68F0A6E92A"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-1B7C279D-779E-5E45-B661-1D68F0A6E92A"><!-- --></a>CCalAttachment* attachment = CCalAttachment::NewUriL(uriAttachment); 
CleanupStack::PushL(attachment);
// set attachment properties
attachment-&gt;SetLabelL(label);
...
calEntry-&gt;AddAttachmentL(*attachment); // calEntry takes ownership
CleanupStack::Pop(attachment);</pre>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-4527435C-4FB8-5A43-B873-01207745A191"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-4527435C-4FB8-5A43-B873-01207745A191"><!-- --></a><h2 class="sectiontitle">Create an email message with a calendar entry and attachment</h2> <p>This use case is intended for all messaging applications when exporting a calendar entry that contains an attachment. </p>
 <p>In this case, the message must contain a vCalendar or iCalendar, and the attachment data itself. The location of the attachment data within the message is referenced by a content ID within the vCalendar or iCalendar. This is described in the MIME specification (RFC 2045). </p>
 <p>To create the email message: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-10186C27-7541-5119-AC85-265B0F95067A"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-10186C27-7541-5119-AC85-265B0F95067A"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-093DA452-606D-5E48-8A76-6FF43EFA7982"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-093DA452-606D-5E48-8A76-6FF43EFA7982"><!-- --></a><p>Fetch an entry from calendar store. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-FE977527-CB4B-5E5E-90F8-3B350E788DFC"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-FE977527-CB4B-5E5E-90F8-3B350E788DFC"><!-- --></a><p>Fetch an attachment from the entry. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-F1C8841C-9BC0-5235-8BD1-84D92420CFE4"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-F1C8841C-9BC0-5235-8BD1-84D92420CFE4"><!-- --></a><p>Generate a content ID for attachment. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-BF477528-18BD-548C-9168-C10DC716A854"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-BF477528-18BD-548C-9168-C10DC716A854"><!-- --></a><p>Set the content ID on the calendar attachment object (see example code below). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-72243EAA-FBF2-54B1-9D54-FB31DF64C5FF"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-72243EAA-FBF2-54B1-9D54-FB31DF64C5FF"><!-- --></a><p>Export the entry to a vCalendar or iCalendar. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-74A376D3-F76D-5F87-81A4-F9FAB3595534"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-74A376D3-F76D-5F87-81A4-F9FAB3595534"><!-- --></a><p>Add a vCalendar or iCalendar to the email message. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D9B51660-8D1F-5A17-80E9-FE0248D1C695"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D9B51660-8D1F-5A17-80E9-FE0248D1C695"><!-- --></a><p>Extract the attachment as binary data from the calendar attachment object (see example code in <a href="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6.html#GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-6FDD80AE-5AB7-5E52-814E-A7AD16FEECE3">Fetch a calendar attachment as binary data</a>). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-15167A8C-DD47-55D0-932D-D3384C2D2B41"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-15167A8C-DD47-55D0-932D-D3384C2D2B41"><!-- --></a><p>Add the attachment to email message. </p>
 </li>
 </ol>
 <p> <strong>Example code:</strong>  </p>
 <p>Preconditions: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D0366534-BA97-53FC-AF31-A9ECEDFFFCC0"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D0366534-BA97-53FC-AF31-A9ECEDFFFCC0"><!-- --></a><p> <em>calEntry</em> is a calendar entry (<a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalEntry</span></a>) containing an attachment to be exported, on the cleanup stack. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-0B2BDC63-7317-5FCA-8557-1D9A1A1CDE54"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-0B2BDC63-7317-5FCA-8557-1D9A1A1CDE54"><!-- --></a><p> <em>attachIndex</em> is the index of the attachment in <a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">calEntry</span></a> to be exported (zero if the entry has only one attachment). </p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-C6DD7405-CC61-5158-B67A-41E491436649"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-C6DD7405-CC61-5158-B67A-41E491436649"><!-- --></a>
CCalAttachment* attachment = calEntry-&gt;AttachmentL(attachIndex);
if (attachment-&gt;FileAttachment() != NULL)
     {
     // generate a content ID for the attachment
     ...
     // set the content ID on this attachment
     attachment-&gt;FileAttachment()-&gt;SetContentIdL(contentId);
     }
// export calEntry to create vCalendar / iCalendar
...</pre>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-35BC5CE7-05B2-5BA9-91BD-07028A2BE37D"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-35BC5CE7-05B2-5BA9-91BD-07028A2BE37D"><!-- --></a><h2 class="sectiontitle">Receive an email message with a calendar entry and attachment</h2> <p>This use case is intended for all messaging applications when importing a calendar entry that contains an attachment. </p>
 <p>The message contains a vCalendar or iCalendar, and the attachment data. The location of the attachment data within the message is referenced by a content ID within the vCalendar or iCalendar. This is described in the MIME specification (RFC 2045). </p>
 <p>To extract a calendar entry and a file attachment from an email message: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-9D84270B-D782-51C2-8FD2-72C617EA82D2"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-9D84270B-D782-51C2-8FD2-72C617EA82D2"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-3715F83B-1761-5986-8CC8-6A8D505E4A84"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-3715F83B-1761-5986-8CC8-6A8D505E4A84"><!-- --></a><p>Import the calendar entry from a vCalendar or iCalendar. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E5764A61-9DEC-5360-AB62-7CE26CF43817"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E5764A61-9DEC-5360-AB62-7CE26CF43817"><!-- --></a><p>Fetch the content ID of the entry’s attachment (see example code). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-646950A5-1177-55A5-ACF7-5B778637F50A"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-646950A5-1177-55A5-ACF7-5B778637F50A"><!-- --></a><p>Resolve this content ID and fetch the attachment as a file handle. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-FDE04657-AB83-53B9-AE8C-F1C44D394EF5"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-FDE04657-AB83-53B9-AE8C-F1C44D394EF5"><!-- --></a><p>Add the file handle to the calendar entry (see example code). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A55DCF1E-90E4-5989-8BD7-831A3339B550"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A55DCF1E-90E4-5989-8BD7-831A3339B550"><!-- --></a><p>Store the calendar entry. </p>
 </li>
 </ol>
 <p> <strong>Example code:</strong>  </p>
 <p>Preconditions: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-42F489F0-2805-58F3-AD10-BD7E31C9C0D1"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-42F489F0-2805-58F3-AD10-BD7E31C9C0D1"><!-- --></a><p> <em>calEntry</em> is a calendar entry which has been imported from a vCalendar or iCalendar. It is on the cleanup stack and has a file attachment. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A4966061-8E3C-5169-8A98-0A32A1D35DE2"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A4966061-8E3C-5169-8A98-0A32A1D35DE2"><!-- --></a><p> <em>attachIndex</em> is the index of a file attachment in the calendar entry. </p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-B7E20D86-FDB5-5557-9509-67A498AA46D0"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-B7E20D86-FDB5-5557-9509-67A498AA46D0"><!-- --></a>
CCalAttachment* attachment = calEntry-&gt;AttachmentL(attachIndex);
// check this is a file attachment with a content ID
if (attachment-&gt;FileAttachment() != NULL &amp;&amp; attachment-&gt; FileAttachment()-&gt;ContentId().Length() &gt; 0)
        { 
     RFile fileHandle;
     // resolve the content ID to find the attachment file handle 
     ...
     // set the file handle on this attachment
     attachment-&gt;FileAttachment()-&gt;SetResourceL(fileHandle);
        }</pre>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-6FDD80AE-5AB7-5E52-814E-A7AD16FEECE3"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-6FDD80AE-5AB7-5E52-814E-A7AD16FEECE3"><!-- --></a><h2 class="sectiontitle">Fetch a calendar attachment as binary data</h2> <p>This use case is intended for a messaging or sync application when exporting a file attachment as binary data. </p>
 <p>To fetch an attachment from a calendar entry and extract the content as binary data: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-9ED4608B-D64A-5613-A933-E89E8C3B7D27"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-9ED4608B-D64A-5613-A933-E89E8C3B7D27"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A99774F3-8B1B-56DB-822C-14B136496C83"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A99774F3-8B1B-56DB-822C-14B136496C83"><!-- --></a><p>Fetch a calendar entry from the database. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-C1B3358F-3974-595B-9141-ED7C1B86D6D2"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-C1B3358F-3974-595B-9141-ED7C1B86D6D2"><!-- --></a><p>Fetch the attachment’s binary data (see example code). </p>
 </li>
 </ol>
 <p> <strong>Example code: </strong>  </p>
 <p>Preconditions: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A506AA6E-E06B-5832-8D45-E13B31C389DD"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-A506AA6E-E06B-5832-8D45-E13B31C389DD"><!-- --></a><p> <em>calEntry</em> is a calendar entry which has been fetched from the calendar store, and placed on the cleanup stack. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-795928AD-52B9-5E34-8658-E0D6938A154C"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-795928AD-52B9-5E34-8658-E0D6938A154C"><!-- --></a><p> <em>attachIndex</em> is a valid index of an attachment on this entry. </p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-3432B244-1050-569D-9975-FA982C6218BC"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-3432B244-1050-569D-9975-FA982C6218BC"><!-- --></a>
CCalAttachment* attachment = calEntry-&gt;AttachmentL(attachIndex);
if (attachment-&gt;FileAttachment() != NULL)
     {
     attachment-&gt;FileAttachment()-&gt;LoadBinaryDataL(); // fetches data
     const TDesC8&amp; KBinaryData = attachment-&gt;Value();
     // KBinaryData contains the binary data of this attachment
     ...
     }
else
     {
     const TDesC8&amp; KUri = attachment-&gt;Value();
     // KUri contains the URI of this attachment
     ...
        }</pre>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D6388AA9-4DAA-5E32-827C-0CC49C6F0646"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D6388AA9-4DAA-5E32-827C-0CC49C6F0646"><!-- --></a><h2 class="sectiontitle">Fetch a file handle of a calendar attachment</h2> <p>This use case is intended for a calendar application to open an attachment file from a calendar entry. </p>
 <p>To fetch a file attachment from a calendar entry and open it: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-354116F5-A0B6-5221-A0DA-44863532B79F"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-354116F5-A0B6-5221-A0DA-44863532B79F"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-2DCC5C29-3464-5D1A-8F83-DF6627CBF839"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-2DCC5C29-3464-5D1A-8F83-DF6627CBF839"><!-- --></a><p>Fetch the calendar entry from the database. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-38FF533D-54A2-5E74-857D-53F245900349"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-38FF533D-54A2-5E74-857D-53F245900349"><!-- --></a><p>Fetch the file handle (see example code). Note that the file handle is read-only. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-858BB3AE-6F8C-5843-B9AC-A46AEA84E0C3"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-858BB3AE-6F8C-5843-B9AC-A46AEA84E0C3"><!-- --></a><p>Open the file from its file handle. </p>
 </li>
 </ol>
 <p> <strong>Example code: </strong>  </p>
 <p>Preconditions: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-4020EF55-CEC6-5934-B652-DCC68F652BEB"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-4020EF55-CEC6-5934-B652-DCC68F652BEB"><!-- --></a><p> <em>calEntry</em> is a calendar entry which has been fetched from the calendar store, and placed on the cleanup stack. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-113C0A61-6AE1-547B-A27D-9D2F7BD1158C"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-113C0A61-6AE1-547B-A27D-9D2F7BD1158C"><!-- --></a><p> <em>attachIndex</em> is a valid index of a file attachment on this entry. </p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-C9435F74-6D7B-55AC-A3E2-52C0C5DD9CEF"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-C9435F74-6D7B-55AC-A3E2-52C0C5DD9CEF"><!-- --></a>
CCalAttachment* attachment = calEntry-&gt;AttachmentL(attachIndex);
if (attachment-&gt;FileAttachment() != NULL)
     {
     RFile fileHandle;
     attachment-&gt;FileAttachment()-&gt;FetchFileHandleL(fileHandle);
     // fileHandle is a read-only file handle to this attachment
     ...
        }</pre>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-41FECE9A-E430-5220-9E6E-3CEB7EE3962C"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-41FECE9A-E430-5220-9E6E-3CEB7EE3962C"><!-- --></a><h2 class="sectiontitle">Remove an attachment from a calendar entry</h2> <p>To remove an attachment from a calendar entry: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-9E7C9370-4CFD-521C-A128-DDB4166F5221"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-9E7C9370-4CFD-521C-A128-DDB4166F5221"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D6492233-C125-594E-93D7-5512823F3883"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D6492233-C125-594E-93D7-5512823F3883"><!-- --></a><p>Fetch a calendar entry with an attachment from the calendar store. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-3292823C-ED53-5B47-B677-180A21B57DB0"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-3292823C-ED53-5B47-B677-180A21B57DB0"><!-- --></a><p>Remove an attachment (see example code). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-80BED7A0-3CC4-5274-85F3-115E71676C4B"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-80BED7A0-3CC4-5274-85F3-115E71676C4B"><!-- --></a><p>Store the entry. The attachment is removed from the calendar store when the entry is stored. </p>
 </li>
 </ol>
 <p> <strong>Example code:</strong>  </p>
 <p>Preconditions: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-5AFDDE52-6468-5B77-AA26-71A90B0DA666"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-5AFDDE52-6468-5B77-AA26-71A90B0DA666"><!-- --></a><p> <em>calEntry</em> is a calendar entry which has been fetched from the calendar store, on the cleanup stack. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D91761FD-A1A0-52CA-8F74-CEF97F70DA88"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D91761FD-A1A0-52CA-8F74-CEF97F70DA88"><!-- --></a><p> <em>attachIndex</em> is the index of the file attachment to be deleted on this entry. </p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-680B3603-9B17-54FE-ABD2-3DD6367799E9"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-680B3603-9B17-54FE-ABD2-3DD6367799E9"><!-- --></a>
CCalAttachment* attachment = calEntry-&gt;AttachmentL(attachIndex);
calEntry-&gt;DeleteAttachmentL(*attachment);</pre>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-F3236480-45BF-51A0-9DA6-146AD1449F98"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-F3236480-45BF-51A0-9DA6-146AD1449F98"><!-- --></a><h2 class="sectiontitle">List all file attachments in order of size</h2> <p>To find all file attachments in order of size to be displayed on a user dialog: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E9CB4D8D-28BC-5F7A-BEE6-B69A77490B5A"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E9CB4D8D-28BC-5F7A-BEE6-B69A77490B5A"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-DDE59FCA-9856-59B6-813B-E301FC51BAF4"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-DDE59FCA-9856-59B6-813B-E301FC51BAF4"><!-- --></a><p>Create an attachment iterator. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-188A1BF6-F1DF-55AA-8035-47AB76C22326"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-188A1BF6-F1DF-55AA-8035-47AB76C22326"><!-- --></a><p>Fetch each attachment held by the iterator (sorted in order of size). </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-097E77D3-E723-5594-A0F8-2DD0B446B01F"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-097E77D3-E723-5594-A0F8-2DD0B446B01F"><!-- --></a><p>Fetch details about all file attachments. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D32AB8C8-D78F-5C32-9E4C-5EC06E6E8C75"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-D32AB8C8-D78F-5C32-9E4C-5EC06E6E8C75"><!-- --></a><p>Display details in UI. </p>
 </li>
 </ol>
 <p> <strong>Example code:</strong>  </p>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E1D7D56A-7A83-5D8A-A01A-6F78CDF104C5"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E1D7D56A-7A83-5D8A-A01A-6F78CDF104C5"><!-- --></a>
CCalAttachmentIterator* attachmentIterator = iCalAttachmentManager-&gt; FetchAttachmentsL(CCalAttachmentManager::ESortBySizeLargestFirst);
CleanupStack::PushL(attachmentIterator);
while (attachmentIterator-&gt;HasMore())
  {
  CCalAttachment* attachment = attachmentIterator-&gt;NextL();
  CleanupStack::PushL(attachment); 
  // display attachment details
  ...
  CleanupStack::PopAndDestroy(attachment);
  }</pre>
 <p>Note that it may be useful to take ownership of the <a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalAttachment</span></a> objects returned from the iterator if it is possible to carry out further actions. For example, if there is a delete option on the attachment dialog, the attachment metadata object is required to fetch the associated entry and remove the attachment. </p>
 </div>
 <div class="section" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-ECB0F0B7-69FE-5CA5-819F-28742012F05C"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-ECB0F0B7-69FE-5CA5-819F-28742012F05C"><!-- --></a><h2 class="sectiontitle"> Do not export file attachments within vCalendar and iCalendar if they are above a certain size</h2> <p>This use case is intended for sync applications. </p>
 <p>When file attachments are exported in a vCalendar by AgnVersit, they are always exported as binary data unless the ‘do not export inline’ flag is set. This flag may be set on any attachment. </p>
 <p>AgnVersit does not make any checks to see if a file is too big to be exported. However, if an out of memory error occurs while exporting binary data, the binary data is ignored as if the ‘do not export inline’ flag had been set. </p>
 <p>To find all file attachments above a certain size and flag these attachments as ‘do not export inline’: </p>
 <a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E72D34B6-ED1C-51C2-8B72-30A180957E36"><!-- --></a><ol id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E72D34B6-ED1C-51C2-8B72-30A180957E36"><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-7EB197D4-B4C8-57EE-A6D2-9209FB4D48A2"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-7EB197D4-B4C8-57EE-A6D2-9209FB4D48A2"><!-- --></a><p>Fetch details about all file attachments, sorted in order of size. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-496E9346-6037-50EB-A3F2-826BE463717C"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-496E9346-6037-50EB-A3F2-826BE463717C"><!-- --></a><p>If the file attachment is greater than a certain size, modify its attributes so it is not exported inline. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E688975F-F388-51CA-B30D-E0ABAF22A005"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-E688975F-F388-51CA-B30D-E0ABAF22A005"><!-- --></a><p>Update the calendar entry with this modified attachment metadata. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-48F125E0-7FDA-5940-9992-420D2F38265D"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-48F125E0-7FDA-5940-9992-420D2F38265D"><!-- --></a><p>Store the entry. </p>
 </li>
 </ol>
 <p>Note that it is possible to set the ‘do not export inline’ flag for one synchronisation only. In this case, the attachment’s flag can be set on the entry immediately before exporting, without storing the entry in the database. This ensures that other synchronisation clients are unaffected. This approach does not require the <a href="GUID-725D11A2-8805-3466-98DB-EF5CDEAF2801.html"><span class="apiname">CCalAttachmentManager</span></a>, instead the client needs to check all entries for their attachments over a certain size. </p>
 <p> <strong>Example code:</strong>  </p>
 <p>Preconditions: </p>
 <ul><li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-FAF08BFD-AE10-5572-9E15-E1AA8160B2F9"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-FAF08BFD-AE10-5572-9E15-E1AA8160B2F9"><!-- --></a><p> <em>KSizeThreshold</em> is the size in bytes above which an attachment must not be exported. </p>
 </li>
 <li id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-EF1FEC9A-F234-594E-815A-65D18D0B7F22"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-EF1FEC9A-F234-594E-815A-65D18D0B7F22"><!-- --></a><p> <em>iCalAttachmentManager</em> is the open calendar attachment manager. </p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-BDEE1742-A44C-5E98-B16C-7512522B8A66"><a name="GUID-32F8114A-B7EF-5B0B-BD9B-0D3C5F09D7E6__GUID-BDEE1742-A44C-5E98-B16C-7512522B8A66"><!-- --></a>
// fetch file attachments in an iterator in size order, largest first
CCalAttachmentIterator* attachmentIterator = iCalAttachmentManager-&gt; FetchAttachmentsL(CCalAttachmentManager::ESortBySizeLargestFirst);
CleanupStack::PushL(attachmentIterator); 
while (attachmentIterator-&gt;HasMore())
  {
  // fetch next attachment from iterator
  CCalAttachment* attachment = attachmentIterator-&gt;NextL();
  CleanupStack::PushL(attachment);
  if (attachment-&gt;FileAttachment() != NULL)
       {
    // get the attachment size
       const TInt KAttachSize = attachment-&gt;FileAttachment()-&gt;Size();
       if (KAttachSize &lt; KSizeThreshold)
         {
         // if an attachment whose size is smaller than the threshold is reached, stop iterating – attachments are in size order so there are no more attachments which are greater than the threshold
         break;
         }
       else
         {
         // this attachment has a size greater than the threshold
         RArray&lt;TCalLocalUid&gt; localUids;
         CleanupClosePushL(localUids);
         // get the IDs of entries associated with this attachment
         iCalAttachmentManager-&gt;EntriesReferencingFileAttachmentL (localUids, *attachment);
            for (TInt I = 0; I &lt; localUids.Count(); ++I)
              {
              // fetch each entry associated with the attachment (usually there is only one)
              CCalEntry* calEntry = iEntryView-&gt;FetchL(localUids[i]); 
              CleanupStack::PushL(calEntry); 
        // modify the attachment’s metadata in order not to export inline
              calEntry-&gt;DeleteAttachmentL(*attachment);
              attachment-&gt;ClearAttribute(CCalAttachment::EExportInline);
              calEntry-&gt;AddAttachmentL(*attachment);
              // store the entry with the modified attachment
              ...
              CleanupStack::PopAndDestroy(calEntry);
              }
            CleanupStack::PopAndDestroy(&amp;localUids);
         }
       }
  CleanupStack::PopAndDestroy(attachment);
  }
CleanupStack::PopAndDestroy(attachmentIterator);</pre>
 </div>
 <div class="section"><h2 class="sectiontitle">Implementation Considerations </h2> <p> <strong>Error condition handling: </strong> See in-source documentation for expected error codes. </p>
 <p> <strong>Performance: </strong> Creating large attachments results in a lot of memory being taken up. However, storing entries containing these attachments is only slightly slower than storing entries without attachments because the entire attachment is not passed over IPC. File handles are passed over IPC instead. </p>
 <p> <strong>Security: </strong> The use of file handle transfer ensures that no user can modify an attachment in the calendar store. Users need ReadUserData capability to read attachment data, which is in a read-only format. </p>
 </div>
 </div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-A60C4549-9FAA-496A-B743-D395A461B61F.html">Tutorials</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>