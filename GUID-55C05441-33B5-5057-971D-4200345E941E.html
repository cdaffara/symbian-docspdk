<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Kernel Trace Tool Tutorial"/>
<meta name="abstract" content="Describes how to use the kernel trace tool component."/>
<meta name="description" content="Describes how to use the kernel trace tool component."/>
<meta name="DC.Relation" scheme="URI" content="GUID-4237DA8E-225A-58C7-B136-3AF7C3D92CF9.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-52371DAB-A231-558C-B3E6-220DAAEE566B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3F8D9A3F-FA9E-5CFB-A58A-D71CA3686900.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-4237DA8E-225A-58C7-B136-3AF7C3D92CF9.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7EA3FAD3-9A41-5B2D-8F46-8C8965CE8B97.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7B477BA5-CC5B-56A2-82BC-E1BC0049FECB.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F27F49B3-4AC1-5517-AF3A-1ADBA1E87A0B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9E0957A1-0691-5741-ABCA-3EA61B4AC0CD.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5CEA46BA-5AA2-51B4-8BBA-5B6EF141D68A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7195C3C2-6DF4-56DE-B3C7-00CC10A22AD2.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-625A116D-185D-57A3-9FB7-B8257F4AB1B2.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2341CFE1-1CDF-537A-99FB-78C59FFA30CE.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-55C05441-33B5-5057-971D-4200345E941E"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Kernel Trace Tool Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-55C05441-33B5-5057-971D-4200345E941E"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2400778 id2401942 id2401957 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-52371DAB-A231-558C-B3E6-220DAAEE566B.html" title="Provides software components that implement the interface between Symbian platform and peripherals.">Logical Device Drivers</a> &gt; <a href="GUID-3F8D9A3F-FA9E-5CFB-A58A-D71CA3686900.html" title="The Kernel Trace Tool allows developers to trace Kernel commands.">Kernel Trace Tool</a> &gt; <a href="GUID-4237DA8E-225A-58C7-B136-3AF7C3D92CF9.html" title="Provides information about the Kernel Trace Tool.">Kernel Trace Tool Guide</a> &gt; </div>
<h1 class="topictitle1">Kernel
Trace Tool Tutorial</h1>
<div><p>Describes how to use the kernel trace tool component. </p>

<div class="section" id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-FA780BFA-B9B5-4397-85E1-8D7EF19B6121"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-FA780BFA-B9B5-4397-85E1-8D7EF19B6121"><!-- --></a><h2 class="sectiontitle">Intended audience</h2><p>This document is intended for
application developers writing a trace tool using the kernel trace tool component. </p>
</div>

<div class="section" id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-7D4309D3-FF07-4F2F-A205-C88810F864F2"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-7D4309D3-FF07-4F2F-A205-C88810F864F2"><!-- --></a><h2 class="sectiontitle">Required background</h2><p>A knowledge of the filters defined
in <a href="GUID-8919270A-B5CE-302D-B7CE-3A4680D5E8CF.html"><span class="apiname">EUser</span></a>. </p>
</div>

<div class="section" id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-3E1BBC37-50AA-40FD-820D-C38CC2586684"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-3E1BBC37-50AA-40FD-820D-C38CC2586684"><!-- --></a><h2 class="sectiontitle">Introduction</h2><p>The kernel trace tool is the user side
part of the kernel trace tool component. It provides output to trace tools
such as the command line kernel trace tool. </p>
</div>

<div class="section" id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-D425A6C2-CA94-46DB-BD59-9766F4764227"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-D425A6C2-CA94-46DB-BD59-9766F4764227"><!-- --></a><h2 class="sectiontitle">Using Kernel Trace Tool </h2> <p>The following tasks will
be covered in this tutorial: </p>
<ul>
<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-60D55507-CFE4-5E88-BA28-DAB2DC6DFC77"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-60D55507-CFE4-5E88-BA28-DAB2DC6DFC77"><!-- --></a><p>Reading trace data from
chunks. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-F01A5987-72E9-5B98-85CF-2F97CF8F9C49"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-F01A5987-72E9-5B98-85CF-2F97CF8F9C49"><!-- --></a><p>Writing trace data to
buffers. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-972D05F0-0D3E-5308-9501-C417F21DA07C"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-972D05F0-0D3E-5308-9501-C417F21DA07C"><!-- --></a><p>Setting trace filters. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-ABFE81E7-A5A7-5032-BEF3-F799C4D3456A"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-ABFE81E7-A5A7-5032-BEF3-F799C4D3456A"><!-- --></a><p>Requesting data notification. </p>
 </li>

</ul>
<p>To perform each of these tasks you must include db32trace.h and declare
an <a href="GUID-9E859841-E8A3-37D5-9A19-BCAA3C700922.html"><span class="apiname">RBTrace</span></a> object. </p>
</div>

<div class="section" id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-00692E7E-9C38-4E6C-8FBE-F68FABCC6CF9"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-00692E7E-9C38-4E6C-8FBE-F68FABCC6CF9"><!-- --></a><h2 class="sectiontitle">Basic procedure</h2><p>The high level steps to using the
kernel trace filter are shown here: </p>
<a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-230AC9BB-530E-5053-991F-75B2C595AE99"><!-- --></a><ol id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-230AC9BB-530E-5053-991F-75B2C595AE99">
<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-73BB417B-46B1-5C97-93B5-4EECE7EDAB50"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-73BB417B-46B1-5C97-93B5-4EECE7EDAB50"><!-- --></a><p>Create and set a trace
filter. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-93BD6995-4191-5BBF-B0BF-7D4637BDDB61"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-93BD6995-4191-5BBF-B0BF-7D4637BDDB61"><!-- --></a><p>Read trace data from
kernel side chunks. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-7D1F9180-D4C8-5E56-894A-4E838D0D2E21"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-7D1F9180-D4C8-5E56-894A-4E838D0D2E21"><!-- --></a><p>Write trace data to
the user side buffers. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-A0E93D6D-E7A8-55AD-9B80-FF0B78AC8721"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-A0E93D6D-E7A8-55AD-9B80-FF0B78AC8721"><!-- --></a><p>Request data notification. </p>
 </li>

</ol>
</div>

<div class="section" id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-B92DE10B-AEA3-4A8B-AF88-227DC8BEB519"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-B92DE10B-AEA3-4A8B-AF88-227DC8BEB519"><!-- --></a><h2 class="sectiontitle">Suggested structure</h2> <p>The functions described must
be called in sequence and some of them must be called more than once to read
all the trace data from the buffer. You are recommended to proceed as follows. </p>
 <ul>
<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-6BBBC72D-13F3-5D74-87DB-D7270EE63389"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-6BBBC72D-13F3-5D74-87DB-D7270EE63389"><!-- --></a><p>Create an <a href="GUID-9E859841-E8A3-37D5-9A19-BCAA3C700922.html"><span class="apiname">RBTrace</span></a> object
and call its <a href="GUID-20D0D10F-3401-3F72-8AF6-DC35F6025DC2.html"><span class="apiname">Open()</span></a> function. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-81837837-E9AB-5B39-BB0C-748BDDBD37FD"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-81837837-E9AB-5B39-BB0C-748BDDBD37FD"><!-- --></a><p>Create a loop which
runs for as long as requests for notification of new data return successfully. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-99649087-30EF-549E-9BD7-795D4381C526"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-99649087-30EF-549E-9BD7-795D4381C526"><!-- --></a><p>Create an inner loop
which runs for as long as read operations return data from the buffer. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-7F3DC415-394B-52CE-82DE-51404A3C4B8A"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-7F3DC415-394B-52CE-82DE-51404A3C4B8A"><!-- --></a><p>Within the inner loop
call a function to do something with the data such as write it to a file. </p>
 </li>

<li id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-DF305E63-02E7-5F10-808D-9B02613ED307"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-DF305E63-02E7-5F10-808D-9B02613ED307"><!-- --></a><p>Call the <a href="GUID-01D2AF56-21E1-3FF3-BF86-0C356A1658EF.html"><span class="apiname">Close()</span></a> function
of the <a href="GUID-9E859841-E8A3-37D5-9A19-BCAA3C700922.html"><span class="apiname">RBTrace</span></a> object. </p>
 </li>

</ul>
 <p>It can be useful though it is not necessary to disable trace capture
while processing the data: you do this with calls to <a href="GUID-8307FC8E-C450-3F02-B610-EAC5BBD2503B.html"><span class="apiname">Mode()</span></a> and <a href="GUID-3587C248-34F6-3C65-9220-31C7E97F0C85.html"><span class="apiname">SetMode()</span></a>. </p>
 <pre class="codeblock" id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-9C9F8DD9-D1A4-56D6-8629-E9F4AF710049"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-9C9F8DD9-D1A4-56D6-8629-E9F4AF710049"><!-- --></a>
        RBTrace trace;
        TInt error = trace.Open();
        if(error!=KErrNone)
            return error;
        const TInt KTraceDataBlockSize = 65536; // size of data we ideally want to process in one go
        TUint8* data;
        TInt size;
        do
            {
            while((size=trace.GetData(data))!=0)
                {
                ProcessTheTraceData(data,size);
                trace.DataUsed();
                }
            TRequestStatus waitStatus;
            trace.RequestData(waitStatus,KTraceDataBlockSize);
            User::WaitForRequest(waitStatus);
            error = waitStatus.Int();
            }
        while(error==KErrNone);
        trace.Close();
        return error;
</pre>
 </div>

<div class="section" id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-F87246C8-2FD3-49C0-AF2A-5C933C53B272"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-F87246C8-2FD3-49C0-AF2A-5C933C53B272"><!-- --></a><h2 class="sectiontitle">Command Line Kernel Trace Tool</h2> <p>The command line
kernel trace tool is supplied as a user interface to the kernel trace tool
and also as a reference implementation. It implements the inner loop by writing
trace data to file or to a debug port. Other possible implementations involve
writing the data to a fast connection off the device or to a graphics tool.
The command line kernel trace tool uses the filters defined in <a href="GUID-8919270A-B5CE-302D-B7CE-3A4680D5E8CF.html"><span class="apiname">EUser</span></a>:
it would also be possible to specify user defined filters. </p>
 <pre class="codeblock" id="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-AB980AA0-BB46-5BE0-92BC-B88E6A1BEBE0"><a name="GUID-55C05441-33B5-5057-971D-4200345E941E__GUID-AB980AA0-BB46-5BE0-92BC-B88E6A1BEBE0"><!-- --></a>
void Dump()
    {
    TUint oldMode = Trace.Mode();
    Trace.SetMode(0); // turn off trace capture while we dump

    TUint8* data;
    TInt size;
    while((size=Trace.GetData(data))!=0)
        {
        if(FileName)
            {
            TInt r=File.Write(TPtrC8(data,size));
            if(r!=KErrNone)
                {
                printf("Error writing to file (1). (Code %d)",r);
                Error();
                }
            }
        if(DumpToDebugPort)
            {
            do
                {
                int s = size;
                if(s&gt;256) s=256;
                RDebug::RawPrint(TPtrC8(data,s));
                data += s;
                size -= s;
                }
            while(size);
            }
        Trace.DataUsed();
        }
    // Flush the file here so we can be sure to detect whether the btrace data 
    // has been written successfully to the file.
    TInt r = File.Flush();
    if (r != KErrNone)
        {
        printf("Error writing to file (2). (Code %d)",r);
        Error();
        }
    File.Close();

    Trace.SetMode(oldMode);
    RePrime();
    }</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-4237DA8E-225A-58C7-B136-3AF7C3D92CF9.html" title="Provides information about the Kernel Trace Tool.">Kernel Trace Tool Guide</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-7EA3FAD3-9A41-5B2D-8F46-8C8965CE8B97.html" title="The kernel trace tool variant device driver exists to implement the handler function of the kernel side BTrace class.">BTraceX Overview</a></div>
<div><a href="GUID-7B477BA5-CC5B-56A2-82BC-E1BC0049FECB.html" title="The kernel trace tool is a user-side client DLL which provides an interface for extracting trace data from a memory buffer">BTraceC Overview</a></div>
<div><a href="GUID-F27F49B3-4AC1-5517-AF3A-1ADBA1E87A0B.html" title="This document provides an overview of the command line kernel trace tool."> Command
Line Kernel Trace Tool                 Overview</a></div>
<div><a href="GUID-9E0957A1-0691-5741-ABCA-3EA61B4AC0CD.html">Command Line
Kernel Trace Tool                 Tutorial</a></div>
<div><a href="GUID-5CEA46BA-5AA2-51B4-8BBA-5B6EF141D68A.html" title="Explains how to use the kernel trace tool to read data from chunks."> Reading
Kernel Trace Data                 From Chunks Tutorial</a></div>
<div><a href="GUID-7195C3C2-6DF4-56DE-B3C7-00CC10A22AD2.html" title="Explains how to use the kernel trace tool API to write trace data to buffers.">Writing Trace
Data to                 Buffers Tutorial</a></div>
<div><a href="GUID-625A116D-185D-57A3-9FB7-B8257F4AB1B2.html" title="Explains how to use the kernel trace tool API to filter trace data."> Setting
Trace Filters                 Tutorial</a></div>
<div><a href="GUID-2341CFE1-1CDF-537A-99FB-78C59FFA30CE.html" title="Explains how to use the kernel trace tool API to request data notification."> Requesting
Data                 Notification Tutorial</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>