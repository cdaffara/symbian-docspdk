<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="String Pools"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F61D1710-2D52-5B9B-A25F-6DFA606DAC0F.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-324107D1-6E0B-56DD-BDC0-7296F688A9CF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D02B5AF1-B1C3-560D-9654-971A5CC1A904.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C8BD333E-8384-534B-822B-F61B2F7C8B9F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F61D1710-2D52-5B9B-A25F-6DFA606DAC0F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-24D509E8-CF46-58D3-85E9-27DA7AB22012.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2B6D7221-A23E-562E-9D9C-5EC197F1CB78.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-27340D18-A31D-512E-920A-B06C784A978A"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>String Pools</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-27340D18-A31D-512E-920A-B06C784A978A"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2381103 id2383459 id2383734 id2383771 id2383785 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html">Generic OS Services Guide</a> &gt; <a href="GUID-324107D1-6E0B-56DD-BDC0-7296F688A9CF.html">Low Level Libraries and Frameworks</a> &gt; <a href="GUID-D02B5AF1-B1C3-560D-9654-971A5CC1A904.html">Application Utilities</a> &gt; <a href="GUID-C8BD333E-8384-534B-822B-F61B2F7C8B9F.html">Basic Application Framework Library</a> &gt; <a href="GUID-F61D1710-2D52-5B9B-A25F-6DFA606DAC0F.html">Basic Application Framework Library Concepts</a> &gt; </div>
<h1 class="topictitle1">String
Pools </h1>
<div>
<p>Many systems, components and applications deal with pre-defined, well known
string constants. For example, parsing and manipulating text containing structure
mostly requires comparisons against standard string constants. </p>

<p>In a complex system, composed of a large number of objects, there may also
be a need to pass strings between objects, and to route processing depending
on the value of some string. The implementation of the HTTP transport framework
and the XML framework are examples within the Symbian platform where such
intense string handling is required. </p>

<p>To improve efficiency, the Symbian platform uses the idea of the string
pool. </p>

<p>A string pool is referenced through an <a href="GUID-4BF6ECD3-5FB3-3A6A-B9CE-98871BD0812B.html"><span class="apiname">RStringPool</span></a>,
which is a handle like object. The following diagram illustrates the basic
idea: </p>

<div class="fignone" id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-756DB8BA-1D6F-56AE-9C93-66DD3512B4A7"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-756DB8BA-1D6F-56AE-9C93-66DD3512B4A7"><!-- --></a><span class="figcap">Figure 1.            String pool representation          </span>

<img src="GUID-7F8F6ABB-8F46-5486-A116-6965787BC539_d0e223600_href.png"/>
</div>

<p>A string pool is a mechanism for storing strings in a particular way that
makes the comparison of strings a very fast operation. It is particularly
efficient at handling strings that can be set up at program compile time.
For example, strings that identify lexical elements in a structured text.
Typically, they are well known strings that are likely to be used very often
in a given context. </p>

<p>Such strings are organised into tables, and each string within a table
can be referenced by an index value, which can be symbolised by an enum. Such
tables are referred to as <strong>static string tables</strong> (See <a href="GUID-27340D18-A31D-512E-920A-B06C784A978A.html#GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-8221E235-15F9-55E9-8C17-4015051F70CD">Static string tables</a>). The basic algorithm used internally ensures
that the pool contains only one string of any particular value, and uses a
reference counting mechanism to keep track of usage. </p>

<p>The advantages of representing string constants in such a way are: </p>

<ul>
<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-DE544092-1FA8-5537-8357-62510F42D2EA"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-DE544092-1FA8-5537-8357-62510F42D2EA"><!-- --></a><p>avoiding a proliferation
of duplicate strings throughout a component or an application; typically there
is one string pool per thread, and one copy of a string </p>
 </li>

<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-55E5FD27-5E2B-51D6-91AA-435AE1A4421C"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-55E5FD27-5E2B-51D6-91AA-435AE1A4421C"><!-- --></a><p>allowing string constants
to be represented by integer values </p>
 </li>

<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-3C5CA539-11E1-53EB-8A1F-69AEF0D9C1F0"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-3C5CA539-11E1-53EB-8A1F-69AEF0D9C1F0"><!-- --></a><p>allowing strings to
be passed between objects by passing integer values, wrapped in a class (any
one of the <a href="GUID-C117EB69-0B1E-3D16-88E1-B44349C716DE.html"><span class="apiname">String</span></a> and <a href="GUID-B886F0AA-DB9C-356C-9B96-33252820F93E.html"><span class="apiname">RStringF</span></a> classes) </p>
 </li>

<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-559BCA58-B426-5919-A948-DC15ED501397"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-559BCA58-B426-5919-A948-DC15ED501397"><!-- --></a><p>allowing strings to
be compared by comparing the integer values. </p>
 </li>

</ul>

<p>Internally, a string pool uses hash tables to reference strings. </p>

<p>Static string tables and string constants can be added dynamically to the
string pool, for example, at run time. However, there is always a performance
penalty while adding either a static or a dynamic string to the string pool
as the hash tables need to be updated. This means that it is better to add
static string tables at string pool initialisation time, as this is the best
time to absorb the overhead. </p>

<div class="section" id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-B2F3D713-6BCA-4A47-99E4-EC4886F857EA"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-B2F3D713-6BCA-4A47-99E4-EC4886F857EA"><!-- --></a><h2 class="sectiontitle">Key features of string pool</h2> <ul>
<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-39F73513-7F37-57DA-AF7A-D3A7B2B28A76"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-39F73513-7F37-57DA-AF7A-D3A7B2B28A76"><!-- --></a><p>The string pool as supplied
by the Symbian platform supports any strings that can be represented
by a <a href="GUID-445B19E5-E2EE-32E2-8D6C-C7D6A9B3C507.html"><span class="apiname">TDes8</span></a> descriptor; this includes ASCII or UTF-8 encoded
strings. Note that a <a href="GUID-445B19E5-E2EE-32E2-8D6C-C7D6A9B3C507.html"><span class="apiname">TDes8</span></a> type can represent any type
of data , including binary data, and means that a string pool can easily handle
the extended characters of another encoding. </p>
 </li>

<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-8F9BA578-B6B5-54FD-8C29-8C2996AED4D0"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-8F9BA578-B6B5-54FD-8C29-8C2996AED4D0"><!-- --></a><p>Within the string pool,
strings are of two types - case sensitive and case insensitive. This affects
the way strings are compared. Case insensitivity implies that strings are
folded for the purpose of comparison. </p>
 </li>

<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-D958763A-70F8-5452-A556-99F92B2B0246"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-D958763A-70F8-5452-A556-99F92B2B0246"><!-- --></a><p>A string pool can contain
up to 4,096 static string tables, and each table can represent up 26,2144
strings. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-8221E235-15F9-55E9-8C17-4015051F70CD"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-8221E235-15F9-55E9-8C17-4015051F70CD"><!-- --></a><h2 class="sectiontitle">Static string
tables</h2> <p>Static string tables are defined and built at compile time.
They are represented by a <a href="GUID-91322CD6-6DA0-3868-A5D7-CA561A102074.html"><span class="apiname">TStringTable</span></a> object. A string
table can be added to the string pool by passing the string table reference
to a call to: </p>
 <pre class="codeblock" id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-2FAB371D-74A4-5D7E-99F1-B7C02BEDA8D5"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-2FAB371D-74A4-5D7E-99F1-B7C02BEDA8D5"><!-- --></a>void RStringTable::OpenL( const TStringTable&amp; aTable );</pre>
 <p>The following diagram illustrates a general picture. Note that the strings
in any given string table are deemed to be either case sensitive or case insensitive,
and this governs how comparisons are made. </p>
 <div class="fignone" id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-D7CEA86C-0643-5BDA-A60E-D80B97008BF2"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-D7CEA86C-0643-5BDA-A60E-D80B97008BF2"><!-- --></a>
<img src="GUID-ECACB935-AD19-5BE6-AC27-A63465244087_d0e223707_href.png"/>
</div>
 <p>As the name implies, a static string table is declared as a <samp class="codeph">const
          TStringTable</samp> data member of a class with a user-defined
name. The class name is defined in a header file while the table itself is
implemented in a <samp class="codeph">.cpp</samp> C++ source file. Both the header file
and the C++ source file are normally included in the project definition. Typically,
a set of enum values are also defined within the scope of the class, and each
value is associated with the strings in the table; code in other parts of
the program access the strings in the string pool using these enum values. </p>
 <p>The
Perl script, <samp class="codeph">stringtable.pl</samp>, located in <span class="filepath">...\syslibs\bafl\stringtools\</span>,
can be used to generate these <samp class="codeph">.cpp</samp> and <samp class="codeph">.h</samp> files
from a simple text definition. The text definition file simply lists the strings
and the enum symbols to be associated with them; the file itself is given
a <samp class="codeph">.st</samp> file type. </p>
 <p>Following is a simple example of <samp class="codeph">ExampleStringTable.st</samp> file: </p>
 <pre class="codeblock" id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-5D487C02-D710-55E6-BD8D-769BE4C4E754"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-5D487C02-D710-55E6-BD8D-769BE4C4E754"><!-- --></a># Example String Table
fstringtable ExampleStringTable
!// Some types of fruit
# This comment won't appear in the .h file, but the one above will.
EApple apple
EOrange orange
EBanana banana
# Some animals
ECat cat
EDog dog
</pre>
 <p>The main points to note are: </p>
 <ul>
<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-8FCB19B1-7033-5120-98DD-08EECA91C65B"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-8FCB19B1-7033-5120-98DD-08EECA91C65B"><!-- --></a><p>the keyword <em>fstringtable</em> is
used to define the name of the class that contains the string table declaration
and the enum value symbols. The class name itself follows the keyword. For
example, <samp class="codeph">ExampleStringTable</samp>. </p>
 <p>Note that you can include
underscore characters in the class name. For example, <samp class="codeph">Example_StringTable</samp>. </p>
 </li>

<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-0E714FA5-859E-597F-9B33-2F0DC3372FCD"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-0E714FA5-859E-597F-9B33-2F0DC3372FCD"><!-- --></a><p>the symbols <samp class="codeph">EApple</samp> and <samp class="codeph">EOrange</samp> form
the enum value symbols that correspond to the strings <samp class="codeph">apple</samp> and <samp class="codeph">orange</samp> respectively. </p>
 </li>

<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-F9F62AD7-5209-5D01-9F60-413C7E161689"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-F9F62AD7-5209-5D01-9F60-413C7E161689"><!-- --></a><p>all statements starting
with a <strong>#</strong> are comments and are completely ignored. However <strong>#</strong> characters
can appear in a string. For example <samp class="codeph">ap#ple</samp> is a valid string
and is not interpreted as a comment. </p>
 </li>

<li id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-F70C2B1A-2029-5B1A-A27D-A65A123A6CA9"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-F70C2B1A-2029-5B1A-A27D-A65A123A6CA9"><!-- --></a><p>all statements starting
with a <strong>!</strong> are comments that are inserted into the generated header file. </p>
 </li>

</ul>
 <p>Running the Perl script with <samp class="codeph">ExampleStringTable.st</samp> as
source generates the header file <samp class="codeph">ExampleStringTable.h</samp> and
the C++ source file <samp class="codeph">ExampleStringTable.cpp</samp> as illustrated
below: </p>
 <pre class="codeblock" id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-7E0263D1-D4A5-5B0A-B355-C2D958247590"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-7E0263D1-D4A5-5B0A-B355-C2D958247590"><!-- --></a>// Autogenerated from epoc32\build\generated\example\ExampleStringTable.st by the stringtable tool - Do not edit

#ifndef STRINGTABLE_ExampleStringTable
#define STRINGTABLE_ExampleStringTable

#include "StringPool.h"

struct TStringTable;

/** A String table */
class ExampleStringTable 
       {
    public:
           enum TStrings
              {
              // Some types of fruit
              /** apple */
              EApple,
              /** orange */
              EOrange,
              /** banana */
              EBanana,
              /** cat */
              ECat,
              /** dog */
              EDog
              };
       static const TStringTable Table;    
       };

#endif // STRINGTABLE_ExampleStringTable
</pre>
 <pre class="codeblock" id="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-6447B06C-00EB-527C-8381-7239F2220D61"><a name="GUID-27340D18-A31D-512E-920A-B06C784A978A__GUID-6447B06C-00EB-527C-8381-7239F2220D61"><!-- --></a>// Autogenerated from epoc32\build\generated\example\ExampleStringTable.st by the stringtable tool - Do not edit
#include &lt;e32std.h&gt;
#include "StringPool.h"
#include "StringTableSupport.h"
#include "ExampleStringTable.h"
#ifdef _DEBUG
#undef _DEBUG
#endif

_STLIT8( K1, "apple" );
_STLIT8( K2, "orange" );
_STLIT8( K3, "banana" );
_STLIT8( K4, "cat" );
_STLIT8( K5, "dog" );

// Intermediate
const void * const KStringPointers[] =
       {
       ( const void* )&amp;K1,
       ( const void* )&amp;K2,
       ( const void* )&amp;K3,
       ( const void* )&amp;K4,
       ( const void* )&amp;K5
       };

const TStringTable ExampleStringTable::Table = {5, KStringPointers, EFalse};
</pre>
 <p>The table itself is the static data member <samp class="codeph">Table</samp> of
class <samp class="codeph">ExampleStringTable</samp>. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-F61D1710-2D52-5B9B-A25F-6DFA606DAC0F.html">Basic Application Framework Library Concepts</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-2B6D7221-A23E-562E-9D9C-5EC197F1CB78.html">Using string
pools</a></div>
</div>
<div class="relinfo reltasks"><strong>Related tasks</strong><br/>
<div><a href="GUID-24D509E8-CF46-58D3-85E9-27DA7AB22012.html" title="A static string table can be built in any .mmp file; the most common use is as part of building an application.">Constructing
a Static                 String Table</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>