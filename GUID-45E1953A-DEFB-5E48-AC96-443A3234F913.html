<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="Retrieving an IP Network Parameters Tutorial"/>
<meta name="abstract" content="How to retrieve IP network parameters from a DHCP server configured network connection."/>
<meta name="description" content="How to retrieve IP network parameters from a DHCP server configured network connection."/>
<meta name="DC.Relation" scheme="URI" content="GUID-7510C121-A23F-50E0-8130-16AF552BC497.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B144EAB9-53AB-579B-9E12-B16518E4FC01.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-DBD4964D-7728-5E57-8BBA-824F98D0CCF8.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7510C121-A23F-50E0-8130-16AF552BC497.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-69B46D92-8D07-5B42-B603-3F725977AA4A.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Retrieving an IP Network Parameters Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913"><a name="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2398162 id2398611 id2858116 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-B144EAB9-53AB-579B-9E12-B16518E4FC01.html" title="Networking Services provides a standard framework for accessing network services and actual implementations of network protocols. The components of the Networking Services are closely related to the framework provided by the Communications Framework module.">Networking Services Guide</a> &gt; <a href="GUID-DBD4964D-7728-5E57-8BBA-824F98D0CCF8.html" title="This section describes the TCP/IP Utilities collection of components, which provides libraries used by TCP/IPv4/v6 PRT for the DNS and DHCP protocols.">TCP/IP Utilities</a> &gt; <a href="GUID-7510C121-A23F-50E0-8130-16AF552BC497.html" title="This section provides the summary of concepts and tutorials related to Dynamic Host Configuration Protocol (DHCP).">Dynamic Host Configuration Protocol</a> &gt; </div>
<h1 class="topictitle1">Retrieving
an IP Network Parameters Tutorial</h1>
<div><p>How to retrieve IP network parameters from a DHCP server configured
network connection. </p>

<div class="section" id="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-C919A1D1-FE46-4D60-B20B-75D919404AB6"><a name="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-C919A1D1-FE46-4D60-B20B-75D919404AB6"><!-- --></a><p> The high level steps to retrieve an IP network parameters are
as  follows: </p>
</div>

<a name="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-A25ECF43-E64D-5DB2-B783-924BFA48F4A0"><!-- --></a><ol id="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-A25ECF43-E64D-5DB2-B783-924BFA48F4A0"><li class="stepexpand" id="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-5851EFBA-6976-55A6-A736-2480750951B6"><a name="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-5851EFBA-6976-55A6-A736-2480750951B6"><!-- --></a><span>Open a socket using <samp class="codeph">RSocketServer</samp> object. </span>
</li>
<li class="stepexpand" id="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-0E0A1640-7A99-587F-B70A-2057C6E3C201"><a name="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-0E0A1640-7A99-587F-B70A-2057C6E3C201"><!-- --></a><span>Create a connection
using <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> function. </span>
</li>
<li class="stepexpand" id="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-A248BB53-9180-5777-93C4-2B964C15FFC3"><a name="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-A248BB53-9180-5777-93C4-2B964C15FFC3"><!-- --></a><span>Start the connection
using <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> with necessary preferences. </span>
 For example, enable DHCP server. The active connection is configured
by the DHCP server. 
</li>
<li class="stepexpand" id="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-796FB8CD-D4CD-54CE-93E0-90E8AD2F1B10"><a name="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-796FB8CD-D4CD-54CE-93E0-90E8AD2F1B10"><!-- --></a><span>To retrieve the
active network connection parameters, Call the <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html#GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD__GUID-9F820CF9-1D4F-3452-983B-E0C694D6783A"><span class="apiname">RConnection::Ioctl()</span></a> function
by passing the relevant arguments. </span>
</li>
<li class="stepexpand" id="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-926BD804-72F9-55F3-8569-4385FAB28989"><a name="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-926BD804-72F9-55F3-8569-4385FAB28989"><!-- --></a><span>The <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html#GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD__GUID-9F820CF9-1D4F-3452-983B-E0C694D6783A"><span class="apiname">RConnection::Ioctl()</span></a> function
returns the necessary parameters. </span>
 <div class="p"><div class="note"><span class="notetitle">Note:</span>  Multiple option codes can be queried to a DHCP server using
the &lt;api-item&gt;TDhcpRawOptionMultipleDataPckg&lt;/api-item&gt; object.</div>
</div>
<p> The
advantages of retrieving multiple parameters are: </p>
<ul>
<li><p>It reduces IPC calls between application and the DHCP daemon. </p>
</li>

<li><p>It reduces the messages exchanged between the DHCP daemon and the DHCP
server. </p>
</li>

</ul>

</li>
</ol>

<div class="example"><h2 class="sectiontitle"> Retrieve IP Network Parameters example</h2> <p>The following
is an example code for how to retrieve IP network parameters: </p>
 <pre class="codeblock" id="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-39A702E4-A746-5BFA-A00E-AD34DBE2AD97"><a name="GUID-45E1953A-DEFB-5E48-AC96-443A3234F913__GUID-39A702E4-A746-5BFA-A00E-AD34DBE2AD97"><!-- --></a>

//create a socket connection  

RSocketServ esock; 
TInt err = eSock.Connect();
...

//handle the error
...
RConnection aConnection;   //create a RConnection 
err = aConnection.Open(esock);
...

//start the connection with necessary preferences
...
err = aConnection.Start(iConnPrefs);


//Retrieve the TFTP server address

TRequestStatus status1;
TTftpServerAddrBuf tftpserveraddr; // Buffer to store TFTP server address
tftpserveraddr().index = 0;
aConnection.Ioctl(KCOLConfiguration, KConnGetTftpServerAddr, status1, &amp;tftpserveraddress);
User::WaitForRequest(status1);
...

//Retrieve the host name of the TFTP server

TRequestStatus status2;
TBuf&lt;256&gt; tftpname; //buffer to store TFTP server name
aConnection.Ioctl(KCOLConfiguration, KConnGetTftpServerName, status2, &amp;tftpname);
User::WaitForRequest(status2);
...

//Retrieve SiAddr field from a DHCP header

TRequestStatus status3;
TConnectionAddrBuf addr;
addr().iAddressFamily = IpAddressFamily();
aConnection.Ioctl(KCOLConfiguration, KConnGetDhcpHdrSiaddr, status3, &amp;addr);
...
//Retrieve SName field from a DHCP header

TRequestStatus status4;
TBuf&lt;64&gt; snamebuf;
aConnection.Ioctl(KCOLConfiguration, KConnGetDhcpHdrSname, status4, &amp;snamebuf);
...
//Retrieve the active IP address

TRequestStatus status5;
TConnectionAddress actaddr;
actaddr().iAddressFamily = IpAddressFamily();
aConnection.Ioctl(KCOLConfiguration, KConnGetCurrentAddr, status5, &amp;actaddr); 
...

//Retrieve multiple parameters

Multiple opcodes can be queried to a DHCP server using the 
TDhcpRawOptionMultipleDataPckg object. 

TBuf8&lt;300&gt; rawbuf;
rawbuf.FillZ(300);   //buffer must be large enough for all returned options values
TDhcpRawOptionMultipleDataPckg pckg1(rawbuf);
pckg1.AddRawOptionCodeL(KTFtpServerAddress);    //option 150 
pckg1.AddRawOptionCodeL(KGeoConfCivicOption);   //option 99
pckg1.AddRawOptionCodeL(KTFtpServerName);  // option 66
TRequestStatus status6;    

// Get raw option data for ip4

aConnection.Ioctl(KCOLConfiguration, KConnDhcpGetMultipleParams, status6, &amp;rawbuf);
User::WaitForRequest(status);
...

 
</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-7510C121-A23F-50E0-8130-16AF552BC497.html" title="This section provides the summary of concepts and tutorials related to Dynamic Host Configuration Protocol (DHCP).">Dynamic Host Configuration Protocol</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-69B46D92-8D07-5B42-B603-3F725977AA4A.html" title="The Dynamic Host Configuration Protocol (DHCP) is an Internet standard defined in RFC2131 (IPv4) and RFC3315 (IPv6).">DHCP</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>