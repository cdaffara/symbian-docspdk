<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Sharable sessions"/>
<meta name="abstract" content="Describes how a session can be shared by threads."/>
<meta name="description" content="Describes how a session can be shared by threads."/>
<meta name="DC.Relation" scheme="URI" content="GUID-6047DB3F-DC92-51DF-9EEB-00E79E890B54.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3786D8E6-17A9-52E4-A8DF-CFCDC3039854.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6047DB3F-DC92-51DF-9EEB-00E79E890B54.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-975F53E5-1C13-5063-B817-795F2623737B"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Sharable sessions</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-975F53E5-1C13-5063-B817-795F2623737B"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2392072 id2392081 id2393224 id2393504 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html" title="Provides a framework for accessing file systems.">User Library and File Server</a> &gt; <a href="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html" title="The User Library allows the applications and services that run on a phone to access the functionality provided by the Symbian platform Kernel.">User Library</a> &gt; <a href="GUID-3786D8E6-17A9-52E4-A8DF-CFCDC3039854.html">Inter Process Communication</a> &gt; <a href="GUID-6047DB3F-DC92-51DF-9EEB-00E79E890B54.html">Using Client-Server</a> &gt; </div>
<h1 class="topictitle1">Sharable
sessions</h1>
<div><p>Describes how a session can be shared by threads.</p>

<p>A session can be shared by threads provided the server is marked as supporting
shared sessions. </p>

<div class="section" id="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-33D699D4-50DD-4B46-BFEA-8E9AD46C66C1"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-33D699D4-50DD-4B46-BFEA-8E9AD46C66C1"><!-- --></a><h2 class="sectiontitle">Sharing</h2> <p>Once a server has started, and a client
has connected to that server (by creating a session), then the client thread
can make the session sharable. There are two types of sharing: </p>
 <ul>
<li id="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-4AF39204-BA70-50CB-9D13-185655322A1D"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-4AF39204-BA70-50CB-9D13-185655322A1D"><!-- --></a><p>where the session is
sharable among all threads belonging to the same process as the originating
thread. </p>
 </li>

<li id="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-69DFB418-D434-58B0-A27E-57C053C822A5"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-69DFB418-D434-58B0-A27E-57C053C822A5"><!-- --></a><p>where the session is
sharable among all threads in the system, i.e. across all processes. </p>
 </li>

</ul>
 <p>A server must support the creation of sharable sessions, otherwise
an attempt to make a session sharable panics the calling thread. Servers can
be created to be either unsharable, sharable among threads in the same process,
or sharable among all threads in the system. </p>
 <p><strong>Sharing
a session among threads in a single process</strong> </p>
 <p>There are two ways
of doing this: </p>
 <ul>
<li id="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-285E2AE9-DEB7-502E-B8B2-47D3B45F50EB"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-285E2AE9-DEB7-502E-B8B2-47D3B45F50EB"><!-- --></a><p>if the session has already
been created, then call <a href="GUID-6D8A458C-9A39-3000-A3BC-060A2A3663E6.html#GUID-6D8A458C-9A39-3000-A3BC-060A2A3663E6__GUID-0A453CA9-9DF7-35B8-963E-D75763626136"><span class="apiname">RSessionBase::ShareAuto()</span></a>, which
has the effect of mutating the handle from a thread relative handle to a process
relative handle. The handle can then be shared by the threads. Until this
function is called, the session is specific to the originating thread, and
cannot be used by any other thread. </p>
 </li>

<li id="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-BD414669-EE7A-5821-A591-12D77CD0FBA9"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-BD414669-EE7A-5821-A591-12D77CD0FBA9"><!-- --></a><p>if the session has not
yet been created, then create the session as sharable from the beginning using
one of the overloads of <samp class="codeph">RSessionBase::CreateSession()</samp> that
takes a <samp class="codeph">TIpcSessionType</samp> argument - <em>this is the preferred
method</em>  </p>
 </li>

</ul>
 <strong>Sharing
a session among threads across all processes</strong><div class="p"> There are two ways of
doing this:<ul>
<li><p>if the session has already been created, then call <a href="GUID-6D8A458C-9A39-3000-A3BC-060A2A3663E6.html#GUID-6D8A458C-9A39-3000-A3BC-060A2A3663E6__GUID-943BCB86-1497-3940-BDA5-6DB1767DA395"><span class="apiname">RSessionBase::ShareProtected()</span></a>,
which has the effect of mutating the handle from a thread relative handle
to a process relative handle; this is also protected and can be passed to
another process. The handle can then be shared by the threads. Until this
function is called, the session is specific to the originating thread, and
cannot be used by any other thread.</p>
</li>

<li><p>if the session has not yet been created, then create the session as
sharable from the beginning using one of the overloads of <samp class="codeph">RSessionBase::CreateSession()</samp> that
takes a <samp class="codeph">TIpcSessionType</samp> argument - <em>this is the preferred
method</em></p>
</li>

</ul>
</div>
 </div>

<div class="section" id="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-49F7BFC0-2DD3-4AA5-A105-18ACFE702789"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-49F7BFC0-2DD3-4AA5-A105-18ACFE702789"><!-- --></a><h2 class="sectiontitle">Server exit</h2> <p>If the server terminates, all outstanding
messages which have been sent to it are completed with a <samp class="codeph">KErrServerTerminated</samp> code.
Any attempt to send further messages, or to share session, fail immediately
with <samp class="codeph">KErrServerTerminated</samp>. The only valid operation on such
a session is to close it. </p>
 </div>

<div class="section" id="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-20F18655-D04E-40CE-8199-058DA9AD1585"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-20F18655-D04E-40CE-8199-058DA9AD1585"><!-- --></a><h2 class="sectiontitle">Session closure</h2> <p>If <samp class="codeph">Close()</samp> is
called on a session, any outstanding messages on the session may not be completed
for the client. Following this, the only message that the server receives
from the session is the disconnect message. </p>
 </div>

<div class="section" id="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-C4508E0A-50FC-4780-AEAA-08018CF2AB7F"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-C4508E0A-50FC-4780-AEAA-08018CF2AB7F"><!-- --></a><h2 class="sectiontitle">Client thread exit</h2> <p>If a session has not been shared,
then the session is closed as part of normal thread cleanup. </p>
 <p>If a
session has been shared, the session handle is owned by the process and is
not automatically cleaned up with the thread. In addition, the server is not
informed that the thread has terminated. </p>
 <p>The only way to free resources
owned by the session is to explicitly close the session, or to terminate the
client process. Note that this makes it possible for a session to have no
client threads ! </p>
 </div>

<div class="section" id="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-9F7C4330-C524-4D8E-A78D-B519CF737D7D"><a name="GUID-975F53E5-1C13-5063-B817-795F2623737B__GUID-9F7C4330-C524-4D8E-A78D-B519CF737D7D"><!-- --></a><h2 class="sectiontitle">Message slots</h2> <p>The maximum number of message slots
that can be allocated to a session, or the maximum number that can be dynamically
acquired from the system-wide pool, is 255. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-6047DB3F-DC92-51DF-9EEB-00E79E890B54.html">Using Client-Server</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>