<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Using ClientMessage Framework"/>
<meta name="abstract" content="This section explains how to use the ClientMessage framework to sanitize the incoming messages."/>
<meta name="description" content="This section explains how to use the ClientMessage framework to sanitize the incoming messages."/>
<meta name="DC.Relation" scheme="URI" content="GUID-D98E984D-69A5-5BA8-89E7-A7CC9FD0C584.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-324107D1-6E0B-56DD-BDC0-7296F688A9CF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D02B5AF1-B1C3-560D-9654-971A5CC1A904.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D98E984D-69A5-5BA8-89E7-A7CC9FD0C584.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-42C94E3D-93DE-543E-A0D2-8B705C668BE0.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Using ClientMessage Framework</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419"><a name="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2381103 id2383459 id2383734 id2383986 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html">Generic OS Services Guide</a> &gt; <a href="GUID-324107D1-6E0B-56DD-BDC0-7296F688A9CF.html">Low Level Libraries and Frameworks</a> &gt; <a href="GUID-D02B5AF1-B1C3-560D-9654-971A5CC1A904.html">Application Utilities</a> &gt; <a href="GUID-D98E984D-69A5-5BA8-89E7-A7CC9FD0C584.html">Base Services Utility Library (BSUL)</a> &gt; </div>
<h1 class="topictitle1">Using
ClientMessage Framework</h1>
<div><p>This section explains how to use the ClientMessage framework to
sanitize the incoming messages. </p>

<div class="section"><h2 class="sectiontitle">Procedure</h2> <a name="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-99AB8BE4-C585-55A3-B16F-C4B53A9E9E61"><!-- --></a><ol id="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-99AB8BE4-C585-55A3-B16F-C4B53A9E9E61">
<li id="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-F6B94808-046E-5D80-9BDC-AEEEE1DB694B"><a name="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-F6B94808-046E-5D80-9BDC-AEEEE1DB694B"><!-- --></a><p>Create and initialize
a <a href="GUID-8AA6248D-64E4-3C73-8541-03C9880000F0.html"><span class="apiname">TClientMessageSchema</span></a> structure to represent a single
message from the client. </p>
 <p>It defines the function number corresponding
to the message, the security policy for the message, the number of paramaters
that are passed to the function and the type and constraint information for
each of the parameters. </p>
 <div class="p"><pre class="codeblock" id="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-76569264-62A5-53A4-A12F-55067521D309"><a name="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-76569264-62A5-53A4-A12F-55067521D309"><!-- --></a>const TParameterDetails KMessageParams2[1] = {{EParamInt,-10,100}};

const TClientMessageSchema KClientMessages[] = 
MESSAGE_SCHEMA( EMessage0, KDefaultPolicy, KMessageParams2 );</pre>
 </div>
 </li>

<li id="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-2BD81806-096B-58F3-A498-733BBC876809"><a name="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-2BD81806-096B-58F3-A498-733BBC876809"><!-- --></a><p>Create and initialize
a <a href="GUID-FF1684A9-62FF-3614-BA8D-084CA2FFC3AE.html"><span class="apiname">TClientMessageServerData</span></a> structure containing an array
of custom validation functions<a href="GUID-DA261437-879F-3A8D-9D91-F683BF41CA32.html"><span class="apiname">TCustomValidationFn</span></a> and <a href="GUID-8AA6248D-64E4-3C73-8541-03C9880000F0.html"><span class="apiname">TClientMessageSchema</span></a> structure
defining a schema for each message that will be accepted by the server. </p>
 <div class="p"><pre class="codeblock" id="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-1B3F0610-C1D9-5354-959A-B4ABDE746350"><a name="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-1B3F0610-C1D9-5354-959A-B4ABDE746350"><!-- --></a>extern const TClientMessageServerData aServerData=
    {
    sizeof( KClientMessages )/sizeof( TClientMessageSchema ),
    KClientMessages,                                               
    KCustomValidationFunctions,
    ( TUint8* )"My Server"
    }</pre>
 </div>
 </li>

<li id="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-A3F4C516-B219-5E77-9F3B-6EB0F76944B4"><a name="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-A3F4C516-B219-5E77-9F3B-6EB0F76944B4"><!-- --></a><p>Initialize the framework
by calling the static function <a href="GUID-45AFEB13-9D05-365D-A2A6-A34EF48A494D.html"><span class="apiname">CClientMessage</span></a>::<a href="GUID-25CE7350-2288-3E55-901C-0F0AAFECCD1B.html"><span class="apiname">InitialiseFrameworkL</span></a> ()
and pass it to <a href="GUID-FF1684A9-62FF-3614-BA8D-084CA2FFC3AE.html"><span class="apiname">TClientMessageServerData</span></a> structure. </p>
 <div class="p"><pre class="codeblock" id="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-F2AEF771-F37F-5028-99D7-6DD1CE9209E0"><a name="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-F2AEF771-F37F-5028-99D7-6DD1CE9209E0"><!-- --></a>IMPORT_C static void InitialiseFrameworkL( const TClientMessageServerData &amp;aServerData );</pre>
 </div>
 </li>

</ol>
 </div>

<div class="section"><h2 class="sectiontitle">Results</h2> <p>On construction, <samp class="codeph">CMessageParameterBase</samp> objects
are instantiated using the <samp class="codeph">TParameterDetails</samp> structs in the
message schema and stored in an <samp class="codeph">RPointerArray</samp>. The objects
represent the individual message arguments and are used to validate each argument
against the constraints defined in the message schema. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Example</h2> <p>Below is an example schema that defines
four messages, including two that define custom validation functions. The
data is passed to the framework through a constant <samp class="codeph">TClientMessageServerData</samp> structure. </p>
 <pre class="codeblock" id="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-5375E126-8C70-5B45-9202-E1F94A969E4B"><a name="GUID-3B2FB34B-B4FC-5273-AE35-DADA2FA4C419__GUID-5375E126-8C70-5B45-9202-E1F94A969E4B"><!-- --></a>#include &lt;bsul/bsul.h&gt;
using namespace BSUL;
//This enum defines the custom parameter types used to validate 
//TPckg&lt;TMyStruct&gt; and TPckg&lt;TMyStruct1&gt; parameters.
enum TCustomParamType
    {        
    EParamCustom1 = ( 0x000 | EParamPckg ),        
    EParamCustom2 = ( 0x100 | EParamPckg )     
    };
//Defines the schema for each message
const TParamaterDetails KMessage0Params[2] = {{EParamInt,-10,100},
                                             {EParamInt,0,200}};
const TParamaterDetails KMessage1Params[2] = {{EParamDes8Read,64,64},
                                             {EParamInt,0,64}};
//Parameter is TPckg&lt;TMyStruct&gt;
const TParamaterDetails KMessage2Params[1] = {{EParamCustom1,sizeof( TMyStruct ), sizeof( TMyStruct )}};
//Parameter is TPckg&lt;TMyStruct1&gt;
const TParamaterDetails KMessage3Params[1] = {{EParamCustom2,sizeof( TMyStruct1 ), sizeof( TMyStruct1 )}};
//Define the security policies for each message
_LIT_SECURITY_POLICY_PASS( KDefaultPolicy );
_LIT_SECURITY_POLICY_C2( KMsg2Policy, ECapabilityReadUserData, ECapabilityWriteUserData );
//This is the array of TClientMessageSchema structs that define the messages that will be accepted by the server.
const TClientMessageSchema KClientMessages[] =      
    {
    {EMessage0,
    KDefaultPolicy,         
    sizeof( KMessage0Params )/sizeof( TParamaterDetails ),KMessage0Params},
    
    {EMessage1,
    KDefaultPolicy,
    sizeof( KMessage1Params )/sizeof( TParamaterDetails ),KMessage1Params},
    
    {EMessage2,
    KMsg2Policy,
    sizeof( KMessage2Params )/sizeof( TParamaterDetails ),KMessage2Params},
    
    {EMessage3,
    KDefaultPolicy,
    sizeof( KMessage3Params )/sizeof( TParamaterDetails ),KMessage3Params}
    };
//These are the custom validation functions that are used to validate 
//TPckg&lt;TMyStruct1&gt; and TPckg&lt;TMyStruct1&gt; parameters
static void CustomValidationFn1L( CMessageParameterBase* aParameter );
static void CustomValidationFn2L( CMessageParameterBase* aParameter );
//This is the array of custom validation functions. The index of the function 
//in the array should match the upper 16 bits of the value defined in 
//TCustomParamType enum for that parameter type.
const TCustomValidationFn KCustomValidationFunctions[] = 
    {
    &amp;CustomValidationFn1L,
    &amp;CustomValidationFn2L
    };
//This is the initialization data that is passed into the ClientMessage 
//framework by the server. It contains everything the framework needs to 
//validate incoming messages
extern const TClientMessageServerData KServerData =
    {
    sizeof( KClientMessages )/sizeof( TClientMessageSchema ),
    KClientMessages,                                               
    KCustomValidationFunctions,
    ( TUint8* )"My Server"
    };</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-D98E984D-69A5-5BA8-89E7-A7CC9FD0C584.html">Base Services Utility Library (BSUL)</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-42C94E3D-93DE-543E-A0D2-8B705C668BE0.html">Base Services
Utility Library Overview</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>