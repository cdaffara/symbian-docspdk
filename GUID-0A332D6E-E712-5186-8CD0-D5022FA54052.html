<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Migrating to V2 client-server APIs"/>
<meta name="abstract" content="Describes how to modify client-server implementations to use the new Version 2 client-server APIs instead of the deprecated Version 1 APIs."/>
<meta name="description" content="Describes how to modify client-server implementations to use the new Version 2 client-server APIs instead of the deprecated Version 1 APIs."/>
<meta name="DC.Relation" scheme="URI" content="GUID-6047DB3F-DC92-51DF-9EEB-00E79E890B54.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3786D8E6-17A9-52E4-A8DF-CFCDC3039854.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6047DB3F-DC92-51DF-9EEB-00E79E890B54.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Migrating to V2 client-server APIs</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2392072 id2392081 id2393224 id2393504 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html" title="Provides a framework for accessing file systems.">User Library and File Server</a> &gt; <a href="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html" title="The User Library allows the applications and services that run on a phone to access the functionality provided by the Symbian platform Kernel.">User Library</a> &gt; <a href="GUID-3786D8E6-17A9-52E4-A8DF-CFCDC3039854.html">Inter Process Communication</a> &gt; <a href="GUID-6047DB3F-DC92-51DF-9EEB-00E79E890B54.html">Using Client-Server</a> &gt; </div>
<h1 class="topictitle1">Migrating
to V2 client-server APIs</h1>
<div><p>Describes how to modify client-server implementations to use the
new Version 2 client-server APIs instead of the deprecated Version 1 APIs.</p>

<p>The new APIs have been introduced as part of the effort to provide a more
secure interface for client-server communications, and form an essential component
of Platform Security in Symbian platform. </p>

<ul>
<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C53A38E9-A821-577A-930A-F478954FF806"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C53A38E9-A821-577A-930A-F478954FF806"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-35D3BD7A-8C16-50C3-80AD-2422E3B92AAB">General points</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-FD82A424-BDB5-5DE7-8904-C579C7683CA1"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-FD82A424-BDB5-5DE7-8904-C579C7683CA1"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0FA5EC5C-8F7B-5E95-BE28-CD0DB6BDCBEE">The Version 1 client-server APIs</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-63746CDF-E64B-5BA0-A133-8DFD0FA9FCF5"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-63746CDF-E64B-5BA0-A133-8DFD0FA9FCF5"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8BDFF94E-80E6-5CAF-8CC0-04D7F74FAF43">The Version 2 client-server APIs</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-87719C35-00EB-51BE-8D01-6955535C6B4A"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-87719C35-00EB-51BE-8D01-6955535C6B4A"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C5A1C9BA-7637-53EB-9898-A58336F87389">Changes to the client interface</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CFDDD4B4-DD54-5F9C-B60D-D361EA621670"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CFDDD4B4-DD54-5F9C-B60D-D361EA621670"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-450BE510-C3C9-5988-853B-1A03A84F0875">Changes to the server interface</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-30E36FBF-25EA-5347-810E-D2C85F853CCD"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-30E36FBF-25EA-5347-810E-D2C85F853CCD"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-07F7FFA6-D421-54E2-90F7-69F002702C46">Using RMessagePtr2</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A2E1CEF3-BD6F-594D-B4DC-098FBABBC6F4"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A2E1CEF3-BD6F-594D-B4DC-098FBABBC6F4"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1ABF5DC6-A957-5623-93AB-CD7631A36A33">Migration quick reference</a>  </p>
 </li>

</ul>

<div class="section" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-35D3BD7A-8C16-50C3-80AD-2422E3B92AAB"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-35D3BD7A-8C16-50C3-80AD-2422E3B92AAB"><!-- --></a><h2 class="sectiontitle">General points</h2> <p>The
user library, EUSER.DLL, makes both the Version 1 and Version 2 client-server
APIs available. However, it is possible to 'hide' the Version 1 APIs during
compilation by defining the C pre-processor macro <samp class="codeph">__HIDE_IPC_V1__</samp>. </p>
 <p>For
example, by adding the following line to a component's MMP file: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-048E20E3-1E8C-5F08-9E40-CE0A43849AD5"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-048E20E3-1E8C-5F08-9E40-CE0A43849AD5"><!-- --></a>macro __HIDE_IPC_V1__</pre>
 <p>This
can also be done globally for all components in Symbian platform by defining
the macro in the platform's HRH file: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-30C6F786-CB13-5962-80E5-5ACBB5879B8C"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-30C6F786-CB13-5962-80E5-5ACBB5879B8C"><!-- --></a>#define __HIDE_IPC_V1__</pre>
 <p>In
addition, the EUSER header files define the macro <samp class="codeph">__IPC_V2_PRESENT__</samp>,
which allows source code that still needs to compile with older Symbian platform
releases, to detect the presence of the new APIs, and use conditional compilation
as appropriate. </p>
 </div>

<div class="section" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0FA5EC5C-8F7B-5E95-BE28-CD0DB6BDCBEE"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0FA5EC5C-8F7B-5E95-BE28-CD0DB6BDCBEE"><!-- --></a><h2 class="sectiontitle">The Version
1 client-server APIs</h2> <p>The following classes and functions are defined
as constituting the Version 1 client-server APIs: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-339D79DC-B401-5F09-B5A2-3D3EE10B3D63"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-339D79DC-B401-5F09-B5A2-3D3EE10B3D63"><!-- --></a>class CSharableSession
class CSession
class CServer
class RMessagePtr
class RMessage
class RServer

RSessionBase::Share(TAttachMode aAttachMode=EExplicitAttach)
RSessionBase::Attach()
RSessionBase::Send(TInt aFunction,TAny* aPtr)
RSessionBase::SendReceive(TInt aFunction,TAny* aPtr,TRequestStatus&amp; aStatus) 
RSessionBase::SendReceive(TInt aFunction,TAny* aPtr)

RSubSessionBase::CreateSubSession(RSessionBase&amp;,TInt aFunction,const TAny* aPtr)
RSubSessionBase::Send(TInt aFunction,const TAny* aPtr)
RSubSessionBase::SendReceive(TInt aFunction,const TAny* aPtr,TRequestStatus&amp;)
RSubSessionBase::SendReceive(TInt aFunction,const TAny* aPtr)

RThread::GetDesLength(const TAny* aPtr)
RThread::GetDesMaxLength(const TAny* aPtr)
RThread::ReadL(const TAny* aPtr,TDes8&amp; aDes,TInt anOffset)
RThread::ReadL(const TAny* aPtr,TDes16 &amp;aDes,TInt anOffset)
RThread::WriteL(const TAny* aPtr,const TDesC8&amp; aDes,TInt anOffset)
RThread::WriteL(const TAny* aPtr,const TDesC16&amp; aDes,TInt anOffset)</pre>
 <p>The
following functions are considered part of the client-server Version 1 APIs,
when the target thread is in another process. Note that these APIs are <em>not</em> hidden
by the <samp class="codeph">__HIDE_IPC_V1__</samp> macro. </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-BDAF69BC-F736-5E2F-9E7C-37B9AAC75A0E"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-BDAF69BC-F736-5E2F-9E7C-37B9AAC75A0E"><!-- --></a>RThread::RequestComplete(TRequestStatus*&amp; aStatus,TInt aReason)
RThread::Kill(TInt aReason)
RThread::Terminate(TInt aReason)
RThread::Panic(const TDesC&amp; aCategory,TInt aReason)
      </pre>
 </div>

<div class="section" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8BDFF94E-80E6-5CAF-8CC0-04D7F74FAF43"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8BDFF94E-80E6-5CAF-8CC0-04D7F74FAF43"><!-- --></a><h2 class="sectiontitle">The Version
2 client-server APIs</h2> <p>The following classes and functions are defined
as constituting the Version 2 client-server APIs. </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E2EDBA7A-5668-52F4-BCF1-18F53A2DD1E9"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E2EDBA7A-5668-52F4-BCF1-18F53A2DD1E9"><!-- --></a>class CSession2
class CServer2
class RMessagePtr2
class RMessage2
class RServer2
class TIpcArgs

RSessionBase::Send(TInt aFunction,const TIpcArgs&amp; aArgs)
RSessionBase::SendReceive(TInt aFunction,const TIpcArgs&amp; aArgs, TRequestStatus&amp;)
RSessionBase::SendReceive(TInt aFunction, const TIpcArgs&amp; aArgs)
RSessionBase::ShareAuto()

RSubSessionBase::CreateSubSession(RSessionBase&amp;,TInt aFunction,const TIpcArgs&amp;)
RSubSessionBase::Send(TInt aFunction,const TIpcArgs&amp; aArgs)
RSubSessionBase::SendReceive(TInt aFunction,const TIpcArgs&amp; aArgs, TRequestStatus&amp;)
RSubSessionBase::SendReceive(TInt aFunction,const TIpcArgs&amp; aArgs)</pre>
 </div>

<div class="section" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C5A1C9BA-7637-53EB-9898-A58336F87389"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C5A1C9BA-7637-53EB-9898-A58336F87389"><!-- --></a><h2 class="sectiontitle">Changes to
the client interface</h2> <p>The client interface to a server consists
of a class derived either from <samp class="codeph">RSessionBase</samp> or <samp class="codeph">RSubSessionBase</samp>.
This section lists the changes required to the use of these classes. </p>
 <ul>
<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-65CF4ED6-3133-5452-800C-F1EDA040B7C2"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-65CF4ED6-3133-5452-800C-F1EDA040B7C2"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F5FB0FB3-6868-5B26-99A5-62082BFA87FD">RSessionBase::Share()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-93211175-EBE0-5C2E-9F67-3BFF6E50E5DD"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-93211175-EBE0-5C2E-9F67-3BFF6E50E5DD"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-68B92D5D-7786-51CD-9A3D-7C835FD64496">RSessionBase::Attach()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-596E1B2A-E1FF-553B-A257-A4091DD15F1A"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-596E1B2A-E1FF-553B-A257-A4091DD15F1A"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8AF1B8B3-F598-5318-B9F9-5C74EEE8FCC9">RSessionBase::Send() &amp; RSessionBase::SendReceive()</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E88F13D3-C4C9-5624-A90B-2CC3EA841D5D"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E88F13D3-C4C9-5624-A90B-2CC3EA841D5D"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-449D6257-772B-5E08-8E4B-40C11EAF8FBA">RSubSessionBase::CreateSubSession()</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B28619D3-BDE6-5434-AB33-3016BA200633"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B28619D3-BDE6-5434-AB33-3016BA200633"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-858A58D1-A539-55FB-855E-50B997BA9A41">RSubSessionBase::Send() &amp; RSubSessionBase::SendReceive()</a>  </p>
 </li>

</ul>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F5FB0FB3-6868-5B26-99A5-62082BFA87FD"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F5FB0FB3-6868-5B26-99A5-62082BFA87FD"><!-- --></a><strong>RSessionBase::Share()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-175135E8-8583-53E4-8829-88738EEFA357"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-175135E8-8583-53E4-8829-88738EEFA357" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 functions: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3A5C2CAB-646B-5C1F-BA30-9808202B61E5"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3A5C2CAB-646B-5C1F-BA30-9808202B61E5"><!-- --></a>Share()
Share(EExplicitAttach)
Share(EAutoAttach)</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D946029A-A553-5BB3-B868-5348D06CF11E"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D946029A-A553-5BB3-B868-5348D06CF11E"><!-- --></a>ShareAuto()</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>In Version 1, the two different share modes existed for historical
reasons. All sessions created with new Version 2 servers behave like the Version
1 <em>auto attach</em> sessions; there is no <em>explicit attach</em> sharing
mode. The new <samp class="codeph">ShareAuto()</samp> function should be used to replace
all occurrences of <samp class="codeph">Share()</samp>. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-68B92D5D-7786-51CD-9A3D-7C835FD64496"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-68B92D5D-7786-51CD-9A3D-7C835FD64496"><!-- --></a><strong>RSessionBase::Attach()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-43575561-41F7-5F61-ADF2-06892D06941B"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-43575561-41F7-5F61-ADF2-06892D06941B" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4E94517B-AAD4-5A7C-8B67-19E2DABF99BF"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4E94517B-AAD4-5A7C-8B67-19E2DABF99BF"><!-- --></a>Attach()</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><p>NONE </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>There is no explicit attach mode in the Version 2 API, (see <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F5FB0FB3-6868-5B26-99A5-62082BFA87FD">RSessionBase::Share()</a>).
This means that all occurrences of <samp class="codeph">Attach()</samp> must be removed
from your code when migrating. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8AF1B8B3-F598-5318-B9F9-5C74EEE8FCC9"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8AF1B8B3-F598-5318-B9F9-5C74EEE8FCC9"><!-- --></a><strong>RSessionBase::Send() &amp;
RSessionBase::SendReceive()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-BA09FDB1-4DF3-5D73-B314-1333E479FF35"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-BA09FDB1-4DF3-5D73-B314-1333E479FF35" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 functions: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-7117993F-8620-598F-818B-769B91A94E02"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-7117993F-8620-598F-818B-769B91A94E02"><!-- --></a>Send(TInt aFunction,TAny* aPtr)
SendReceive(TInt aFunction,TAny* aPtr,TRequestStatus&amp; aStatus)
SendReceive(TInt aFunction,TAny* aPtr)</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 functions: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0A9B8E34-708E-531F-B6C3-2AD2EF9A831B"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0A9B8E34-708E-531F-B6C3-2AD2EF9A831B"><!-- --></a>Send(TInt aFunction,const TIpcArgs&amp; aArgs)
SendReceive(TInt aFunction,const TIpcArgs&amp; aArgs, TRequestStatus&amp; aStatus)
SendReceive(TInt aFunction, const TIpcArgs&amp; aArgs)</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>These are functions for sending request messages to a server.
Each of these messages can take up to <samp class="codeph">KMaxMessageArguments</samp> arbitrary
arguments (i.e. 4 arguments), and it is the packaging of these arguments which
has been changed in the Version 2 APIs. </p>
 <p>The Version 1 APIs take a <samp class="codeph">TAny*</samp>,
which points to a C array containing a <samp class="codeph">KMaxMessageArguments</samp> number
of 32-bit quantities, usually <samp class="codeph">TAny</samp> * or <samp class="codeph">TInt</samp> types.
This is an example Version 1 client function: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-5FF9D271-11EC-5144-A3ED-8D0B65DD43E1"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-5FF9D271-11EC-5144-A3ED-8D0B65DD43E1"><!-- --></a>TInt RMySession::Write(TDes8C&amp; aDes, TInt aLength, TInt aMode)
    {
    TAny* args[KMaxMessageArguments];
    args[0]=&amp;aDes;
    args[1]=(TAny*)aLength;
    args[2]=(TAny*)aMode;
    return SendReceive(ERequestWrite, &amp;args[0]);
    }</pre>
 <p>The Version 2 APIs package all of the arguments into
a <samp class="codeph">TIpcArgs</samp> object. This has templated constructors that take
between 0 and 4 objects. The above example would be implemented like this
using the Version 2 APIs: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3AD69C4D-B00D-5384-9455-4529235ADC0B"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3AD69C4D-B00D-5384-9455-4529235ADC0B"><!-- --></a>TInt RMySession::Write(TDes8&amp; aDes, TInt aLength, TInt aMode)
    {
    TIpcArgs args(&amp;aDes, aLength, aMode);
    return SendReceive(ERequestWrite, args);
    }</pre>
 <p>This could also be written in a shorter way: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-9F904E6F-C2BE-57C9-B287-F25D4C743B54"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-9F904E6F-C2BE-57C9-B287-F25D4C743B54"><!-- --></a>TInt RMySession::Write(TDes8C&amp; aDes, TInt aLength, TInt aMode)
    {
    return SendReceive(ERequestWrite, TIpcArgs(&amp;aDes, aLength, aMode) );
    }</pre>
 <p>The <samp class="codeph">TIpcArgs</samp> object stores additional
type information for each argument, and this is used to validate a server's
usage of the arguments with the various <samp class="codeph">RMessagePtr2::Read()</samp> and <samp class="codeph">RMessagePtr2::Write()</samp> functions. </p>
 <p>If
you need to explicitly send an empty or unused argument to a server, then
use the <samp class="codeph">ENothing</samp> enumeration. For example: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1AFAE8D7-6EF1-531C-9605-249952DD3414"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1AFAE8D7-6EF1-531C-9605-249952DD3414"><!-- --></a>TIpcArgs args(arg1, TIpcArgs::ENothing, arg3);</pre>
 <p>The
second argument will have an undefined value when the server receives the
message. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-449D6257-772B-5E08-8E4B-40C11EAF8FBA"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-449D6257-772B-5E08-8E4B-40C11EAF8FBA"><!-- --></a><strong>RSubSessionBase::CreateSubSession()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D11D839A-A6DC-56F6-A375-715C3C20DB58"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D11D839A-A6DC-56F6-A375-715C3C20DB58" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C10014FE-A269-55B4-8D7C-AFA726A7468D"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C10014FE-A269-55B4-8D7C-AFA726A7468D"><!-- --></a>CreateSubSession(RSessionBase&amp; aSession,TInt aFunction,const TAny* aPtr)</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4EDF33FA-B99D-5089-AB2E-F6DD29814FA7"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4EDF33FA-B99D-5089-AB2E-F6DD29814FA7"><!-- --></a>CreateSubSession(RSessionBase, TInt aFunction, const TIpcArgs&amp; aArgs)</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>The message arguments supplied to this function use a <samp class="codeph">TIpcArgs</samp> object
in Version 2. This is for the same reason as described in <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8AF1B8B3-F598-5318-B9F9-5C74EEE8FCC9">RSessionBase::Send() &amp; RSessionBase::SendReceive()</a>. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-858A58D1-A539-55FB-855E-50B997BA9A41"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-858A58D1-A539-55FB-855E-50B997BA9A41"><!-- --></a><strong>RSubSessionBase::Send()
&amp; RSubSessionBase::SendReceive()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3357BA2C-42CF-5590-94EE-0AC5C46C463B"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3357BA2C-42CF-5590-94EE-0AC5C46C463B" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 functions: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4CCEAB86-160A-50DD-B2AD-63BAD6E865C7"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4CCEAB86-160A-50DD-B2AD-63BAD6E865C7"><!-- --></a>Send(TInt aFunction,const TAny* aPtr)
SendReceive(TInt aFunction,const TAny* aPtr,TRequestStatus&amp;)
SendReceive(TInt aFunction,const TAny* aPtr)</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 functions: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0E7FE44C-19E2-5F5C-98A7-04F9F7129C70"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0E7FE44C-19E2-5F5C-98A7-04F9F7129C70"><!-- --></a>Send(TInt aFunction,const TIpcArgs&amp; aArgs)
SendReceive(TInt aFunction,const TIpcArgs&amp; aArgs, TRequestStatus&amp;)
SendReceive(TInt aFunction,const TIpcArgs&amp; aArgs)</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>The message arguments supplied to this function use a <samp class="codeph">TIpcArgs</samp> object
in Version 2. This is for the same reason as described in <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8AF1B8B3-F598-5318-B9F9-5C74EEE8FCC9">RSessionBase::Send() &amp; RSessionBase::SendReceive()</a>. </p>
 </div>

<div class="section" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-450BE510-C3C9-5988-853B-1A03A84F0875"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-450BE510-C3C9-5988-853B-1A03A84F0875"><!-- --></a><h2 class="sectiontitle">Changes to
the server interface</h2> <p>This section details the changes required
to migrate a server implementation to the Version 2 APIs. These APIs have,
in nearly all cases, been implemented using the same class names as in Version
1, but with the addition of the suffix '2'. For example, <samp class="codeph">CServer2</samp> implements
the Version 2 APIs corresponding to the Version 1 functionality provided by <samp class="codeph">CServer</samp>. </p>
 <ul>
<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F2E4AB18-F24A-5EEF-B5CC-F8FBF947DE4E"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F2E4AB18-F24A-5EEF-B5CC-F8FBF947DE4E"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-43CF1E50-8E60-5633-97B7-B030D1DEC182">CServer</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-7A262AF7-DBBD-5765-8179-F72E288304B2"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-7A262AF7-DBBD-5765-8179-F72E288304B2"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B05AFD51-FF98-5972-9F40-107D8F8FEA5A">CServer::NewSessionL()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1E1E1D8C-5BA5-5116-99B0-41453000DEE5"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1E1E1D8C-5BA5-5116-99B0-41453000DEE5"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-77592C37-AF3E-59DE-981E-AF23B442163B">CSharableSession</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C02F715E-6DF6-5AB0-A607-D740F32ADCEF"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C02F715E-6DF6-5AB0-A607-D740F32ADCEF"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1616B87E-A4C3-509B-AF79-D4A964032BF1">CSharableSession::CreateL()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3D09C142-DCF5-5FC6-99CC-A54D2FBECFBF"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3D09C142-DCF5-5FC6-99CC-A54D2FBECFBF"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-868E4703-DD82-5145-809D-91908237266C">CSharableSession::ResourceCountMarkEnd()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-38A6E9AB-4804-5852-907D-264F0CDA6D0B"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-38A6E9AB-4804-5852-907D-264F0CDA6D0B"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-54BF8797-7AE5-57E0-B5FD-C36C45D8CFFB">CSharableSession::RMessage()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-69440B22-6333-5783-A129-AFFFF7639068"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-69440B22-6333-5783-A129-AFFFF7639068"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F62D83DD-2A1C-5745-9813-E6646FF167BB">CSession</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-12DC701E-E313-5CFA-9113-077423AE1CFE"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-12DC701E-E313-5CFA-9113-077423AE1CFE"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F0C1B0F6-BF72-5A52-84D1-E7E748D3E1A5">CSession::CSession()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D1DE193D-A5E7-5A80-B317-2E657008B174"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D1DE193D-A5E7-5A80-B317-2E657008B174"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F2BB351E-73DA-522A-96ED-361F2EB1A379">RMessage</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-606187D7-226C-5919-86D9-7881540D30D6"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-606187D7-226C-5919-86D9-7881540D30D6"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B0431DFE-C0E5-5767-A299-564EC502B01E">RMessage::Client()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-06E2F69F-ABEE-5AB8-9751-45E285C3B494"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-06E2F69F-ABEE-5AB8-9751-45E285C3B494"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4EEFEF47-D875-5C16-8836-98DD03C0A91D">RMessage::MessagePtr()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-73BB6C0D-FEE3-5C9A-B2E6-7BFCD2C59C1B"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-73BB6C0D-FEE3-5C9A-B2E6-7BFCD2C59C1B"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8754F52F-371C-546B-9290-B5369E915318">RMessage::descriptor access methods</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CE72E73D-4BA9-566B-ABA0-6FC52F1E17EC"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CE72E73D-4BA9-566B-ABA0-6FC52F1E17EC"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-49869449-4440-5D20-97ED-32C14C5D1DAF">RMessagePtr</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F91895A2-E211-56AF-9DA8-372D312E5E1B"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F91895A2-E211-56AF-9DA8-372D312E5E1B"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A94A9960-319C-51B5-B693-2538D3985004">RThread</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4C8AF2A5-72D9-5367-9A7E-3721CC94401F"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4C8AF2A5-72D9-5367-9A7E-3721CC94401F"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-9DA5C542-44B6-5277-837D-1D9150F43B10">RThread::RequestComplete()</a> </p>
 </li>

</ul>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-43CF1E50-8E60-5633-97B7-B030D1DEC182"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-43CF1E50-8E60-5633-97B7-B030D1DEC182"><!-- --></a><strong>CServer</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-BD8385C6-AEAA-5379-87F3-F3B3A9CA5397"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-BD8385C6-AEAA-5379-87F3-F3B3A9CA5397" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-48ECE79F-22EA-5DE5-A52F-1F6689969E3C"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-48ECE79F-22EA-5DE5-A52F-1F6689969E3C"><!-- --></a>CServer</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F213E0FA-2708-5365-92F5-551D0A3B15FB"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F213E0FA-2708-5365-92F5-551D0A3B15FB"><!-- --></a>CServer2</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>Simply replace <samp class="codeph">CServer</samp> with <samp class="codeph">CServer2</samp>. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B05AFD51-FF98-5972-9F40-107D8F8FEA5A"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B05AFD51-FF98-5972-9F40-107D8F8FEA5A"><!-- --></a><strong>CServer::NewSessionL()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1755D610-F3C5-50A8-9CE4-BE357883373B"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1755D610-F3C5-50A8-9CE4-BE357883373B" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0E800CBB-6A25-5338-940C-93FD1D5EAB12"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0E800CBB-6A25-5338-940C-93FD1D5EAB12"><!-- --></a>CSharableSession* CServer::NewSessionL(const TVersion&amp; aVersion) const</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-515A05BB-AB3C-5231-B32A-C8812A55B414"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-515A05BB-AB3C-5231-B32A-C8812A55B414"><!-- --></a>CSession2* CServer2::NewSessionL(const TVersion&amp; aVersion,const RMessage2&amp; aMessage) const</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>In Version 1, <samp class="codeph">CServer::NewSessionL()</samp> is implemented
by a class derived from <samp class="codeph">CServer</samp>. In Version 2, your derived
class uses <samp class="codeph">CServer2</samp> as the base class. </p>
 <p>The <samp class="codeph">RMessage2</samp> argument
in Version 2 is the 'connect' message from the client. It has been added to
allow implementations to check identity and security information about the
new client. </p>
 <p>This message argument can be ignored when migrating code
from the Version 1 APIs. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-77592C37-AF3E-59DE-981E-AF23B442163B"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-77592C37-AF3E-59DE-981E-AF23B442163B"><!-- --></a><strong>CSharableSession</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3FE15D11-51FA-5B24-B153-47EF5B20C925"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3FE15D11-51FA-5B24-B153-47EF5B20C925" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-067FF488-35CE-585F-94FE-BF350B0DA2E1"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-067FF488-35CE-585F-94FE-BF350B0DA2E1"><!-- --></a>CSharableSession</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-241A9E7D-2FC5-5202-A9F1-FC17D5CA8F38"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-241A9E7D-2FC5-5202-A9F1-FC17D5CA8F38"><!-- --></a>CSession2</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>Simply replace <samp class="codeph">CSharableSession</samp> with <samp class="codeph">CSession2</samp>. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1616B87E-A4C3-509B-AF79-D4A964032BF1"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1616B87E-A4C3-509B-AF79-D4A964032BF1"><!-- --></a><strong>CSharableSession::CreateL()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-7805C54A-7534-5C20-BE26-09575363F9C2"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-7805C54A-7534-5C20-BE26-09575363F9C2" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D484349C-7B49-5DFE-8B0E-92AD511CC615"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D484349C-7B49-5DFE-8B0E-92AD511CC615"><!-- --></a>void CSharableSession::CreateL(const CServer&amp; aServer)</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-7B9C9D6D-A20C-571A-A533-3A4359067B84"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-7B9C9D6D-A20C-571A-A533-3A4359067B84"><!-- --></a>void CSession2::CreateL()</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>In Version 1, <samp class="codeph">CSharableSession::CreateL()</samp> can
be re-implemented by a class derived from <samp class="codeph">CSharableSession</samp>.
In Version 2, your derived class uses <samp class="codeph">CSession2</samp> as the base
class. </p>
 <p>The Version 2 <samp class="codeph">CreateL()</samp> function has no arguments.
If a derived session object overrides this function, then it will need modifying. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-868E4703-DD82-5145-809D-91908237266C"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-868E4703-DD82-5145-809D-91908237266C"><!-- --></a><strong>CSharableSession::ResourceCountMarkEnd()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0E84FAD2-8007-5EA6-BCBB-659E67B0E94D"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0E84FAD2-8007-5EA6-BCBB-659E67B0E94D" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-52CC1805-86C8-5B3F-8AC2-D53020B93DDF"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-52CC1805-86C8-5B3F-8AC2-D53020B93DDF"><!-- --></a>void CSharableSession::ResourceCountMarkEnd()</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-037656C1-A71D-52BA-80BE-9647B12D2E6E"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-037656C1-A71D-52BA-80BE-9647B12D2E6E"><!-- --></a>void CSession2::ResourceCountMarkEnd(const RMessage2&amp; aMessage)</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>In Version 2, the function requires a reference to the client
message that requested the resource check. This message is used to panic the
client if the check fails. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-54BF8797-7AE5-57E0-B5FD-C36C45D8CFFB"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-54BF8797-7AE5-57E0-B5FD-C36C45D8CFFB"><!-- --></a><strong>CSharableSession::RMessage()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-342A2BD3-8446-5437-B785-47BD8071B307"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-342A2BD3-8446-5437-B785-47BD8071B307" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-86D3741D-F30E-5A9A-A211-5A1C008B70B2"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-86D3741D-F30E-5A9A-A211-5A1C008B70B2"><!-- --></a>const RMessage&amp; CSharableSession::Message() const</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><p>No equivalent function. </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>In Version 1. this function returns a reference to the last message
delivered to the server. It is usually used by a session implementation to
mean <em>the current message being processed by the session</em>. </p>
 <p>This
function is not available in Version 2. When a session needs to manipulate
a message delivered to it, it should use the <samp class="codeph">RMessage2</samp> argument
passed to <samp class="codeph">ServiceL()</samp>, instead. Achieving this may require
passing this reference as an argument between function calls, or if that is
complex, then storing a reference to the message in the session object. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F62D83DD-2A1C-5745-9813-E6646FF167BB"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F62D83DD-2A1C-5745-9813-E6646FF167BB"><!-- --></a><strong>CSession</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-DB57B8A0-66D6-59CF-8DF6-15DBF0EDE488"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-DB57B8A0-66D6-59CF-8DF6-15DBF0EDE488" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-44314564-FEE3-57B5-8878-A989125074EB"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-44314564-FEE3-57B5-8878-A989125074EB"><!-- --></a>CSession</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-18D7BC87-81E7-54D0-A4E0-E4BDAB172FD8"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-18D7BC87-81E7-54D0-A4E0-E4BDAB172FD8"><!-- --></a>CSession2</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>Replace <samp class="codeph">CSession</samp> with <samp class="codeph">CSession2</samp>. </p>
 <p>The
changes applicable to <samp class="codeph">CSharableSession</samp> derived classes also
apply to <samp class="codeph">CSession</samp> derived classes. See: </p>
 <ul>
<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-5C5C37DF-5D39-571C-8998-43A3ECB48DA2"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-5C5C37DF-5D39-571C-8998-43A3ECB48DA2"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1616B87E-A4C3-509B-AF79-D4A964032BF1">CSharableSession::CreateL()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F40EFC23-D7A3-5814-8660-DEE9E9CE7762"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F40EFC23-D7A3-5814-8660-DEE9E9CE7762"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-868E4703-DD82-5145-809D-91908237266C">CSharableSession::ResourceCountMarkEnd()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-74ED0DB9-10A1-5616-9CFE-3FE2A37F1905"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-74ED0DB9-10A1-5616-9CFE-3FE2A37F1905"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-54BF8797-7AE5-57E0-B5FD-C36C45D8CFFB">CSharableSession::RMessage()</a> </p>
 </li>

</ul>
 <p>In addition, if you use the following <samp class="codeph">CSession</samp> functions,
then you will need to change your code to use the equivalent functions in
the <samp class="codeph">RMessage2</samp> and/or <samp class="codeph">RMessagePtr2</samp> classes.
See <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-07F7FFA6-D421-54E2-90F7-69F002702C46">Using
RMessagePtr2</a>. </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-97AE07E6-AA05-59D2-9F6E-4D063C40BAD2"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-97AE07E6-AA05-59D2-9F6E-4D063C40BAD2"><!-- --></a>void ReadL(const TAny* aPtr,TDes8&amp; aDes) const;
void ReadL(const TAny* aPtr,TDes8&amp; aDes,TInt anOffset) const;
void ReadL(const TAny* aPtr,TDes16&amp; aDes) const;
void ReadL(const TAny* aPtr,TDes16&amp; aDes,TInt anOffset) const;
void WriteL(const TAny* aPtr,const TDesC8&amp; aDes) const;
void WriteL(const TAny* aPtr,const TDesC8&amp; aDes,TInt anOffset) const;
void WriteL(const TAny* aPtr,const TDesC16&amp; aDes) const;
void WriteL(const TAny* aPtr,const TDesC16&amp; aDes,TInt anOffset) const;
void Panic(const TDesC&amp; aCategory,TInt aReason) const;
void Kill(TInt aReason) const;
void Terminate(TInt aReason) const;</pre>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F0C1B0F6-BF72-5A52-84D1-E7E748D3E1A5"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F0C1B0F6-BF72-5A52-84D1-E7E748D3E1A5"><!-- --></a><strong>CSession::CSession()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8EE0CBE3-B5C4-54A4-9027-0DD37C00EDBD"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8EE0CBE3-B5C4-54A4-9027-0DD37C00EDBD" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E445EA4B-C26A-5F19-BD11-8C420C005C9E"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E445EA4B-C26A-5F19-BD11-8C420C005C9E"><!-- --></a>CSession::CSession(RThread aClient)</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><p>No equivalent constructor. </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>The Version 1 <samp class="codeph">CSession</samp> object stores a handle
for the client thread. This should no longer be required after moving over
to Version 2, and indeed, a constructor taking a thread handle as an argument
is not supplied. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F2BB351E-73DA-522A-96ED-361F2EB1A379"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F2BB351E-73DA-522A-96ED-361F2EB1A379"><!-- --></a><strong>RMessage</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-AE303124-F8E6-5814-ABF3-86CE010AEB0D"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-AE303124-F8E6-5814-ABF3-86CE010AEB0D" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-97B0E175-06DD-56D5-B72D-F248AA327E28"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-97B0E175-06DD-56D5-B72D-F248AA327E28"><!-- --></a>RMessage</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F4DEABFB-9B23-5CA1-B8B4-2A83FA36F787"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F4DEABFB-9B23-5CA1-B8B4-2A83FA36F787"><!-- --></a>RMessage2</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>Replace <samp class="codeph">RMessage</samp> with <samp class="codeph">RMessage2</samp>. </p>
 <p>Note
that <samp class="codeph">RMessage2</samp> derives from <samp class="codeph">RMessagePtr2</samp> and
that most of the functions that were members of the Version 1 class <samp class="codeph">RMessage</samp> are
now implemented in the Version 2 class <samp class="codeph">RMessagePtr2</samp>. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B0431DFE-C0E5-5767-A299-564EC502B01E"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B0431DFE-C0E5-5767-A299-564EC502B01E"><!-- --></a><strong>RMessage::Client()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D8B43D00-689F-5A63-B2D8-89D74E2D5ACE"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D8B43D00-689F-5A63-B2D8-89D74E2D5ACE" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-2E080CC6-801E-5E91-9146-BE08338C7F2E"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-2E080CC6-801E-5E91-9146-BE08338C7F2E"><!-- --></a>const RThread&amp; RMessage::Client() const</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-6FC3BD1F-11BC-5309-AFE3-EC3043B162E6"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-6FC3BD1F-11BC-5309-AFE3-EC3043B162E6"><!-- --></a>TInt RMessage2::Client(RThread&amp; aClient, TOwnerType aOwnerType=EOwnerProcess) const</pre>
 <p>(Note that the function is implemented by the <samp class="codeph">RMessagePtr2</samp> base
class.) </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>In Version 1, the kernel maintains a handle to the client thread
which can be extracted from a message by calling <samp class="codeph">RMessage::Client()</samp>. </p>
 <p>In
Version 2, this special handle is not present; instead, a function is provided
that explicitly opens a handle on the client thread. This should be treated
just like any other thread handle, i.e. <samp class="codeph">Close()</samp> should be
called on the handle when it is no longer needed. </p>
 <p>Here's an example
of its usage: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-60EB6ACF-4A2D-5EEA-9008-265DDEF3E332"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-60EB6ACF-4A2D-5EEA-9008-265DDEF3E332"><!-- --></a>void CMySession::ServiceL(const RMessage2&amp; aMessage)
    {
    ...
    RThread clientThread;
    // Open a handle on the client thread. Leaving if there is an error.
    User::LeaveIfError(aMessage.Client(clientThread));
    // Do something with the handle. (Print its ID in this example)
    RDebug::Print(_L("Client Thread ID = %n"),clientThread.Id());
    // Close handle
    clientThread.Close();
    ...
    }</pre>
 <p> <strong>You need to carefully examine all uses of RMessage::Client(),
as most servers should not need to use this function after migrating to the
Version 2 APIs. This is because the use of thread handles in a Version 1 server
is likely to involve those functions that have been removed from the Version
2 APIs.</strong> See <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A94A9960-319C-51B5-B693-2538D3985004">RThread</a> for
more information. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4EEFEF47-D875-5C16-8836-98DD03C0A91D"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4EEFEF47-D875-5C16-8836-98DD03C0A91D"><!-- --></a><strong>RMessage::MessagePtr()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C4466017-A740-505D-BFF2-90CCE1014878"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-C4466017-A740-505D-BFF2-90CCE1014878" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D771DA22-E50F-532E-AE35-16FCFD1194B9"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D771DA22-E50F-532E-AE35-16FCFD1194B9"><!-- --></a>const RMessagePtr RMessage::MessagePtr() const</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><p>No equivalent function. </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p> <samp class="codeph">RMessage2</samp> derives from <samp class="codeph">RMessagePtr2</samp>,
therefore an <samp class="codeph">RMessagePtr2</samp> can be simply constructed or assigned
directly from an <samp class="codeph">RMessage2</samp>. There is no need for an explicit
method of construction as was the case in the Version 1 APIs. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8754F52F-371C-546B-9290-B5369E915318"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-8754F52F-371C-546B-9290-B5369E915318"><!-- --></a><strong>RMessage::descriptor access
methods</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E584453B-6BC7-56C1-9FDB-E531A3BC0A8C"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E584453B-6BC7-56C1-9FDB-E531A3BC0A8C" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 functions: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-9C3A91D8-FABE-5D70-91F0-0103FAD39E63"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-9C3A91D8-FABE-5D70-91F0-0103FAD39E63"><!-- --></a>void RMessage::ReadL(const TAny* aPtr,TDes8&amp; aDes) const;
void RMessage::ReadL(const TAny* aPtr,TDes8&amp; aDes,TInt anOffset) const;
void RMessage::ReadL(const TAny* aPtr,TDes16&amp; aDes) const;
void RMessage::ReadL(const TAny* aPtr,TDes16&amp; aDes,TInt anOffset) const;
void RMessage::WriteL(const TAny* aPtr,const TDesC8&amp; aDes) const;
void RMessage::WriteL(const TAny* aPtr,const TDesC8&amp; aDes,TInt anOffset) const;
void RMessage::WriteL(const TAny* aPtr,const TDesC16&amp; aDes) const;
void RMessage::WriteL(const TAny* aPtr,const TDesC16&amp; aDes,TInt anOffset) const;</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 functions: </p>
 </td>

<td class="cellrowborder" valign="top"><p>These functions are replaced by functions that take a message argument
index instead of a <samp class="codeph">TAny*</samp>. See <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-07F7FFA6-D421-54E2-90F7-69F002702C46">Using
RMessagePtr2</a>. </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-49869449-4440-5D20-97ED-32C14C5D1DAF"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-49869449-4440-5D20-97ED-32C14C5D1DAF"><!-- --></a><strong>RMessagePtr</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D7F81784-48AD-5896-8DFF-F71CCE379E1D"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D7F81784-48AD-5896-8DFF-F71CCE379E1D" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-BF9BEDE9-DB54-5CEB-B66E-4ACA8D97AA92"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-BF9BEDE9-DB54-5CEB-B66E-4ACA8D97AA92"><!-- --></a>RMessagePtr</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 class: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-AD8BAE63-C125-5912-8B97-FAEE0F41CB58"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-AD8BAE63-C125-5912-8B97-FAEE0F41CB58"><!-- --></a>RMessagePtr2</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>Replace <samp class="codeph">RMessagePtr</samp> with <samp class="codeph">RMessagePtr2</samp>. </p>
 <p>See <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-07F7FFA6-D421-54E2-90F7-69F002702C46">Using
RMessagePtr2</a>. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A94A9960-319C-51B5-B693-2538D3985004"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A94A9960-319C-51B5-B693-2538D3985004"><!-- --></a><strong>RThread</strong> </p>
 <p>Calls
to the following functions need to be changed to use the equivalent functions
in a <samp class="codeph">RMessage2</samp> /<samp class="codeph">RMessagePtr2</samp> class. See <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-07F7FFA6-D421-54E2-90F7-69F002702C46">Using
RMessagePtr2</a>. </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-589B9378-3AF1-5AFF-99A1-ADF44D7AB575"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-589B9378-3AF1-5AFF-99A1-ADF44D7AB575"><!-- --></a>TInt RThread::GetDesLength(const TAny* aPtr) const
TInt RThread::GetDesMaxLength(const TAny* aPtr)
void RThread::ReadL(const TAny* aPtr,TDes8&amp; aDes,TInt anOffset) const
void RThread::ReadL(const TAny* aPtr,TDes16 &amp;aDes,TInt anOffset) const
void RThread::WriteL(const TAny* aPtr,const TDesC8&amp; aDes,TInt anOffset) const
void RThread::WriteL(const TAny* aPtr,const TDesC16&amp; aDes,TInt anOffset) const
void RThread::Kill(TInt aReason)
void RThread::Terminate(TInt aReason)
void RThread::Panic(const TDesC&amp; aCategory,TInt aReason)</pre>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-9DA5C542-44B6-5277-837D-1D9150F43B10"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-9DA5C542-44B6-5277-837D-1D9150F43B10"><!-- --></a><strong>RThread::RequestComplete()</strong> </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CB602E73-0C6F-51DC-88BB-CC2D334008DD"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CB602E73-0C6F-51DC-88BB-CC2D334008DD" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>Version 1 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0338C808-E3B3-567E-95AE-EA577E286A7B"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0338C808-E3B3-567E-95AE-EA577E286A7B"><!-- --></a>void RThread::RequestComplete(TRequestStatus*&amp; aStatus,TInt aReason) const</pre>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Version 2 function: </p>
 </td>

<td class="cellrowborder" valign="top"><pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-6201C836-1533-5252-B68A-2AEE7CFA59D9"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-6201C836-1533-5252-B68A-2AEE7CFA59D9"><!-- --></a>void RMessagePtr2::Complete(TInt aReason) const</pre>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>With the Version 2 APIs, the only way of signalling a client's
request status in a different process is by completing a message sent by the
client to the session. This means that a call to <samp class="codeph">RThread::RequestComplete()</samp> should
be replaced by a call to <samp class="codeph">RMessagePtr2::Complete()</samp>. This requires
some minor changes to the internal architecture of the server. </p>
 <p>An
example of a call to <samp class="codeph">RThread::RequestComplete()</samp> is where
a server implements a kind of notification service, where a client asks to
be signalled when some event or change of state occurs. </p>
 <p><strong>A
version 1 server implementation</strong> </p>
 <p>In a Version 1 server implementation,
the notification scheme is often implemented with code similar to this: </p>
 <p>Client
function: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-97208CAC-12F1-5871-A7FE-C9CD465B2C5E"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-97208CAC-12F1-5871-A7FE-C9CD465B2C5E"><!-- --></a>TInt RMySession::NotifyChanges(TRequestStatus&amp; aStatus)
    {
    TAny* args[KMaxMessageArguments];
    args[0]=&amp;aStatus;
    return SendReceive(ERequestNotifyChanges, &amp;args[0]);
    }</pre>
 <p>The server processes the request like this: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-34777BB5-E58B-5EA2-BF62-6CF96CBECA94"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-34777BB5-E58B-5EA2-BF62-6CF96CBECA94"><!-- --></a>void CMySession::ServiceL(const RMessage&amp; aMessage)
    {
    ...
    // Get arguments needed to signal client
    RThread clientThread = aMessage.Client();
    TRequestStatus* clientStatus = (TRequestStatus*)aMessage.Ptr0();
    // Make notify object
    TMyNotifyChanges notifyObject(clientThread,clientStatus);
    // Add notify object to list of all requests
    TInt result=AddNotification(notifyObject);
    // Complete request message
    aMessage.Complete(result);
    ...
    }</pre>
 <p>When the event happens, clients are notified: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E45B2795-EA7D-51EF-8892-0516E0BF53DB"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E45B2795-EA7D-51EF-8892-0516E0BF53DB"><!-- --></a>void CMySession::SignalNotifications(TInt aResult)
    {
    TMyNotifyChanges* notifyObject;
    while(notifyObject=RemoveNotifyObject())
        {
        // Complete each NotifyChanges object
        RThread clientThread = notifyObject-&gt;ClientThread();
        TRequestStatus* clientStatus = notifyObject-&gt;ClientStatus();
        clientThread.RequestComplete(clientStatus,aResult);
        }
    }</pre>
 <p><strong>A
version 2 server implementation</strong> </p>
 <p>In a Version 2 server implementation,
the notification scheme could be implemented using the Version 2 APIs like
this: </p>
 <p>Client function: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0FC0A82A-1C12-5455-BD31-1439C1BC89E2"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0FC0A82A-1C12-5455-BD31-1439C1BC89E2"><!-- --></a>void RMySession::NotifyChanges(TRequestStatus&amp; aStatus)
    {
    TIpcArgs args();   // No arguments
    // Use asynchronous SendReceive for request
    SendReceive(ERequestNotifyChanges, args, aStatus);
    // void return type because errors will be signalled through aStatus
    }</pre>
 <p>The server processes the request like this: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A27E21CB-C83E-5FA5-B06C-C7326B219314"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A27E21CB-C83E-5FA5-B06C-C7326B219314"><!-- --></a>void CMySession::ServiceL(const RMessage2&amp; aMessage)
    {
    ...
    RMessagePtr2 messagePtr = aMessage;
    // Make notify object
    TMyNotifyChanges notifyObject(messagePtr);
    // Add notify object to list of all requests
    TInt result=AddNotification(notifyObject);
    // Complete request message (only if error)
    if(result!=KErrNone)
        {
        aMessage.Complete(result);
        }
    ...
    }</pre>
 <p>When the event happens, clients will be notified: </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3CFBE6E0-226F-5893-BB8B-978D739A2379"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3CFBE6E0-226F-5893-BB8B-978D739A2379"><!-- --></a>void CMySession::SignalNotifications(TInt aResult)
    {
    TMyNotifyChanges* notifyObject;
    while(notifyObject=RemoveNotifyObject())
        {
        // Complete each NotifyChanges object
        RMessagePtr2 messagePtr = notifyObject-&gt;MessagePtr();
        messagePtr.Complete(aResult)
        }
    }</pre>
 </div>

<div class="section" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-07F7FFA6-D421-54E2-90F7-69F002702C46"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-07F7FFA6-D421-54E2-90F7-69F002702C46"><!-- --></a><h2 class="sectiontitle">Using RMessagePtr2</h2> <p>In
Version 2, a server's interaction with its clients is channelled through <samp class="codeph">RMessagePtr2</samp>,
from which <samp class="codeph">RMessage2</samp> is derived. An <samp class="codeph">RMessagePtr2</samp> object
acts as a handle to the message that the client has sent. The details of the
original message are maintained within the kernel so that it can enforce correct
use of the <samp class="codeph">RMessagePtr2</samp> functions. </p>
 <p>The <samp class="codeph">RThread</samp> and <samp class="codeph">RSession</samp> functions
for accessing descriptors, panicking the client and completing requests are
not available in Version 2. Instead, this functionality is provided by <samp class="codeph">RMessagePtr2</samp>.
Because of this, server implementations may need to have a reference to the
message available in many places. This may be done by passing such references
as arguments between functions or by storing a reference in the session object
processing the request. </p>
 <ul>
<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-522FC7B3-A4BA-5507-9BD3-05CBAE0DDED8"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-522FC7B3-A4BA-5507-9BD3-05CBAE0DDED8"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-5D18833F-55D6-50C1-94DB-569F5CA30ECB">Descriptor access functions</a>  </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D78F8B64-0E73-56EC-A40D-FC7E8FB1D722"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D78F8B64-0E73-56EC-A40D-FC7E8FB1D722"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4BCF7E62-3ACA-535C-B201-84E570F95DE1">RMessagePtr2::Complete()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-5DFDDBFB-41AE-5EBC-943A-528C1C42312F"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-5DFDDBFB-41AE-5EBC-943A-528C1C42312F"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-460A24B8-6BA3-5059-BE3B-FF9287ACF965">RMessagePtr2::Kill()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A21E615F-A19C-5673-A7A0-372309AC944F"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-A21E615F-A19C-5673-A7A0-372309AC944F"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-FD417FCA-8EC2-568F-A848-1F5712828E7D">RMessagePtr2::Terminate()</a> </p>
 </li>

<li id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CC7E6514-B7C0-507D-902C-2FE3F8EE1D36"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CC7E6514-B7C0-507D-902C-2FE3F8EE1D36"><!-- --></a><p> <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3005E91E-1930-5092-B89D-60772D5BD9CA">RMessagePtr2::Panic()</a> </p>
 </li>

</ul>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-5D18833F-55D6-50C1-94DB-569F5CA30ECB"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-5D18833F-55D6-50C1-94DB-569F5CA30ECB"><!-- --></a><strong>Descriptor access functions</strong> </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-959C66E7-9219-54F7-A104-374CCF8B9D5A"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-959C66E7-9219-54F7-A104-374CCF8B9D5A"><!-- --></a>TInt RMessagePtr2::GetDesLength(TInt aParam) const;
TInt RMessagePtr2::GetDesMaxLength(TInt aParam) const;
void RMessagePtr2::ReadL(TInt aParam,TDes8&amp; aDes,TInt aOffset=0) const;
void RMessagePtr2::ReadL(TInt aParam,TDes16 &amp;aDes,TInt aOffset=0) const;
void RMessagePtr2::WriteL(TInt aParam,const TDesC8&amp; aDes,TInt aOffset=0) const;
void RMessagePtr2::WriteL(TInt aParam,const TDesC16&amp; aDes,TInt aOffset=0) const;
TInt RMessagePtr2::Read(TInt aParam,TDes8&amp; aDes,TInt aOffset=0) const;
TInt RMessagePtr2::Read(TInt aParam,TDes16 &amp;aDes,TInt aOffset=0) const;
TInt RMessagePtr2::Write(TInt aParam,const TDesC8&amp; aDes,TInt aOffset=0) const;
TInt RMessagePtr2::Write(TInt aParam,const TDesC16&amp; aDes,TInt aOffset=0) const</pre>
 <p>These
are used in the same way as the equivalent <samp class="codeph">RThread</samp> functions
in the Version 1 APIs, except that instead of referring to the descriptor
by an address in the client, the <samp class="codeph">aParam</samp> argument is used.
This is a value between 0 and 3 and indicates which of the four arguments
in the original client message contains the pointer to the descriptor. </p>
 <p>For
example, if a client sends a message using code like this </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CF62ABBF-824D-5E84-A39B-58068C85C38F"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-CF62ABBF-824D-5E84-A39B-58068C85C38F"><!-- --></a>TInt RMySession::Write(TDes8C&amp; aDes, TInt aLength)
    {
    return SendReceive(ERequestWrite, TIpcArgs(&amp;aDes, aLength) );
    }</pre>
 <p>then the server would access <samp class="codeph">aDes</samp> using
an <samp class="codeph">aParam</samp> value of 0. </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B608F856-8443-58DC-BBAE-D3253E911EA5"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-B608F856-8443-58DC-BBAE-D3253E911EA5"><!-- --></a>void CMySession::ServiceL(const RMessage2&amp; aMessage)
    {
    ...
    TInt length=aMessage.Int1();  // Get length from message param 1
    TPtr8 buffer=MyNewBufferL(length);  // Make a new buffer for the data
    aMessage.ReadL(0,buffer);  // Read data from client descriptor (param 0)
    ...</pre>
 <p>Because <samp class="codeph">TIpcArgs</samp> also stores type
information about arguments, the kernel knows that argument 0 in the above
message is an 8-bit constant descriptor. On Symbian platforms
using the EKA2 kernel, this information is used to enforce correct usage of
descriptor access methods; in this case, trying to write to <samp class="codeph">aDes</samp>,
or treating it as a 16-bit descriptor would fail with <samp class="codeph">KErrBadDescriptor</samp>.
(The latter case would have allowed access to data beyond the length of the
8- bit descriptor. </p>
 <p>Note, both leaving and non-leaving versions of
the <samp class="codeph">Read()</samp> and <samp class="codeph">Write()</samp> functions are provided.
This allows the removal of some TRAP statements in code after migration to
the Version 2 APIs. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4BCF7E62-3ACA-535C-B201-84E570F95DE1"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4BCF7E62-3ACA-535C-B201-84E570F95DE1"><!-- --></a><strong>RMessagePtr2::Complete()</strong> </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D0231B69-B33C-5EF5-89D3-0D332C840518"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-D0231B69-B33C-5EF5-89D3-0D332C840518"><!-- --></a>void RMessagePtr2::Complete(TInt aReason) const;</pre>
 <p>This
function signals completion of the client request, in the same way that <samp class="codeph">RMessage::Complete()</samp> does
in Version 1. After completion, the <samp class="codeph">iHandle</samp> member is set
to zero, and this means that <samp class="codeph">RMessagePtr2::Handle()</samp> returns
zero, and <samp class="codeph">RMessagePtr2::IsNull()</samp> returns True. </p>
 <p>It
is important to note that once a message has been completed, it cannot be
used by the server, and any such attempt results in a KERN-EXEC 44 panic (Bad
Message Handle). To avoid this situation, implementations may need to check <samp class="codeph">RMessagePtr2::IsNull()</samp>,
but be aware that any copies of the message made before completion will not
have had their handles nulled. For this reason, it is best to avoid making
copies of <samp class="codeph">RMessage2</samp> or <samp class="codeph">RMessagePtr2</samp> objects,
this includes passing them as arguments to other functions 'by value'. Use
references instead. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-460A24B8-6BA3-5059-BE3B-FF9287ACF965"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-460A24B8-6BA3-5059-BE3B-FF9287ACF965"><!-- --></a><strong>RMessagePtr2::Kill()</strong> </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E3A4E634-BCA5-5680-96F8-8D83429BB832"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-E3A4E634-BCA5-5680-96F8-8D83429BB832"><!-- --></a>void RMessagePtr2::Kill(TInt aReason) const;</pre>
 <p>This
function is used in the same way as the equivalent <samp class="codeph">RMessage</samp> or <samp class="codeph">RThread</samp> functions
in Version 1. Note that this function also performs the action of <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4BCF7E62-3ACA-535C-B201-84E570F95DE1">RMessagePtr2::Complete()</a>, so care must be taken that the message is
not used again. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-FD417FCA-8EC2-568F-A848-1F5712828E7D"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-FD417FCA-8EC2-568F-A848-1F5712828E7D"><!-- --></a><strong>RMessagePtr2::Terminate()</strong> </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-69309A0B-36C9-5F5F-9C9B-DD0C318B35DB"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-69309A0B-36C9-5F5F-9C9B-DD0C318B35DB"><!-- --></a>void RMessagePtr2::Terminate(TInt aReason) const;</pre>
 <p>This
function is used in the same way as the equivalent <samp class="codeph">RMessage</samp> or <samp class="codeph">RThread</samp> functions
in Version 1. Note that this function also performs the action of <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4BCF7E62-3ACA-535C-B201-84E570F95DE1">RMessagePtr2::Complete()</a>, so care must be taken that the message is
not used again. </p>
 <p id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3005E91E-1930-5092-B89D-60772D5BD9CA"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-3005E91E-1930-5092-B89D-60772D5BD9CA"><!-- --></a><strong>RMessagePtr2::Panic()</strong> </p>
 <pre class="codeblock" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F31F59D2-D286-57F6-A685-C255225B45C8"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-F31F59D2-D286-57F6-A685-C255225B45C8"><!-- --></a>void RMessagePtr2::Panic(const TDesC&amp; aCategory,TInt aReason) const;</pre>
 <p>This
function is used in the same way as the equivalent <samp class="codeph">RMessage</samp> or <samp class="codeph">RThread</samp> functions
in Version 1. Note that this function also performs the action of <a href="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052.html#GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-4BCF7E62-3ACA-535C-B201-84E570F95DE1">RMessagePtr2::Complete()</a>, so care must be taken that the message is
not used again. </p>
 </div>

<div class="section" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1ABF5DC6-A957-5623-93AB-CD7631A36A33"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-1ABF5DC6-A957-5623-93AB-CD7631A36A33"><!-- --></a><h2 class="sectiontitle">Migration quick
reference</h2> <p>This is a quick reference to show you which Version 2
APIs you should use to replace the Version 1 APIs. </p>
 
<div class="tablenoborder"><a name="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0DAF9004-8A70-5F88-899D-996CC96090CC"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-0A332D6E-E712-5186-8CD0-D5022FA54052__GUID-0DAF9004-8A70-5F88-899D-996CC96090CC" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p> <strong>Version 1 (where used)</strong>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <strong>Version 2 (replace with...)</strong>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">CSharableSession</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">CSession2</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">CSession</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">CSession2</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">CServer</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">CServer2</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessage</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessage2</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RServer</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RServer2</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::GetDesLength(const TAny* aPtr)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::GetDesLength(TInt aParam)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::GetDesMaxLength(const TAny* aPtr)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::GetDesMaxLength(TInt aParam)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::ReadL(const TAny* aPtr,TDes8&amp; aDes,TInt  
                anOffset)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::ReadL(TInt aParam,TDes8&amp; aDes,TInt  
                aOffset=0)</samp>  </p>
 <p>Note: use of <samp class="codeph">RThread::ReadL()</samp> enclosed
in a TRAP statement can be replaced by the non-leaving <samp class="codeph">RMessagePtr2::Read()</samp>. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::ReadL(const TAny* aPtr,TDes16&amp; aDes,TInt 
                 anOffset) </samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::ReadL(TInt aParam,TDes16&amp; aDes,TInt 
                 aOffset=0)</samp>  </p>
 <p>Note: use of <samp class="codeph">RThread::ReadL()</samp> enclosed
in a TRAP statement can be replaced by the non-leaving <samp class="codeph">RMessagePtr2::Read()</samp>. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::WriteL(const TAny* aPtr,const TDesC8&amp;    
              aDes,TInt anOffset) </samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::WriteL(TInt aParam,const TDesC8&amp;    
              aDes,TInt aOffset=0)</samp>  </p>
 <p>Note: use of <samp class="codeph">RThread::WriteL()</samp> enclosed
in a TRAP statement can be replaced by the non-leaving <samp class="codeph">RMessagePtr2::Write()</samp>. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::WriteL(const TAny* aPtr,const TDesC16&amp;   
               aDes,TInt anOffset)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::WriteL(TInt aParam,const TDesC16&amp;   
               aDes,TInt aOffset=0)</samp>  </p>
 <p>Note: use of <samp class="codeph">RThread::WriteL()</samp> enclosed
in a TRAP statement can be replaced by the non-leaving <samp class="codeph">RMessagePtr2::Write()</samp>. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::RequestComplete(TRequestStatus*&amp; aStatus,TInt
                  aReason)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::Complete(TInt aReason)</samp>  </p>
 <p>Note:
the only way of signalling the client thread is by completing a message which
the client sent to the session. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::Kill(TInt aReason)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::Kill(TInt aReason)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::Terminate(TInt aReason)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::Terminate(TInt aReason)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RThread::Panic(const TDesC&amp; aCategory,TInt        
          aReason)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RMessagePtr2::Panic(const TDesC&amp; aCategory,TInt   
               aReason)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSessionBase::Share()</samp>  </p>
 <p>or </p>
 <p> <samp class="codeph">RSessionBase::Share(EExplicitAttach)</samp>  </p>
 <p>or </p>
 <p> <samp class="codeph">RSessionBase::Share(EAutoAttach)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSessionBase::ShareAuto()</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSessionBase::Attach()</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Not required in Version 2. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSessionBase::Send(TInt aFunction,TAny* aPtr)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSessionBase::Send(TInt aFunction,const TIpcArgs&amp; 
                 aArgs)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSessionBase::SendReceive(TInt aFunction,TAny*        
          aPtr,TRequestStatus&amp; aStatus)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSessionBase::SendReceive(TInt aFunction,const        
          TIpcArgs&amp; aArgs, TRequestStatus&amp; aStatus)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSessionBase::SendReceive(TInt aFunction,TAny* aPtr)</samp> </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSessionBase::SendReceive(TInt aFunction, const       
           TIpcArgs&amp; aArgs)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSubSessionBase::CreateSubSession(RSessionBase&amp;   
               aSession,TInt aFunction,const TAny* aPtr)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSubSessionBase::CreateSubSession(RSessionBase, TInt  
                aFunction, const TIpcArgs&amp; aArgs);</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSubSessionBase::Send(TInt aFunction,const TAny*      
            aPtr)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSubSessionBase::Send(TInt aFunction,const TIpcArgs&amp;
                  aArgs)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSubSessionBase::SendReceive(TInt aFunction,const TAny*
                  aPtr,TRequestStatus&amp;)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSubSessionBase::SendReceive(TInt aFunction,const     
             TIpcArgs&amp; aArgs, TRequestStatus&amp;)</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSubSessionBase::SendReceive(TInt aFunction,const TAny*
                  aPtr)</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">RSubSessionBase::SendReceive(TInt aFunction,const     
             TIpcArgs&amp; aArgs)</samp>  </p>
 </td>

</tr>

</tbody>

</table>
</div>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-6047DB3F-DC92-51DF-9EEB-00E79E890B54.html">Using Client-Server</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>