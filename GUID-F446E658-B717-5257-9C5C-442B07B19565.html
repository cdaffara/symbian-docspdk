<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="Performing Cryptographic Operations with Keys"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C3290344-486B-554D-97FC-42DF48E150AA.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-39B459CD-8210-59B5-95F4-85CE36676735.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-695FCEB8-EA04-5C1C-A197-648275BA0281.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C4389D60-2A8D-532D-9D92-E57B0CCD14CF.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-F446E658-B717-5257-9C5C-442B07B19565"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Performing Cryptographic Operations with Keys</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-F446E658-B717-5257-9C5C-442B07B19565"><a name="GUID-F446E658-B717-5257-9C5C-442B07B19565"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2858558 id2859383 id2859414 id2859476 id2859513 id2859527 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html">OS Security Guide</a> &gt; <a href="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html">Crypto Services</a> &gt; <a href="GUID-C3290344-486B-554D-97FC-42DF48E150AA.html">Certificate and Key Management</a> &gt; <a href="GUID-39B459CD-8210-59B5-95F4-85CE36676735.html">Unified Stores</a> &gt; <a href="GUID-695FCEB8-EA04-5C1C-A197-648275BA0281.html" title="The Unified Keystore is responsible for managing cryptographic keys.">Unified Keystore</a> &gt; <a href="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html" title="These tutorials explain the tasks that can be performed by client applications using the services provided by the unified keystore.">Unified Keystore Tutorials</a> &gt; </div>
<h1 class="topictitle1"> Performing
Cryptographic Operations with Keys</h1>
<div><div><p>You can use various types of algorithms (for example RSA sign,
DSA sign, Decrypt, DH key agreement, and so on) to perform cryptographic operations
with keys in the unified keystore. This section provides information on the
signing process. </p>
<p> The following steps explain the process of signing
keys by considering the example of an RSA signing operation:</p>
</div>

<a name="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-E7265950-3F94-51A6-BD6E-E99A25152E0B"><!-- --></a><ol id="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-E7265950-3F94-51A6-BD6E-E99A25152E0B"><li class="stepexpand" id="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-98896CA9-D5F6-5FCD-92B8-627D701DD080"><a name="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-98896CA9-D5F6-5FCD-92B8-627D701DD080"><!-- --></a><span/><br/>
 Create an object of type CUnifiedKeyStore using <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-C7A96153-4179-3B3F-878D-1EAA64A98D39"><span class="apiname">CUnifiedKeyStore::NewL()</span></a> or <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-217FBB3B-CEF5-36F2-A612-EDDA0982053C"><span class="apiname">CUnifiedKeyStore::NewLC()</span></a>. 
</li>
<li class="stepexpand" id="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-3CFD0F4D-5467-5FE5-9003-F16FDF6750B1"><a name="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-3CFD0F4D-5467-5FE5-9003-F16FDF6750B1"><!-- --></a><span/><br/>
 Initialise the member functions and keystore using the asynchronous
function <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-6C5D732C-1FD1-3EF0-AC90-87690F891B8D"><span class="apiname">CUnifiedKeyStore::Initialize()</span></a>. 
</li>
<li class="stepexpand" id="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-73A277E5-45B8-5F87-B114-2004AE4DD4C5"><a name="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-73A277E5-45B8-5F87-B114-2004AE4DD4C5"><!-- --></a><span/><br/>
 List all the keys in the keystore and then retrieve the key to be signed
based on filter criteria. 
</li>
<li class="stepexpand" id="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-036E7985-FB51-52C5-BC27-4ADAD38E0923"><a name="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-036E7985-FB51-52C5-BC27-4ADAD38E0923"><!-- --></a><span>Invoke the <samp class="codeph">MKeyStore::Open()</samp> function
for opening the key. This also enables the creation of an object capable of
performing the required signing operation. In the case of an RSA signing process,
the key is opened to create a <samp class="codeph">MRSASigner</samp> object. </span>
  Note: The following table lists the objects created for different cryptographic
operations: 
 
<div class="tablenoborder"><a name="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-0DE1BD27-AF6F-5CC1-8A9E-9D36380D4EBE"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-0DE1BD27-AF6F-5CC1-8A9E-9D36380D4EBE" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p> <strong>Operation</strong>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <strong>Object</strong>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>DSA Sign </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">MDSASigner</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>Decrypt </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">MCTDecryptor</samp>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>DH Key Agreement </p>
 </td>

<td class="cellrowborder" valign="top"><p> <samp class="codeph">MCTDH</samp>  </p>
 </td>

</tr>

</tbody>

</table>
</div>
 
</li>
<li class="stepexpand" id="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-D3E1854A-D798-5CB5-B528-AB5F672C2AC7"><a name="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-D3E1854A-D798-5CB5-B528-AB5F672C2AC7"><!-- --></a><span/><br/>
 Use <samp class="codeph">MCTSigner::SignMessage()</samp> or <samp class="codeph">MCTSigner::Sign()</samp> to
perform the signing operation. 
</li>
</ol>

<div class="section"><p>The <samp class="codeph">CRSASignature</samp> object contains the value of
the signing operation. </p>
 </div>

<div class="example"><p>The following code snippet shows RSA signing operation: </p>
<pre class="codeblock" id="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-B7FA7CF8-38D6-5088-B51E-73AB04139997"><a name="GUID-F446E658-B717-5257-9C5C-442B07B19565__GUID-B7FA7CF8-38D6-5088-B51E-73AB04139997"><!-- --></a>

//Create a file system session object
RFs iFs;
CleanupClosePushL(&amp;iFs);


//Initialise the keystore and member functions
CUnifiedKeyStore* keyStore = CUnifiedKeyStore::NewL(fs);
keyStore-&gt;Initialize(iStatus); //iStatus is a TRequestStatus object


...



// Create a filter to retrieve all keys from the store
TCTKeyAttributeFilter filter;
filter.iPolicyFilter = TCTKeyAttributeFilter:EAllKeys;



// Retrieve a list of all the keys from the key store
RPointerArray&lt;CCTKeyInfo&gt; iKeys; // This variable will contain the key to be signed
iKeyStore-&gt;List(iKeys,filter,iStatus);


...


// Retrieve the key based on the label you are looking for 
_LIT(Klabel,”keylabel”);
TInt keyCount = iKeys.Count();
for (i = 0; i &lt; keyCount; i++)
{
    CCTKeyInfo* keyInfo = iKeys[i];
    if (keyInfo-&gt;Label() == Klabel)
        {
            // Create a signer object for the key
            MRSASigner* iRSASigner
            // The signer object will be returned after the key has been opened for signing
            keyStore-&gt;Open(*keyInfo, iRSASigner, iStatus);
            break;
        }
}



// Perform the signing operation

// Define the data for signing

HBufC* dataToSign; 
dataToSign = HBufC::NewL(20);
_LIT(KTxtSign,"Data to be signed");
*dataToSign = KTxtSign; 


CRSASignature* iRSASignature;
// iRSASignature will contain the result after the completion
// of the following request

iRSASigner-&gt;SignMessage(*dataToSign, iRSASignature, iStatus);


...


// Retrieve the RSA signature value through the CRSASignature object 
TInt signature = iRSASignature-&gt;S();
</pre>
</div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html" title="These tutorials explain the tasks that can be performed by client applications using the services provided by the unified keystore.">Unified Keystore Tutorials</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-C4389D60-2A8D-532D-9D92-E57B0CCD14CF.html" title="The Unified Keystore provides a unified view of all the keystores in a device.">Unified Keystore</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>