<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Playback operation"/>
<meta name="abstract" content="Describes the operation of the Sound Driver for sound playback."/>
<meta name="description" content="Describes the operation of the Sound Driver for sound playback."/>
<meta name="DC.Relation" scheme="URI" content="GUID-8DC12024-7599-52E8-BCF1-D9D765EC7B9B.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-52371DAB-A231-558C-B3E6-220DAAEE566B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-669C77A3-89BA-5321-ABB1-4356A5FE478C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6D75968E-53CF-5436-8390-54CA12BCFDE9.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-8DC12024-7599-52E8-BCF1-D9D765EC7B9B.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-15FDDEED-89F1-5BE5-97AD-8DFD3640369A"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Playback operation</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-15FDDEED-89F1-5BE5-97AD-8DFD3640369A"><a name="GUID-15FDDEED-89F1-5BE5-97AD-8DFD3640369A"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2400778 id2402156 id2402170 id2402191 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-52371DAB-A231-558C-B3E6-220DAAEE566B.html" title="Provides software components that implement the interface between Symbian platform and peripherals.">Logical Device Drivers</a> &gt; <a href="GUID-669C77A3-89BA-5321-ABB1-4356A5FE478C.html" title="Describes how to create a port of the sound driver for your phone hardware.">Sound Driver</a> &gt; <a href="GUID-6D75968E-53CF-5436-8390-54CA12BCFDE9.html" title="Describes the technology, architecture, and behaviour of the Sound Driver.">Concepts</a> &gt; <a href="GUID-8DC12024-7599-52E8-BCF1-D9D765EC7B9B.html" title="Describes the behaviour of the Sound Driver for and record operations.">Dynamic Behaviour</a> &gt; </div>
<h1 class="topictitle1">Playback
operation</h1>
<div><p>Describes the operation of the Sound Driver for sound playback. </p>

<div class="section" id="GUID-15FDDEED-89F1-5BE5-97AD-8DFD3640369A__GUID-AECB2CE7-CB57-4AB2-B030-62E0A65851C9"><a name="GUID-15FDDEED-89F1-5BE5-97AD-8DFD3640369A__GUID-AECB2CE7-CB57-4AB2-B030-62E0A65851C9"><!-- --></a><h2 class="sectiontitle">Normal operation</h2> <p>The client calls <a href="GUID-B0118EDD-2B08-353E-BE92-2DC75E5622B3.html#GUID-B0118EDD-2B08-353E-BE92-2DC75E5622B3__GUID-DA119B93-6E4D-36DA-878A-D6709039E0EA"><span class="apiname">RSoundSc::PlayData()</span></a> to
issue an audio request. </p>
 <p>The LDD breaks the audio request into manageable
fragments and transfers them to the PDD by calling <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-8C79D09B-317A-3D8E-B9C2-474812F17529"><span class="apiname">DSoundScPdd::TransferData()</span></a>. </p>
 <p>When
the PDD has transmitted the fragment it calls <a href="GUID-5807543D-A30F-3EB9-8F28-91A623B0D484.html#GUID-5807543D-A30F-3EB9-8F28-91A623B0D484__GUID-16853E0D-60E8-3BEC-9E3E-9563BA7CAECE"><span class="apiname">DSoundScLdd::PlayCallback()</span></a> to
signal to the LDD that it has finished transfer of a fragment. When the client
request has been completed, the LDD calls <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-FDBEFD98-EE11-3358-869C-DECC3B5CF83A"><span class="apiname">DSoundScPdd::StopTransfer()</span></a> to
stop the PDD transmitting data and to release any transfer specific resources. </p>
 <p>To
ensure uninterrupted playback, a client must have multiple play requests pending
on the driver. As soon as one request completes, the client issues a further
request until the end of the track. Typically, a client issues a series of
calls to <a href="GUID-B0118EDD-2B08-353E-BE92-2DC75E5622B3.html#GUID-B0118EDD-2B08-353E-BE92-2DC75E5622B3__GUID-DA119B93-6E4D-36DA-878A-D6709039E0EA"><span class="apiname">RSoundSc::PlayData()</span></a> to play an audio track. </p>
 <p>Each <a href="GUID-B0118EDD-2B08-353E-BE92-2DC75E5622B3.html#GUID-B0118EDD-2B08-353E-BE92-2DC75E5622B3__GUID-DA119B93-6E4D-36DA-878A-D6709039E0EA"><span class="apiname">RSoundSc::PlayData()</span></a> request
is handled in the context of the driver's Deferred Function Call (DFC) thread.
Assuming that the driver is not already in the process of playing data when
the first request is received, the LDD checks whether the client has specified
or supplied a <a href="GUID-51514A4B-0220-557B-9F7A-FB110CEFEF10.html" title="A shared chunk is a mechanism that kernel-side code uses to share memory buffers safely with user-side code.">shared
chunk</a> to the <a href="GUID-E2641957-8163-5EF4-B282-FC3FD9CA75A6.html#GUID-E2641957-8163-5EF4-B282-FC3FD9CA75A6__GUID-4D6A01FE-47E7-5A6F-9DFE-F612B880165B">Driver
channel</a> and also whether the audio configuration and volume have both
been set. If the chunk configuration has not been specified, then the driver
cannot proceed and returns <samp class="codeph">KErrNotReady</samp>. However, if the
audio configuration or volume has not been specified, then the LDD simply
applies default settings to the audio hardware device. These values are returned
by the PDD functions <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-39AA2B2D-E98B-33A0-9C46-08B783413860"><span class="apiname">DSoundScPdd::SetConfig()</span></a> and <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-D893A29B-1A4B-35AF-876B-84D74B7E783C"><span class="apiname">DSoundScPdd::SetVolume()</span></a> when
called by the LDD. </p>
 <p>The LDD may need to break the play request down
into fragments to support the maximum amount of data that the PDD can handle
in a single transfer. The function <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-534D46F4-2CB1-3130-9E72-A1C3BF085865"><span class="apiname">DSoundScPdd::MaxTransferLen()</span></a> returns
this maximum value. The LDD queues as many transfer fragments on the PDD as
it can accept with a call to <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-8C79D09B-317A-3D8E-B9C2-474812F17529"><span class="apiname">DSoundScPdd::TransferData()</span></a> for
each fragment. </p>
 <p>To support uninterrupted transfer of audio data, the
PDD must be able to accept at least two transfer fragments simultaneously:
the first being actively transferred by the audio hardware device, the other
being queued for transfer on the same device. Therefore, as long as the LDD
has transfer fragments still to queue, it continues to call <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-8C79D09B-317A-3D8E-B9C2-474812F17529"><span class="apiname">DSoundScPdd::TransferData()</span></a> on
the PDD until this signals that it has temporarily reached its capacity, by
returning <samp class="codeph">KErrNotReady</samp>. </p>
 <p>If the PDD accepts all the
fragments for this initial play request then the LDD moves on to process the
subsequent requests from the client. These are also fragmented until either
the PDD reaches its capacity or all pending play requests are queued. </p>
 <p>Each
time the PDD completes the transfer of a fragment from a play buffer, it must
signal this event back to the LDD by calling the function <a href="GUID-5807543D-A30F-3EB9-8F28-91A623B0D484.html#GUID-5807543D-A30F-3EB9-8F28-91A623B0D484__GUID-16853E0D-60E8-3BEC-9E3E-9563BA7CAECE"><span class="apiname">DSoundScLdd::PlayCallback()</span></a>.
This must always be called in the context of the driver DFC thread so there
are no synchronisation problems. For example, where transfer completion interrupts
the processing of new play requests from the client. </p>
 <p>In executing <a href="GUID-5807543D-A30F-3EB9-8F28-91A623B0D484.html#GUID-5807543D-A30F-3EB9-8F28-91A623B0D484__GUID-16853E0D-60E8-3BEC-9E3E-9563BA7CAECE"><span class="apiname">DSoundScLdd::PlayCallback()</span></a>,
the LDD checks whether the entire transfer for the current request is now
complete. If so, it signals completion back to the client. Also within the <a href="GUID-5807543D-A30F-3EB9-8F28-91A623B0D484.html#GUID-5807543D-A30F-3EB9-8F28-91A623B0D484__GUID-16853E0D-60E8-3BEC-9E3E-9563BA7CAECE"><span class="apiname">DSoundScLdd::PlayCallback()</span></a> function,
the LDD will attempt to queue further fragments on the PDD, by calling <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-8C79D09B-317A-3D8E-B9C2-474812F17529"><span class="apiname">DSoundScPdd::TransferData()</span></a>,
as the PDD should now have the capability to accept more transfers. The PDD
must be written to handle calls to <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-8C79D09B-317A-3D8E-B9C2-474812F17529"><span class="apiname">DSoundScPdd::TransferData()</span></a> within
its callback to <a href="GUID-5807543D-A30F-3EB9-8F28-91A623B0D484.html#GUID-5807543D-A30F-3EB9-8F28-91A623B0D484__GUID-8440330E-E7B1-3B43-B3C9-2290E24241E3"><span class="apiname">DSoundScLdd::PlayCallBack()</span></a>. </p>
 <p>If,
on completing a request from the client, the LDD discovers that there are
no further play requests pending from the client, then this is treated as
an underflow situation and <samp class="codeph">KErrUnderflow</samp> is returned to the
client. If however, the client specified <samp class="codeph">KSndFlagLastSample</samp> as
the <samp class="codeph">aFlag</samp> argument of the <a href="GUID-B0118EDD-2B08-353E-BE92-2DC75E5622B3.html#GUID-B0118EDD-2B08-353E-BE92-2DC75E5622B3__GUID-DA119B93-6E4D-36DA-878A-D6709039E0EA"><span class="apiname">RSoundSc::PlayData()</span></a> function
then an underflow is expected after this request completes. </p>
 <p>When the
audio request has been completed the LDD calls <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-FDBEFD98-EE11-3358-869C-DECC3B5CF83A"><span class="apiname">DSoundScPdd::StopTransfer()</span></a> on
the PDD. This allows the PDD to release any resources necessary for transfer. </p>
 </div>

<div class="section" id="GUID-15FDDEED-89F1-5BE5-97AD-8DFD3640369A__GUID-E0C18DE6-E5FD-48D2-87A2-4E4C15C10BC0"><a name="GUID-15FDDEED-89F1-5BE5-97AD-8DFD3640369A__GUID-E0C18DE6-E5FD-48D2-87A2-4E4C15C10BC0"><!-- --></a><h2 class="sectiontitle">Pausing and resuming audio playback</h2> <p>The client
may temporarily halt the progress of audio playback at any time by issuing <a href="GUID-5807543D-A30F-3EB9-8F28-91A623B0D484.html#GUID-5807543D-A30F-3EB9-8F28-91A623B0D484__GUID-D912620F-9C51-3AFC-8A59-31AF9455AC4A"><span class="apiname">DSoundScLdd::Pause()</span></a>.
In order to configure the audio hardware device to halt playback, the LDD
calls <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-0608766F-2645-3E28-B804-BD4B953DB5FF"><span class="apiname">DSoundScPdd::PauseTransfer()</span></a> on the PDD. Ideally,
playback should be suspended in such a way that it can be resumed later, starting
from <em>next</em> sample following the one last played. </p>
 <p>The client
requests resumption of playback by calling <a href="GUID-5807543D-A30F-3EB9-8F28-91A623B0D484.html#GUID-5807543D-A30F-3EB9-8F28-91A623B0D484__GUID-86BF7277-0CDE-3DCE-8157-DCCD8E8D60F0"><span class="apiname">DSoundScLdd::Resume()</span></a> on
the LDD. The LDD, in turn tells the PDD to re-commence playback by calling <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-C692BF61-FA3D-3B85-BCC6-1248C9C7D9BF"><span class="apiname">DSoundScPdd::ResumeTransfer()</span></a>  </p>
 <p>Since
access to the hardware is required in both cases, pause and resume are handled
in the context of the driver DFC thread. </p>
 </div>

<div class="section" id="GUID-15FDDEED-89F1-5BE5-97AD-8DFD3640369A__GUID-A65EF976-2523-4CE0-BDE6-1F6AF8B5DDC4"><a name="GUID-15FDDEED-89F1-5BE5-97AD-8DFD3640369A__GUID-A65EF976-2523-4CE0-BDE6-1F6AF8B5DDC4"><!-- --></a><h2 class="sectiontitle">Error handling during playback</h2> <p>If the PDD reports
an error when setting up the audio device for playback then the LDD immediately
completes the first play request back to the client returning the error value
as the result. For example, if the PDD returns a value other than <samp class="codeph">KErrNone</samp> from
a call to the function <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-54D3CC19-0C00-3FFA-BD1A-62618D36EB20"><span class="apiname">DSoundScPdd::StartTransfer()</span></a>. The
LDD attempts to re-start playback data transfer when it processes any further
play requests from the client. </p>
 <p>If the PDD reports an error when commencing
transfer or as the result of the transfer of a playback fragment, then the
LDD ceases transfer of the associated request and instead immediately completes
the request back to the client returning the error value as the result. </p>
 <p>Unexpected
errors from the PDD are returned to the LDD via the functions <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-8C79D09B-317A-3D8E-B9C2-474812F17529"><span class="apiname">DSoundScPdd::TransferData()</span></a> and <a href="GUID-5807543D-A30F-3EB9-8F28-91A623B0D484.html#GUID-5807543D-A30F-3EB9-8F28-91A623B0D484__GUID-16853E0D-60E8-3BEC-9E3E-9563BA7CAECE"><span class="apiname">DSoundScLdd::PlayCallback()</span></a>. The <a href="GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424.html#GUID-61CC68CB-A01D-3CA0-93D9-F3717ABD6424__GUID-8C79D09B-317A-3D8E-B9C2-474812F17529"><span class="apiname">DSoundScPdd::TransferData()</span></a> function signals that
an error has occurred when setting up the transfer of a playback fragment
by returning an error value other than <samp class="codeph">KErrNone</samp> or <samp class="codeph">KErrNotReady</samp>.
The <a href="GUID-5807543D-A30F-3EB9-8F28-91A623B0D484.html#GUID-5807543D-A30F-3EB9-8F28-91A623B0D484__GUID-16853E0D-60E8-3BEC-9E3E-9563BA7CAECE"><span class="apiname">DSoundScLdd::PlayCallback()</span></a> function called by the
PDD at the end of a transfer, signals an error to the LDD if the value passed
is not equal to <samp class="codeph">KErrNone</samp>. </p>
 <p>The LDD does not cancel
the transfer of other fragments for the same request which are already queued
on the PDD, but it ignores their outcome. However, the LDD does try to carry
on with the transfer of subsequent play requests queued by the client. </p>
 <p>In
any of the above situations, the client may choose to terminate playback operation
by cancelling all outstanding play requests when it detects a playback error. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-8DC12024-7599-52E8-BCF1-D9D765EC7B9B.html" title="Describes the behaviour of the Sound Driver for and record operations.">Dynamic Behaviour</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>