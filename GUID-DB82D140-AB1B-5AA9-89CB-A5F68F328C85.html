<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="Creating an MTP Data Provider Plug-in"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3DFC21DA-D9F2-572C-9A6A-9AF1F55009CB.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A0D4B6EC-8FA7-5FD9-AE5A-E811D876D585.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-98ACB508-ED32-5193-9E30-BCDF7E921788.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0463683C-9E9A-55ED-836D-0826E8EFCA73.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3DFC21DA-D9F2-572C-9A6A-9AF1F55009CB.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Creating an MTP Data Provider Plug-in</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2534806 id2534929 id2534938 id2534958 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-A0D4B6EC-8FA7-5FD9-AE5A-E811D876D585.html">Remote Connectivity Guide</a> &gt; <a href="GUID-98ACB508-ED32-5193-9E30-BCDF7E921788.html">MTP Frameworks</a> &gt; <a href="GUID-0463683C-9E9A-55ED-836D-0826E8EFCA73.html">MTP Framework</a> &gt; <a href="GUID-3DFC21DA-D9F2-572C-9A6A-9AF1F55009CB.html">MTP Framework Tutorials</a> &gt; </div>
<h1 class="topictitle1">Creating
an MTP Data Provider Plug-in</h1>
<div>
<div class="p" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-E3BEB74D-79C7-59A9-9366-CCD8B52DB7F8-GENID-1-12-1-28-1-1-5-1-3-1-5-1-4-1-2-1"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-E3BEB74D-79C7-59A9-9366-CCD8B52DB7F8-GENID-1-12-1-28-1-1-5-1-3-1-5-1-4-1-2-1"><!-- --></a><p>Before you start,
you must: </p>
 <ul>
<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-83AE79AE-086A-5A3C-9A58-159CF32EBE32"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-83AE79AE-086A-5A3C-9A58-159CF32EBE32"><!-- --></a><p>Understand the MTP Data
Provider API. </p>
 </li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-893581C5-6E8D-5552-8624-C692058550AE"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-893581C5-6E8D-5552-8624-C692058550AE"><!-- --></a><p>Understand <a href="GUID-1E7AA950-06C2-599C-BCC2-12BB99306E1B.html">Symbian
capabilities</a>. </p>
 </li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-45FB644B-17AD-5E84-9645-82979D29FC20"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-45FB644B-17AD-5E84-9645-82979D29FC20"><!-- --></a><p> <a href="http://www.microsoft.com/whdc/device/wpd/MTPDevServExt_spec.mspx" target="_blank">MTP Device Services Extension Specification</a>. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-6799E3F3-353E-5C00-A38C-D32F888392AA-GENID-1-12-1-28-1-1-5-1-3-1-5-1-4-1-2-2"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-6799E3F3-353E-5C00-A38C-D32F888392AA-GENID-1-12-1-28-1-1-5-1-3-1-5-1-4-1-2-2"><!-- --></a><p>MTP data providers
are implemented as ECOM plug-ins loaded into the MTP framework. The MTP Data
Provider APIs enable device creators to create data provider plug-ins and
support specific media and data types. Data providers interact with the MTP
framework using the API/SPI interface pair. </p>
 </div>

<a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-CB0E761B-76EF-57F3-87E7-8CB508E1E08C"><!-- --></a><ol id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-CB0E761B-76EF-57F3-87E7-8CB508E1E08C"><li class="stepexpand" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-EC8BEF8F-2849-52D2-9801-E48E75AFFDB8"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-EC8BEF8F-2849-52D2-9801-E48E75AFFDB8"><!-- --></a><span>Create a data provider
plug-in class that derives from <a href="GUID-710B9980-7EF5-3E20-954B-795241D1D479.html"><span class="apiname">CMTPDataProviderPlugin</span></a> and
implements the abstract SPI methods defined by <a href="GUID-706C058C-6562-33F6-A923-4AD31C6233E3.html"><span class="apiname">MMTPDataProvider</span></a>. </span>
</li>
<li class="stepexpand" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-0BEC04D8-6399-55CC-8A07-41B832A13227"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-0BEC04D8-6399-55CC-8A07-41B832A13227"><!-- --></a><span>Call <samp class="codeph">MMTPDataProviderFramework::DataCodeGenerator()</samp> to
get a reference of <a href="GUID-86E1BD36-36F3-3136-9185-330385950E17.html"><span class="apiname">MMTPDataCodeGenerator</span></a> and generate a
set of unique datacodes for a data provider service. </span>
  Note: This step is only required to implement a data provider as a
device service. Device creators can also write their own datacode allocation
mechanism to avoid datacode conflicts. For more information about Datacodes,
refer to the <a href="http://www.microsoft.com/whdc/device/wpd/MTPDevServExt_spec.mspx" target="_blank">MTP Device Service Extension Specification</a>. 
 The MTP Device Services Extension Specification extends the MTP protocol.
It moves the limited 16-bit datacodes to 128-bit Global Unique IDs (GUID)
to support extensible operations, properties and formats for a service. For
better performance and efficiency, 16-bit datacodes which map the GUIDs are
still used. They are generated at run time on a device with unique values.
Datacodes and their mapping GUIDs are sent to a host PC and then only datacodes
are used in later communications. 
 The <a href="GUID-86E1BD36-36F3-3136-9185-330385950E17.html"><span class="apiname">MMTPDataCodeGenerator</span></a> interface class defines
the following functions:<ol type="a">
<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-C9D57D43-1510-482C-A88D-CFEF55A17B31"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-C9D57D43-1510-482C-A88D-CFEF55A17B31"><!-- --></a><p><samp class="codeph">MMTPDataCodeGenerator::AllocateServiceID()</samp> generates
a datacode for a service GUID.</p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-961A9AED-C60C-4320-8950-7C838E2F916E"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-961A9AED-C60C-4320-8950-7C838E2F916E"><!-- --></a><p><samp class="codeph">           
          MMTPDataCodeGenerator::AllocateServicePropertyCode()</samp> generates
datacodes for service property GUIDs. </p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-97F8065B-D63E-4C18-9611-EED7C61CF505"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-97F8065B-D63E-4C18-9611-EED7C61CF505"><!-- --></a><p><samp class="codeph">           
          MMTPDataCodeGenerator::AllocateServiceFormatCode()</samp> generates
datacodes service format GUIDs.</p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-FD2490F0-651F-46F8-B53E-E4E5644F456B"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-FD2490F0-651F-46F8-B53E-E4E5644F456B"><!-- --></a><p><samp class="codeph">           
          MMTPDataCodeGenerator::AllocateServiceMethodFormatCode()</samp> generates
datacodes for service method format GUIDs. </p>
</li>

</ol>

 The following code block shows how to generate datacodes for the Task
service GUID and one of its service format GUIDs: 
 <pre class="codeblock" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-32D9F595-F8B1-5B61-ADD6-C75CCAA4F62F"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-32D9F595-F8B1-5B61-ADD6-C75CCAA4F62F"><!-- --></a>void CMTPTaskDataProvider::ConstructL()
{
…

//Get the reference of the Datacode Generator.
MMTPDataCodeGenerator&amp; datacodeGenerator(Framework().DataCodeGenerator());

// Generate a datacode for the Windows task service GUID.
TUint taskServiceID(0);
const TMTPTypeUint128 KMTPTaskDpPersistentServiceID(
                          MAKE_TUINT64(0x10287013,0x00000001),
                          MAKE_TUINT64(0x00000000,0x00000000));
User::LeaveIfError(datacodeGenerator.AllocateServiceID(
                                         KMTPTaskDpPersistentServiceID,
                                         0,
                                         taskServiceID));
…

//Generate a datacode for the service AbstractTask format.
TUint16  abstractTaskFormatcode(0);
const TMTPTypeUint128 KAbstractTaskGUID(
                           MAKE_TUINT64(0x522979c0,0x74cf44ab),
                           MAKE_TUINT64(0x975455bc,0x596a67df));
User::LeaveIfError(datacodeGenerator.AllocateServiceFormatCode(
                                         KMTPTaskDpPersistentServiceID,
                                         KAbstractTaskGUID,
                                         abstractTaskFormatcode));
…

}
</pre>
 
</li>
<li class="stepexpand" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-6D5FDCB3-A1E0-5CFE-94A0-6B33F16B11EB"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-6D5FDCB3-A1E0-5CFE-94A0-6B33F16B11EB"><!-- --></a><span>Register and configure
a data provider. </span>
 Each Data Provider must register with the ECOM plug-in framework by
creating and exporting a standard ECOM plug-in framework registration file.
In addition, each MTP Data Provider is required to register itself with the
MTP framework by exporting a compiled resource file as follows 
  <span class="filepath">z:/resource/mtp/[implementation_uid].rsc</span>  
 Where [implementation_uid] is the Data Provider’s unique MTP Data Provider
SPI implementation UID. For a Data Provider implemented as an ECOM plug-in
[implementation_uid] should match the implementation_uid value specified in
its ECOM plug-in registration file, for example 
  <span class="filepath">z:/resource/mtp/[implementation_uid].rsc</span>  
</li>
<li class="stepexpand" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-9336C1C4-14B4-5529-B855-C3A61376F7A5"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-9336C1C4-14B4-5529-B855-C3A61376F7A5"><!-- --></a><span>Notify USB cable
disconnection. </span>
 The MTP Data Provider must be notified by the Symbian MTP USB transport
upon the USB disconnection from the Host. To notify the USB disconnection,
the licensee must handle the <samp class="codeph">EMTPDisconnected</samp> event using
the <samp class="codeph">ProcessNotificationL()</samp> function. 
 For example, 
 <pre class="codeblock" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-8BF67564-E1BE-5374-A622-9264050CCA3E"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-8BF67564-E1BE-5374-A622-9264050CCA3E"><!-- --></a>void CMTPImageDataProvider::ProcessNotificationL(TMTPNotification aNotification, const TAny* aParams)

    {

    __FLOG(_L8("ProcessNotificationL - Entry"));

    switch (aNotification)

        {

    case EMTPSessionClosed:

        SessionClosedL(*reinterpret_cast&lt;const TMTPNotificationParamsSessionChange*&gt;(aParams));

        break;

        

    case EMTPSessionOpened:

        SessionOpenedL(*reinterpret_cast&lt;const TMTPNotificationParamsSessionChange*&gt;(aParams));

        break;

    case EMTPDisconnected:

        {

        __FLOG(_L8("USB  - Disconnected"));   

        }
        
        break;

    default:

        // Ignore all other notifications.

        break;

        }

    __FLOG(_L8("ProcessNotificationL - Exit"));

    }

</pre>
 
</li>
<li class="stepexpand" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-B0D95CB3-82BB-5769-8D06-1C25B1DC43E6"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-B0D95CB3-82BB-5769-8D06-1C25B1DC43E6"><!-- --></a><span>Grant MTP Data Provider
capabilities. </span>
 The MTP daemon has the following capabilities. To be loaded by the MTP
daemon, the same capabilities must be granted to your data provider plug-in. <ol type="a">
<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-B0295923-4372-46DB-8B4C-EF10F751CBC8"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-B0295923-4372-46DB-8B4C-EF10F751CBC8"><!-- --></a><p><samp class="codeph">CommDD</samp></p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-0B0F177A-3A12-469F-A656-968F6CFE4BAA"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-0B0F177A-3A12-469F-A656-968F6CFE4BAA"><!-- --></a><p><samp class="codeph">LocalServices</samp></p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-9717C39E-7C86-4D79-B33D-192A8A4C0249"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-9717C39E-7C86-4D79-B33D-192A8A4C0249"><!-- --></a><p><samp class="codeph">NetworkControl</samp></p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-7FF04718-5E4E-4123-8CF2-B19B49C0AE0D"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-7FF04718-5E4E-4123-8CF2-B19B49C0AE0D"><!-- --></a><p><samp class="codeph">NetworkServices</samp></p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-D9449582-B3FD-4C71-A26B-83E6FB44E8AC"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-D9449582-B3FD-4C71-A26B-83E6FB44E8AC"><!-- --></a><p><samp class="codeph">PowerMgmt</samp></p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-523A5B84-AF70-43E7-A9AC-C1B9CCFED431"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-523A5B84-AF70-43E7-A9AC-C1B9CCFED431"><!-- --></a><p><samp class="codeph">ReadDeviceData</samp></p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-14CA2113-B996-4395-AC11-B9C5C9A6EC14"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-14CA2113-B996-4395-AC11-B9C5C9A6EC14"><!-- --></a><p><samp class="codeph">ReadUserData</samp></p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-AE84D61F-8AC4-487C-AE46-7746B9897C61"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-AE84D61F-8AC4-487C-AE46-7746B9897C61"><!-- --></a><p><samp class="codeph">TrustedUI</samp></p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-7DC3B602-BC3B-40BC-9A64-EC0DB52C2BFE"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-7DC3B602-BC3B-40BC-9A64-EC0DB52C2BFE"><!-- --></a><p><samp class="codeph">WriteDeviceData</samp></p>
</li>

<li id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-4FD2D0EE-F9F5-4714-92F2-DA2900E5EA55"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-4FD2D0EE-F9F5-4714-92F2-DA2900E5EA55"><!-- --></a><p><samp class="codeph">WriteUserData</samp></p>
</li>

</ol>

</li>
<li class="stepexpand" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-829B1633-1E8B-5FA1-B03E-77FDD5A2E28E"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-829B1633-1E8B-5FA1-B03E-77FDD5A2E28E"><!-- --></a><span/><br/>
 Set the file exclusion list and folder exclusion list 
 Your data provider supports specific media and data type(s). You may
need to prevent the File Data Provider and the Device Data Provider (and possibly
any other Data Providers) from trying to handle the same data type(s). You
can use the file exclusion list in the File Data Provider and the folder exclusion
list in the Device Data Provider for this purpose. The ways to configure the
lists are different based on whether your data provider is built in ROM or
installed via SIS file. 
<a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-433FE006-32E4-4A36-93AC-2463A6027142"><!-- --></a>
<table border="1" frame="hsides" rules="rows" cellpadding="4" cellspacing="0" summary="" class="choicetableborder" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-433FE006-32E4-4A36-93AC-2463A6027142">
<thead><tr><th id="d1981991e245-option" valign="bottom" align="left">Option</th>
<th id="d1981991e245-desc" valign="bottom" align="left">Description</th></tr></thead>
<tbody>
<tr>
<td valign="top" headers="d1981991e245-option" id="d1981991e249"><strong><p><a href="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85.html#GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-89540e99-3699-43fa-9da4-0b59aee8006c">Data
provider built in ROM</a> </p>
</strong></td>

<td valign="top" headers="d1981991e245-desc d1981991e249"><p>For data providers included in the ROM.</p>
</td>

</tr>

<tr>
<td valign="top" headers="d1981991e245-option" id="d1981991e263"><strong><p><a href="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85.html#GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-EAE8EA84-489E-43F0-BA92-318B96600E71">Data
provider installed via SIS file</a></p>
</strong></td>

<td valign="top" headers="d1981991e245-desc d1981991e263"><p>For data providers installed via SIS file.</p>
</td>

</tr>

</tbody></table>

 <span class="wintitle" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-89540E99-3699-43FA-9DA4-0B59AEE8006C"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-89540E99-3699-43FA-9DA4-0B59AEE8006C"><!-- --></a>Data provider
built in ROM</span> <p>If the data provider is included in the ROM (<span class="filepath">z:</span> drive),
edit the configuration files directly as follows: </p>

<a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-403EA734-31CB-55C8-A1E3-C266326D597C"><!-- --></a><ol type="a" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-403EA734-31CB-55C8-A1E3-C266326D597C">
<li class="substepexpand" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-74E385CF-6E32-5DC6-9043-5E410040201F"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-74E385CF-6E32-5DC6-9043-5E410040201F"><!-- --></a><span/><br/>
 Edit <span class="filepath">mtpfiledp_config.rss</span>, the File Data Provider
configuration resource file, using a text editor. Add the file format code
to the <samp class="codeph">format_exclusion_list</samp> section and add its mapping
file extension to the <samp class="codeph">extension_map</samp> section. 
 For example a Music Data Provider is to be included in the ROM. The
Music Data Provider supports <span class="filepath">.mp3</span>, whose file format
code is <samp class="codeph">0x3009</samp>. The <span class="filepath">mtpfiledp_config.rss</span> file
must be configured as follows: 
 <pre class="codeblock" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-8379ACB6-5D96-523C-9119-B640AFE0F904"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-8379ACB6-5D96-523C-9119-B640AFE0F904"><!-- --></a>RESOURCE MTP_FILEDP_CONFIG fileConfig
{
    enumeration_iteration_length = 32;
    format_exclusion_list = {
    //Association
    0x3001,
    0x3009 //mp3 code added to exclusion list, handled by Music Data Provider.
    };
    
    extension_map = 
    {
      ...
      MTP_FILEDP_EXTENSION_MAP // mp3 added to extension map, handled by Music Data Provider.
      {
      file_extension = "mp3";
      mtp_object_format = 0x3009;
      },
     
     ...
     };

}</pre>
 
</li>

<li class="substepexpand" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-5EDB4F14-0469-59AA-95E6-A47883BB9CAF"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-5EDB4F14-0469-59AA-95E6-A47883BB9CAF"><!-- --></a><span/><br/>
 Edit <span class="filepath">mtpdevicedp_config.rss</span>, the Device Data Provider
configuration resource file, using a text editor. Add the folder or drive
to save the supported data to the <samp class="codeph">folder_exclusion_list</samp> section,
for example <span class="filepath">c:\media\music</span>. 
 <pre class="codeblock" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-33656110-667F-564B-BAC7-6DE853F8F99A"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-33656110-667F-564B-BAC7-6DE853F8F99A"><!-- --></a>RESOURCE MTP_DEVICEDP_CONFIG folderConfig
    {
    enumeration_iteration_length = 32;
    folder_exclusion_list = 
        {
        ...

        "c:\\media\\music\\",
        ...

        };
    }</pre>
 
</li>

</ol>

  <p><span class="wintitle" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-EAE8EA84-489E-43F0-BA92-318B96600E71"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-EAE8EA84-489E-43F0-BA92-318B96600E71"><!-- --></a>Data provider
installed via SIS file</span></p>
<p>If the data provider is installed
via SIS file, <samp class="codeph">MMTPDataProvider::Supported()</samp> and <samp class="codeph">MMTPDataProvider::SupportedL()</samp> must
be implemented for the folder and file exclusion lists. </p>
<p>For example
after a phone is shipped, the Music Data Provider can be installed via SIS
files to the phone. The Music Data Provider supports <span class="filepath">.mp3</span>,
whose file format code is <samp class="codeph">0x3009</samp>. MP3 files are saved under <span class="filepath">c:\media\music</span>.
The following snippet of code shows an implementation of the two methods. </p>
<pre class="codeblock" id="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-62743679-6CA2-587D-9E8A-5A8923F20816"><a name="GUID-DB82D140-AB1B-5AA9-89CB-A5F68F328C85__GUID-62743679-6CA2-587D-9E8A-5A8923F20816"><!-- --></a>/**
define all the operations that are supported by the music data provider
*/
static const TUint16 KMTPMusicDpSupportedFormats[] =
    {
    EMTPFormatCodeWMA,
    EMTPFormatCodeMP3
    };

...

void CMTPMusicDataProvider::Supported(TMTPSupportCategory aCategory, RArray&lt;TUint&gt;&amp; aArray) const
    {
    switch (aCategory) 
        {      
    case EObjectCaptureFormats:
    case EObjectPlaybackFormats:
           {
           TInt count = sizeof(KMTPMusicDpSupportedFormats) / sizeof(TUint16);
           for(TInt i = 0; i &lt; count; i++)
                {
                aArray.Append(KMTPMusicDpSupportedFormats[i]);
                }
        }
        break;
                     
    default:
        break;
        }
    }

void CMTPMusicDataProvider::SupportedL(TMTPSupportCategory aCategory, CDesCArray&amp; aStrings) const
    {
    switch (aCategory) 
        {
    case EFolderExclusionSets:
         {
         //Hardcoded path, can be read from a resource file.
         _LIT(KMusicDPRootDir, "c:\\media\\music\\*");
         aStrings.AppendL(KMusicDPRootDir);
          }
          break;
    case EFormatExtensionSets:
         {
         _LIT(KFormatExtensionMP3, "0x3009:MP3");
         aStrings.AppendL(KFormatExtensionMP3);
         }
         break;
    
    default:
         break;
        }
    }
...

</pre>

</li>
</ol>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-3DFC21DA-D9F2-572C-9A6A-9AF1F55009CB.html">MTP Framework Tutorials</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>