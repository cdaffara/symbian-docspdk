<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Deriving from COpenFontRasterizerContext"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-762A665F-43D0-53ED-B698-0CBD3AC46391.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B798C19D-4030-564A-A208-D84738259D72.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-89AD2E29-DF29-5B2B-9894-B7ECD62854F4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F477E82D-2929-5C69-BF6D-A69A61AC9EA5.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1CF78E25-8C83-5812-AE6F-8612B3F9CDA9.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Deriving from COpenFontRasterizerContext</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395"><a name="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2535736 id2535744 id2535786 id2535806 id2535827 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html">Text and Localization Guide</a> &gt; <a href="GUID-762A665F-43D0-53ED-B698-0CBD3AC46391.html" title="The Font and Text Services Collection contains the Font Store and related plug-ins and the Text Rendering component. Application developers can select fonts from the Font Store. Device creators can create and add fonts.">Font and Text Services Collection</a> &gt; <a href="GUID-B798C19D-4030-564A-A208-D84738259D72.html" title="The Font Store is encapsulated by the Font and Bitmap Server. It represents all of the fonts stored as files in the file system. Font files may be of the native Symbian bitmap format or they may require rasterising into bitmaps. Font rasterisers are ECOM plug-ins to the Font Store.">Font Store Component</a> &gt; <a href="GUID-89AD2E29-DF29-5B2B-9894-B7ECD62854F4.html">Font Store Tutorials</a> &gt; <a href="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html" title="This section provides instructions for creating a font rasterizer. The code examples in this tutorial are take from the FreeType font rasterizer.">Writing a Font Rasterizer Plug-in Tutorial</a> &gt; </div>
<h1 class="topictitle1">Deriving from COpenFontRasterizerContext</h1>
<div><div class="section" id="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395__GUID-584F2A9E-E224-4110-A349-438F749F48AA"><a name="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395__GUID-584F2A9E-E224-4110-A349-438F749F48AA"><!-- --></a><h2 class="sectiontitle">Overview</h2> <p>The font rasterizer context provides the link between the framework required by the open font system, and the font rasterizer engine. As such it should contain a function to return a bitmap for the specified character, and then convert it into Symbian's run-length encoded format. Information about this format is provided in "How to derive from <samp class="codeph">COpenFont</samp> ". </p>
 <p> <samp class="codeph">COpenFontRasterizerContext</samp> is a convenience class â€” use of this class is optional. It contains a number of utility functions to make it easier to write glyph bitmaps in Symbian's bitmap format. </p>
 <p>Use <samp class="codeph">COpenFontRasterizer::StartGlyph()</samp> to initialize the buffer for writing the bitmap. Use <samp class="codeph">COpenFontRasterizer::WriteGlyphBit()</samp> to write the individual bits to the buffer. When all the bits have been added to the buffer, call <samp class="codeph">COpenFontRasterizer::EndGlyph()</samp> to write the glyph bitmap to <samp class="codeph">aGlyphData-&gt;iBitmapBuffer</samp>  </p>
 </div>
 <div class="section" id="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395__GUID-58E64205-EF52-482B-AA41-D1C7A0499A15"><a name="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395__GUID-58E64205-EF52-482B-AA41-D1C7A0499A15"><!-- --></a><h2 class="sectiontitle">Example</h2> <p>The following code fragment shows a partial implementation of <samp class="codeph">CFreeTypeContext::RasterizeL()</samp>. This function creates the glyph bitmap used to represent a specified character, based on the specification in the font file. </p>
 <p>This fragment has been provided because it shows how the glyph information is obtained from the font file, and how to implement the algorithm to write a glyph in Symbian run-length encoded format. Note the use of <samp class="codeph">StartGlyph()</samp>, <samp class="codeph">WriteGlyphBit()</samp> and <samp class="codeph">EndGlyph()</samp>. </p>
 <pre class="codeblock" id="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395__GUID-650B3D46-EFBD-55A2-ABD6-2CAA6A5795D0"><a name="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395__GUID-650B3D46-EFBD-55A2-ABD6-2CAA6A5795D0"><!-- --></a>//code before here writes the character metrics to aGlyphData

 // Try to use the built in raster map; if it's not big enough use a temporary bigger one.
    TBool use_temp_raster_map = width &gt; KRasterWidth || height &gt; KRasterHeight;
    CRasterMap* cur_raster_map = iRasterMap;
    if (use_temp_raster_map)
        {
        cur_raster_map = CRasterMap::NewL(width,height);
        CleanupStack::PushL(cur_raster_map);
        }
    
    cur_raster_map-&gt;Clear();
    TT_Raster_Map&amp; tt_raster_map = cur_raster_map-&gt;RasterMap();
    error = TT_Get_Glyph_Bitmap(aGlyph, &amp;tt_raster_map,-tt_metrics.bearingX,
    (tt_raster_map.rows - ascent) &lt;&lt; 6);
    if (error)
        User::Leave(KErrGeneral);
    
    StartGlyph(aGlyphData);
    const TUint8* p = (const TUint8*)tt_raster_map.bitmap;
    int row = 0;
    while (row &lt; height)
        {
        // Find the number of repeating or non-repeating rows (up to 15)
        int count = 1;
        TBool repeating = EFalse;
        const TUint8* cur = p;
        while (count &lt; 15 &amp;&amp; row + count &lt; height)
            {
            const TUint8* prev = cur;
            cur += tt_raster_map.cols;
            TBool same = Mem::Compare(prev,width_bytes,cur,width_bytes) == 0;
            if (count == 1)
                repeating = same;
            else if (repeating != same)
                break;
            count++;
            }
    
        // Write a 0 for repeating or a 1 for non-repeating.
        WriteGlyphBit(repeating ? 0 : 1);
    
        // Write the count.
        WriteGlyphBit(count &amp; 1 ? 1 : 0);
        WriteGlyphBit(count &amp; 2 ? 1 : 0);
        WriteGlyphBit(count &amp; 4 ? 1 : 0);
        WriteGlyphBit(count &amp; 8 ? 1 : 0);
    
        // Write a single repeating row or all the non-repeating rows.
        int rows_written = repeating ? 1 : count;
        cur = p;
        for (int row_written = 0; row_written &lt; rows_written; row_written++, 
       cur += tt_raster_map.cols)
            {
            int col = 0;
            for (int byte = 0; byte &lt; width_bytes; byte++)
                {
                unsigned char x = cur[byte];
                for (int bit = 0; bit &lt; 8 &amp;&amp; col &lt; width; bit++, col++, x &lt;&lt;= 1)
                    WriteGlyphBit(x &amp; 128 ? 1 : 0);
                }
            }
    
        row += count;
        p += tt_raster_map.cols * count;
        }
    
    EndGlyph();
    if (use_temp_raster_map)
        CleanupStack::PopAndDestroy();    // cur_raster_map
    }</pre>
 </div>
 </div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html" title="This section provides instructions for creating a font rasterizer. The code examples in this tutorial are take from the FreeType font rasterizer.">Writing a Font Rasterizer Plug-in Tutorial</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-F477E82D-2929-5C69-BF6D-A69A61AC9EA5.html">Creating a
                Font Rasterizer Plug-in</a></div>
<div><a href="GUID-1CF78E25-8C83-5812-AE6F-8612B3F9CDA9.html">Deriving
                from COpenFontRasterizer</a></div>
<div><a href="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547.html">Deriving from
                COpenFontFile</a></div>
<div><a href="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C.html">Deriving from
                COpenFont</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>