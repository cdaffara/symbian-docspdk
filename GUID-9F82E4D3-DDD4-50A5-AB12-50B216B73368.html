<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="How to use the heap descriptor - HBufC"/>
<meta name="abstract" content="Heap descriptors provide a buffer of fixed length, allocated on the heap. Descriptors are useful for holding constant strings or data, when the length of the data may not be known until run time."/>
<meta name="description" content="Heap descriptors provide a buffer of fixed length, allocated on the heap. Descriptors are useful for holding constant strings or data, when the length of the data may not be known until run time."/>
<meta name="DC.Relation" scheme="URI" content="GUID-E8BEE049-6814-543B-8A88-889E434A5D92.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-DBF88873-21B1-5493-8EBF-C9071D314A09.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-11EEFB3D-0414-5BEB-9D78-56A4B9154008.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E8BEE049-6814-543B-8A88-889E434A5D92.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>How to use the heap descriptor - HBufC</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2392072 id2392081 id2392600 id2392686 id2392788 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html" title="Provides a framework for accessing file systems.">User Library and File Server</a> &gt; <a href="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html" title="The User Library allows the applications and services that run on a phone to access the functionality provided by the Symbian platform Kernel.">User Library</a> &gt; <a href="GUID-DBF88873-21B1-5493-8EBF-C9071D314A09.html" title="Links to documents that describe buffers and strings.">Buffers And Strings</a> &gt; <a href="GUID-11EEFB3D-0414-5BEB-9D78-56A4B9154008.html" title="This is a list of documents that describe how to use descriptors.">Using Descriptors</a> &gt; <a href="GUID-E8BEE049-6814-543B-8A88-889E434A5D92.html" title="Explains how to use descriptors for various use cases.">How to Use Descriptors</a> &gt; </div>
<h1 class="topictitle1">How to use the heap descriptor - HBufC</h1>
<div><p>Heap descriptors provide a buffer of fixed length, allocated on the heap. Descriptors are useful for holding constant strings or data, when the length of the data may not be known until run time.</p>

    
    <div class="section" id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__CONTEXT_361D960801D14A01BDCA84C4583DBC07"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__CONTEXT_361D960801D14A01BDCA84C4583DBC07"><!-- --></a><p>Some key points about heap descriptors:</p>
<a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__UL_1B2EE288A79A45CDADC061A8AD013AA1"><!-- --></a><ul id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__UL_1B2EE288A79A45CDADC061A8AD013AA1"><li id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_593B247AD60649A3995B848E524423FF"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_593B247AD60649A3995B848E524423FF"><!-- --></a>For text data, it is usual to construct a &lt;code&gt;<samp class="codeph">HBufC</samp>&lt;/code&gt; type and			 allow the appropriate variant, either a &lt;code&gt;<samp class="codeph">HBufC8</samp>&lt;/code&gt; or a <samp class="codeph">HBufC16</samp> to be selected at build time.</li>
<li id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_5FB940C2E42143B9BFE6961D6CD72B86"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_5FB940C2E42143B9BFE6961D6CD72B86"><!-- --></a>For binary data, an explicit <samp class="codeph">HBufC8</samp> is used.</li>
<li id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_9D41DDF6F4544E90A79494F10D453DC4"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_9D41DDF6F4544E90A79494F10D453DC4"><!-- --></a>It is rare to use an explicit <samp class="codeph">HBufC16</samp>.</li>
<li id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_0C6D6B9242EC473B8754A321A68A1BB2"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_0C6D6B9242EC473B8754A321A68A1BB2"><!-- --></a>Data cannot be changed through this descriptor although it can be
			 replaced using the assignment operators.
</li>
<li id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_FFFA4A8EB811448BB63BED6865555087"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_FFFA4A8EB811448BB63BED6865555087"><!-- --></a>If you need to pass an <samp class="codeph">HBufC</samp> to a function that takes a <samp class="codeph">TDesC&amp;</samp> parameter, simply dereference the <samp class="codeph">HBufC</samp> pointer.</li>
<li id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_D010A4CD7E26494EA8AB123A6FD76BEA"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_D010A4CD7E26494EA8AB123A6FD76BEA"><!-- --></a>If you need to modify the <samp class="codeph">HBufC</samp>'s data, use its <samp class="codeph">Des()</samp> function to construct a <samp class="codeph">TPtr/TPtr8/TPtr16</samp> modifiable pointer descriptor for the buffer's data.</li>
<li id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_1317203B41FC4D1887AC3E4F9E62EEBC"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_1317203B41FC4D1887AC3E4F9E62EEBC"><!-- --></a>The size of the heap descriptor buffer can be replaced by
			 reallocating it with a new length.
</li>
</ul>
<p>Although the following notes refer to the build independent types, they are equally valid for the 8 bit and 16 bit types.</p>
 


</div>

    <div class="section" id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__SECTION_C424B2F2D52D477AA71C739E4B27BBBC"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__SECTION_C424B2F2D52D477AA71C739E4B27BBBC"><!-- --></a><h2 class="sectiontitle">Constructing an <samp class="codeph">HBufC</samp></h2>
		
		<p>
		  A heap descriptor can be constructed in one of two ways:
		</p>
 

		<a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__UL_97F558DD94EA45068D1C8B885D092AB1"><!-- --></a><ul id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__UL_97F558DD94EA45068D1C8B885D092AB1"> 
		  <li id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_FAA60C6043CB42BF84558932764C1054"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_FAA60C6043CB42BF84558932764C1054"><!-- --></a> 
			 <p>
				using the static member functions <samp class="codeph">New()</samp>,
				<samp class="codeph">NewL()</samp> or <samp class="codeph">NewLC()</samp>
			 </p>
 
		  </li>
 
		  <li id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_3A20A3574E404335BFFE058BB3DEA02F"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__LI_3A20A3574E404335BFFE058BB3DEA02F"><!-- --></a> 
			 <p>
				using the <samp class="codeph">Alloc()</samp>, <samp class="codeph">AllocL()</samp> or
				<samp class="codeph">AllocLC()</samp> functions of an existing descriptor
			 </p>
 
		  </li>
 
		</ul>


		<p>
		  The following code fragment constructs a heap descriptor which can hold up to 15 data items. The current length is zero.
		</p>
 
		<pre class="codeblock">HBufC* buf;
...
buf = HBufC::NewL(15);</pre>
 
		<p>
		  The following code fragment constructs a heap descriptor from an existing descriptor. The new heap descriptor is initialised with the content of
		  <samp class="codeph">buf1</samp>, i.e. the string: "Hello World!"
		</p>
 
		<p>
		  The source descriptor is a literal which is converted to descriptor type.
		</p>
 
		<pre class="codeblock">_LIT(KText,"Hello World!");
TBufC&lt;16&gt; buf1(KText);
...
HBufC* hptr;
hptr = buf1.AllocL();
...</pre>
 
	 </div>
 

	 <div class="section" id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__SECTION_B06A1A56ECEE4F02BEB57288C759CF80"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__SECTION_B06A1A56ECEE4F02BEB57288C759CF80"><!-- --></a><h2 class="sectiontitle">Replacing data and re-allocating</h2>
		
		<p>
		  Although existing data within a heap descriptor cannot be modified, the
		  assignment operator can be used to replace that data.
		</p>
 
		<pre class="codeblock">_LIT(KText,"Hello World!");
...
HBufC* buf;
...
buf  = HBufC::NewL(15);
*buf = KText;</pre>
 
		<p>
		  The source descriptor is a literal which is converted to descriptor
		  type.
		</p>
 
		<p>
		  To allow more than 15 characters or data items to be assigned into the
		  heap descriptor, it must be reallocated:
		</p>
 
		<pre class="codeblock">buf = buf-&gt;ReAllocL(20);</pre>
 
		<p>
		  This permits the following assignment to be done without raising a
		  panic:
		</p>
 
		<pre class="codeblock">_LIT(KNewText,"Hello World! Morning");
...
*buf = KNewText;</pre>
 
		<p>
		  <samp class="codeph">buf</samp> may or may not point to a different location in the
		  heap after reallocation. The location of the reallocated descriptor depends on
		  the heap fragmentation and the size of the new cell. It is always safer to
		  assume that the location changes.
		</p>
 
	 </div>
 

	 <div class="section" id="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__SECTION_27A2310F89E141159A3DF3169D860CDA"><a name="GUID-9F82E4D3-DDD4-50A5-AB12-50B216B73368__SECTION_27A2310F89E141159A3DF3169D860CDA"><!-- --></a><h2 class="sectiontitle">Changing data through a modifiable pointer descriptor.</h2>
		
		<p>
		  The data contained by a heap descriptor <em>can</em> be changed by
		  constructing a <samp class="codeph">TPtr</samp> modifiable pointer descriptor using the
		  <samp class="codeph">Des()</samp> member function and then changing the data through that
		  <samp class="codeph">TPtr</samp>.
		</p>
 
		<p>
		  The maximum length of the <samp class="codeph">TPtr</samp> is determined from the size
		  of the cell allocated to the data area of the heap descriptor.
		</p>
 
		<p>
		  The following code fragment changes the data in the heap descriptor and
		  the length of the heap descriptor.
		</p>
 
		<pre class="codeblock">TPtr ptr = buf-&gt;Des();
...
ptr.Delete((ptr.Length()-9),9);
ptr.Append(_LIT(" &amp; Hi"));</pre>
 
		<p>
		  Take particular care if a the heap descriptor is re-allocated after the
		  <samp class="codeph">TPtr</samp> has been constructed. A <samp class="codeph">TPtr</samp> created before
		  re-allocating the heap descriptor is not guaranteed to have a valid pointer
		  after re-allocation. Any attempt to modify data through the original
		  <samp class="codeph">TPtr</samp> after re-allocation may have undefined consequences.
		</p>
<div class="note"><span class="notetitle">Note:</span> it is a common error to use <samp class="codeph">Des()</samp> to create a
		  <samp class="codeph">TDesC&amp;</samp> reference. While not incorrect, it is simpler and much
		  more efficient to simply dereference the heap descriptor.</div>

		 
	 </div>
     
  </div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-E8BEE049-6814-543B-8A88-889E434A5D92.html" title="Explains how to use descriptors for various use cases.">How to Use Descriptors</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>