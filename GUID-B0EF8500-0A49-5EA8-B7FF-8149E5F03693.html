<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="How to use the SIP Client API"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E339A683-94E2-54E8-BB2B-286B11B0FCE3.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6425B722-4095-56E3-9198-70BA3E06C617.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-057F1F82-56AF-5696-853E-79196A3D567E.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E339A683-94E2-54E8-BB2B-286B11B0FCE3.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>How to use the SIP Client API</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2397554 id2397680 id2397694 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-6425B722-4095-56E3-9198-70BA3E06C617.html">Multimedia Protocols Guide</a> &gt; <a href="GUID-057F1F82-56AF-5696-853E-79196A3D567E.html">SIP</a> &gt; <a href="GUID-E339A683-94E2-54E8-BB2B-286B11B0FCE3.html">SIP Client API</a> &gt; </div>
<h1 class="topictitle1">How to use the SIP Client API</h1>
<div><div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-DC93FFFF-1981-5EA1-9B88-E3CC56CCCEB7"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-DC93FFFF-1981-5EA1-9B88-E3CC56CCCEB7"><!-- --></a><h2 class="sectiontitle">Protocols</h2> <p>The following sections describe how to do the following: </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-7E5B3D7B-45E4-543A-8219-A5C1C0D25913"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-7E5B3D7B-45E4-543A-8219-A5C1C0D25913"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-AFD6AB5D-1B1B-53CB-ABC7-4585D9A91CE8">Starting the SIP Client</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-39810F58-A7EB-5F1C-96C6-4A2E62B263EB"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-39810F58-A7EB-5F1C-96C6-4A2E62B263EB"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-42784C1C-600A-53AE-9AEB-463EBF34C636">Closing SIP Client</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-544748CF-463C-546B-A291-08D1C2887C01"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-544748CF-463C-546B-A291-08D1C2887C01"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-AC90094E-BF4E-5C2B-81B2-EF9BF5603BA2"> Sending a SIP request</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-F71538DD-111C-5DFE-88A3-2E025E05429C"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-F71538DD-111C-5DFE-88A3-2E025E05429C"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-5E5EC61F-5AB3-55F6-9AB0-463D5D0876DA">Receiving a SIP request</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-CC881957-ACE4-597F-85B4-1859886B61E7"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-CC881957-ACE4-597F-85B4-1859886B61E7"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-820D689F-6404-5E40-AAC2-A45ABECDBADC">Receiving a SIP request and creating a session</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-5FBBC17B-D4B7-51F3-8560-13F6730010B6"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-5FBBC17B-D4B7-51F3-8560-13F6730010B6"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-109B933C-1063-577F-9A58-BA809869A0DF">Registration</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-8E35F949-CC67-546C-9899-3A2C1BF8BBC1"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-8E35F949-CC67-546C-9899-3A2C1BF8BBC1"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-E683488B-B7EA-5215-8476-8C39950AC21B">Creating a dialog with INVITE</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-3246EFA2-48AB-5D54-9E5C-E8095886FCCD"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-3246EFA2-48AB-5D54-9E5C-E8095886FCCD"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-E4E6E0C2-7B0F-51AA-B1E3-282E8F728EDC"> Generating a '100 SIP response'</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-6E4E101D-8638-5AD8-B105-D5FD5D9ED6E5"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-6E4E101D-8638-5AD8-B105-D5FD5D9ED6E5"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C1ED4FC7-5DEB-5C5B-AE82-549D4577A9A9">Responding to a CANCEL request</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-010BA345-B521-54AC-8208-B0C5969BA87D"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-010BA345-B521-54AC-8208-B0C5969BA87D"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-CB27D3C3-D28B-5081-B201-8C10DE60CF25">Sending a SIP request and responding to a HTTP Digest challenge</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-4A8CF777-7379-5AF6-90A9-B15480B2E67E"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-4A8CF777-7379-5AF6-90A9-B15480B2E67E"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-B882D001-CDE9-579F-8DDE-C087D8707C2E">Notification of a failed refresh</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-79F2A3B3-2CC0-52ED-903B-3D4855E4A274"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-79F2A3B3-2CC0-52ED-903B-3D4855E4A274"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-DDD7FDBD-FBC9-5111-BE71-A71E6CCEFB2A">Error handling</a>  </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-AB416C57-9986-54AD-BB8A-7240D8FBCD7D"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-AB416C57-9986-54AD-BB8A-7240D8FBCD7D"><!-- --></a><p><a href="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693.html#GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-0FC8038A-64AE-5E98-A9F9-ADBC6F05DF2B">Refreshing a Connection</a>  </p>
 </li>
 </ul>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-AFD6AB5D-1B1B-53CB-ABC7-4585D9A91CE8"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-AFD6AB5D-1B1B-53CB-ABC7-4585D9A91CE8"><!-- --></a><h2 class="sectiontitle">Starting the SIP Client</h2> <p>To start the SIP Client: </p>
 <a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-62B966F0-272C-5A03-9364-7685412436B0"><!-- --></a><ol id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-62B966F0-272C-5A03-9364-7685412436B0"><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-626ACA6E-6CA9-5A3C-8582-EDEE7AE823D0"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-626ACA6E-6CA9-5A3C-8582-EDEE7AE823D0"><!-- --></a><p>Create an instance of the <a href="GUID-AFB2603A-8A35-3E70-8EC2-229C9726F00B.html"><span class="apiname">CSIP</span></a> class. The <a href="GUID-AFB2603A-8A35-3E70-8EC2-229C9726F00B.html"><span class="apiname">CSIP</span></a> class creates a <a href="GUID-AFB2603A-8A35-3E70-8EC2-229C9726F00B.html"><span class="apiname">CSIP</span></a> object and implements the callback functions defined by <a href="GUID-C6FF4A83-0097-3A82-B4ED-802E1FEA05D1.html"><span class="apiname">MSIPObserver</span></a>. The <a href="GUID-AFB2603A-8A35-3E70-8EC2-229C9726F00B.html"><span class="apiname">CSIP</span></a> object connects the client to a shared server. </p>
 <p> <strong>Note:</strong> The server is started if it is not active. This may take a short time while the server side resources are created and initialised. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-BEE4CC97-50C6-5681-ACEB-180CA59B0CD3"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-BEE4CC97-50C6-5681-ACEB-180CA59B0CD3"><!-- --></a><p>Create an instance of the <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> class to use an IAP. The <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> class must implement the callback functions defined by <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html"><span class="apiname">MSIPConnectionObserver</span></a>. The <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> class creates <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> object. The <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> object forms a sub-session between the client and the server. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-1B0B51F8-37DF-5495-AEEC-F49A6C7EE947"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-1B0B51F8-37DF-5495-AEEC-F49A6C7EE947"><!-- --></a><p>Call the <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html#GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94__GUID-7F3A8623-2989-3CCE-BF0C-BA4717D29D64"><span class="apiname">CSIPConnection::NewL()</span></a> function to create an active connection. The <samp class="codeph">CSIPConnection::EActive</samp> state indicates that the object can be used to send SIP messages and create registrations and dialogs. The current state is asked by calling <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html#GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94__GUID-A1A6D679-936C-3156-BA7D-5CBC3E2DEF7F"><span class="apiname">CSIPConnection::State()</span></a>. The <samp class="codeph">MSIPConnectionObserver::ConnectionStateChanged(CSIPConnection::
                EActive)</samp> callback function is called. </p>
 </li>
 </ol>
 <p>The following illustration shows the sequence of events involved in starting the SIP Client API. </p>
 <div class="fignone" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-86E80D26-544B-587A-B2FD-B15CF44E47B4"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-86E80D26-544B-587A-B2FD-B15CF44E47B4"><!-- --></a><img src="GUID-15CAB5AF-CAA5-5D1B-9236-7874BF944484_d0e552794_href.png"/></div>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-42784C1C-600A-53AE-9AEB-463EBF34C636"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-42784C1C-600A-53AE-9AEB-463EBF34C636"><!-- --></a><h2 class="sectiontitle">Closing the SIP Client</h2> <p>To close the SIP Client: </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-9FA5F4F3-9403-5256-9B80-939042BB2A8A"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-9FA5F4F3-9403-5256-9B80-939042BB2A8A"><!-- --></a><p>Delete the <a href="GUID-AFB2603A-8A35-3E70-8EC2-229C9726F00B.html"><span class="apiname">CSIP</span></a> object to close the connection to the SIP server. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-2C9F26A2-D5D1-585A-87C8-222A57D05F2F"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-2C9F26A2-D5D1-585A-87C8-222A57D05F2F"><!-- --></a><p>Delete the <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> object to close the sub-session between the client and the server. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-78A46553-52E1-57E3-BB0A-AEC70FC36F0F"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-78A46553-52E1-57E3-BB0A-AEC70FC36F0F"><!-- --></a><p>When the connection has been closed, operations on objects that depend on the connection fail with the <samp class="codeph">KErrSIPResourceNotAvailable</samp> error code. </p>
 </li>
 </ul>
 <p>For example, if an application has <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> and <a href="GUID-48AA01D5-CE7B-3C22-B2E0-529261121EC4.html"><span class="apiname">CSIPRegistrationBinding</span></a> objects, and it deletes the <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> object, then subsequent attempts to use the <samp class="codeph">CSIPRegistrationBinding</samp> object fails. This is because <samp class="codeph">CSIPRegistrationBinding</samp> cannot communicate with the server side of the SIP stack without the <samp class="codeph">CSIPConnection</samp> object. </p>
 <p>The following illustration shows the order for deleting SIP Client API objects. </p>
 <div class="fignone" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-5C5F0C8E-76BD-56CC-AA9E-BECF035D1A9F"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-5C5F0C8E-76BD-56CC-AA9E-BECF035D1A9F"><!-- --></a><img src="GUID-A9BFB95C-E2B0-5CD0-8B39-C448E3C81400_d0e552860_href.png"/></div>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-AC90094E-BF4E-5C2B-81B2-EF9BF5603BA2"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-AC90094E-BF4E-5C2B-81B2-EF9BF5603BA2"><!-- --></a><h2 class="sectiontitle"> Sending a SIP request</h2> <p>To send a SIP request: </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C92F9ADF-1BF5-5057-8851-0940E67A3C6A"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C92F9ADF-1BF5-5057-8851-0940E67A3C6A"><!-- --></a><p>Create a <a href="GUID-19FB031A-CFA7-3C67-A627-CFF501060AA5.html"><span class="apiname">CSIPRequestElements</span></a> object and enter the required fields of the request. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-E69DA3E7-5C13-5D10-BD82-1D37AEE0EE8A"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-E69DA3E7-5C13-5D10-BD82-1D37AEE0EE8A"><!-- --></a><p>Call the <samp class="codeph">CSIPConnection::SendRequestL(CSIPRequestElements*)</samp> function to take control of the <a href="GUID-19FB031A-CFA7-3C67-A627-CFF501060AA5.html"><span class="apiname">CSIPRequestElements</span></a> objects and communicate the request to the server side of the SIP stack. </p>
 <p> <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname"> CSIPConnection</span></a> creates a <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a> object and returns it to the application. </p>
 </li>
 </ul>
 <p> <strong>Note:</strong>  <samp class="codeph">SendRequestL()</samp> starts the server side processing of sending the MESSAGE request. This task takes time as address resolving and socket operations are done only after the <samp class="codeph">SendRequestL()</samp> call is returned. If an error occurs after <samp class="codeph">SendRequestL()</samp> returns, then the error is communicated to the application through one of the <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-E4E56635-42BB-351A-8356-DB12B5BE24CC"><span class="apiname">MSIPConnectionObserver::ErrorOccured()</span></a> callback functions. An example of such a failure is failure to resolve the address. When <samp class="codeph">SendRequestL()</samp> returns, the MESSAGE request is not yet sent to the network, and is being processed on the server side of the SIP stack. </p>
 <p>After <samp class="codeph">SendRequestL()</samp> returns and the sending of a MESSAGE request is in progress on the shared server, there is no way for the application to cancel that operation. This also applies to other operation types. However the <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html#GUID-059F9C3A-EA04-3295-912F-50444F073CE7__GUID-8F7BF1A8-75C4-39A1-BCB3-4E1F7CDE59CC"><span class="apiname">CSIPClientTransaction::CancelL()</span></a> function is used to send a CANCEL request after the application sends an INVITE request. </p>
 <p>When the SIP response is received from the server side, the <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> object: </p>
 <a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-0DB00054-27E8-57BF-8BB0-7F8231C7627B"><!-- --></a><ol id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-0DB00054-27E8-57BF-8BB0-7F8231C7627B"><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-D207CF42-5B04-5625-8CF8-4EEAD3451542"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-D207CF42-5B04-5625-8CF8-4EEAD3451542"><!-- --></a><p>creates a <a href="GUID-13F32052-70BE-3B4D-9F8B-DF2DABB896B0.html"><span class="apiname">CSIPResponseElements</span></a> object to represent the SIP response </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-7131D953-EFF6-5D31-B20F-64B56C968368"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-7131D953-EFF6-5D31-B20F-64B56C968368"><!-- --></a><p>attaches it to the <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a> object </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-72C682B2-05BE-58ED-B743-0554C9476CC2"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-72C682B2-05BE-58ED-B743-0554C9476CC2"><!-- --></a><p>notifies the application through a call to one of the <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-EE7CC7B8-CC03-3814-9177-CFBFBB043426"><span class="apiname">MSIPConnectionObserver:: IncomingResponse()</span></a> callback functions. </p>
 </li>
 </ol>
 <p>The application determines the kind of response received by accessing the <a href="GUID-13F32052-70BE-3B4D-9F8B-DF2DABB896B0.html"><span class="apiname">CSIPResponseElements</span></a> object through <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a>. As the response is provisional, the application does not delete the <samp class="codeph">CSIPClientTransaction</samp> object. A '200 response' is received later, and the application then deletes the <samp class="codeph">CSIPClientTransaction</samp> object. </p>
 <p>Then, create a <a href="GUID-13F32052-70BE-3B4D-9F8B-DF2DABB896B0.html"><span class="apiname">CSIPResponseElements</span></a> object to represent the SIP response, attach it to <samp class="codeph">CSIPClientTransaction</samp> and notify the application with <samp class="codeph">MSIPConnectionObserver::
          IncomingResponse</samp>. </p>
 <p>The following illustration shows the sequence of events involved in sending a MESSAGE request and receiving two responses to it. </p>
 <div class="fignone" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-6724EF0B-9B98-5225-BABA-3967A5065711"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-6724EF0B-9B98-5225-BABA-3967A5065711"><!-- --></a><img src="GUID-7712BAB3-5F48-5A28-9EA9-104D8B4A0431_d0e553006_href.png"/></div>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-5E5EC61F-5AB3-55F6-9AB0-463D5D0876DA"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-5E5EC61F-5AB3-55F6-9AB0-463D5D0876DA"><!-- --></a><h2 class="sectiontitle">Receiving a SIP request</h2> <p>A standalone SIP request is received through an existing <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> object. The <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> creates <a href="GUID-19FB031A-CFA7-3C67-A627-CFF501060AA5.html"><span class="apiname">CSIPRequestElements</span></a> and <a href="GUID-7E54C95E-5155-30B1-8169-A59778774403.html"><span class="apiname">CSIPServerTransaction</span></a> objects before notifying the application through the <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-2DF68D26-9787-3D00-B86F-1999D20E4981"><span class="apiname">MSIPConnectionObserver::IncomingRequest()</span></a> callback function. The <a href="GUID-19FB031A-CFA7-3C67-A627-CFF501060AA5.html"><span class="apiname">CSIPRequestElements</span></a> and <a href="GUID-7E54C95E-5155-30B1-8169-A59778774403.html"><span class="apiname">CSIPServerTransaction</span></a> represent the incoming SIP request </p>
 <p>The <a href="GUID-7E54C95E-5155-30B1-8169-A59778774403.html"><span class="apiname">CSIPServerTransaction</span></a> object is passed to the <a href="GUID-19FB031A-CFA7-3C67-A627-CFF501060AA5.html"><span class="apiname">CSIPRequestElements</span></a> object through the callback function. The application retrieves information about the request from the <a href="GUID-7E54C95E-5155-30B1-8169-A59778774403.html"><span class="apiname">CSIPServerTransaction</span></a> object. </p>
 <p>To send a response, the application creates a <a href="GUID-13F32052-70BE-3B4D-9F8B-DF2DABB896B0.html"><span class="apiname">CSIPResponseElements</span></a> object and passes it to <a href="GUID-7E54C95E-5155-30B1-8169-A59778774403.html#GUID-7E54C95E-5155-30B1-8169-A59778774403__GUID-2D5A77B6-114D-3A22-B622-5342BF235B67"><span class="apiname">CSIPServerTransaction::SendResponseL()</span></a>. This passes the response to the server side for further processing. When <samp class="codeph">SendResponseL()</samp> is returned, the application no longer needs the <a href="GUID-7E54C95E-5155-30B1-8169-A59778774403.html"><span class="apiname">CSIPServerTransaction</span></a> object and deletes it. </p>
 <p>The following illustration shows the sequence of events involved in receiving a MESSAGE request and sending a response to it. </p>
 <div class="fignone" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-8C9A8944-1150-52E2-A031-BA65F16191F4"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-8C9A8944-1150-52E2-A031-BA65F16191F4"><!-- --></a><img src="GUID-1158BDD3-69F7-5892-9887-FAE30110E33C_d0e553081_href.png"/></div>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-820D689F-6404-5E40-AAC2-A45ABECDBADC"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-820D689F-6404-5E40-AAC2-A45ABECDBADC"><!-- --></a><h2 class="sectiontitle">Receiving a SIP request and creating a session</h2> <p>The SIP stack receives a SIP INVITE request from the network acting as a User Agent Server (UAS) and creates an invite server transaction for the received request. The SIP stack sends a '100 SIP response' to the remote UA. After comparing the received request with the stored application capabilities, the SIP stack routes the received INVITE request to the chosen application. </p>
 <p>The application creates a <a href="GUID-B4A2FBBD-2B5F-3E64-800D-C4E9203679A8.html"><span class="apiname">CSIPInviteDialogAssoc</span></a> object and the SIP stack creates an instance of <a href="GUID-382BC1BE-3CF3-3E81-B1FF-341EEF2B67EA.html"><span class="apiname">CSIPDialog</span></a>. The application sends a '200 SIP response' to the remote UA. The remote UA acknowledges the '200 SIP' response with ACK and creates a SIP session is between the local and remote UA. </p>
 <p>The following illustration shows the sequence of events involved in receiving a SIP request and creating a SIP dialog. </p>
 <div class="fignone" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-8A8D96E1-99DC-5F11-847A-9D407212CA6E"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-8A8D96E1-99DC-5F11-847A-9D407212CA6E"><!-- --></a><img src="GUID-C64D200D-32A9-5F50-ACF1-4D93DDD0B0A4_d0e553106_href.png"/></div>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-109B933C-1063-577F-9A58-BA809869A0DF"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-109B933C-1063-577F-9A58-BA809869A0DF"><!-- --></a><h2 class="sectiontitle">Registration</h2> <p>An application creates a <a href="GUID-3C166C85-6E17-323B-9CD3-B3E2836DC1C3.html"><span class="apiname">CSIPRefresh</span></a> object to initiate a registration. It then creates a <a href="GUID-48AA01D5-CE7B-3C22-B2E0-529261121EC4.html"><span class="apiname">CSIPRegistrationBinding</span></a> object, passing <samp class="codeph">CSIPRefresh</samp> to it. </p>
 <p> <strong>Note:</strong> It is not mandatory to create a <samp class="codeph">CSIPRefresh</samp> object. It is required if the registration is to be refreshed by the SIP stack. </p>
 <p>After the <samp class="codeph">CSIPRegistrationBinding</samp> object exists, the application initiates the registration process by calling <samp class="codeph">RegisterL()</samp> on the <samp class="codeph">CSIPRegistrationBinding</samp> object. <samp class="codeph"/>  <samp class="codeph">CSIPRegistrationBinding</samp> forms a REGISTER request and communicates it to the server side of the SIP stack, it instantiates the <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a> object and returns it to the application. </p>
 <p>When the '200 SIP response' is received from the server side, <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> creates the <a href="GUID-13F32052-70BE-3B4D-9F8B-DF2DABB896B0.html"><span class="apiname">CSIPResponseElements</span></a> object to contain the response, and then routes the response to <a href="GUID-48AA01D5-CE7B-3C22-B2E0-529261121EC4.html"><span class="apiname">CSIPRegistrationBinding</span></a>. <a href="GUID-48AA01D5-CE7B-3C22-B2E0-529261121EC4.html"><span class="apiname">CSIPRegistrationBinding</span></a> attaches the response to <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a>. The application is informed about the response through one of the <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-7DE6337F-4EAA-3AE4-B573-1F7E59EDCFE5"><span class="apiname">MSIPConnectionObserver::IncomingResponse()</span></a> callback functions. </p>
 <p>The application does not require the <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a> object and can delete it. The <samp class="codeph">IsContextActive()</samp> finds out if the registration is successful. </p>
 <p>The following illustration shows the sequence of events involved in registering with a refresh and receiving a '200 OK response'. </p>
 <div class="fignone" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-7F489E97-2ADE-5753-A03B-5600E4BD1C55"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-7F489E97-2ADE-5753-A03B-5600E4BD1C55"><!-- --></a><img src="GUID-02521DB0-53C4-55D5-856F-BD478E134B73_d0e553198_href.png"/></div>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-45BEF04F-64A3-5B29-8CE4-8B1F5CA0E64F"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-45BEF04F-64A3-5B29-8CE4-8B1F5CA0E64F"><!-- --></a><h2 class="sectiontitle">Configuring the registration</h2> <p>When registering an SIP connection, applications have two options to configure the registration : outbound proxy caching and expiration value removal. To set each of these options, call <a href="GUID-48AA01D5-CE7B-3C22-B2E0-529261121EC4.html#GUID-48AA01D5-CE7B-3C22-B2E0-529261121EC4__GUID-B3C68013-AF24-3529-8595-5CC9497F2E98"><span class="apiname">CSIPRegistrationBinding::SetProperty()</span></a> with the corresponding property constant, as explained below. </p>
 <p>The SIP stack resolves the IP address of the outbound proxy during registration. The default behavior is to resolve the address again for each SIP message sent using this registration context. However, you can also cache the address to optimise network traffic. If you set <a href="GUID-9A7A7547-76EB-3CC7-9C3D-7F1C08A160D0.html"><span class="apiname">KSIPCacheOutboundProxyIP</span></a> property to <samp class="codeph">ETrue</samp>, the SIP stack reuses the proxy address that was resolved during registration. The proxy address is refreshed by successful REGISTER transactions, which always perform a DNS query. </p>
 <p>By default, the SIP stack sends the expiration value in the REGISTER request. In the '200 OK' answer to a REGISTER message, the registrar returns an expiration value that may be different from the value that was sent. The SIP stack validates the returned expiration value against the minimum and maximum expiration values: if the returned expiration value is out of range, the SIP stack uses the minimum value or the maximum value. </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-478291AE-D709-5AF1-AE4A-F1C115F8BE7C"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-478291AE-D709-5AF1-AE4A-F1C115F8BE7C"><!-- --></a><p>The minimum expiration value is 30 seconds, to reduce network activity and battery consumption. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-A0C7C631-F4CF-5CC0-BAA7-236C939E87C8"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-A0C7C631-F4CF-5CC0-BAA7-236C939E87C8"><!-- --></a><p>The maximum expiration value is the expiration value that you specify for the REGISTER request. By default, the maximum expiration value is 3600 seconds, to protect the application from DOS attacks that provide '200 OK' responses with a very high expiration value. </p>
 </li>
 </ul>
 <p>If you set <a href="GUID-C0920ECB-95CC-3152-8D6F-C4751AA8271E.html"><span class="apiname">KSIPSendWithExpires</span></a> to <samp class="codeph">EFalse</samp>, the SIP stack does not send the application's expiration value in the REGISTER message. </p>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-E683488B-B7EA-5215-8476-8C39950AC21B"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-E683488B-B7EA-5215-8476-8C39950AC21B"><!-- --></a><h2 class="sectiontitle">Creating a dialog with INVITE</h2> <p>To create a dialog with INVITE an application creates <a href="GUID-B4A2FBBD-2B5F-3E64-800D-C4E9203679A8.html"><span class="apiname">CSIPInviteDialogAssoc</span></a> and <a href="GUID-77CFD812-7238-3B84-80FF-475BD73C3506.html"><span class="apiname">CSIPMessageElements</span></a> objects. The application must enter the relevant SIP headers in the <a href="GUID-77CFD812-7238-3B84-80FF-475BD73C3506.html"><span class="apiname">CSIPMessageElements </span></a> object before passing it to <a href="GUID-B4A2FBBD-2B5F-3E64-800D-C4E9203679A8.html"><span class="apiname">CSIPInviteDialogAssoc</span></a> using the <a href="GUID-B4A2FBBD-2B5F-3E64-800D-C4E9203679A8.html#GUID-B4A2FBBD-2B5F-3E64-800D-C4E9203679A8__GUID-D587F38B-3631-3399-9A82-04EA473E7694"><span class="apiname">CSIPInviteDialogAssoc::SendInviteL()</span></a> function. </p>
 <p> <a href="GUID-B4A2FBBD-2B5F-3E64-800D-C4E9203679A8.html"><span class="apiname">CSIPInviteDialogAssoc</span></a> then forms an INVITE request and communicates it to the server side of the SIP stack. It then creates a <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a> object, and returns it to the application. </p>
 <p>When the server sends '180 response', the <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> creates a <a href="GUID-13F32052-70BE-3B4D-9F8B-DF2DABB896B0.html"><span class="apiname">CSIPResponseElements</span></a> object to contain the response, and then routes the response to <a href="GUID-382BC1BE-3CF3-3E81-B1FF-341EEF2B67EA.html"><span class="apiname">CSIPDialog</span></a>. <samp class="codeph">CSIPDialog</samp> attaches the response to <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a>. The application is informed about the receipt of the '180 response' through a call to one of the <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-EE7CC7B8-CC03-3814-9177-CFBFBB043426"><span class="apiname">MSIPConnectionObserver:: IncomingResponse()</span></a> callback functions. </p>
 <p>When the '200 response' is received, processing similar to '180 response' occurs. Then the application responds by sending an ACK request. This is done by invoking the <a href="GUID-B4A2FBBD-2B5F-3E64-800D-C4E9203679A8.html#GUID-B4A2FBBD-2B5F-3E64-800D-C4E9203679A8__GUID-DBA0B06D-EC23-3458-9397-402E6CA17106"><span class="apiname">CSIPInviteDialogAssoc::SendAckL()</span></a> function, which forms the ACK request and sends it to the server side of the SIP stack. </p>
 <p>The INVITE request might fork at a proxy, so the server side of the SIP stack waits for several possible responses. When the forking is does not happen, the server side of the SIP stack sends an <samp class="codeph">InviteCompleted</samp> event. The SIP Client API forwards the <samp class="codeph">InviteCompleted</samp> event to the application, indicating that the application can now delete the <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a>. </p>
 <p>The following figure shows the sequence of events involved in sending an INVITE, receiving a response and sending an ACK. </p>
 <div class="fignone" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-3AE23155-63D4-5948-855E-9D44F48E4D11"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-3AE23155-63D4-5948-855E-9D44F48E4D11"><!-- --></a><img src="GUID-C8D04D54-D391-5505-9E80-596589410179_d0e553336_href.png"/></div>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-E4E6E0C2-7B0F-51AA-B1E3-282E8F728EDC"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-E4E6E0C2-7B0F-51AA-B1E3-282E8F728EDC"><!-- --></a><h2 class="sectiontitle"> Generating a '100 SIP response'</h2> <p>The SIP stack generates a '100 response' automatically when it receives an <samp class="codeph">INVITE</samp> request from the network. Applications are not allowed to send '100 responses'. </p>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C1ED4FC7-5DEB-5C5B-AE82-549D4577A9A9"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C1ED4FC7-5DEB-5C5B-AE82-549D4577A9A9"><!-- --></a><h2 class="sectiontitle">Responding to a CANCEL request</h2> <p>When the SIP stack receives a CANCEL request from the network, it automatically responds to it. CANCEL requests are never passed to an application. </p>
 <p>If the SIP stack: </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-05B62303-9453-5E42-8E2A-6D50A5857312"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-05B62303-9453-5E42-8E2A-6D50A5857312"><!-- --></a><p>does not find a matching transaction for a CANCEL request, it automatically generates a '481 response'. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-69DBD19D-1871-57C5-AF95-8858A92BE6C5"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-69DBD19D-1871-57C5-AF95-8858A92BE6C5"><!-- --></a><p>finds a matching transaction for a CANCEL request, it automatically generates a '200 response'. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C806FF70-7EBD-5D06-989E-971E2E7589DD"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C806FF70-7EBD-5D06-989E-971E2E7589DD"><!-- --></a><p>finds a matching INVITE server transaction that is in the <samp class="codeph">Proceeding</samp> state (that is a final response is not yet sent), it also automatically generates a '487 response' to the INVITE transaction. </p>
 </li>
 </ul>
 <p>After these actions are complete, the SIP stack informs the application by calling the <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-500F0C1D-6FCF-32DB-B9CC-4F7CEC1A9053"><span class="apiname">MSIPConnectionObserver::InviteCanceled()</span></a> callback function. </p>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-CB27D3C3-D28B-5081-B201-8C10DE60CF25"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-CB27D3C3-D28B-5081-B201-8C10DE60CF25"><!-- --></a><h2 class="sectiontitle">Sending a SIP request and responding to a HTTP Digest challenge</h2> <p>A SIP server in the signalling chain challenges any SIP request initiated by the application with an HTTP Digest challenge by responding with a '401 SIP response', '407 SIP response' or a '494 SIP response'. The responses contain details of the challenge. These responses are never passed directly to the application. Instead, they are passed to the application through a call to the callback function <a href="GUID-FA0A893D-E3E3-33F8-9C63-B2A6A2A053EF.html#GUID-FA0A893D-E3E3-33F8-9C63-B2A6A2A053EF__GUID-D12ED59B-FF9F-3AAD-9740-1108B1091421"><span class="apiname">MSIPHttpDigestChallengeObserver::ChallengeReceived()</span></a>. </p>
 <p>To enable an application to respond to a challenge, it must: </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-69B100E7-A67F-5F0C-B886-1B0FAE9DBEB4"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-69B100E7-A67F-5F0C-B886-1B0FAE9DBEB4"><!-- --></a><p>create a <a href="GUID-F9FBAFBE-A895-3FD3-A526-604A6C9E035D.html"><span class="apiname">CSIPHttpDigest</span></a> object </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-A58199C3-57A0-536F-8EC2-76A29F3003DA"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-A58199C3-57A0-536F-8EC2-76A29F3003DA"><!-- --></a><p>provide an implementation of the callback function <a href="GUID-FA0A893D-E3E3-33F8-9C63-B2A6A2A053EF.html#GUID-FA0A893D-E3E3-33F8-9C63-B2A6A2A053EF__GUID-D12ED59B-FF9F-3AAD-9740-1108B1091421"><span class="apiname">MSIPHttpDigestChallengeObserver::ChallengeReceived()</span></a> . </p>
 </li>
 </ul>
 <p>The application can either accept or reject the challenge: </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-8EFD6F96-73E8-594E-9971-95DB3DA5B5ED"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-8EFD6F96-73E8-594E-9971-95DB3DA5B5ED"><!-- --></a><p>If it accepts the challenge, the callback function must call <a href="GUID-F9FBAFBE-A895-3FD3-A526-604A6C9E035D.html#GUID-F9FBAFBE-A895-3FD3-A526-604A6C9E035D__GUID-FBDFE260-789F-3FB1-9884-D958B82E3734"><span class="apiname">CSIPHttpDigest::SetCredentialsL()</span></a>, specifying the username, password, and the realm passed to the callback function. </p>
 <p>Then, SIP stack re-sends the original SIP request with the HTTP Digest response. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C1A1BCCC-7E0C-5B4F-A0D9-EDC52F081D59"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C1A1BCCC-7E0C-5B4F-A0D9-EDC52F081D59"><!-- --></a><p>If it rejects the challenge, the callback function must call <a href="GUID-F9FBAFBE-A895-3FD3-A526-604A6C9E035D.html#GUID-F9FBAFBE-A895-3FD3-A526-604A6C9E035D__GUID-2F3A2A6D-B825-30A5-A133-EEBBFCD3F52B"><span class="apiname">CSIPHttpDigest::IgnoreChallenge()</span></a>, specifying the realm passed to the callback function. </p>
 <p>Then, SIP stack calls the callback function <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-E4E56635-42BB-351A-8356-DB12B5BE24CC"><span class="apiname">MSIPConnectionObserver::ErrorOccured()</span></a>, by passing the error code <a href="GUID-FF8BB656-99F5-369E-A6CE-56684D329AD5.html"><span class="apiname">KErrSIPForbidden</span></a>. </p>
 </li>
 </ul>
 <p>If an application does not want to receive the HTTP Digest challenge then it must not create a <a href="GUID-F9FBAFBE-A895-3FD3-A526-604A6C9E035D.html"><span class="apiname">CSIPHttpDigest</span></a> object. In this event, the SIP stack calls the callback function <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-E4E56635-42BB-351A-8356-DB12B5BE24CC"><span class="apiname">MSIPConnectionObserver::ErrorOccured()</span></a>, passing the error code <a href="GUID-FF8BB656-99F5-369E-A6CE-56684D329AD5.html"><span class="apiname">KErrSIPForbidden</span></a>. </p>
 <p> <strong>Note:</strong>  </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-A028B39A-292E-5556-B4A0-AF801F6131F3"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-A028B39A-292E-5556-B4A0-AF801F6131F3"><!-- --></a><p>If an application uses the SIP Profile Agent for SIP registration, the SIP Profile Agent handles the HTTP Digest challenges related to the registration procedure according to the SIP profile information. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-19A777A8-E8D0-54F4-A59E-53550B6A802C"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-19A777A8-E8D0-54F4-A59E-53550B6A802C"><!-- --></a><p>The SIP stack maintains a HTTP Digest cache which stores username and password pairs for realms. If the username and password have been configured for a proxy, or if the application has already provided them after being asked through a <a href="GUID-FA0A893D-E3E3-33F8-9C63-B2A6A2A053EF.html#GUID-FA0A893D-E3E3-33F8-9C63-B2A6A2A053EF__GUID-D12ED59B-FF9F-3AAD-9740-1108B1091421"><span class="apiname">MSIPHttpDigestChallengeObserver::ChallengeReceived()</span></a> call, then the SIP stack uses them to answer subsequent challenges for a matching realm automatically. </p>
 <p>For example, if the application uses a SIP Profile whose proxy is configured with HTTP Digest passwords and then sends an INVITE, it does not need to provide the passwords for the proxy as the SIP stack gets it from the HTTP Digest cache. </p>
 </li>
 </ul>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-B882D001-CDE9-579F-8DDE-C087D8707C2E"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-B882D001-CDE9-579F-8DDE-C087D8707C2E"><!-- --></a><h2 class="sectiontitle">Notification of a failed refresh</h2> <p>The following example shows how an application is notified when a refresh request within a dialog terminates after an error occurs. In this example the application sends a SUBSCRIBE request with refresh, and receives a <samp class="codeph">2xx</samp> class response. The SIP stack periodically sends a refreshed SUBSCRIBE message. After successfully refreshed SUBSCRIBE requests, the remote server responds with a '481 response', and the application receives the following callback: </p>
 <pre class="codeblock" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-A7F94C80-1224-5A70-B757-98FFAAD92B3B"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-A7F94C80-1224-5A70-B757-98FFAAD92B3B"><!-- --></a>MSIPConnectionObserver::ErrorOccured(TInt aError, CSIPDialogAssocBase&amp; aDialogAssoc)</pre>
 <p>If the value of <samp class="codeph">aError</samp> is <a href="GUID-D711A918-6BCE-3A6A-988C-1B1917CD19A6.html"><span class="apiname">KErrSIPTerminatedWithResponse</span></a>, then the actual SIP response causing the refresh to end can be found as follows: </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-76291322-B9F0-55D3-A019-73A9040F2652"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-76291322-B9F0-55D3-A019-73A9040F2652"><!-- --></a><p>Check that <samp class="codeph">aDialogAssoc.Type()</samp> returns <samp class="codeph">"SUBSCRIBE"</samp>. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-52B18DCF-2308-52A9-AB13-5920042C2E5D"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-52B18DCF-2308-52A9-AB13-5920042C2E5D"><!-- --></a><p>Call the function with the following signature to get the refresh instance (<a href="GUID-3C166C85-6E17-323B-9CD3-B3E2836DC1C3.html"><span class="apiname">CSIPRefresh</span></a> object): </p>
 <pre class="codeblock" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-F0E7DFDA-506F-5377-9F87-CE9775436133"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-F0E7DFDA-506F-5377-9F87-CE9775436133"><!-- --></a>const CSIPRefresh* CSIPSubscribeDialogAssoc::SIPRefresh() const</pre>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-6AB4677A-19F9-5CD3-8DAB-E1A242A98D54"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-6AB4677A-19F9-5CD3-8DAB-E1A242A98D54"><!-- --></a><p>Use the <a href="GUID-3C166C85-6E17-323B-9CD3-B3E2836DC1C3.html"><span class="apiname">CSIPRefresh</span></a> object to get the associated transaction by calling the following function: </p>
 <pre class="codeblock" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-D4889AC1-1281-5367-B19B-2136AE9DA707"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-D4889AC1-1281-5367-B19B-2136AE9DA707"><!-- --></a>const CSIPClientTransaction* CSIPRefresh::SIPTransaction() const</pre>
 <p> <strong>Note:</strong> The returned <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a> object is not similar to the one returned from the call to <samp class="codeph">SendSubscribeL(),</samp> that the application originally used to send the SUBSCRIBE request. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-D1B61B14-7B99-59EA-9FDD-5ECEB839C4DA"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-D1B61B14-7B99-59EA-9FDD-5ECEB839C4DA"><!-- --></a><p>Call the following function to get the SIP response: </p>
 <pre class="codeblock" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-04849100-2F81-5B03-9B1A-2797AF7F96DD"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-04849100-2F81-5B03-9B1A-2797AF7F96DD"><!-- --></a>const CSIPResponseElements* CSIPClientTransaction::ResponseElements() const</pre>
 </li>
 </ul>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-DDD7FDBD-FBC9-5111-BE71-A71E6CCEFB2A"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-DDD7FDBD-FBC9-5111-BE71-A71E6CCEFB2A"><!-- --></a><h2 class="sectiontitle">Error handling</h2> <p>Errors are passed to an application by calling the callback functions or by leaving. For more information, see <a href="GUID-E5A83EF3-948B-5729-A2CD-3644E803520B.html" title="Provides idioms to handle program exceptions, and to clean up memory when exceptions occur">Cleanup support overview</a>. If an error occurs during the synchronous part of an operation is initiated by the application, functions leave with an error code. If an error occurs during the asynchronous processing stage, the error is passed to the application through one of the <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-E4E56635-42BB-351A-8356-DB12B5BE24CC"><span class="apiname">MSIPConnectionObserver::ErrorOccured()</span></a> callback functions. </p>
 <p>There are several overloaded variants of <samp class="codeph">ErrorOccured()</samp> functions. Each of them takes the error code and reference to the SIP Client API object that encountered the error: </p>
 <ul><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-2734ECF0-1751-5AB8-BFE3-425965D01CF0"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-2734ECF0-1751-5AB8-BFE3-425965D01CF0"><!-- --></a><p>A call to the variants of <samp class="codeph">ErrorOccured()</samp> taking a <a href="GUID-93256B64-49C9-37F1-9A4E-72C521759749.html"><span class="apiname">CSIPTransactionBase</span></a> or <a href="GUID-059F9C3A-EA04-3295-912F-50444F073CE7.html"><span class="apiname">CSIPClientTransaction</span></a> parameter means that transaction has entered the state <a href="GUID-8E445232-29A0-3EED-94C3-43BFDD328358.html#GUID-8E445232-29A0-3EED-94C3-43BFDD328358__GUID-288F503D-3EEA-3B4B-8D31-B58E3777F875"><span class="apiname">CTransactionBase::ETerminated</span></a>. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C45D4A2D-F175-542B-92BF-211E1673F3F1"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-C45D4A2D-F175-542B-92BF-211E1673F3F1"><!-- --></a><p>A call to the variant of <samp class="codeph">ErrorOccured()</samp> taking a <a href="GUID-48AA01D5-CE7B-3C22-B2E0-529261121EC4.html"><span class="apiname">CSIPRegistrationBinding</span></a> parameter means that the registration context is no longer active, that is <samp class="codeph">CSIPRegistrationBinding::IsContextActive() == EFalse</samp>. </p>
 <p>If the registration was being refreshed, then the refresh has also ended and its state is <a href="GUID-3C166C85-6E17-323B-9CD3-B3E2836DC1C3.html#GUID-3C166C85-6E17-323B-9CD3-B3E2836DC1C3__GUID-EFEDCA93-E338-32A1-B005-8BA316B3C172"><span class="apiname">CSIPRefresh::ETerminated</span></a>. </p>
 </li>
 </ul>
 <p>If the callback function <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-27DE00DC-5572-3B55-B92B-5325794EE663"><span class="apiname">MSIPConnectionObserver::ConnectionStateChanged()</span></a> is called and the <samp class="codeph">aState</samp> parameter is either <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html#GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94__GUID-68DD22DC-67E4-387B-BBE9-B9B96D9C9016"><span class="apiname">CSIPConnection::EInactive</span></a> or <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html#GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94__GUID-5963A947-BD5C-3B34-9D10-2CB5DC413774"><span class="apiname">CSIPConnection::EUnavailable</span></a>, then all dialogs, registrations, and standalone transactions using the <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html"><span class="apiname">CSIPConnection</span></a> are terminated. </p>
 <p>To avoid an overload of callback calls in this type of situation, calls to <samp class="codeph">ErrorOccured()</samp> for the individual dialog, registration and transaction objects are not sent to the application. </p>
 <p>When the connection state changes, the <samp class="codeph">MSIPConnectionObserver::ConnectionStateChanged()</samp> callback function does not provide a reason. Call <a href="GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94.html#GUID-2A070F4D-A35B-3505-BE86-E6C7A2F27B94__GUID-B9D5319D-D569-3D4A-AF73-66F057ACF88D"><span class="apiname">CSIPConnection::GetConnectionError()</span></a> to get details about the connection error that caused the change. </p>
 </div>
 <div class="section" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-0FC8038A-64AE-5E98-A9F9-ADBC6F05DF2B"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-0FC8038A-64AE-5E98-A9F9-ADBC6F05DF2B"><!-- --></a><h2 class="sectiontitle">Refreshing a Connection</h2> <p>To refresh a connection, do the following steps: </p>
 <a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-368431B7-E9FB-56E7-A45F-01B686DBECAA"><!-- --></a><ol id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-368431B7-E9FB-56E7-A45F-01B686DBECAA"><li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-97E972C7-E839-5942-A487-48A9FD1EEC0E"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-97E972C7-E839-5942-A487-48A9FD1EEC0E"><!-- --></a><p>Start the connection on the desired IAP. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-35157131-E6EA-5EB2-8773-33832C45F46E"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-35157131-E6EA-5EB2-8773-33832C45F46E"><!-- --></a><p>Monitor the status of the connection using the <a href="GUID-64C272AA-5727-3AB9-A131-68303E5A75D6.html#GUID-64C272AA-5727-3AB9-A131-68303E5A75D6__GUID-7984D221-06F6-3F4B-B373-11C96D0A17F3"><span class="apiname">MSIPConnectionObserver::ConnectionStateChanged(CSIPConnection::TState
                aState)</span></a> function. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-85CDAB12-933A-5748-B2B8-33971F58B7B4"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-85CDAB12-933A-5748-B2B8-33971F58B7B4"><!-- --></a><p>If the connection is inactive, notify the <samp class="codeph">EInactive</samp> state to the application through <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-27DE00DC-5572-3B55-B92B-5325794EE663"><span class="apiname">MSIPConnectionObserver::ConnectionStateChanged()</span></a> function that is, if <a href="GUID-8239C16D-74EC-3B97-ADB0-B6AE57D30C89.html#GUID-8239C16D-74EC-3B97-ADB0-B6AE57D30C89__GUID-3380638E-B5BA-3C88-82CB-9E52385F6A38"><span class="apiname">(CSIPConnection::TState == EInactive)</span></a>, then send a <a href="GUID-7FBF47FB-7D1F-3F20-BBCA-A195BB540D67.html"><span class="apiname">RefreshConnection()</span></a> function to make it active. </p>
 <p> <strong>Note:</strong> This requires a bearer monitor on that IAP to which a refresh request is sent. </p>
 </li>
 <li id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-49A770C0-0992-5D27-B8A6-4D68E4B90E09"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-49A770C0-0992-5D27-B8A6-4D68E4B90E09"><!-- --></a><p>Any changes to the state of the connection is notified through <a href="GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4.html#GUID-B889A3FD-3B14-3785-90AE-3546F0C9A5D4__GUID-27DE00DC-5572-3B55-B92B-5325794EE663"><span class="apiname">MSIPConnectionObserver::ConnectionStateChanged()</span></a>. </p>
 </li>
 </ol>
 <p>The following sequence diagram shows how a client refreshes a connection. </p>
 <div class="fignone" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-B3D9E694-31F8-59AA-A722-BE6F9C0D5E89"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-B3D9E694-31F8-59AA-A722-BE6F9C0D5E89"><!-- --></a><img src="GUID-A50BBBE2-2E23-5AEE-BF53-9EF54FD7F00E_d0e553747_href.jpg"/></div>
 <p>The following example code describes how to refresh a connection. </p>
 <pre class="codeblock" id="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-B14ADDEF-1E3C-5B21-8426-4D0FE65FBC28"><a name="GUID-B0EF8500-0A49-5EA8-B7FF-8149E5F03693__GUID-B14ADDEF-1E3C-5B21-8426-4D0FE65FBC28"><!-- --></a>// It is assumed that the connection is started and is in an Inactive state that is, 
// (CSIPConnection::TState == EInactive)

// Refresh the IAP ID of the connection by sending a Refresh Request to the Bearer monitor of the IAP
CSIPConnection:: RefreshConnection()

// Note: The application is notified of the changes in the state of the connection through the 
// ConnectionStateChanged() function of MSIPConnectionObserver Interface.</pre>
 </div>
 </div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-E339A683-94E2-54E8-BB2B-286B11B0FCE3.html">SIP Client API</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>