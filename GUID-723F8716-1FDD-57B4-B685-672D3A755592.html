<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Requesting and Cancelling Monitoring for a Process"/>
<meta name="abstract" content="This tutorial describes how to request and cancel monitoring for a process."/>
<meta name="description" content="This tutorial describes how to request and cancel monitoring for a process."/>
<meta name="DC.Relation" scheme="URI" content="GUID-70DA7D35-3EF3-5B9B-9E86-28893021A4A1.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F8C8CE42-E7C9-5AFC-86BC-B78F677F1B05.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-AC1BBF7B-4195-5F83-B4DD-02965CB9A5CE.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-70DA7D35-3EF3-5B9B-9E86-28893021A4A1.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-8BC13552-7C7D-52AC-AF91-1BB7476912AF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-484B27EF-3FA1-5193-97EC-B9699AE49026.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-723F8716-1FDD-57B4-B685-672D3A755592"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Requesting and Cancelling Monitoring for a Process</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-723F8716-1FDD-57B4-B685-672D3A755592"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2519078 id2519506 id2519514 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-F8C8CE42-E7C9-5AFC-86BC-B78F677F1B05.html" title="Device Services provides device specific services to control phone resources and establish remote controlled connection with the external devices. It also monitors the phone resources and provides stage shutdown mechanism.">Device Services Guide</a> &gt; <a href="GUID-AC1BBF7B-4195-5F83-B4DD-02965CB9A5CE.html" title="System Health Management contains the System Health Manager component, formerly known as the System Monitor, which monitors and restarts processes and applications.">System Health Management</a> &gt; <a href="GUID-70DA7D35-3EF3-5B9B-9E86-28893021A4A1.html">System Health Manager</a> &gt; </div>
<h1 class="topictitle1">Requesting
and Cancelling Monitoring for a Process</h1>
<div><p>This tutorial describes how to request and cancel monitoring for
a process. </p>

<div class="section"><h2 class="sectiontitle">Introduction</h2> <p>Before monitoring a process, SHMA
reads the following information from SSM: </p>
 <ul>
<li id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-5396E46B-9AB1-526A-9AAA-FBC5A40A1094"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-5396E46B-9AB1-526A-9AAA-FBC5A40A1094"><!-- --></a><p>file name of the process
to be launched </p>
 </li>

<li id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-E18CEB76-319C-5DBA-8DEA-9254EF9CC0CE"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-E18CEB76-319C-5DBA-8DEA-9254EF9CC0CE"><!-- --></a><p>arguments required for
the process </p>
 </li>

<li id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-DC166941-30B5-5918-839A-6700C5932B90"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-DC166941-30B5-5918-839A-6700C5932B90"><!-- --></a><p>execution behaviour
(See <a href="GUID-12EE2A10-149F-36C8-8699-65BE8DDFCC6C.html"><span class="apiname">TSsmExecutionBehaviour</span></a> for more information) </p>
 </li>

<li id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-A78E13B0-C9AD-5E6E-9BD9-5A103033CEAC"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-A78E13B0-C9AD-5E6E-9BD9-5A103033CEAC"><!-- --></a><p>time-out to wait for
process to start before considering it as a failure </p>
 </li>

<li id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-463017DC-3DC7-54A6-B39B-96324642A52C"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-463017DC-3DC7-54A6-B39B-96324642A52C"><!-- --></a><p>number of retries if
an application or a process fails to start. </p>
 </li>

</ul>
 <p> <a href="GUID-19467402-8575-33F0-817D-339D39982D39.html"><span class="apiname">RSysMonSession</span></a> is the client interface for SHMA. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Procedure</h2><p>The following methods can be used to request
monitoring a process or an application:</p>
<pre class="codeblock">EXPORT_C void RSysMonSession::MonitorL( const CSsmStartupProperties&amp; aSsmStartupProperties,
                                        const RProcess&amp; aProcess,
                                        TBool aExecuteRecoveryMethodOnFailure )</pre>
<pre class="codeblock">EXPORT_C void RSysMonSession::MonitorSelfL( const CSsmStartupProperties&amp; aSsmStartupProperties )</pre>
<p>When the SysMon server receives monitoring request, it checks that the
client has appropriate PlatSec capabilities, and that the process is not currently
being monitored. A client which is monitoring itself can use the following
method to cancel monitoring:</p>
<pre class="codeblock">EXPORT_C void RSysMonSession::CancelMonitorSelfL()</pre>
<p>It
is not possible for a client to cancel monitoring of another process, even
if it was responsible for requesting monitoring.</p>
</div>

<div class="section" id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-91438FCA-D06F-5779-98E9-D353692BE59F"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-91438FCA-D06F-5779-98E9-D353692BE59F"><!-- --></a><h2 class="sectiontitle">Example</h2> <p>The
following code fragment illustrates how a client can request monitoring using
SHMA, specifying that the monitored process must be restarted in the event
of failure and that, if it cannot be restarted, the device must be rebooted. </p>
 <pre class="codeblock" id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-226291A8-CF61-5A8D-BA0C-6FBCA5F5E160"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-226291A8-CF61-5A8D-BA0C-6FBCA5F5E160"><!-- --></a>...
// Monitoring a process using SysMon.

LIT( KMonitoredProcess, "monitoredprocess.exe" );

// Properties for the application
CSsmStartupProperties *ssmProp = CSsmStartupProperties::NewLC( KMonitoredProcess, KNullDesC );

//ESsmWaitForSignal is the execution behaviour for starting the process.
ssmProp-&gt;SetExecutionBehaviour( ESsmWaitForSignal );    
TSsmMonitorInfo monitorInfo;
monitorInfo.iRestartPolicy = ESsmRestartOS;

//Startup mode to restart the OS
monitorInfo.iRestartMode = 0;

//Infinite time-out
monitorInfo.iTimeout = 0;  

//No of retries if an application or a process fails to start.
monitorInfo.iRetries = 1;

ssmProp-&gt;SetMonitorInfoL( monitorInfo ); 

RProcess process;

TInt err = process.Create( KMonitoredProcess, KNullDesC );
User::LeaveIfError( err );
CleanupClosePushL( &amp;process );
process.Resume();

// instantiate a session
RSysMonSession sess;   

//Open a session
sess.OpenL();         

//Create a monitor for the session
TRAP( err, sess.MonitorL( *ssmProp, process ) );
sess.Close();
CleanupStack::PopAndDestroy( 2, ssmProp );          </pre>
 <p>The following
code fragments illustrate the structs in a resource file used for process
monitoring: </p>
 <pre class="codeblock" id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-921B742E-6566-51CF-92A7-1AC653379647"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-921B742E-6566-51CF-92A7-1AC653379647"><!-- --></a>STRUCT SSM_START_APP_INFO
    {
    // Must be the first entry in this struct - Zero means command is unconditional
    LLINK conditional_information = 0;                 
    // Must be the second entry in this struct and must not be changed
    WORD type = ESsmCmdStartApp;     
   #ifndef SYMBIAN_SSM_FLEXIBLE_MERGE
    // Must be the third entry in this struct
    WORD version = ECmdStartAppInitialVersion; 
   #else
    // This version supports priority of the command
    WORD version = ECmdStartAppVersionWithPriority;    
   #endif
    // Can have a higher severity defined in TCmdErrorSeverity
    WORD severity = ECmdIgnoreFailure;        
    // VALUE REQUIRED - full path to the application
    LTEXT name = "";
    // Passed to the "Tail End" at the command line
    // see CApaCommandLine. Maximum argument length allowed is 256 chars.
    LTEXT args = "";
    // Can also be ESsmWaitForSignal or ESsmDeferredWaitForSignal
    BYTE execution_behaviour = ESsmFireAndForget;
    // Time in milliseconds for every retry on failure
    LONG timeout = 0;        
    // Number of times to retry on failure
    WORD retries = 0;
    // Set to 1 if app is viewless
    BYTE viewless = 0;            
    // Set to 1 if app should be launched in the background
    BYTE background = 0;
    // zero means no monitoring is required, SSM_MONITOR_INFO
    // should be used if monitoring is required
    LLINK monitor_info = 0;
   #ifdef SYMBIAN_SSM_FLEXIBLE_MERGE
    // The order of the command in the list - range can be from 0x00 to 0xffffu
    WORD priority = KDefaultCommandPriority;
   #endif
   }
</pre>
 <pre class="codeblock" id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-D8529CF5-87ED-503E-87CB-7599263AF403"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-D8529CF5-87ED-503E-87CB-7599263AF403"><!-- --></a>
/**
Struct for starting processes.

STRUCT SSM_START_PROCESS_INFO
    {
    // Must be the first entry in this struct - Zero means
    // command is unconditional
    LLINK conditional_information = 0;
    // Must be the second entry in this struct and must not be changed
    WORD type = ESsmCmdStartProcess;
   #ifndef SYMBIAN_SSM_FLEXIBLE_MERGE
    // Must be the third entry in this struct
    WORD version = ECmdStartProcessInitialVersion;
   #else
    // This version supports priority of the command
    WORD version = ECmdStartProcessVersionWithPriority;
   #endif
    // Can have a higher severity defined in TCmdErrorSeverity
    WORD severity = ECmdIgnoreFailure;
    // VALUE REQUIRED - full path to the process
    LTEXT name = "";
    // Passed to the "Tail End" at the command line
    // see CApaCommandLine. Maximum argument length allowed is 256 chars.
    LTEXT args = "";
    // Can also be ESsmWaitForSignal or ESsmDeferredWaitForSignal
    BYTE execution_behaviour = ESsmFireAndForget;
    // Time in milliseconds for every retry on failure
    LONG timeout = 0;
    // Number of times to retry on failure
    WORD retries = 0;
    // zero means no monitoring is required,
    // SSM_MONITOR_INFO should be used if monitoring is required
    LLINK monitor_info = 0;
   #ifdef SYMBIAN_SSM_FLEXIBLE_MERGE
    // The order of the command in the list - range can be from 0x00 to 0xffffu
    WORD priority = KDefaultCommandPriority;
    #endif
    }</pre>
 <pre class="codeblock" id="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-06E40D32-AF80-58D8-B445-75D317F7D748"><a name="GUID-723F8716-1FDD-57B4-B685-672D3A755592__GUID-06E40D32-AF80-58D8-B445-75D317F7D748"><!-- --></a>/**
Struct for monitoring information.

STRUCT SSM_MONITOR_INFO
    {
    // Must be the first entry in this struct and must not be changed
    WORD type = ESsmMonitorInfo;
    // Must be the second entry in this struct
    WORD version = ESsmMonitorInfoInitialVersion;
    // OS Restart policy to be used if component restarting has failed
    BYTE restart_policy = ESsmIgnoreOnFailure;
    // Restart mode when restart_policy=ESsmRestartOSWithMode
    BYTE restart_mode;
    // Delay in milliseconds between retries
    LONG timeout = 0;
    // Number of times to attempt to restart a failed component
    WORD retries = 0;
    }</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-70DA7D35-3EF3-5B9B-9E86-28893021A4A1.html">System Health Manager</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-8BC13552-7C7D-52AC-AF91-1BB7476912AF.html">System Health
Manager Overview</a></div>
<div><a href="GUID-484B27EF-3FA1-5193-97EC-B9699AE49026.html">System Health
Manager Concepts</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>