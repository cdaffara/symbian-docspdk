<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Embeddable Applications"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3CAD7211-2164-5F93-9EA7-7167E1C14012.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-58035B49-2EAE-5144-B226-28AF2EDD62E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-58CA15F8-D984-5D07-8C00-161FA16A8FD3.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1578590A-FC00-5C3B-8BF9-F6E43CA9D9A0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D2E19490-4179-548F-9DA8-9AE637FAC9E2.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C4CC3CA3-8C02-5F73-A482-4F849DD08111.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3CAD7211-2164-5F93-9EA7-7167E1C14012.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A6116E8B-9C4A-5B9E-AA8A-BE031408AA2F.html#GUID-A6116E8B-9C4A-5B9E-AA8A-BE031408AA2F/GUID-A28ABF97-3EF0-5554-8A66-C9EB1FF954B6"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Embeddable Applications</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2520040 id2520048 id2520063 id2520123 id2520201 id2520209 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-58035B49-2EAE-5144-B226-28AF2EDD62E7.html">Generic Application Support Guide</a> &gt; <a href="GUID-58CA15F8-D984-5D07-8C00-161FA16A8FD3.html">Application Framework</a> &gt; <a href="GUID-1578590A-FC00-5C3B-8BF9-F6E43CA9D9A0.html">Application Architecture</a> &gt; <a href="GUID-D2E19490-4179-548F-9DA8-9AE637FAC9E2.html">Application Architecture Tutorials</a> &gt; <a href="GUID-C4CC3CA3-8C02-5F73-A482-4F849DD08111.html">Porting Tutorial</a> &gt; <a href="GUID-3CAD7211-2164-5F93-9EA7-7167E1C14012.html">Porting Applications to EXEs</a> &gt; </div>
<h1 class="topictitle1">Embeddable
Applications</h1>
<div>
<div class="section" id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-4CE56897-FEB9-523F-843A-E5BAFFDBBCDB"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-4CE56897-FEB9-523F-843A-E5BAFFDBBCDB"><!-- --></a><h2 class="sectiontitle">Procedure</h2> <p>Embeddable
applications are implemented as ECom plug-ins. The <a href="GUID-C0297A58-2E39-3211-A2B4-C334192CE2A7.html"><span class="apiname">CApaApplication</span></a> class
defines the interface, and the majority of an application's code will be in
the ECom plug-in. To allow an embeddable application to run as a standalone
application a small EXE also needs to be created which calls the <samp class="codeph">EikStart::RunApplication()</samp> function,
but this time specifying the UID of the ECom plug-in rather than a pointer
to the factory function. </p>
 <p>This section describes the steps for converting
an existing embeddable application to an ECom plug-in and executable. </p>
 <p id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-D3711552-3728-592E-9244-4A94D17B430D"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-D3711552-3728-592E-9244-4A94D17B430D"><!-- --></a><strong>Creating the ECom plug-in</strong> </p>
 <p>The
MMP file of the embeddable application needs to be changed to create an ECom
plug-in instead of a DLL application, using the following lines: </p>
 <pre class="codeblock" id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-5A76A5A1-5E8B-50A5-A222-03775DB8784C"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-5A76A5A1-5E8B-50A5-A222-03775DB8784C"><!-- --></a>TARGET Example_embedded.dll 
TARGETTYPE PLUGIN 
UID 0x10009d8d 0x01010101</pre>
 <p>where <samp class="codeph">0x01010101</samp> is
a newly allocated UID, not the application's original UID - this is used elsewhere,
see below. </p>
 <p>The MMP file also needs to create the ECom plug-in resource,
and the original resource line needs to be modified so the application resource
file(s) are created in the correct directory. </p>
 <pre class="codeblock" id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-C47AD0E7-8A92-5AB4-A742-C1DDB6AC74D4"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-C47AD0E7-8A92-5AB4-A742-C1DDB6AC74D4"><!-- --></a>START RESOURCE 01010101.rss 
#ifdef SYMBIAN_SECURE_ECOM 
TARGET Example_embedded.rsc 
#endif 
END 

START RESOURCE Example.rss 
HEADER 
TARGETPATH \resource\apps 
LANG SC
END</pre>
 <p>The <span class="filepath">01010101.rss</span> ECom plug-in resource
file uses the standard format for ECom plug-ins, where the interface definition
UID for <a href="GUID-C0297A58-2E39-3211-A2B4-C334192CE2A7.html"><span class="apiname">CApaApplication</span></a> s is: </p>
 <pre class="codeblock" id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-AEDBF454-0768-5A16-BC2B-CFF4EEF81D87"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-AEDBF454-0768-5A16-BC2B-CFF4EEF81D87"><!-- --></a>const TUid KUidFileEmbeddedApplicationInterfaceUid={0x101f8c96};</pre>
 <p>The implementation UID should be the application's original UID (<samp class="codeph">0x01234567</samp> in
the example below), and therefore the file should look like this: </p>
 <pre class="codeblock" id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-04F88175-A0D8-5358-8183-8DDF040CBD01"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-04F88175-A0D8-5358-8183-8DDF040CBD01"><!-- --></a>#include &lt;RegistryInfo.rh&gt; 
RESOURCE REGISTRY_INFO
    {
    dll_uid = 0x01010101; 
    interfaces =
        {
        INTERFACE_INFO
            {
            interface_uid=0x101f8c96;
            implementations=
                {
                IMPLEMENTATION_INFO
                    {
                    implementation_uid=0x01234567;
                    version_no=1;
                    }
                };
            }
        };
    }</pre>
 <p> <span class="filepath"> ECom.lib</span> should be included in
the library section in the MMP file. </p>
 <p>The AIF section is not needed
as the application information is now provided by the registration file, localizable
resource file and icon file. A registration file should be provided to inform
the framework about the embeddable capability of the plug-in. This can be
achieved by setting the ‘embeddability' flag in <samp class="codeph">APP_REGISTRATION_INFO</samp> structure.
If a stub EXE is provided to start the ECom plug-in, set the embeddability
flag to <samp class="codeph">KAppEmbeddable</samp>, otherwise set <samp class="codeph">KAppEmbeddableOnly</samp>.
For more information about the registration file please refer to the <a href="GUID-D8302B04-D850-5FA7-A1AD-F5C40CF6A1EF.html" title="This document describes the changes required to migrate exe-apps to a data caged directory structure.">How to port guide - data
caged applications</a> document. </p>
 <p>The code for the application should
no longer export the <samp class="codeph">NewApplication()</samp> function at ordinal
1, but instead the function which informs the ECom framework of the implementations
this ECom plug-in provides (as is standard for an ECom plug-in). This is demonstrated
by the following code: </p>
 <pre class="codeblock" id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-77C1A71A-E4DB-5D1D-BBFC-8DB508BE439C"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-77C1A71A-E4DB-5D1D-BBFC-8DB508BE439C"><!-- --></a>#include "ExampleApp.h" 
#include &lt;ecom.h&gt; 
#include &lt;implementationproxy.h&gt; 
GLDEF_C TInt E32Dll(TDllReason)
    {
    return KErrNone;
    }

LOCAL_C CApaApplication* NewApplication()
    {
    return new CExampleApplication;
    }

LOCAL_D const TImplementationProxy ImplementationTable[]= 
    { 
    IMPLEMENTATION_PROXY_ENTRY(0x01234567, NewApplication)
    };
EXPORT_C const TImplementationProxy* ImplementationGroupProxy(TInt&amp; aTableCount) 
    { 
    aTableCount=sizeof(ImplementationTable)/sizeof(ImplementationTable[0]);
    return ImplementationTable; 
    }</pre>
 <p id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-F2901432-ED44-576A-B081-D3AF916C9A93"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-F2901432-ED44-576A-B081-D3AF916C9A93"><!-- --></a><strong>Creating
the standalone EXE for the application</strong> </p>
 <p>The MMP file for the standalone
EXE should create an EXE-app (as described in the section above) and the EXE
should have the application's UID as its third UID. The AIF file should be
replaced by a registration file. The registration file is used to inform the
framework that the application is capable of being embedded by setting <samp class="codeph">KAppEmbeddable</samp> in
the ‘embeddability' field of the <samp class="codeph">APP_REGISTRATION_INFO</samp> structure. </p>
 <pre class="codeblock" id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-BE2079A0-F267-583F-8098-3F7143EE22FF"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-BE2079A0-F267-583F-8098-3F7143EE22FF"><!-- --></a>#if !defined(EKA2) &amp;&amp; defined(WINS)
TARGET Example.app 
TARGETTYPE exedll 
deffile \epoc32\release\wins\exedllapp.def 
#else 
TARGET Example.exe 
TARGETTYPE exe 
#endif 
UID 0x100039CE 0x01234567 
TARGETPATH \sys\bin 
EPOCSTACKSIZE 0x5000 
SOURCEPATH . 
SOURCE Example_Standalone.cpp 
USERINCLUDE . 
SYSTEMINCLUDE \epoc32\include

// Application exe registration resource file 
start resource     Example_reg.rss 
targetpath     \private\10003a3f\apps 
lang        sc 
end

LIBRARY euser.lib apparc.lib eikcore.lib</pre>
 <p>The executable need
only be a 'stub' to start the application architecture with the ECom UID.
Therefore the single source file should contain code similar to the following: </p>
 <pre class="codeblock" id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-F6746743-4040-51C8-837A-851AE41B69F5"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-F6746743-4040-51C8-837A-851AE41B69F5"><!-- --></a>#include &lt;e32std.h&gt; 
#include &lt;eikstart.h&gt;

const TUid KExampleUid = {0x01234567}; 
GLDEF_C TInt E32Main()
    {
    return EikStart::RunApplication(KExampleUid);
    } 
#if defined(__WINS__) &amp;&amp; !defined(EKA2) 
GLDEF_C TInt E32Dll(TDllReason)
    {
    return KErrNone;
    } 
EXPORT_C TInt WinsMain(TDesC* aCmdLine)
    {
    return EikStart::RunApplication(KExampleUid, aCmdLine);
    } 
#endif</pre>
 <p>Finally, the <span class="filepath">bld.inf</span> for the application
needs to be modified to build both MMP files, for example: </p>
 <pre class="codeblock" id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-ADA03DA8-4AE4-50BB-9A28-5745A0F807E2"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-ADA03DA8-4AE4-50BB-9A28-5745A0F807E2"><!-- --></a>PRJ_MMPFILES 
Example_embedded.MMP 
Example_standalone.MMP</pre>
 <p id="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-C75A516F-B0BA-5E5C-8C86-2A4FBA9C3034"><a name="GUID-BD7C45B2-11BF-5162-9F9B-B84E51C5C6D4__GUID-C75A516F-B0BA-5E5C-8C86-2A4FBA9C3034"><!-- --></a><strong>Embedding
a new-style application in an existing application</strong> </p>
 <p>To add a new
document to an application, an overload of <samp class="codeph">CApaProcess::AddNewDocumentL()</samp> has
been created which can accept an ECom UID or an ECom <a href="GUID-3107B19B-0607-3E9E-AEA5-BAD07EEC59D0.html"><span class="apiname">CImplementationInformation</span></a> reference.
However, the existing overload of <samp class="codeph">AddNewDocumentL()</samp> handles
the case where the application for the document is an EXE, and attempts to
find an ECom plug-in with the correct UID to create the embedded application.
Therefore, existing applications (which perhaps offer a list of available
embeddable applications to the user) do not need to be modified. Also, the
internalizing and externalizing of embedded documents (through <a href="GUID-F9CF2D9A-DF57-3603-896F-E2D5A2AE7481.html"><span class="apiname">CApaDoor</span></a>)
works with no modifications necessary. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-3CAD7211-2164-5F93-9EA7-7167E1C14012.html">Porting Applications to EXEs</a></div>
</div>
<div class="relinfo"><strong>Related information</strong><br/>
<div><a href="GUID-A6116E8B-9C4A-5B9E-AA8A-BE031408AA2F.html#GUID-A6116E8B-9C4A-5B9E-AA8A-BE031408AA2F__GUID-A28ABF97-3EF0-5554-8A66-C9EB1FF954B6">Application properties</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>