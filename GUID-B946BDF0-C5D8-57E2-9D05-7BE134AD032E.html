<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Unified Certificate Store Tutorial"/>
<meta name="abstract" content="The Unified Certificate Store is the single point of access for client applications to access and manipulate certificate stores in the device. This tutorial provides information on how you can use the Unified Certificate Store to perform various certificate-manipulation operations."/>
<meta name="description" content="The Unified Certificate Store is the single point of access for client applications to access and manipulate certificate stores in the device. This tutorial provides information on how you can use the Unified Certificate Store to perform various certificate-manipulation operations."/>
<meta name="DC.Relation" scheme="URI" content="GUID-0010EB39-8C23-5453-BE96-4EFC520B6F81.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C3290344-486B-554D-97FC-42DF48E150AA.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-39B459CD-8210-59B5-95F4-85CE36676735.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0010EB39-8C23-5453-BE96-4EFC520B6F81.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-037225BC-AC45-540E-A899-1B8AB9112D6E.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Unified Certificate Store Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2858558 id2859383 id2859414 id2859476 id2859490 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html">OS Security Guide</a> &gt; <a href="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html">Crypto Services</a> &gt; <a href="GUID-C3290344-486B-554D-97FC-42DF48E150AA.html">Certificate and Key Management</a> &gt; <a href="GUID-39B459CD-8210-59B5-95F4-85CE36676735.html">Unified Stores</a> &gt; <a href="GUID-0010EB39-8C23-5453-BE96-4EFC520B6F81.html">Unified Certificate Store</a> &gt; </div>
<h1 class="topictitle1">Unified
Certificate Store Tutorial</h1>
<div><p>The Unified Certificate Store is the single point of access for
client applications to access and manipulate certificate stores in the device.
This tutorial provides information on how you can use the Unified Certificate
Store to perform various certificate-manipulation operations. </p>

<div class="section"><h2 class="sectiontitle">Procedure</h2> <p>Follow these steps to perform the various
certificate manipulation operations using the Unified Certificate Store: </p>
 <a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-FF80C823-255E-5EF6-B433-A56190C80A8F"><!-- --></a><ol id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-FF80C823-255E-5EF6-B433-A56190C80A8F">
<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-B9D2FEBD-776E-5940-94CC-FDFF775DF1E6"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-B9D2FEBD-776E-5940-94CC-FDFF775DF1E6"><!-- --></a><p>Create an instance of
the Unified Certificate Store and initialize it. </p>
 <p>You can create a
certificate store in read-only or writable mode. Operations like adding and
removing certificates can be performed when the certificate store is in writable
mode. Basic operations like listing certificates, retrieving certificate details,
viewing trust statuses of certificates can be performed when the certificate
store is in read-only mode. </p>
 <p>The following steps explain the processing
of creating and initialising a Unified Certificate Store: </p>
 <a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-99B8E435-FDCF-5D5A-B15F-2685B18D6E4B"><!-- --></a><ol type="a" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-99B8E435-FDCF-5D5A-B15F-2685B18D6E4B">
<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-9B955334-F229-54B4-8F48-039AAED1685C"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-9B955334-F229-54B4-8F48-039AAED1685C"><!-- --></a><p>Create an instance of
the <samp class="codeph">RFs</samp> class. Use the object created as a file system session. </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-53BDC7C5-1380-53E3-840F-61E7BAB0BD53"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-53BDC7C5-1380-53E3-840F-61E7BAB0BD53"><!-- --></a><p>Create an object of
type <samp class="codeph">CUnifiedCertStore</samp> using <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-FB4204E6-EEB5-3C8E-9938-5466C8AA318E"><span class="apiname">CUnifiedCertStore::NewL()</span></a> or <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-E66689D6-82C9-33B5-8CB6-7CE40EBAFF4E"><span class="apiname">CUnifiedCertStore::NewLC()</span></a>. </p>
 <p> <strong>Note:</strong>  </p>
 <p>The value that you set for the Boolean variable <samp class="codeph">aOpenForWrite</samp> decides
if you can open the certificate store in read-only or writable mode. Set the
value of the variable to: </p>
 <ul>
<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-FF0DA388-7DFC-504A-9C0F-AAB32F44C6D3"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-FF0DA388-7DFC-504A-9C0F-AAB32F44C6D3"><!-- --></a><p> <samp class="codeph">ETrue</samp> to
open the certificate store with write access. </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-F1DF4204-DE2A-59B6-BB85-E65BFED1A929"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-F1DF4204-DE2A-59B6-BB85-E65BFED1A929"><!-- --></a><p> <samp class="codeph">EFalse</samp> to
open the certificate store with read-only access. </p>
 </li>

</ul>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-C158790B-DE2D-52DC-A387-90961DC77F4B"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-C158790B-DE2D-52DC-A387-90961DC77F4B"><!-- --></a><p>Initialize the certificate
store and the member functions using the asynchronous function <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-949ACD5A-756A-356A-8DC5-462FBDFB0B95"><span class="apiname">CUnifiedCertStore::Initialize()</span></a>. </p>
 </li>

</ol>
 <p>The code snippet to create and initialize a Unified Certificate Store
is as follows: </p>
 <pre class="codeblock" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-9DE1EB37-DDFE-5D22-9A3B-ADE97CBD4A5D"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-9DE1EB37-DDFE-5D22-9A3B-ADE97CBD4A5D"><!-- --></a>
//Create a file system session object
RFs iFs;
iFS.connect();
CleanupClosePushL(iFs);


//Create and initialize the Unified Certificate Store
CUnifiedCertStore* iCertStore = CUnifiedCertStore::NewL(iFs, ETrue);

//iStatus is a TRequestStatus
iCertStore-&gt;Initialize(iStatus); 
</pre>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-ED591EC4-417B-5D57-BA41-3B4F8C97D2D6"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-ED591EC4-417B-5D57-BA41-3B4F8C97D2D6"><!-- --></a><p>Complete any of the
following tasks as per your requirement: </p>
 <ul>
<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-E5BFB9AB-1754-5D58-84E2-49395DC2A87D"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-E5BFB9AB-1754-5D58-84E2-49395DC2A87D"><!-- --></a><p><a href="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E.html#GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-A9389658-0ECD-59BA-A602-C528767456D5">Adding certificates</a>  </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-99C0B5EC-8204-522A-94EC-08D06BB00C1D"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-99C0B5EC-8204-522A-94EC-08D06BB00C1D"><!-- --></a><p><a href="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E.html#GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-2842C30A-579C-5E1A-8307-7AFF399BCCDE">Removing certificates</a>  </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-1DCEFAE8-36AF-50AB-B925-FBBB6E35DCA4"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-1DCEFAE8-36AF-50AB-B925-FBBB6E35DCA4"><!-- --></a><p><a href="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E.html#GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-7C74D0F9-25A3-5FDE-9FF1-EB865A31535E">Finding certificates</a>  </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-AAB713A9-450A-5ADF-8B4D-852BF418E2C0"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-AAB713A9-450A-5ADF-8B4D-852BF418E2C0"><!-- --></a><p><a href="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E.html#GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-42C7CD98-4617-57D2-8331-C0A05DF7F7E7">Retrieving certificate as a parsed object</a>  </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-61C6704B-4A88-5FD4-90D5-310BF7D98180"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-61C6704B-4A88-5FD4-90D5-310BF7D98180"><!-- --></a><p><a href="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E.html#GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-1F1F9608-C387-5597-8041-AB1BC1F65992">Retrieving certificate details</a>  </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-71FD55FF-2619-59B0-8F96-13AFDABC0E4E"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-71FD55FF-2619-59B0-8F96-13AFDABC0E4E"><!-- --></a><p><a href="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E.html#GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-DD7D5D55-A2F1-54FB-AA38-B4A7C920B6A6"> Managing applicability and trust settings for certificates</a>  </p>
 </li>

</ul>
 </li>

</ol>
 </div>

<div class="section" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-A9389658-0ECD-59BA-A602-C528767456D5"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-A9389658-0ECD-59BA-A602-C528767456D5"><!-- --></a><h2 class="sectiontitle">Adding certificates</h2> <p>Before
adding a certificate, it is essential to determine the certificate store to
which the certificate will be added. </p>
 <p>The following steps explain the
process of retrieving the certificate store by specifying an appropriate index
value and then adding a certificate to the particular store: </p>
 <a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-B4CC2EBE-BCCC-5BC3-B0B1-88B9086A8D7E"><!-- --></a><ol id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-B4CC2EBE-BCCC-5BC3-B0B1-88B9086A8D7E">
<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-33EF0F8B-C0D0-5E34-9FB6-0EC694D6F8C0"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-33EF0F8B-C0D0-5E34-9FB6-0EC694D6F8C0"><!-- --></a><p>Create an object of
a writable certificate store using <a href="GUID-135A2547-5D64-3223-82DC-8133F8FEAD37.html"><span class="apiname">MCTWritableCertStore</span></a> and
retrieve the certificate store to which the certificate will be added. </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-5095B782-EF13-5A92-B025-DFA523A5E638"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-5095B782-EF13-5A92-B025-DFA523A5E638"><!-- --></a><p>Specify the details
of the certificate to be added and include it to the selected store using <a href="GUID-135A2547-5D64-3223-82DC-8133F8FEAD37.html#GUID-135A2547-5D64-3223-82DC-8133F8FEAD37__GUID-0913D6AB-35ED-3525-BDD1-11C93514C5F5"><span class="apiname">MCTWritableCertStore::Add()</span></a>. </p>
 </li>

</ol>
 <p>The following code snippet explains how to add a certificate to the
certificate store: </p>
 <pre class="codeblock" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-EFE9F14D-15CE-5977-A1B1-B2DCB1241C69"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-EFE9F14D-15CE-5977-A1B1-B2DCB1241C69"><!-- --></a>
//Create and initialize the Unified Certificate Store
.
.
.

//Create an object of the writable certificate store 

//Retrieve the certificate store present at the specified index
//If the certificate store index is invalid 
//or the specified certificate store cannot be opened
//then the store object is NULL

MCTWritableCertStore&amp; ustore = iCertStore-&gt;iWritableCertStore(0);
.
.
.
//Specify details of the certificate

//The certificate label
HBufC* iCertLabel; 
iCertLabel = HBufC::NewL(20);
_LIT(KTxtLabel,"CertificateLabel");
*iCertLabel = KTxtLabel;

//The certificate format
TCertificateFormat icertFormat = EX509Certificate;

//The certificate owner type
TCertificateOwnerType iCertOwnerType = ECACertificate;

//The certificate's subject key id and issuer key id
//Both are optional fields

TKeyIdentifier* aSubjectKeyId = NULL;
TKeyIdentifier* aIssuerKeyId = NULL;

//iCertData is an HBufC8* buffer that holds certificate data
HBufC* iCertData  = HBufC::NewL(200);

//Add the certificate
//The subject key id and issuer key id values are 0

ustore-&gt;Add(*iCertLabel, EX509Certificate, ECACertificate, 0, 0, iCertData-&gt;Des(), iStatus); 
</pre>
 </div>

<div class="section" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-2842C30A-579C-5E1A-8307-7AFF399BCCDE"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-2842C30A-579C-5E1A-8307-7AFF399BCCDE"><!-- --></a><h2 class="sectiontitle">Removing certificates</h2> <p>Specify
details of the certificate to be removed and then remove it from the certificate
store. The following steps provide the require details: </p>
 <a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-C3D2E9DF-8CFA-5F23-A620-DCDE2EE49D44"><!-- --></a><ol id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-C3D2E9DF-8CFA-5F23-A620-DCDE2EE49D44">
<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-C55FC085-7037-5447-BBF4-A69EE77B0055"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-C55FC085-7037-5447-BBF4-A69EE77B0055"><!-- --></a><p>Create an object of
a writable certificate store using <a href="GUID-135A2547-5D64-3223-82DC-8133F8FEAD37.html"><span class="apiname">MCTWritableCertStore</span></a> and
retrieve the certificate store from which the certificate will be removed. </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-9E4DE5E2-E0D1-5ED2-8415-B0B44C54A424"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-9E4DE5E2-E0D1-5ED2-8415-B0B44C54A424"><!-- --></a><p>Create a <samp class="codeph">CCTCertInfo</samp> object
of the certificate to be removed. Pass this to the <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-C5782446-6A63-32E7-A4CE-1DDC4F8AC5CB"><span class="apiname">CUnifiedCertStore::Remove()</span></a> function
to remove the particular certificate from the certificate store. </p>
 </li>

</ol>
 <p>The following code snippet explains how to remove a certificate from
the certificate store: </p>
 <pre class="codeblock" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-721E6910-928F-52E4-B7A5-F281D9947539"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-721E6910-928F-52E4-B7A5-F281D9947539"><!-- --></a>
//Create and initialize the Unified Certificate Store
.
.
.

//Create an object of the writable certificate store 

//Retrieve the certificate store present at the specified index
//If the certificate store index is invalid 
//or the specified certificate store cannot be opened
//then the store object is NULL

MCTWritableCertStore&amp; ustore = iCertStore-&gt;iWritableCertStore(0);
.
.
.
//Create a CCTCertInfo object for the certificate to be removed

//Instantiate a token

_LIT(KTokenString,"certtoken");

class CSimpleToken:: public CBase,public MCTToken
{
public:
    static MCTToken* NewL(MCTTokenType* aTokenType);

public: //  From MCTToken
     MCTTokenType&amp; TokenType();
     const TDesC&amp; Label();
     TCTTokenHandle Handle();

private:
     MCTTokenType* iTokenType;
}

MCTToken* CSimpleToken::NewL(MCTTokenType* aTokenType)
     {
     CDummyTokenClient* self = new (ELeave) CSimpleTokenType(aTokenType);
     return static_cast&lt;MCTToken*&gt;(self);
     }
 
 CSimpleToken::CSimpleToken(MCTTokenType* aTokenType)
             :   iTokenType(aTokenType),
     {
     }

 MCTTokenType&amp; CSimpleToken::TokenType()
     {
     return *iTokenType;
     }
 const TDesC&amp; CSimpleToken::Label()
     {
     return KTokenString();
     }
 TCTTokenHandle CSimpleToken::Handle()
     {
     return (TCTTokenHandle(iTokenType-&gt;Type(), 0));
     }
// Create token type
TUid tokenUid = 0x103478;
CCTTokenType* tokenType =  CCTTokenType(tokenUid,iFs);
CleanupReleasePushL(*tokenType);

// Open the token
MCTToken* token = NULL;
tokenType.openToken(KTokenString, token, iStatus);  
.
.
.
//The certificate label
HBufC* iCertLabel = HBufC::NewL(20);
_LIT(KTxtLabel,"CertificateLabel2");
*iCertLabel = KTxtLabel;
  
//The certificate format
TCertificateFormat icertFormat = EX968Certificate;

//The certificate owner type
TCertificateOwnerType iCertOwnerType = EUserCertificate;

//The certificate's subject key id and issuer key id fields
TKeyIdentifier* aSubjectKeyId = NULL;
TKeyIdentifier* aIssuerKeyId = NULL;

//The certificate ID 
const TInt KCertificateId = 0x00001234;

//iCertInfo is a CCTCertInfo object that points to the certificate to be removed
CCTCertInfo* iCertInfo  = CCTCertInfo::NewLC(*iCertLabel, icertFormat, iCertOwnerType, 999, aSubjectKeyId, aIssuerKeyId, token, KCertificateId, ETrue);


//Remove the certificate
ustore-&gt;Remove(iCertInfo, iStatus);
CleanupStack::PopAndDestroy(2, tokenType);
</pre>
 </div>

<div class="section" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-7C74D0F9-25A3-5FDE-9FF1-EB865A31535E"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-7C74D0F9-25A3-5FDE-9FF1-EB865A31535E"><!-- --></a><h2 class="sectiontitle">Finding certificates</h2> <p>You
can specify filter criteria like certificate format, certificate owner type
and so on to find a particular set of certificates from the certificate store.
The following steps explain the process of finding certificates: </p>
 <a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-C7E944A0-9B0C-58E0-A2D8-15CEA6369B76"><!-- --></a><ol id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-C7E944A0-9B0C-58E0-A2D8-15CEA6369B76">
<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-B7170624-BA1B-58A5-B52D-DDDA55B02494"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-B7170624-BA1B-58A5-B52D-DDDA55B02494"><!-- --></a><p>Specify a filter object
for the certificates to be returned. </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-63746FE1-B1D8-593D-8262-5F27635E7EEA"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-63746FE1-B1D8-593D-8262-5F27635E7EEA"><!-- --></a><p>Specify the filter criteria
for returning a specific category of certificates. </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-246E4834-0C0E-5721-BE8D-01B7B688BC1A"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-246E4834-0C0E-5721-BE8D-01B7B688BC1A"><!-- --></a><p>Use the <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-F88680D5-737A-3BF5-98E4-1BAD101A6B1C"><span class="apiname">CUnifiedCertStore::List()</span></a> function
to list the filtered certificates. </p>
 </li>

</ol>
 <p>The following code snippet explains how to find certificates in a
certificate store: </p>
 <pre class="codeblock" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-FC4077EB-0B5A-5832-BA3F-1EA9CAA80BC5"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-FC4077EB-0B5A-5832-BA3F-1EA9CAA80BC5"><!-- --></a>
//Create and initialize the Unified Certificate Store
.
.
.

RPointerArray&lt;CCTCertInfo&gt; iCerts; //This variable will contain the certificates found

//Specify filter object for the certificates
CCertAttributeFilter&amp; iCertFilter;
iCertFilter = CCertAttributeFilter::NewL(); 


//Specify the filter criteria           
iCertFilter-&gt;SetFormat(EWTLSCertificate); 
iCertFilter-&gt;SetOwnerType(ECACertificate);


//List the certificates based on the filter criteria
iCertStore-&gt;List(iCerts, iCertFilter, iStatus);
</pre>
 </div>

<div class="section" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-42C7CD98-4617-57D2-8331-C0A05DF7F7E7"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-42C7CD98-4617-57D2-8331-C0A05DF7F7E7"><!-- --></a><h2 class="sectiontitle">Retrieving
certificate as a parsed object</h2> <p>You can retrieve a certificate as
a parsed object only in case of <a href="GUID-C676C4E6-93AF-59E9-886D-74D59F154490.html">X.509</a> or
Wireless Transport Layer Security (WTLS) certificates. This method of retrieval
does not work for URL certificates. </p>
 <p>Use the <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-DE63711C-95CA-3C92-B406-3BEF04184866"><span class="apiname">CUnifiedCertStore::Retrieve()</span></a> function
to retrieve the certificate as a parsed object. </p>
 <p>The following code
snippet explains how to retrieve a certificate as a parsed object: </p>
 <pre class="codeblock" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-233AA2D2-5A2B-5F29-8C30-79C2AB821C8A"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-233AA2D2-5A2B-5F29-8C30-79C2AB821C8A"><!-- --></a>
//Create and initialize the Unified Certificate Store
.
.
.

//Retrieve the certificate

//iCertInfo is a CCTCertInfo object that points to the certificate to be retrieved
//iCert contains the returned certificate
 
iCertStore-&gt;Retrieve(iCertInfo, iCert, iStatus);
</pre>
 </div>

<div class="section" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-1F1F9608-C387-5597-8041-AB1BC1F65992"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-1F1F9608-C387-5597-8041-AB1BC1F65992"><!-- --></a><h2 class="sectiontitle">Retrieving
certificate details</h2> <p>You can retrieve Abstract Syntax Notation One
(ASN.1) encoded certificate data from the certificate store. The certificate
data is returned as an ASN.1-encoded string. </p>
 <p>Use the <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-DE63711C-95CA-3C92-B406-3BEF04184866"><span class="apiname">CUnifiedCertStore::Retrieve()</span></a> function
to retrieve the certificate details. Unlike the function used to retrieve
a certificate as a parsed object, this function also accepts a buffer object
to hold the details of the certificate that is being retrieved. </p>
 <p>The
following code snippet explains how to retrieve details of a specific certificate: </p>
 <pre class="codeblock" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-7D781666-11BF-5BAF-A642-F5C02C79E0E7"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-7D781666-11BF-5BAF-A642-F5C02C79E0E7"><!-- --></a>
//Create and initialize the Unified Certificate Store
.
.
.

//Retrieve the certificate details

//iCertInfo is a CCTCertInfo object that points to the certificate to be retrieved
//iCertData is an HBufC8* buffer that holds certificate data

iCertStore-&gt;Retrieve(iCertInfo, iCertData-&gt;Des(), iStatus); 
</pre>
 </div>

<div class="section" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-DD7D5D55-A2F1-54FB-AA38-B4A7C920B6A6-GENID-1-12-1-26-1-1-10-1-5-1-5-1-4-1-4-1-3-7"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-DD7D5D55-A2F1-54FB-AA38-B4A7C920B6A6-GENID-1-12-1-26-1-1-10-1-5-1-5-1-4-1-4-1-3-7"><!-- --></a><h2 class="sectiontitle">Managing applicability
and trust settings</h2> <p>The trust status of a certificate indicates
if it can be considered as a trust anchor for validating any application.
This status is valid only for certificates issued by the Certificate Authority
(CA). The applicability settings of a certificate indicate the applications
for which the trust status is valid. </p>
 <p>The Unified Certificate Store
API provides the following functions to get and set the applicability and
trust settings for certificates: </p>
 
<div class="tablenoborder"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-B1E90AB7-D5AF-5DC2-AC8C-13922449A1A7"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-B1E90AB7-D5AF-5DC2-AC8C-13922449A1A7" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" id="d1698685e354">Function</th>

<th class="cellrowborder" valign="top" id="d1698685e357">Description</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" headers="d1698685e354 "><p> <samp class="codeph">Applications()</samp>  </p>
 </td>

<td class="cellrowborder" valign="top" headers="d1698685e357 "><p>Gets a list of application UIDs for a certificate </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" headers="d1698685e354 "><p> <samp class="codeph"> IsApplicable()</samp>  </p>
 </td>

<td class="cellrowborder" valign="top" headers="d1698685e357 "><p>Determines whether a certificate has a specific application UID </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" headers="d1698685e354 "><p> <samp class="codeph"> Trusted()</samp>  </p>
 </td>

<td class="cellrowborder" valign="top" headers="d1698685e357 "><p>Determines whether a certificate is trusted </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" headers="d1698685e354 "><p> <samp class="codeph">SetApplicability()</samp>  </p>
 </td>

<td class="cellrowborder" valign="top" headers="d1698685e357 "><p>Sets the list of application UIDs </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" headers="d1698685e354 "><p> <samp class="codeph">SetTrust() </samp>  </p>
 </td>

<td class="cellrowborder" valign="top" headers="d1698685e357 "><p>Sets the trust flag. </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p><strong>Setting applicability and trust settings</strong> </p>
 <p>You can
change the existing applicability and trust settings of a certificate. The
details are as follows: </p>
 <ul>
<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-97330D30-CE30-5B54-9E8D-54DDCB469BC4"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-97330D30-CE30-5B54-9E8D-54DDCB469BC4"><!-- --></a><p> <strong>Set applicability:</strong> Specify
a <samp class="codeph">CCTCertInfo</samp> object for the certificate, an array for containing
the new applicability settings and a request status object that will contain
the result of the applicability setting operation when complete. Pass these
as parameters to the <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-2A38AD3B-A04A-3382-858A-232E4BD64207"><span class="apiname">CUnifiedCertStore::SetApplicability()</span></a> function
and apply the settings. </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-783FF55B-65EF-5ED3-BE18-DAE1E596EA79"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-783FF55B-65EF-5ED3-BE18-DAE1E596EA79"><!-- --></a><p> <strong>Set trust: </strong> Specify
a <samp class="codeph">CCTCertInfo</samp> object for the certificate, a <samp class="codeph">TBool</samp> object
to decide if the certificate is to be trusted (<samp class="codeph">ETrue</samp> if trusted
and <samp class="codeph">EFalse</samp> if not) and a request status object that will
contain the result of the trust setting operation when complete. Pass these
as parameters to the <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-96640E22-0F69-3053-A609-4708AE3E6559"><span class="apiname">CUnifiedCertStore::SetTrust()</span></a> function
and apply the trust settings. </p>
 </li>

</ul>
 <p>The following code snippet explains how to set the applicability
and trust settings for a certificate: </p>
 <pre class="codeblock" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-11E65DD8-F148-5241-8C9C-693E076973C0"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-11E65DD8-F148-5241-8C9C-693E076973C0"><!-- --></a>
//Create and initialize the Unified Certificate Store
.
.
.

//Parameters for applicability and trust settings 

RArray&lt;TUid&gt; iApplications; //The applicability settings
TBool iTrustStatus = ETrue; //The trust setting

//Set Applicability

//iCertInfo is a CCTCertInfo object that points to the certificate whose applicability and trust settings are to be updated

iCertStore-&gt;SetApplicability(iCertInfo, iApplications, iStatus); 

//Set Trust

iCertStore-&gt;SetTrust(iCertInfo, iTrustStatus, iStatus);
</pre>
 <p><strong>Getting applicability and trust settings</strong> </p>
 <p>You
can determine whether a certificate is trusted as well as get a list of application
UIDs for a certificate. The details are as follows: </p>
 <ul>
<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-0083812D-C352-5BB3-A4FD-09A10FBB7375"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-0083812D-C352-5BB3-A4FD-09A10FBB7375"><!-- --></a><p> <strong>Get applicability:</strong> Specify
a <samp class="codeph">CCTCertInfo</samp> object for the certificate, an array for containing
applicability settings (Application UIDs pertaining to the certificate) and
a request status object that will contain the result of getting the applicability
settings when the operation is complete. Pass these as parameters to the <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-7B518009-7848-30FB-BE52-7F38E3C88C59"><span class="apiname">CUnifiedCertStore::Applications()</span></a> function. </p>
 </li>

<li id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-1FD626D2-965C-5CBC-AD13-6D8DA90F065D"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-1FD626D2-965C-5CBC-AD13-6D8DA90F065D"><!-- --></a><p> <strong>Get trust:</strong> Specify
a <samp class="codeph">CCTCertInfo</samp> object for the certificate, a <samp class="codeph">TBool</samp> object
that returns the trust status of the certificate (<samp class="codeph">ETrue</samp> if
trusted and <samp class="codeph">EFalse</samp> if not) and a request status object that
will contain the trust settings. Pass these as parameters to the <a href="GUID-AD63C29A-17C3-375C-840F-42A92422300D.html#GUID-AD63C29A-17C3-375C-840F-42A92422300D__GUID-183B8E74-1F85-380D-B69C-0303FD4B9A1C"><span class="apiname">CUnifiedCertStore::Trusted()</span></a> function. </p>
 </li>

</ul>
 <p>The following code snippet explains how to get the applicability
and trust settings for a certificate: </p>
 <pre class="codeblock" id="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-309E1640-E00E-59CF-A4B3-17FC0C8AE3C7"><a name="GUID-B946BDF0-C5D8-57E2-9D05-7BE134AD032E__GUID-309E1640-E00E-59CF-A4B3-17FC0C8AE3C7"><!-- --></a>
//Create and initialize the Unified Certificate Store
.
.
.
//Get Applicability

//iCertInfo is a CCTCertInfo object that points to the certificate whose applicability and trust settings are to be updated
//iApplications is an RArray&lt;TUid&gt; that returns the application UIDs for the certificate

iCertStore-&gt;Applications(iCertInfo, iApplications, iStatus); 

//Get Trust
//iTrustStatus is a TBool returns the trust status of a certificate

iCertStore-&gt;Trusted(iCertInfo, iTrustStatus, iStatus);
</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-0010EB39-8C23-5453-BE96-4EFC520B6F81.html">Unified Certificate Store</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-037225BC-AC45-540E-A899-1B8AB9112D6E.html">Unified Certificate
Store Overview</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>