<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="How to manipulate simple global text"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2DDEF473-B804-51DF-874F-ADF46CB03ABA.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-4F901F56-7F0E-4869-85CA-6109ED0AF5B7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-533EC918-BF5B-5D0B-8860-1E8746A05EE3.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2DDEF473-B804-51DF-874F-ADF46CB03ABA.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-74E69324-7BCC-591F-B2A9-2932A3790966"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>How to manipulate simple global text</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2535736 id2436594 id2436602 id2436669 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html">Text and Localization Guide</a> &gt; <a href="GUID-4F901F56-7F0E-4869-85CA-6109ED0AF5B7.html" title="This section describes about Text Handling and Text Formatting.">Text Layout</a> &gt; <a href="GUID-533EC918-BF5B-5D0B-8860-1E8746A05EE3.html">Using Text and Text Attributes (ETEXT)</a> &gt; <a href="GUID-2DDEF473-B804-51DF-874F-ADF46CB03ABA.html">Formatting</a> &gt; </div>
<h1 class="topictitle1">How to manipulate simple global text</h1>
<div><div class="section"><h2 class="sectiontitle">Creating a global text object</h2> <p>A <span class="keyword">global text object</span> has global <span class="keyword">paragraph</span> and <span class="keyword">character</span> formatting. Its formatting is stored in a paragraph and a character <span class="keyword">format layer</span>. To create a global text object, you need to create these layers, and pass them as parameters to the <a href="GUID-4F502FE5-44D4-3947-9D73-67EF4886059A.html"><span class="apiname">CGlobalText</span></a> constructor:</p>
 <pre class="codeblock" id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-751BE38C-5DF2-544C-8D5B-3E62F081A212"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-751BE38C-5DF2-544C-8D5B-3E62F081A212"><!-- --></a>CGlobalText* iglobalText; // global text document
CParaFormatLayer* iparaFormatLayer;
CCharFormatLayer* icharFormatLayer; 
iparaFormatLayer=CParaFormatLayer::NewL(); // required para format
icharFormatLayer=CCharFormatLayer::NewL(); // required char format
iglobalText=CGlobalText::NewL(iparaFormatLayer, icharFormatLayer);</pre>
 <p><strong>Notes</strong> </p>
 <ul><li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-EC58C950-BAAA-5F3E-92A4-0331872048C9"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-EC58C950-BAAA-5F3E-92A4-0331872048C9"><!-- --></a><p>The code above constructs a global text object which uses default paragraph and character formatting.</p>
 </li>
 <li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-4239E00E-221A-5B14-8630-02629AA17B60"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-4239E00E-221A-5B14-8630-02629AA17B60"><!-- --></a><p>Rich text is formatted in exactly the same way as global text, except that the length and position arguments now are relevant and must specify a valid range of characters. Only characters in the range specified are affected.</p>
 </li>
 <li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-E35FC190-0D69-5E43-9041-3243FE20DD8A"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-E35FC190-0D69-5E43-9041-3243FE20DD8A"><!-- --></a><p>The global text object does <em>not</em> take on ownership of these <span class="keyword">format layers</span>. This allows several global text objects to share the same format layers. Therefore, if you have only a single global text object, you must destroy not only it, but the format layers also:</p>
 </li>
 </ul>
 <pre class="codeblock" id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-EB55D07F-3A79-5372-B25A-418FF0F7F55C"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-EB55D07F-3A79-5372-B25A-418FF0F7F55C"><!-- --></a>delete iglobalText; // delete contained document
delete icharFormatLayer; // delete char format layer
delete iparaFormatLayer; // and para format layer</pre>
 <p>If you had several global text objects sharing the same format layers, you would destroy the format layers only after all the text objects had been destroyed.</p>
 </div>
 <div class="section"><h2 class="sectiontitle">Inserting text and paragraphs</h2> <p>Text may be inserted using <samp class="codeph">InsertL()</samp>, specifying a <span class="keyword">document position</span> and the text to insert.</p>
 <pre class="codeblock" id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-B5A979D1-D93E-5CB1-93C3-1B234A413335"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-B5A979D1-D93E-5CB1-93C3-1B234A413335"><!-- --></a>iGlobalText-&gt;InsertL(0,_L("Hello!"));
iGlobalText-&gt;InsertL(5,_L(" World"));
iGlobalText-&gt;InsertL(12,CEditableText::EParagraphDelimiter);
    // insert paragraph marker
iGlobalText-&gt;InsertL(13,_L("And hello again!"));
    // insert text to follow this marker</pre>
 <p><strong>Note</strong> </p>
 <ul><li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-BE90B234-2B52-5ECC-9280-6898304CDB6C"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-BE90B234-2B52-5ECC-9280-6898304CDB6C"><!-- --></a><p>The code inserts two character strings into the text at document positions 0 and 5. Position 5 is the position between the fifth and sixth characters. A new <span class="keyword">paragraph delimiter</span> and some more text is then inserted.</p>
 </li>
 </ul>
 </div>
 <div class="section"><h2 class="sectiontitle">Extracting information and text</h2> <p>The following example code extracts information about a text object and about a word within the text object and reads the word at a document position. The status message <samp class="codeph">iMessage</samp> (a <samp class="codeph">TBuf&lt;80&gt;</samp>) is used to display the number of <span class="keyword">characters</span>, <span class="keyword">words</span> and <span class="keyword">paragraphs</span> in the global text object.</p>
 <p><samp class="codeph">ParagraphCount()</samp> always returns a count of at least one due to the existence of the terminating <span class="keyword">paragraph
  delimiter</span> at the end of every text object.</p>
 <pre class="codeblock" id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-5EE64712-1E94-536E-B590-3F855087EF92"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-5EE64712-1E94-536E-B590-3F855087EF92"><!-- --></a>iMessage.Format(_L("chars=%d, words=%d, paras=%d"),
iGlobalText-&gt;DocumentLength(),
        // length up to and excluding final para mark
iGlobalText-&gt;WordCount(), // white-space delimited words
iGlobalText-&gt;ParagraphCount()); // paras including the final one</pre>
 <p>In the following example information about the word containing the character at a specified document position, and the word itself, are extracted and printed.</p>
 <p><samp class="codeph">CGlobalText::GetWordInfo()</samp> is used to extract information about a word and <samp class="codeph">CGlobalText::Read()</samp> to obtain a read-only pointer to the word. </p>
 <pre class="codeblock" id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-DAB7E1DD-8F18-5125-BE1D-324FB3CD353F"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-DAB7E1DD-8F18-5125-BE1D-324FB3CD353F"><!-- --></a>TInt pos=65; // Choose an arbitrary document position
TInt startPos, length; // results of function
iGlobalText-&gt;GetWordInfo(pos,startPos,length,EFalse,ETrue);
// Read length (the length of the word at position pos) number of 
// characters beginning at startPos (start of word at pos). 
TPtrC pointer=iGlobalText-&gt;Read(startPos,length);
// Print word and word info
iMessage.Format(_L("Word at pos %d (\"%S\") has"
        " %d characters, starts at position %d"),
            pos, &amp;pointer, length, startPos);</pre>
 <pre class="codeblock" id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-DB34A490-10EE-59C1-81DB-974C319493A0"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-DB34A490-10EE-59C1-81DB-974C319493A0"><!-- --></a>// insert huge amounts of text
...</pre>
 </div>
 <div class="section"><h2 class="sectiontitle">Using fields</h2> <p>Before any field, apart from the page number field in a<span class="keyword">header</span> or <span class="keyword">footer</span>, can be inserted into a document, a field factory must be declared. A field factory is a class which derives from the <a href="GUID-6202B0B7-663C-3172-BE13-88D77081B42C.html"><span class="apiname">MTextFieldFactory</span></a> class, and which defines a <a href="GUID-6202B0B7-663C-3172-BE13-88D77081B42C.html#GUID-6202B0B7-663C-3172-BE13-88D77081B42C__GUID-0391FC8A-9206-3118-A057-5549E49D2309"><span class="apiname">MTextFieldFactory::NewFieldL()</span></a> function. The function constructs new fields according to a<span class="keyword">UID</span> passed into the function.</p>
 <p> The steps involved before the field factory can be used to create and insert a field are as follwows</p>
 <a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-FFE9F7BC-A4A1-5B27-BA07-FE2985F9BEF1"><!-- --></a><ol id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-FFE9F7BC-A4A1-5B27-BA07-FE2985F9BEF1"><li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-7232879E-58FF-50F7-8E40-5BEC68193FC1"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-7232879E-58FF-50F7-8E40-5BEC68193FC1"><!-- --></a><p>Instantiate a field factory. </p>
 </li>
 <li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-EF54FC5C-F23D-5E84-A2E9-72239B96FF08"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-EF54FC5C-F23D-5E84-A2E9-72239B96FF08"><!-- --></a><p>Set that factory to be the text object's field factory</p>
 </li>
 <li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-5B5CF95A-5280-5E80-AAD0-FCFD0343944C"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-5B5CF95A-5280-5E80-AAD0-FCFD0343944C"><!-- --></a><p>Construct a field using <samp class="codeph">CPlainText::NewTextFieldL()</samp> </p>
 </li>
 <li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-E9F3EFAD-5307-5E6D-BA91-5653ED4537DF"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-E9F3EFAD-5307-5E6D-BA91-5653ED4537DF"><!-- --></a><p>If, for example, a date/time field is to be inserted, format it as required. By default, the date/time is formatted as dd/mm/yyyy. </p>
 </li>
 <li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-65F09753-B14B-5F7E-97F8-8D873ED8C7CE"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-65F09753-B14B-5F7E-97F8-8D873ED8C7CE"><!-- --></a><p>Insert the field at the desired document position</p>
 </li>
 <li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-851024F4-E31D-5020-92D1-22DE1685EAA0"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-851024F4-E31D-5020-92D1-22DE1685EAA0"><!-- --></a><p>Update the field. Until this is done, no field text will be visible. Also, care must be taken that the field length is not greater than 20 characters (the maximum field length), otherwise <samp class="codeph">UpdateFieldL()</samp> will panic. The first time the field is updated, the position specified must be the position at which the field was inserted. Subsequent updates may specify any position within the field.</p>
 </li>
 <li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-C451C955-CDEB-5940-9D9D-182E1F33545C"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-C451C955-CDEB-5940-9D9D-182E1F33545C"><!-- --></a><p><a href="GUID-ED1FFBC5-23C3-3C9E-B5D1-04B72B9369E6.html#GUID-ED1FFBC5-23C3-3C9E-B5D1-04B72B9369E6__GUID-DAC0984B-2AE1-3BE0-A76B-7226D162D709"><span class="apiname">CPlainText::FindFields()</span></a> may be used to get information about a field, including its start position and length.</p>
 </li>
 </ol>
 </div>
 <div class="section"><h2 class="sectiontitle">Paragraph formatting</h2> <p>The following code centre aligns the text. Alignment is a<span class="keyword">paragraph format attribute</span> and is a member of the <a href="GUID-2F795E02-0704-39AE-8EC6-06CB5D5D670F.html"><span class="apiname">CParaFormat</span></a> class. All paragraph format attributes which are not explicitly set are taken from the system-provided default settings. </p>
 <p>Use <a href="GUID-4F502FE5-44D4-3947-9D73-67EF4886059A.html#GUID-4F502FE5-44D4-3947-9D73-67EF4886059A__GUID-E5B80F41-D2A1-322D-85F7-8C016F2F9519"><span class="apiname">CGlobalText::ApplyParaFormatL()</span></a> to globally change the paragraph formatting. In this example, the position and the length arguments are redundant because the formatting is applied globally. However, they must be specified, although their values are irrelevant. </p>
 <p>To set or clear paragraph format attributes, use a<a href="GUID-C4220B5C-1037-342E-A409-B62F0429E7F2.html"><span class="apiname">TParaFormatMask</span></a> in conjunction with an object of class<samp class="codeph">CParaFormat</samp>. The attributes specified in the mask are set according to the corresponding value contained in <samp class="codeph">CParaFormat</samp>. Any attributes not specified in the mask are unaffected.</p>
 <pre class="codeblock" id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-2D7DCFFC-70AE-599E-AF13-B7D800080905"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-2D7DCFFC-70AE-599E-AF13-B7D800080905"><!-- --></a>CParaFormat* paraFormat=CParaFormat::NewLC();
TParaFormatMask paraFormatMask; 
paraFormat-&gt;iHorizontalAlignment=CParaFormat::ECenterAlign; 
        // set centered
paraFormatMask.SetAttrib(EAttAlignment); // interested in alignment
iglobalText-&gt;ApplyParaFormatL(paraFormat,paraFormatMask,0,0);
        // apply format under mask - pos and length irrelevant
CleanupStack::PopAndDestroy();  // paraFormat </pre>
 <p><strong>Note</strong> </p>
 <ul><li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-327FE937-FB69-58EF-9032-71DDBCF913E6"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-327FE937-FB69-58EF-9032-71DDBCF913E6"><!-- --></a><p>An alternative method to using <samp class="codeph">ApplyParaFormatL()</samp> for global text is to directly set the formatting of the global <span class="keyword">paragraph
format layer</span> upon which the object's paragraph formatting is based. This may be done by using either <a href="GUID-C5A6B3D4-1BDE-35B4-AC6B-DF517A4D4147.html#GUID-C5A6B3D4-1BDE-35B4-AC6B-DF517A4D4147__GUID-25234E88-E9B8-399D-8279-0B74EBF01746"><span class="apiname">CParaFormatLayer::SetL()</span></a>, to reset the formatting of the existing layer, or<a href="GUID-4F502FE5-44D4-3947-9D73-67EF4886059A.html#GUID-4F502FE5-44D4-3947-9D73-67EF4886059A__GUID-A0FE0C07-EF67-3C70-9FF7-AECAC66B2F0D"><span class="apiname">CGlobalText::SetGlobalParaFormat()</span></a> which sets a new layer. Both methods cause all attributes to be reset; no mask is specified.</p>
 </li>
 </ul>
 </div>
 <div class="section"><h2 class="sectiontitle">Character formatting</h2> <p>The following code globally sets the bold, italic and underline<span class="keyword">character format attributes</span>. These attributes are accessed through the <samp class="codeph">iFontPresentation</samp> and<samp class="codeph">iFontStyle</samp> members of the <a href="GUID-3518B92C-D1BD-36D1-B447-728A1052292F.html"><span class="apiname">TCharFormat</span></a> class. Any attributes not explicitly set are taken from the system-provided default settings. </p>
 <p>Global character formatting is applied in a similar manner to paragraph formatting, using a <a href="GUID-4FD3211A-DFF8-3487-8DFF-5C7F2EF3997D.html"><span class="apiname">TCharFormatMask</span></a> in conjunction with a<samp class="codeph">TCharFormat</samp>, then calling<samp class="codeph">CGlobalText::ApplyCharFormatL()</samp>.</p>
 <pre class="codeblock" id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-0E31A055-55A4-5806-9B9A-62AD53E78C6E"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-0E31A055-55A4-5806-9B9A-62AD53E78C6E"><!-- --></a>charFormatMask.SetAttrib(EAttFontUnderline); // set underline
charFormatMask.SetAttrib(EAttFontPosture); // and posture (for italic)
charFormatMask.SetAttrib(EAttFontStrokeWeight); // and weight (for 
    // bold)
charFormat.iFontPresentation.iUnderline=EUnderlineOn;
charFormat.iFontSpec.iFontStyle.SetPosture(EPostureItalic);
charFormat.iFontSpec.iFontStyle.SetStrokeWeight(EStrokeWeightBold);
// apply format under mask
iGlobalText-&gt;ApplyCharFormatL(charFormat,charFormatMask,0,0);</pre>
 <p><strong>Note</strong> </p>
 <ul><li id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-DF042F94-88C1-5F1C-B21A-17DF58EEBCD4"><a name="GUID-74E69324-7BCC-591F-B2A9-2932A3790966__GUID-DF042F94-88C1-5F1C-B21A-17DF58EEBCD4"><!-- --></a><p>No more than one attribute can be specified in the argument to<a href="GUID-4FD3211A-DFF8-3487-8DFF-5C7F2EF3997D.html#GUID-4FD3211A-DFF8-3487-8DFF-5C7F2EF3997D__GUID-B110FDDE-1E2C-3969-8E9E-A8FC8633932E"><span class="apiname">TCharFormatMask::SetAttrib()</span></a>. To set more than one attribute in a single call to <samp class="codeph">ApplyCharFormatL()</samp>, either use several calls to<samp class="codeph">SetAttrib()</samp>, as above, or use<a href="GUID-4FD3211A-DFF8-3487-8DFF-5C7F2EF3997D.html#GUID-4FD3211A-DFF8-3487-8DFF-5C7F2EF3997D__GUID-CAFA619F-81A3-337B-9EE0-E27152F2BDBE"><span class="apiname">TCharFormatMask::SetAll()</span></a> to set all attributes in the mask.</p>
 </li>
 </ul>
 </div>
 </div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-2DDEF473-B804-51DF-874F-ADF46CB03ABA.html">Formatting</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>