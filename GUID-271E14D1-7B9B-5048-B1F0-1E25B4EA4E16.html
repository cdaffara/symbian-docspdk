<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="SqlExample: Creating and Querying an SQL Database"/>
<meta name="abstract" content="This example application demonstrates the use of the SQL API for creating and querying a database."/>
<meta name="description" content="This example application demonstrates the use of the SQL API for creating and querying a database."/>
<meta name="DC.Relation" scheme="URI" content="GUID-6D28A0C6-7D1A-5C71-B61C-EE3F9E29DC5D.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F8824165-4B33-50D1-9706-BD2438B5A2EE.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6D28A0C6-7D1A-5C71-B61C-EE3F9E29DC5D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-582CAA4A-1240-5138-983D-D9C6EEAF5566.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>SqlExample: Creating and Querying an SQL Database</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2859821 id2860178 id2534747 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html" title="Provides services to enable and support persistence.">Persistent Data Services Guide</a> &gt; <a href="GUID-F8824165-4B33-50D1-9706-BD2438B5A2EE.html" title="The persistent storage collection.">Persistent Storage</a> &gt; <a href="GUID-6D28A0C6-7D1A-5C71-B61C-EE3F9E29DC5D.html" title="This describes example code for the Persistent Storage collection.">Persistent Storage Example Code</a> &gt; </div>
<h1 class="topictitle1">SqlExample: Creating and Querying an SQL Database</h1>
<div><p>This example application demonstrates the use of the SQL
API for creating and querying a database.</p>

<div class="section" id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-8941D325-DE9F-571B-9EAB-C8F675155EEE"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-8941D325-DE9F-571B-9EAB-C8F675155EEE"><!-- --></a><h2 class="sectiontitle">Description</h2> <p><strong>Creating the database</strong> </p>
 <p>You can create two types
of databases; secure and non-secure. </p>
 <ul>
<li id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-3C94A459-7CD3-5B6C-94D9-235F714FD53E"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-3C94A459-7CD3-5B6C-94D9-235F714FD53E"><!-- --></a><p> <strong>Non-secure
database:</strong> A database that can be accessed and updated by any program
since no security policy is provided. </p>
 </li>

<li id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-1D128D45-7D64-5BB3-A350-FB13CBD4CEE6"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-1D128D45-7D64-5BB3-A350-FB13CBD4CEE6"><!-- --></a><p> <strong>Secure database:</strong> A database with static policy defined and therefore can be accessed
by authorized clients with specific capabilities. </p>
 </li>

</ul>
 <p><strong>Creating a non-secure database</strong> </p>
 <p>The application
first creates an <a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html"><span class="apiname">RSqlDatabase</span></a> object and creates
a non-secure SQL database using the <a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-0F4435A7-C28C-342F-AC90-73FABDE6F5DD"><span class="apiname">RSqlDatabase::Create()</span></a> function. The database is then closed. Finally the database is deleted
using the <a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-27BE67CC-037F-3533-A3B4-E3CC4879EA1C"><span class="apiname">RSqlDatabase::Delete()</span></a> function. </p>
 <p>The format for naming the non-secure database would be the following: </p>
 <pre class="codeblock" id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-B8E067E8-99B1-56EF-9646-589D38156F90"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-B8E067E8-99B1-56EF-9646-589D38156F90"><!-- --></a>X:&lt;path&gt;&lt;database-name&gt;.db</pre>
 <p>where, <samp class="codeph">X</samp> is the writable drive on the device
or the emulator. </p>
 <p>If path is not specified, it returns the <samp class="codeph">KErrArgument</samp> error, and if the specified path is not writable
by SQL server, the application returns <samp class="codeph">KErrPermission</samp> error. In this example, the application will create the database
in its own data area, pass a handle to the database to enable the
data manipulation by the SQL server. </p>
 <div class="p"><div class="note"><span class="notetitle">Note:</span>  You cannot create
two databases with the same name in a location </div>
</div>
<p><strong>Related
APIs</strong></p>
<ul>
<li><p><a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html"><span class="apiname">RSqlDatabase</span></a> - A handle to a SQL database.</p>
</li>

<li><p><a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-0F4435A7-C28C-342F-AC90-73FABDE6F5DD"><span class="apiname">RSqlDatabase::Create()</span></a></p>
</li>

<li><p><a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-27BE67CC-037F-3533-A3B4-E3CC4879EA1C"><span class="apiname">RSqlDatabase::Delete()</span></a></p>
</li>

</ul>
 <p><strong>Creating a secure database</strong> </p>
 <p>To create a secure
database, you need to provide the following: </p>
 <ul>
<li id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-AF260BF8-D103-5A08-8BF4-3B8F9F658DBF"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-AF260BF8-D103-5A08-8BF4-3B8F9F658DBF"><!-- --></a><p>UID of the application </p>
 </li>

<li id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-BCA90A2B-241A-5636-9A2C-080DF6EAAF61"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-BCA90A2B-241A-5636-9A2C-080DF6EAAF61"><!-- --></a><p>security policy </p>
 </li>

</ul>
 <p><strong>UID </strong> </p>
 <p>You need to use the UID of the example
application to name the database. </p>
 <p>The format for naming the
database would be the following: </p>
 <pre class="codeblock" id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-768E0B87-B08B-5484-AED0-072D3840CC5B"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-768E0B87-B08B-5484-AED0-072D3840CC5B"><!-- --></a>X:&lt;UID&gt;&lt;name&gt;.db</pre>
 <p>where, </p>
 <ul>
<li id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-328D11AC-814B-532C-8FEA-A0BB467A0CC2"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-328D11AC-814B-532C-8FEA-A0BB467A0CC2"><!-- --></a><p> <samp class="codeph">X</samp> is the drive in which the database is created </p>
 </li>

<li id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-12C3F6BD-2E50-5FFE-8B1C-2B73A40C88E6"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-12C3F6BD-2E50-5FFE-8B1C-2B73A40C88E6"><!-- --></a><p> <samp class="codeph">UID</samp> is the UID of the application that creates the database </p>
 </li>

<li id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-3FA9C3C5-903B-58CD-B509-335686E72BD4"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-3FA9C3C5-903B-58CD-B509-335686E72BD4"><!-- --></a><p> <samp class="codeph">name</samp> is any valid database name. You should not specify the complete
path of the database. </p>
 </li>

</ul>
 <p>To successfully create and use a secure database, you must
have appropriate capabilities such as <samp class="codeph">READUSERDATA</samp>, <samp class="codeph">WRITEUSERDATA</samp>. The example application uses <samp class="codeph">NETWORKCONTROL</samp> capablity along with above specified capabilities. </p>
 <div class="p"> <div class="note"><span class="notetitle">Note:</span> If the given UID does not match with that of client application
(in this case, the SQL example application) the attempts to create
the database fails.</div>
 </div>
 <p><strong>Security policy </strong> </p>
 <p>To create a secure database, you need to initially set up a container
that has a set of security policies (<a href="GUID-81A285F6-3F87-3E77-9426-61BB16BC7109.html"><span class="apiname">TSecurityPolicy</span></a>), and pass it to the <a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-0F4435A7-C28C-342F-AC90-73FABDE6F5DD"><span class="apiname">RSqlDatabase::Create()</span></a> function.
The <a href="GUID-81A285F6-3F87-3E77-9426-61BB16BC7109.html"><span class="apiname">TSecurityPolicy</span></a> object defines what capabilities
the calling application must have in order to perform a specific database
operation. To cross check if the database security policy matches
with the policy used when the database was created, the <a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-43E42D5C-62B8-34A7-AF2E-D62432DDB9DE"><span class="apiname">RSqlDatabase::GetSecurityPolicy()</span></a> function is called. </p>
<p><strong>Related APIs</strong></p>
<ul>
<li><p><a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-0F4435A7-C28C-342F-AC90-73FABDE6F5DD"><span class="apiname">RSqlDatabase::Create()</span></a></p>
</li>

<li><p><a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-43E42D5C-62B8-34A7-AF2E-D62432DDB9DE"><span class="apiname">RSqlDatabase::GetSecurityPolicy()</span></a></p>
</li>

<li><p><a href="GUID-81A285F6-3F87-3E77-9426-61BB16BC7109.html"><span class="apiname">TSecurityPolicy</span></a> - Class representing a generic
security policy</p>
</li>

</ul>
 <p><strong>Copying one database to another</strong> </p>
 <p>The example
copies one database to another using the <a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-D8B48367-D20B-337E-B41A-1E02119D91D6"><span class="apiname">RSqlDatabase::Copy()</span></a> function. If the database was created using a specific UID, then
only the application with same UID, can perform the copy operation. </p>
 <div class="p"><div class="note"><span class="notetitle">Note:</span>  In this example, copy function is essentially a <em>file
copy</em> as the client does a copy within its data cage. The copy
operation should ideally fail if the destination database already
exists. An application with appropriate permissions can use the file
system to copy the database.</div>
 </div>
<p><strong>Related APIs</strong></p>
<ul>
<li><p><a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-D8B48367-D20B-337E-B41A-1E02119D91D6"><span class="apiname">RSqlDatabase::Copy()</span></a></p>
</li>

</ul>
 <p><strong>Attaching the database</strong> </p>
 <p>The example application
then demonstrates attaching two databases. In this example, a non-secure
database is attached to a secure database. The attached database is
later read from and written to, and the secure database is also written
to before the two databases are deleted using the <a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-27BE67CC-037F-3533-A3B4-E3CC4879EA1C"><span class="apiname">RSqlDatabase::Delete()</span></a> function. </p>
<p><strong>Related APIs</strong></p>
<ul>
<li><p><a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html#GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF__GUID-27BE67CC-037F-3533-A3B4-E3CC4879EA1C"><span class="apiname">RSqlDatabase::Delete()</span></a></p>
</li>

</ul>
 <p><strong>Querying the database</strong> </p>
 <p>The example then demonstrates
how to prepare and execute a query. </p>
 <p><strong>Simple query</strong> </p>
 <p>A simple query statement is prepared and executed using the <samp class="codeph">CSqlExample::DataTypesQueryL()</samp> function. </p>
 <p><strong>Query
with a large parameter and writing using streaming</strong> </p>
 <p>A query
with a large parameter is prepared, executed and the results are written
to <a href="GUID-6313887C-8DE0-3702-BF4B-0622BAB2EE8E.html"><span class="apiname">RSqlParamWriteStream</span></a> stream. A table containing
fields of data types; integer, 64-bit integer, float, text and binary
is created. It inserts two records into the table and implements the <a href="GUID-E7B775B0-A609-313A-8BFD-375C81D782A5.html"><span class="apiname">TSqlScalarFullSelectQuery</span></a> function for 64 bit integer (F2)
and text (F4) fields and checks the returned value. The query for
the data type which the column does not hold is executed, only to
show that this is possible. For example, if a column holding the integer
value 1000 is queried as real, it would return <samp class="codeph">1000.00</samp>. </p>
<p><strong>Related APIs</strong></p>
<ul>
<li><p><a href="GUID-6313887C-8DE0-3702-BF4B-0622BAB2EE8E.html"><span class="apiname">RSqlParamWriteStream</span></a> - The write stream
interface.</p>
</li>

<li><p><a href="GUID-E7B775B0-A609-313A-8BFD-375C81D782A5.html"><span class="apiname">TSqlScalarFullSelectQuery</span></a> - TSqlScalarFullSelectQuery
interface is used for executing <samp class="codeph">SELECT</samp> sql queries,
which return a single row consisting of a single column value.</p>
</li>

</ul>
 <p><strong>Query returning data being read using streaming</strong> </p>
 <p>The example lastly demonstrates how to prepare and execute a
query which returns the data, and read that data from the data stream
(<a href="GUID-35BF7B4A-C4F7-3215-B5DF-6D0682247976.html"><span class="apiname">RSqlColumnReadStream</span></a>). The read stream interface
class is used for reading a large amount of binary or text data from
the column. </p>
<p><strong>Related APIs</strong></p>
<ul>
<li><p><a href="GUID-35BF7B4A-C4F7-3215-B5DF-6D0682247976.html"><span class="apiname">RSqlColumnReadStream</span></a> - The read stream interface.</p>
</li>

</ul>
 </div>

<div class="section" id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-EA613161-C0ED-42AD-96D5-DBC9A13643E4"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-EA613161-C0ED-42AD-96D5-DBC9A13643E4"><!-- --></a><h2 class="sectiontitle">Download</h2> <p>Click on the following link to download the example: <a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-ef83061e-0e34-482b-bfcf-267d8972e786.zip" target="_blank">SqlExample.zip</a></p>
<p>Click: <a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-ef83061e-0e34-482b-bfcf-267d8972e786.html">browse</a> to view the example code.</p>
 </div>

<div class="section" id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-E5E5C7EA-7E69-42A9-A51C-9B8C0B596605"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-E5E5C7EA-7E69-42A9-A51C-9B8C0B596605"><!-- --></a><h2 class="sectiontitle">Class
summary</h2><ul>
<li><p><a href="GUID-4688F6B7-E1B0-37CF-BAA2-C6BD103D4FDF.html"><span class="apiname">RSqlDatabase</span></a></p>
</li>

<li><p><a href="GUID-0176BF07-DF94-3259-8F90-DE030E35CE9A.html"><span class="apiname">RSqlStatement</span></a></p>
</li>

<li><p><a href="GUID-35BF7B4A-C4F7-3215-B5DF-6D0682247976.html"><span class="apiname">RSqlColumnReadStream</span></a></p>
</li>

<li><p><a href="GUID-6313887C-8DE0-3702-BF4B-0622BAB2EE8E.html"><span class="apiname">RSqlParamWriteStream</span></a></p>
</li>

<li><p><a href="GUID-56C52D43-C4A9-3B31-B154-CA1E77693F57.html"><span class="apiname">RSqlSecurityPolicy</span></a></p>
</li>

<li><p><a href="GUID-E7B775B0-A609-313A-8BFD-375C81D782A5.html"><span class="apiname">TSqlScalarFullSelectQuery</span></a></p>
</li>

</ul>
</div>

<div class="section" id="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-AC702731-D7EE-563C-8AE9-2CFAB58AD97C"><a name="GUID-271E14D1-7B9B-5048-B1F0-1E25B4EA4E16__GUID-AC702731-D7EE-563C-8AE9-2CFAB58AD97C"><!-- --></a><h2 class="sectiontitle">Build</h2> <p>The Symbian build process describes how to build an application. </p>
 <p>The Sql example builds an executable called <span class="filepath">sqlexample.exe</span> in the standard location (<span class="filepath">\epoc32\release\winscw\</span> <em>&lt;build_variant&gt;</em> for CodeWarrior). After launching the
executable depending on the emulator, you may need to task away from
the app launcher or shell screen to view the console. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-6D28A0C6-7D1A-5C71-B61C-EE3F9E29DC5D.html" title="This describes example code for the Persistent Storage collection.">Persistent Storage Example Code</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-582CAA4A-1240-5138-983D-D9C6EEAF5566.html" title="These are the SQL tutorials.">SQL
Tutorials</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>