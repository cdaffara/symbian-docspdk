<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Display Control and Mapping in the Window Server Client"/>
<meta name="abstract" content="ScreenPlay provides support for externally connected displays, such as TV-out. Previous versions of Symbian and the non-ScreenPlay variant consider the size of each display to be fixed, assuming it to be built into the phone. However, for High-Definition Multimedia Interface (HDMI) and composite video connectors, there is a range of resolutions that can change dynamically. ScreenPlay provides an optional feature that supports switching between resolutions at runtime and notifies Window Server clients when there are changes to the resolution and connectedness."/>
<meta name="description" content="ScreenPlay provides support for externally connected displays, such as TV-out. Previous versions of Symbian and the non-ScreenPlay variant consider the size of each display to be fixed, assuming it to be built into the phone. However, for High-Definition Multimedia Interface (HDMI) and composite video connectors, there is a range of resolutions that can change dynamically. ScreenPlay provides an optional feature that supports switching between resolutions at runtime and notifies Window Server clients when there are changes to the resolution and connectedness."/>
<meta name="DC.Relation" scheme="URI" content="GUID-1F9A47CE-7F4C-52BD-8823-25D5D1BEF42F.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-57A777A3-5D67-5CBB-B224-B7AD422A451B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0C4B86B5-530A-5839-86C1-46E7ABE281E0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-DC5E8C7D-D697-53E8-87F4-344301430E61.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1F9A47CE-7F4C-52BD-8823-25D5D1BEF42F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1F9A47CE-7F4C-52BD-8823-25D5D1BEF42F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0EBE5733-A267-5F4A-85AD-87C3ECF80731.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1D529BDC-6665-58E2-AB3F-7023D8A84F69.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Display Control and Mapping in the Window Server Client</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2384330 id2384499 id2384574 id2384588 id2384610 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html">Graphics Guide</a> &gt; <a href="GUID-57A777A3-5D67-5CBB-B224-B7AD422A451B.html" title="The Windowing collection contains two components—the Window Server, which manages the use of the screen by applications, and the Window Server Plugins component.">Windowing Collection</a> &gt; <a href="GUID-0C4B86B5-530A-5839-86C1-46E7ABE281E0.html" title="The Window Server component manages the use of the screen by applications and handles key and pointer events.">Window Server Component</a> &gt; <a href="GUID-DC5E8C7D-D697-53E8-87F4-344301430E61.html" title="The Window Server client-side library provides client applications with access to the screen and input devices.">Window Server Client-Side Library</a> &gt; <a href="GUID-1F9A47CE-7F4C-52BD-8823-25D5D1BEF42F.html" title="This section introduces some important concepts that relate to the Window Server client-side library.">Window Server Client-Side Library Concepts</a> &gt; </div>
<h1 class="topictitle1">Display
Control and Mapping in the Window Server Client</h1>
<div><p>ScreenPlay provides support for externally connected displays,
such as TV-out. Previous versions of Symbian and the non-ScreenPlay variant
consider the size of each display to be fixed, assuming it to be built into
the phone. However, for High-Definition Multimedia Interface (HDMI) and composite
video connectors, there is a range of resolutions that can change dynamically.
ScreenPlay provides an optional feature that supports switching between resolutions
at runtime and notifies Window Server clients when there are changes to the
resolution and connectedness. </p>

<p>This topic builds on the introduction in <a href="GUID-0EBE5733-A267-5F4A-85AD-87C3ECF80731.html" title="ScreenPlay provides support for externally connected displays, such as TV-out. Previous versions of Symbian and the non-ScreenPlay variant consider the size of all displays to be fixed, assuming them to be built into the phone. However, for High-Definition Multimedia Interface (HDMI) and composite video connectors, there is a range of resolutions that can change dynamically. ScreenPlay provides an optional feature that supports switching between resolutions at runtime.">Dynamic
Resolution Switching</a>. </p>

<p>The <a href="GUID-30479BE3-296E-3B4D-914D-B080ABD733E4.html"><span class="apiname">CWsScreenDevice</span></a> Window Server client-side API has
a <samp class="codeph">GetInterface()</samp> function, which you can use to return pointers
to the <samp class="codeph">MDisplayControl</samp> and <samp class="codeph">MDisplayMapping</samp> interfaces
or null if the interface is not supported. For example: </p>

<pre class="codeblock" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-1F87BCBD-F4FB-5C20-8B94-01088F79CD73"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-1F87BCBD-F4FB-5C20-8B94-01088F79CD73"><!-- --></a>// Establish connection and get display control interface.
class CWindowClient : public CBase
    {
    ...
    RWsSession iSession;
    CWsScreenDevice* iScreenDevice;
    MDisplayControl* iDisplayControl;
    MDisplayMapping* iDisplayMapping;
    TWsDisplayChangedEvent iLastEvent;
    }
    
void CWindowClient::ConstructL(TInt aDisplayNumber)
    {
    User::LeaveIfError(iSession.Connect());
    iScreenDevice = new(ELeave) CWsScreenDevice(iSession);
    User::LeaveIfError(iScreenDevice-&gt;Construct(aDisplayNumber));
    iDisplayControl = iScreenDevice-&gt;GetInterface(EDisplayControl);
    User::LeaveIfNull(iDisplayControl);
    iDisplayMapping = iScreenDevice-&gt;GetInterface(EDisplayMapping);
    User::LeaveIfNull(iDisplayMapping);
    }</pre>

<p>In addition, <a href="GUID-30479BE3-296E-3B4D-914D-B080ABD733E4.html"><span class="apiname">CWsScreenDevice</span></a> provides the <samp class="codeph">IsCurrentModeDynamic()</samp> and <samp class="codeph">IsModeDynamic()</samp> functions
for querying whether the current screen mode and a given screen mode are dynamic.
If a screen mode is dynamic, the application extent always fills the full
UI space and the area returned by <a href="GUID-30479BE3-296E-3B4D-914D-B080ABD733E4.html#GUID-30479BE3-296E-3B4D-914D-B080ABD733E4__GUID-8E1B5729-FD1C-3D4A-AC73-C6364E7D5BBF"><span class="apiname">CWsScreenDevice::SizeInPixels()</span></a> always
matches the actual resolution that is in use. However, the <samp class="codeph">MDisplayMapping</samp> interface
also provides features that enable you to draw outside the application UI
extent. </p>

<div class="section" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-00B91456-0C70-468E-8974-17DE3836849C"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-00B91456-0C70-468E-8974-17DE3836849C"><!-- --></a><h2 class="sectiontitle">MDisplayControl</h2>  <p>The <a href="GUID-0C384D35-77DD-318E-AF3E-C9ED5ADD9D11.html"><span class="apiname">MDisplayControl</span></a> interface
provides Window Server clients with functions for setting and getting the
current display configuration, getting a list of available resolutions and
enabling display change event notifications (<samp class="codeph">EEventDisplayChanged</samp>).
The following diagram shows the class hierarchy. </p>
 <div class="fignone" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-F9D95387-151F-5725-8BDD-C44A3D333A97"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-F9D95387-151F-5725-8BDD-C44A3D333A97"><!-- --></a><span class="figcap">Figure 1.  Display control class diagram            </span>

<img src="GUID-68E3609C-3429-5B1C-B8D9-C0EBBACEF357_d0e239348_href.png"/>
</div>
 <p>For a diagram of the <a href="GUID-7ED11E23-6E13-36D4-BB10-8AE9E745C560.html"><span class="apiname">TDisplayConfiguration</span></a> class
hierarchy, see the <a href="GUID-19C3DA8C-0128-5172-B859-4FD6F6197451.html" title="The Common Graphics Headers component contains classes that are used by a number of ScreenPlay components and their clients. The classes are divided between those that relate to surfaces and those that relate to display configuration.">Common
Graphics Headers Component Overview</a>. </p>
 <p>Once you have obtained
the <a href="GUID-0C384D35-77DD-318E-AF3E-C9ED5ADD9D11.html"><span class="apiname">MDisplayControl</span></a> interface, you can call <samp class="codeph">GetResolutions()</samp> on
it. For example: </p>
 <pre class="codeblock" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-C82D0166-0E29-5F90-8087-800EDDE2D895"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-C82D0166-0E29-5F90-8087-800EDDE2D895"><!-- --></a>// Get available resolutions
RArray&lt;MDisplayControl::TResolution&gt; resolutions;
User::LeaveIfError(iDisplayControl-&gt;GetResolutions(resolutions));
          
// Use resolution list.
       
</pre>
 <p>You can use the <samp class="codeph">EnableDisplayChangedEvents()</samp> function
to register for notifications of the <samp class="codeph">EEventDisplayChanged</samp> event.
This is generated when the display device is attached or detached or there
is a change in the current resolution, the resolution list or the current
configuration. For example, this can be generated by a render stage or the
composition engine in response to a hardware event (such as an external display
being connected or disconnected). The event is sometimes, but not always,
triggered by a change in the screen mode. </p>
 <p>There are therefore two
aspects to the event in that it can be triggered by a display change or a
configuration change. Typically you check the event against the previous one
to see what has changed. </p>
 <p>The following table provides a summary of
how this event compares to <samp class="codeph">EEventScreenDeviceChanged</samp>. </p>
 
<div class="tablenoborder"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-50D8232A-E394-590F-A762-79567E4424C3"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-50D8232A-E394-590F-A762-79567E4424C3" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" id="d1637461e148">Action</th>

<th class="cellrowborder" valign="top" id="d1637461e151"><samp class="codeph">EEventScreenDeviceChanged</samp> </th>

<th class="cellrowborder" valign="top" id="d1637461e156"><samp class="codeph">EEventDisplayChanged</samp> </th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" headers="d1637461e148 "><p>Screen mode change </p>
 </td>

<td class="cellrowborder" valign="top" headers="d1637461e151 "><p>Always triggers this event </p>
 </td>

<td class="cellrowborder" valign="top" headers="d1637461e156 "><p>Triggers this event only if it causes a change in the configuration. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" headers="d1637461e148 "><p>Display configuration change </p>
 </td>

<td class="cellrowborder" valign="top" headers="d1637461e151 "><p>Generally does not trigger this event </p>
 </td>

<td class="cellrowborder" valign="top" headers="d1637461e156 "><p>Generally triggers this event </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p>The following example first registers for notification of <samp class="codeph">EEventDisplayChanged</samp> events
and then changes the screen mode. The second part illustrates a simplified
handler for the events. It demonstrates checking the event against the previous
one to see whether the resolution or configuration has changed. </p>
 <pre class="codeblock" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-E78D2CA8-4C1E-5E19-92EC-7E87B010E5BE"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-E78D2CA8-4C1E-5E19-92EC-7E87B010E5BE"><!-- --></a>// Establish connection and get display control interface.

iDisplayControl-&gt;EnableDisplayChangeEvents(ETrue);

iScreenDevice-&gt;SetScreenMode(2);    // Number depends on WSINI.INI config.
iScreenDevice-&gt;SetAppScreenMode(2); // Ensure application windows are
                                    // shown in the new mode.
...
    
// Simplified event handler.
TWsEvent event;
iSession.GetEvent(event);
    
switch (event.Type())
    {
    case EEventScreenDeviceChanged:
        {
        TSize screenSize = iScreenDevice-&gt;SizeInPixels();
        // Re-layout windows for new application screen dimensions
        }
        break;
    case Redraw:
        {
        // Draw content of window
        }
        break;
    case EEventDisplayChanged:
        {
        TWsDisplayChangedEvent* newEvent;
        newEvent = event.DisplayChanged();

        if (newEvent-&gt;iResolutionListChangeId !=
            iLastEvent.iResolutionListChangeId)
            {
            // ...
            }
        
        if (newEvent-&gt;iConfigurationChangeId !=
            iLastEvent.iConfigurationChangeId)
            {
            TDisplayConfiguration config;
            User::LeaveIfError(
                iDisplayControl-&gt;GetConfiguration(config)));
            // Handle updated configuration
            // May be entirely handled by screen device changed event
            }
        iLastEvent = *newEvent;
        }
        break;
    }</pre>
 <p>Here is an example of setting a new display resolution: </p>
 <pre class="codeblock" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-B9C0254D-3990-5B41-9F63-1A81D30A3FB6"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-B9C0254D-3990-5B41-9F63-1A81D30A3FB6"><!-- --></a>TDisplayConfiguration config;
config.SetResolution(TSize(1280, 720));
config.SetRotation(MDisplayControl::ERotation180);
          
User::LeaveIfError(iDisplayControl-&gt;SetConfiguration(config));
</pre>
 </div>

<div class="section" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-EF610977-6881-4542-AEFF-C562A7022B21"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-EF610977-6881-4542-AEFF-C562A7022B21"><!-- --></a><h2 class="sectiontitle">MDisplayMapping</h2>  <p>The <a href="GUID-BA6FEFAE-8891-3286-A38F-2EA522D7A27E.html"><span class="apiname">MDisplayMapping</span></a> interface
enables Window Server clients to map between coordinate spaces, allowing for
translation and scaling of coordinates. For example, suppose an application
is to draw a virtual keyboard outside of the application's extent. This requires
knowing the extent of both the application and the full UI area. The application
can use the <a href="GUID-BA6FEFAE-8891-3286-A38F-2EA522D7A27E.html"><span class="apiname">MDisplayMapping</span></a> interface to get this information,
so that the virtual keyboard can be drawn within the full UI area but outside
of the application's extent. </p>
 <div class="fignone" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-55BD49C6-9A51-53A7-A587-29A151FACF6B"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-55BD49C6-9A51-53A7-A587-29A151FACF6B"><!-- --></a><span class="figcap">Figure 2.  Display mapping class diagram            </span>

<img src="GUID-7293765E-2B1E-5F0D-B6A8-0E48729DC365_d0e239496_href.png"/>
</div>
 <p> </p>
 <p>The <a href="GUID-BA6FEFAE-8891-3286-A38F-2EA522D7A27E.html"><span class="apiname">MDisplayMapping</span></a> interface is very
flexible. UIDs are used to signify the application UI coordinate space, the
full UI space, the composition/display coordinate space (which may be a different
scale to the UI coordinate space) and the Direct Screen Access (DSA) space
(which may match the full UI space, or be offset relative to the application
UI space). </p>
 <p>The <samp class="codeph">MapCoordinates()</samp> function
takes a rectangle, a source space and a target space and returns the correspondingly
mapped rectangle in the target space. To map a point, use a rectangle with
a width and height of one pixel, because the scaling between UI space and
composition/display space may enlarge (or sometimes reduce) the rectangle’s
size. </p>
 <p>For example, consider the following diagram, in which the outer
rectangle represents the display area and the inner one represents the application
space (screen mode). </p>
 <div class="fignone" id="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-6935A7BE-C651-5582-8E2A-11A18CDD531F"><a name="GUID-B1CB6374-2C2B-5D6C-9A7C-6E49D8F235B8__GUID-6935A7BE-C651-5582-8E2A-11A18CDD531F"><!-- --></a><span class="figcap">Figure 3. Display area and application extent            </span>

<img src="GUID-09142C26-0AFA-510E-836D-010EE07A1549_d0e239525_href.png"/>
</div>
 <p>The display resolution is 1280 x 720, the application size is 176
x 208 and a virtual resolution of 426 x 240 has been introduced, which gives
a scaling factor of three in each direction. All pixels are approximately
square, for simplicity. The application area has been centered in the display,
giving an <em>X</em> offset of (426-176)/2 and a <em>Y</em> offset of (240-208)/2,
or (125, 16). </p>
 <p>To put a window on screen to fill the display, create
a rectangle positioned at (0,0) with a size of the current resolution (426
x 240). Then pass this in with a source space of the full UI and target space
of the application. This results in a rectangle of the same size but at offset
(125,16). </p>
 <p>In addition, to use an external surface at the real resolution,
pass this rectangle in with a source space of the application UI and a target
space of the composition/display. This results in a rectangle with size of
1280 x 720, which you can then use when creating the surface. Because the
UI surface and external surface are scaled independently, the UI memory requirements
can remain low, even with high resolution video, viewfinder and games. For
an example code snippet, see <a href="GUID-495EA1C8-E95F-54AE-B4D1-0F463003C2D7.html" title="This topic provides an introduction to displaying an external surface on a window. The surface is then known as a background surface. This feature is available in ScreenPlay only.">External
Surfaces Overview</a>. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-1F9A47CE-7F4C-52BD-8823-25D5D1BEF42F.html" title="This section introduces some important concepts that relate to the Window Server client-side library.">Window Server Client-Side Library Concepts</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-1F9A47CE-7F4C-52BD-8823-25D5D1BEF42F.html" title="This section introduces some important concepts that relate to the Window Server client-side library.">Window Server
Client-Side Library                 Concepts</a></div>
<div><a href="GUID-0EBE5733-A267-5F4A-85AD-87C3ECF80731.html" title="ScreenPlay provides support for externally connected displays, such as TV-out. Previous versions of Symbian and the non-ScreenPlay variant consider the size of all displays to be fixed, assuming them to be built into the phone. However, for High-Definition Multimedia Interface (HDMI) and composite video connectors, there is a range of resolutions that can change dynamically. ScreenPlay provides an optional feature that supports switching between resolutions at runtime.">Dynamic Resolution
                Switching</a></div>
</div>
<div class="relinfo relref"><strong>Related reference</strong><br/>
<div><a href="GUID-1D529BDC-6665-58E2-AB3F-7023D8A84F69.html" title="This topic provides a reference to the wsini.ini file parameters. Some of the parameters are general, some are screen-specific and some are specific to individual plug-ins.">The wsini.ini
File                 Reference</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>