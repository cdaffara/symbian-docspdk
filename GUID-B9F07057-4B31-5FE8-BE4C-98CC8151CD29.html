<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="Single Phase Constructor Tutorial"/>
<meta name="abstract" content="Single phase construction is enabled by defining the CONSTRUCTORS_MAY_LEAVE() macro in a public section of a class definition if the single phase construction is part of the public interface of the class."/>
<meta name="description" content="Single phase construction is enabled by defining the CONSTRUCTORS_MAY_LEAVE() macro in a public section of a class definition if the single phase construction is part of the public interface of the class."/>
<meta name="DC.Relation" scheme="URI" content="GUID-D33EB877-CCCB-527B-8AFC-4A8385C55E78.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-324107D1-6E0B-56DD-BDC0-7296F688A9CF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-28AD51DC-C101-5E6E-9EC3-C2B61400D8CD.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D60B55FA-D8C1-559A-9D99-48845BE32A6C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D33EB877-CCCB-527B-8AFC-4A8385C55E78.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B007634D-4D55-528A-8B85-6120C633AC8B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-96AB1D5A-932E-55BE-A025-F01608546B99.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Single Phase Constructor Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29"><a name="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2381103 id2383459 id2384051 id2384059 id2384120 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html">Generic OS Services Guide</a> &gt; <a href="GUID-324107D1-6E0B-56DD-BDC0-7296F688A9CF.html">Low Level Libraries and Frameworks</a> &gt; <a href="GUID-28AD51DC-C101-5E6E-9EC3-C2B61400D8CD.html">Generic Usability Library</a> &gt; <a href="GUID-D60B55FA-D8C1-559A-9D99-48845BE32A6C.html" title="The EUser High Level (EUserHL) library is a general purpose user library that provides a usability layer to hide away some of the complexities of the Symbian platform. This section lists the concepts, the overview and the tutorials that helps the Symbian Developers understand the importance of the EUserHL library.">EUser High Level Library</a> &gt; <a href="GUID-D33EB877-CCCB-527B-8AFC-4A8385C55E78.html" title="The EUser High Level Library tutorials are meant to discuss the usage of the LString and resource management class implementation.">EUser High Level Library Tutorials</a> &gt; </div>
<h1 class="topictitle1">Single
Phase Constructor Tutorial</h1>
<div><p>Single phase construction is enabled by defining the <samp class="codeph">CONSTRUCTORS_MAY_LEAVE()</samp> macro
in a public section of a class definition if the single phase construction
is part of the public interface of the class. </p>

<div class="p" id="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-0FCC96BD-B7C4-4604-96C1-D6E5D574AB53"><a name="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-0FCC96BD-B7C4-4604-96C1-D6E5D574AB53"><!-- --></a><p><strong>Required background</strong></p>
<p>Before
beginning you must know the following: </p>
 <ul>
<li id="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-DC57A39F-122C-545C-A2A1-D26F71209C10"><a name="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-DC57A39F-122C-545C-A2A1-D26F71209C10"><!-- --></a><p> <strong>RAII:</strong> The Resource
Acquisition Is Initialization (RAII) idiom is the basis of the implementation
of the smart pointer class templates. </p>
 </li>

<li id="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-C0228985-A32D-5652-8CCC-4BF401998FCC"><a name="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-C0228985-A32D-5652-8CCC-4BF401998FCC"><!-- --></a><p> <a href="GUID-764C2888-7EA7-3F58-B519-878A82E879CA.html"><span class="apiname">CONSTRUCTORS_MAY_LEAVE()</span></a>:
This macro is used for enabling single phase construction, particularly for
CBase-derived classes. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-D82AD7F2-633E-4A5B-9B82-4026A8F91B41"><a name="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-D82AD7F2-633E-4A5B-9B82-4026A8F91B41"><!-- --></a><p>Single phase constructor
provides a means to use the RAII concepts for Symbian Developers who are familiar
with C++ standards. It is provided as a tool and needs to be used after careful
consideration. </p>
 </div>

<a name="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-DF51DCE9-ACA3-4376-B4B3-4A31728670D2"><!-- --></a><ol id="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-DF51DCE9-ACA3-4376-B4B3-4A31728670D2"><li class="stepexpand" id="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-FA70E487-145A-4502-BB58-B09A42F69183"><a name="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-FA70E487-145A-4502-BB58-B09A42F69183"><!-- --></a><span>Enabling single
phase constructor</span>
 <p>Single phase construction is enabled by defining the CONSTRUCTORS_MAY_LEAVE()
macro in a public section of a class definition if the single phase construction
is part of the public interface of the class. An example of this is given
below: </p>
<pre class="codeblock">class CManagedUserSinglePhase : public CBase
	{
public:
	CONSTRUCTORS_MAY_LEAVE
	static CManagedUserSinglePhase* NewL(CTicker* aTicker)
		{
		return new(ELeave) CManagedUserSinglePhase(aTicker);
		}
	. . .
	}	</pre>

</li>
<li class="stepexpand" id="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-5A449AB7-512E-4701-928A-2209C1A41A06"><a name="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-5A449AB7-512E-4701-928A-2209C1A41A06"><!-- --></a><span>Using single phase
constructor</span>
 <p>This macro must be used within a public section of a class definition,
if the single phase construction is part of the public interface of the class.
Other classes, not derived from CBase will not be affected by this macro. </p>
<p>The
following example code snippet the class demonstrates the use of an embedded
string in the ingle-phase construction pattern, where a leave-safe constructor
fully initializes the object.  </p>
<pre class="codeblock">class CStringUserSinglePhase : public CBase
	{
public:
		CONSTRUCTORS_MAY_LEAVE

	static CStringUserSinglePhase* NewL(const TDesC&amp; aName)
		{
		return new(ELeave) CStringUserSinglePhase(aName);
		}

	~CStringUserSinglePhase()
		{
		
		}</pre>

</li>
<li class="stepexpand" id="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-D41D3443-FBFA-44DA-8E35-E82C12829F3D"><a name="GUID-B9F07057-4B31-5FE8-BE4C-98CC8151CD29__GUID-D41D3443-FBFA-44DA-8E35-E82C12829F3D"><!-- --></a><span>Need to declare
the CONSTRUCTORS_MAY_LEAVE macro</span>
 <p>This is necessary because the Symbian platform currently lacks
the placement delete operator counterparts corresponding to the CBase placement
new operators that take a TLeave parameter (new(ELeave)). The macro defines
these missing placement delete operators and ensures that all allocated memory
can be freed if a constructor leaves.</p>

</li>
</ol>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-D33EB877-CCCB-527B-8AFC-4A8385C55E78.html" title="The EUser High Level Library tutorials are meant to discuss the usage of the LString and resource management class implementation.">EUser High Level Library Tutorials</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-B007634D-4D55-528A-8B85-6120C633AC8B.html">EUser High
Level Library Overview</a></div>
<div><a href="GUID-96AB1D5A-932E-55BE-A025-F01608546B99.html">RAII Idiom</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>