<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="How to use the cleanup stack"/>
<meta name="abstract" content="This document describes how to use the cleanup stack when a function leaves."/>
<meta name="description" content="This document describes how to use the cleanup stack when a function leaves."/>
<meta name="DC.Relation" scheme="URI" content="GUID-E7D29464-05E1-5039-8A02-62CB27B5FF21.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-61DEE78D-4E78-5367-BC8A-F99D3B4E9D5A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E7D29464-05E1-5039-8A02-62CB27B5FF21.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-14BBFDA8-7765-5939-9E47-36E299841F50"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>How to use the cleanup stack</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-14BBFDA8-7765-5939-9E47-36E299841F50"><a name="GUID-14BBFDA8-7765-5939-9E47-36E299841F50"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2392072 id2392081 id2393700 id2393796 id2393858 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html" title="Provides a framework for accessing file systems.">User Library and File Server</a> &gt; <a href="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html" title="The User Library allows the applications and services that run on a phone to access the functionality provided by the Symbian platform Kernel.">User Library</a> &gt; <a href="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html" title="Memory is allocated to programs in chunks, the documentation in this set explains how to allocate, manage and release that memory.">Memory Management</a> &gt; <a href="GUID-61DEE78D-4E78-5367-BC8A-F99D3B4E9D5A.html" title="Provides an introduction to code construction and error management options.">More about Cleanup Support</a> &gt; <a href="GUID-E7D29464-05E1-5039-8A02-62CB27B5FF21.html" title="Provides tutorials and an introduction to the Cleanup Stack.">Cleanup Stack Basics</a> &gt; </div>
<h1 class="topictitle1">How
to use the cleanup stack</h1>
<div><p>This document describes how to use the cleanup stack when a function
leaves.</p>

<p>The cleanup stack is used as follows: </p>

<a name="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-BAC73597-5165-55A6-B5E7-12FA156785DF"><!-- --></a><ol id="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-BAC73597-5165-55A6-B5E7-12FA156785DF">
<li id="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-9C056803-25F8-557C-B630-0B40D38EFABA"><a name="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-9C056803-25F8-557C-B630-0B40D38EFABA"><!-- --></a><p>Use <samp class="codeph">CleanupStack::PushL()</samp> <strong>  </strong> to
push a pointer to the object onto the cleanup stack before any operation which
might leave is performed </p>
 </li>

<li id="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-F5F7946D-9E99-54B7-AF13-C76317296442"><a name="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-F5F7946D-9E99-54B7-AF13-C76317296442"><!-- --></a><p>Use <samp class="codeph">CleanupStack::Pop()</samp> to
pop the pointer from the cleanup stack when all operations that might leave
have completed </p>
 </li>

</ol>

<p>If a function leaves, then part of leave processing is to pop <em>and destroy</em> all
objects on the cleanup stack. Thus, the cleanup stack may be used to prevent
objects becoming orphaned if a leave occurs. </p>

<pre class="codeblock" id="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-4692E277-85DD-5178-B7AF-57539C9CA2E8"><a name="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-4692E277-85DD-5178-B7AF-57539C9CA2E8"><!-- --></a>void doExampleL()
 {
 // allocate with checking
 CExample* myExample = new (ELeave) CExample;

 // do something that cannot leave
 myExample-&gt;iInt = 5; // cannot leave: no protection needed

 // do something that can leave: use cleanup stack
 CleanupStack::PushL(myExample); // pointer on cleanup stack
 myExample-&gt;DoSomethingL(); // something that might leave
 CleanupStack::Pop(); // it didn't leave: pop the pointer

 // delete
 delete myExample;
 }</pre>

<div class="section" id="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-9DCA8E7D-9F8B-4597-9743-1793458DCB9B"><a name="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-9DCA8E7D-9F8B-4597-9743-1793458DCB9B"><!-- --></a><h2 class="sectiontitle">Notes</h2> <ul>
<li id="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-AFBFF014-D03C-56A5-AA09-EB7BCF54A22A"><a name="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-AFBFF014-D03C-56A5-AA09-EB7BCF54A22A"><!-- --></a><p>The cleanup stack is
necessary here because the <samp class="codeph">CExample</samp> would be orphaned on
the heap if a leave occurred. This is because the <samp class="codeph">CExample</samp> is
referred to only by an automatic pointer <samp class="codeph">myExample</samp>, which
itself becomes orphaned on the stack when the leave occurs. If the <samp class="codeph">CExample</samp> â€™s
address had been stored in an object which was <em>not</em> orphaned by the
leave, then it would not be necessary to use the cleanup stack to ensure that
it is cleaned up correctly. </p>
 </li>

<li id="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-2B0103C5-991E-54AF-B21C-E68205212510"><a name="GUID-14BBFDA8-7765-5939-9E47-36E299841F50__GUID-2B0103C5-991E-54AF-B21C-E68205212510"><!-- --></a><p>The <samp class="codeph">CleanupStack::PushL()</samp> operation
itself may leave because more memory may be needed for more cleanup stack
frames. It is guaranteed that the object is pushed to the stack before any
attempt is made to allocate more stack space. Thus, a failure of <samp class="codeph">CleanupStack::PushL()</samp> will
cause the object that was being pushed to be cleaned up properly. </p>
 </li>

</ul>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-E7D29464-05E1-5039-8A02-62CB27B5FF21.html" title="Provides tutorials and an introduction to the Cleanup Stack.">Cleanup Stack Basics</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>