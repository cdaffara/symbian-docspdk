<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Redraw Stores"/>
<meta name="abstract" content="Redraw stores store the sequence of drawing commands representing window contents. Whenever possible, the Window Server performs server-initiated redraws by repeating the sequence of stored commands, rather than by sending redraw requests to the client. This minimises the number of client-server transactions and means that redraws are done as soon as the server detects that they are needed. This topic explains some of the background to redraw stores."/>
<meta name="description" content="Redraw stores store the sequence of drawing commands representing window contents. Whenever possible, the Window Server performs server-initiated redraws by repeating the sequence of stored commands, rather than by sending redraw requests to the client. This minimises the number of client-server transactions and means that redraws are done as soon as the server detects that they are needed. This topic explains some of the background to redraw stores."/>
<meta name="DC.Relation" scheme="URI" content="GUID-E29CAFA8-523D-57D2-AC1B-D6D01741550B.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-57A777A3-5D67-5CBB-B224-B7AD422A451B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0C4B86B5-530A-5839-86C1-46E7ABE281E0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-862D3B3B-3369-5FF4-B81A-ED5BE415B035.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E29CAFA8-523D-57D2-AC1B-D6D01741550B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-484B51EC-2209-5492-8E9C-9D792AB0DF35.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1D529BDC-6665-58E2-AB3F-7023D8A84F69.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Redraw Stores</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2384330 id2384499 id2384574 id2385090 id2385098 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html">Graphics Guide</a> &gt; <a href="GUID-57A777A3-5D67-5CBB-B224-B7AD422A451B.html" title="The Windowing collection contains two components—the Window Server, which manages the use of the screen by applications, and the Window Server Plugins component.">Windowing Collection</a> &gt; <a href="GUID-0C4B86B5-530A-5839-86C1-46E7ABE281E0.html" title="The Window Server component manages the use of the screen by applications and handles key and pointer events.">Window Server Component</a> &gt; <a href="GUID-862D3B3B-3369-5FF4-B81A-ED5BE415B035.html" title="This section provides information about the internals of the Window Server. It is mainly aimed at system integrators, UI platform providers and device and hardware manufacturers. However, it also contains information about configuring the Window Server for testing and debugging, which may be of interest to application developers.">Window Server Internals</a> &gt; <a href="GUID-E29CAFA8-523D-57D2-AC1B-D6D01741550B.html" title="This section provides introductory and overview material about the internal workings of the Window Server.">Window Server Internals: Concepts</a> &gt; </div>
<h1 class="topictitle1">Redraw
Stores</h1>
<div><p>Redraw stores store the sequence of drawing commands representing
window contents. Whenever possible, the Window Server performs server-initiated
redraws by repeating the sequence of stored commands, rather than by sending
redraw requests to the client. This minimises the number of client-server
transactions and means that redraws are done as soon as the server detects
that they are needed. This topic explains some of the background to redraw
stores. </p>

<p> <strong>Variant</strong>: Both (ScreenPlay and non-ScreenPlay). <strong>Target audience</strong>:
Device creators. </p>

<p>The classes involved with redraw stores are as follows: </p>

<div class="fignone" id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-85C23EC3-BADE-5DE1-872D-0D8399209874"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-85C23EC3-BADE-5DE1-872D-0D8399209874"><!-- --></a><span class="figcap">Figure 1.            Redraw stores class diagram          </span>

<img src="GUID-40437D9A-7503-5087-851A-D1269F0AF9A9_d0e251912_href.png"/>
</div>

<p> <a href="GUID-FF963788-695A-320F-9E81-76E45B0287D1.html"><span class="apiname">CWsRedrawMsgWindow</span></a> is the class representing a redraw
store. Draw commands are stored in a number of segments, stored in the nested
class <a href="GUID-53F68722-1A1D-30D8-960E-226843AB56E1.html"><span class="apiname">CRedrawSegment</span></a>. </p>

<p>Redraw drawing takes place as follows: </p>

<a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-2C26C7D9-1C38-55E1-BF14-A36A9F9F05F3"><!-- --></a><ol id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-2C26C7D9-1C38-55E1-BF14-A36A9F9F05F3">
<li id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-2FCE8CBF-6BF3-5033-8BB7-935D0B276F7C"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-2FCE8CBF-6BF3-5033-8BB7-935D0B276F7C"><!-- --></a><p>A call to <a href="GUID-683603DD-F3D3-3193-BEB3-8236C7DE7F79.html#GUID-683603DD-F3D3-3193-BEB3-8236C7DE7F79__GUID-28202F81-52FE-30F5-8B8C-ABED0915822E"><span class="apiname">RWindow::Invalidate()</span></a> causes
either the whole window, or a rectangle within it, to be marked as invalid. </p>
 </li>

<li id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-EB4CAD7F-1B3C-5D2A-85FD-31D0C7F9503D"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-EB4CAD7F-1B3C-5D2A-85FD-31D0C7F9503D"><!-- --></a><p>Next, a call to <a href="GUID-683603DD-F3D3-3193-BEB3-8236C7DE7F79.html#GUID-683603DD-F3D3-3193-BEB3-8236C7DE7F79__GUID-9337538E-7A53-3153-A330-968B5E4F2FF2"><span class="apiname">RWindow::BeginRedraw()</span></a> is
made, either for the whole window or for a rectangle within it. </p>
 </li>

<li id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-88AF657A-8C5E-5CE8-BEF9-F8C1E34F6174"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-88AF657A-8C5E-5CE8-BEF9-F8C1E34F6174"><!-- --></a><p>Draw operations take
place. </p>
 </li>

<li id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-58BC4A48-5035-582D-BE17-C15A885F4B5F"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-58BC4A48-5035-582D-BE17-C15A885F4B5F"><!-- --></a><p>Finally there is a call
to <a href="GUID-683603DD-F3D3-3193-BEB3-8236C7DE7F79.html#GUID-683603DD-F3D3-3193-BEB3-8236C7DE7F79__GUID-3DE16607-AD3B-3946-BEB3-88512EAAB9CE"><span class="apiname">RWindow::EndRedraw()</span></a>. </p>
 </li>

</ol>

<p>In this sequence, the draw operations within the <samp class="codeph">BeginRedraw()</samp> and <samp class="codeph">EndRedraw()</samp> brackets
are interpreted as <em>replacing</em> whatever drawing was previously present
in the affected rectangle. </p>

<p>It is important to bracket all drawing within <samp class="codeph">BeginRedraw(TRect)</samp> and <samp class="codeph">EndRedraw(TRect)</samp> calls.
In ScreenPlay, the Window Server ignores all drawing not within <samp class="codeph">BeginRedraw()</samp> and <samp class="codeph">EndRedraw()</samp> brackets
and triggers a full-window redraw. In debug builds, there is an option to
panic clients violating this convention. </p>

<p>For more information, see <a href="GUID-8DB1C618-597C-560C-95A2-C0AB2CEBB027.html" title="This topic provides background information about redraw drawing and tips for updating old code to comply with the recommendation that all drawing is migrated to redraw drawing.">Redraw
Drawing</a>. </p>

<div class="section" id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-27FE041D-3DE3-4290-AF6D-38DDB8970008"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-27FE041D-3DE3-4290-AF6D-38DDB8970008"><!-- --></a><h2 class="sectiontitle">Redraw segments and non-redraw handling</h2> <p>When the
Window Server receives a batch of redraw drawing, everything between a BeginRedraw/EndRedraw
bracket is stored in a single <strong>redraw segment</strong>. The segment is marked
as <samp class="codeph">ESegmentTypePendingRedraw</samp> while it is being received,
and <samp class="codeph">ESegmentTypeRedraw</samp> once it is complete. </p>
 <p>Redraw
segments have a region to which they apply. For <samp class="codeph">ESegmentTypeRedraw</samp>,
the region is initially set to be the rectangle passed into the <samp class="codeph">BeginRedraw()</samp> call.
When a new<samp class="codeph">ESegmentTypeRedraw</samp> is created, its region is subtracted
from the regions of all existing segments. This reflects the fact that redraw
drawing <em>replaces</em> existing drawing. If, as a consequence of new redraw
drawing, the region of an existing segment becomes empty, that segment is
discarded. Its drawing has been replaced everywhere, so it is no longer needed. </p>
 <p>What
happens to drawing that is received between an <samp class="codeph">EndRedraw</samp> and
the next <samp class="codeph">BeginRedraw</samp> —and which is therefore <strong>non-redraw
drawing</strong> —depends on which variant is in use: </p>
 <ul>
<li id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-0B29AC2F-AD48-5EAB-B3BE-B8FC296B092A"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-0B29AC2F-AD48-5EAB-B3BE-B8FC296B092A"><!-- --></a><p>In ScreenPlay, non-redraw
drawing is not stored in a segment but instead triggers the Window Server
to invalidate the entire window. This means that the client application must
then perform a full window redraw. </p>
 </li>

<li id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-B592A6D0-68B7-5A16-B179-9F78C5FCDBB3"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-B592A6D0-68B7-5A16-B179-9F78C5FCDBB3"><!-- --></a><p>In the non-ScreenPlay
variant, non-redraw drawing is stored in a segment marked as <samp class="codeph">ESegmentTypeNonRedraw</samp>.
For these segments the region is initially set to be the whole window and
does not affect the regions of existing segments, because non-redraw drawing
is drawn over existing drawing. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-DB24B91E-6628-4B6E-AE9A-ACAB30AA02C3"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-DB24B91E-6628-4B6E-AE9A-ACAB30AA02C3"><!-- --></a><h2 class="sectiontitle"> Redraw store playback</h2> <p>When playback is required,
the redraw store goes through the redraw segments and replays them if the
region for the segment intersects the region that is to be redrawn. It follows
from the way that they are managed that the regions of redraw segments are
mutually disjoint. This means that in ScreenPlay they can be replayed in any
order. This is also true in the non-ScreenPlay when there are only redraw
segments present. </p>
 <p>In the non-ScreenPlay variant, any non-redraw segments
are replayed in earliest-first order, because they draw on top of earlier
drawing. </p>
 </div>

<div class="section" id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-74EC09C2-BB39-42B2-B765-191A7E17A4D6"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-74EC09C2-BB39-42B2-B765-191A7E17A4D6"><!-- --></a><h2 class="sectiontitle"> Aging of non-redraw segments</h2> <p> <strong>Variant</strong>:
Non-ScreenPlay only. </p>
 <p>Non-redraw segments can cause inefficient operation
of redraw stores. For this reason, in the non-ScreenPlay variant where non-redraw
segments are still used, the Window Server "ages" them. That is, non-redraw
segments are considered to have a finite lifetime, after which they are discarded.
When a non-redraw segment is discarded, the Window Server makes a redraw request
to the client asking it to provide new draw operations for the invalid region. </p>
 <p>The
lifetime for non-redraw segments is set in the <a href="GUID-1D529BDC-6665-58E2-AB3F-7023D8A84F69.html" title="This topic provides a reference to the wsini.ini file parameters. Some of the parameters are general, some are screen-specific and some are specific to individual plug-ins.">WSINI.INI
file</a> using the parameter <samp class="codeph">NONREDRAWAGELIMIT</samp>, followed
by a duration in microseconds. If this line is not present in the <samp class="codeph">WSINI.INI</samp>,
a default of one second is used. </p>
 </div>

<div class="section" id="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-8CE71B67-21F3-4D16-9A1A-70A70A24EFD3"><a name="GUID-0AD34BA6-D0C5-5AD7-B8E1-F737BB5FC0AC__GUID-8CE71B67-21F3-4D16-9A1A-70A70A24EFD3"><!-- --></a><h2 class="sectiontitle">Atomic Redraws</h2> <p> <strong>Variant</strong>: Both (ScreenPlay
and non-ScreenPlay). </p>
 <p>Another <a href="GUID-1D529BDC-6665-58E2-AB3F-7023D8A84F69.html" title="This topic provides a reference to the wsini.ini file parameters. Some of the parameters are general, some are screen-specific and some are specific to individual plug-ins.">WSINI.INI
file</a> setting that affects redraw storing is <samp class="codeph">ATOMICREDRAWS</samp>.
If this parameter is present, new draw operations received after a <samp class="codeph">BeginRedraw()</samp> are
not considered valid until the corresponding <samp class="codeph">EndRedraw()</samp> is
received. In particular, a new segment does not replace existing segments
until it is complete. This has the consequence that if redraw store playback
is required before the <samp class="codeph">EndRedraw()</samp> for a new segment is received,
draw operations from old segments for that region are used instead. Thus drawing
within <samp class="codeph">Begin/EndRedraw</samp> brackets can be considered as an atomic
operation. This eliminates one potential source of flicker. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-E29CAFA8-523D-57D2-AC1B-D6D01741550B.html" title="This section provides introductory and overview material about the internal workings of the Window Server.">Window Server Internals: Concepts</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-484B51EC-2209-5492-8E9C-9D792AB0DF35.html" title="This section provides application developers with an introduction to key concepts involved in drawing graphics to the screen.">Graphics
and Drawing </a></div>
</div>
<div class="relinfo relref"><strong>Related reference</strong><br/>
<div><a href="GUID-1D529BDC-6665-58E2-AB3F-7023D8A84F69.html" title="This topic provides a reference to the wsini.ini file parameters. Some of the parameters are general, some are screen-specific and some are specific to individual plug-ins.">The wsini.ini
File Reference</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>