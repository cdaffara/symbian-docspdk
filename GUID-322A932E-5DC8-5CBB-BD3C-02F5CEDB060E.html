<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Secure Simple Pairing (SSP)"/>
<meta name="abstract" content="Describes SSP."/>
<meta name="description" content="Describes SSP."/>
<meta name="DC.Relation" scheme="URI" content="GUID-A035B592-F423-5980-8E7E-E726CF24CF3E.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-DD13AA8E-BDAD-57EC-81EC-49C8D6D30A86.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6CE12919-FF81-5254-BA12-385F589FEA44.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A035B592-F423-5980-8E7E-E726CF24CF3E.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Secure Simple Pairing (SSP)</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2535271 id2535486 id2535650 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-DD13AA8E-BDAD-57EC-81EC-49C8D6D30A86.html" title="The Short Link Services module enables licensees to implement Bluetooth, USB, Infrared and OBEX on Symbian platform devices.">Short Link Services Guide</a> &gt; <a href="GUID-6CE12919-FF81-5254-BA12-385F589FEA44.html" title="The Bluetooth Management collection contains the Bluetooth Manager and Bluetooth Client components.">Bluetooth Management Collection</a> &gt; <a href="GUID-A035B592-F423-5980-8E7E-E726CF24CF3E.html">Using Bluetooth Security Manager</a> &gt; </div>
<h1 class="topictitle1">Secure
Simple Pairing (SSP)</h1>
<div><p>Describes SSP.</p>

<ul>
<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-D51EB888-7908-5F75-80B7-06B47994F22B"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-D51EB888-7908-5F75-80B7-06B47994F22B"><!-- --></a><p><a href="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E.html#GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-226FB791-0EA7-5756-893F-2839D4178E1E">Introduction</a>  </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-F8B04B59-3A9B-54B5-9D64-A64F6A930A9E"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-F8B04B59-3A9B-54B5-9D64-A64F6A930A9E"><!-- --></a><p><a href="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E.html#GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-2891BA26-F6C3-5F3C-A567-34D806A5DAA4">Overview</a>  </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-744E1DDF-2908-569D-9C7A-E29223C6C9E1"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-744E1DDF-2908-569D-9C7A-E29223C6C9E1"><!-- --></a><p><a href="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E.html#GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-FC295A44-D8D9-5835-A895-BFB85C5CB8B8">Symbian support for SSP</a>  </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-2C9207CF-8924-568A-93F9-340AB3F2A1E4"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-2C9207CF-8924-568A-93F9-340AB3F2A1E4"><!-- --></a><p><a href="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E.html#GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E6541D2E-7881-5670-B0CF-F57AA64AC032">Implementing SSP notifiers</a>  </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-3703505F-4F60-534C-B492-D83002FA9577"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-3703505F-4F60-534C-B492-D83002FA9577"><!-- --></a><p><a href="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E.html#GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E1A7D7D3-891E-5A90-926D-3F946A5448A3">Using the Out of Band API</a>  </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-67BC873E-DC42-5208-AE65-2564B1655C41"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-67BC873E-DC42-5208-AE65-2564B1655C41"><!-- --></a><p><a href="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E.html#GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-6C20C226-C4CE-5937-93D2-C1A89F00004C">Using the dedicated bonding API</a>  </p>
 </li>

</ul>

<div class="section" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-226FB791-0EA7-5756-893F-2839D4178E1E"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-226FB791-0EA7-5756-893F-2839D4178E1E"><!-- --></a><h2 class="sectiontitle">Introduction</h2> <p>Secure
Simple Pairing, introduced into Bluetooth v2.1, simplifies the user experience
when pairing Bluetooth devices. </p>
 <p>This document describes the Symbian
platform implementation of SSP. It describes the tasks that must be performed
by UI creators to implement SSP and it describes how application developers
can use Symbian APIs to pair with Bluetooth enabled devices using SSP. </p>
 <p><strong>Scope</strong> </p>
 <p>This document is intended for Symbian partners and developers
implementing SSP on Symbian platform. It assumes that you are familiar with
Bluetooth and with developing on Symbian platform. </p>
 <p><strong>Purpose of SSP</strong> </p>
 <p>SSP was introduced to simplify the user experience
when pairing Bluetooth devices. Specifically: </p>
 <ul>
<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-63DD983D-4C9B-55A9-BC1E-B5F590576B51"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-63DD983D-4C9B-55A9-BC1E-B5F590576B51"><!-- --></a><p>there is no need for
the user to think of a number </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-08AFD4B9-4B08-55CD-8A5A-83200F0D75AD"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-08AFD4B9-4B08-55CD-8A5A-83200F0D75AD"><!-- --></a><p>the authentication process
may differ for different devices and different services </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-AC68A597-36ED-5FE4-8678-21FB8F4498BE"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-AC68A597-36ED-5FE4-8678-21FB8F4498BE"><!-- --></a><p>all data transfer is
encrypted </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-2891BA26-F6C3-5F3C-A567-34D806A5DAA4"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-2891BA26-F6C3-5F3C-A567-34D806A5DAA4"><!-- --></a><h2 class="sectiontitle">Overview</h2> <p><strong>The pairing model</strong> </p>
 <p>Pre-SSP pairing is achieved by the user(s)
entering a personal identification number (PIN) on one or both devices. Devices
with no keypads, such as headsets, have their PINs (typically "0000" or "1234")
hard-wired. This is now referred to as Legacy Paring. </p>
 <p>Under SSP, devices
specify their authorisation requirements. The user may have to: </p>
 <ul>
<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-4B260DAC-E745-5FBE-95D7-3FD721A3F960"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-4B260DAC-E745-5FBE-95D7-3FD721A3F960"><!-- --></a><p>press a button in response
to a simple yes or no query </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E73EB3E7-5DBC-5326-9728-E086AA58B05A"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E73EB3E7-5DBC-5326-9728-E086AA58B05A"><!-- --></a><p>compare two automatically
generated numbers and select 'yes' if they match or 'no' if they do not </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-C7AE53AC-037A-5171-AED1-62AB0F0A1953"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-C7AE53AC-037A-5171-AED1-62AB0F0A1953"><!-- --></a><p>enter a number on one
or both devices </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E4FF8EB0-D0DD-5C39-891E-9732F53B4D7E"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E4FF8EB0-D0DD-5C39-891E-9732F53B4D7E"><!-- --></a><p>do nothing </p>
 </li>

</ul>
 <p>Once the devices have paired the user may be asked to authorise bonding.
Bonded devices can subsequently pair with no user interaction. </p>
 <p><strong>Key concepts</strong> </p>
 <dl>

<dt class="dlterm"> Authentication</dt>

<dd><p>Verification that a remote device is what it claims to be. Authentication
may be unnecessary for some pairings (see Just Works), may require user intervention
(see Man in the Middle) or may be performed through another channel (see Out
of Band). </p>
 </dd>



<dt class="dlterm"> Authorisation</dt>

<dd><p>In legacy pairing a remote device can be authorised after pairing such
that it subsequently connects automatically without user intervention. Authorisation
is on a per-service basis. See <strong>bonding</strong>. </p>
 </dd>



<dt class="dlterm">Encryption</dt>

<dd><p>Transmission of data between devices after SSP is always encrypted.
Under legacy pairing data transmission is not always encrypted. </p>
 </dd>



<dt class="dlterm"> Man In The Middle (MITM) protection</dt>

<dd><p>Authentication explicitly provided by the user before pairing can take
place. Under SSP, devices and services have hard-wired authentication requirements
as follows: MITM required, MITM not required (see Just Works) and MITM desired
(subject to the user interface capabilities of the devices) </p>
 </dd>



<dt class="dlterm"> Just Works</dt>

<dd><p>For some pairings there is little risk of a security breach so SSP
provides a mechanism for devices to pair with no explicit user authentication. </p>
 </dd>



<dt class="dlterm"> Passkey</dt>

<dd><p>In the context of a Symbian device, which always has both a display
and a keypad, passkey authentication is used when pairing with a remote device
which has a keypad but no display. The Symbian device displays a number which
the user must enter using the keypad on the remote device </p>
 </dd>



<dt class="dlterm"> Out Of Band (OOB)</dt>

<dd><p>Out of Band authentication is performed using a non-Bluetooth communication
channel. The data required to open an MITM protected Bluetooth connection
with a remote device is transmitted by other means. </p>
 </dd>



<dt class="dlterm"> Bonding</dt>

<dd><p>Two devices may bond after athentication such that they can reconnect
without user intervention. Bonding is achieved on a Symbian device by storing
a link key. Symbian devices attempt to bond by default. The user or the remote
device may specify that the devices do not bond. </p>
 </dd>



<dt class="dlterm"> Link key</dt>

<dd><p>When a connection is authenticated a link key is created. The link
key indicates the strength of authentication (legacy, authenticated or unauthenticated).
The link key may be stored by the Symbian device and used to bond (the default
behaviour) or discarded when the connection ends. The link key is not displayed
to the user. </p>
 </dd>


</dl>
 </div>

<div class="section" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-FC295A44-D8D9-5835-A895-BFB85C5CB8B8"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-FC295A44-D8D9-5835-A895-BFB85C5CB8B8"><!-- --></a><h2 class="sectiontitle">Symbian support
for SSP</h2> <p><strong>Components</strong> </p>
 <p>Most
of the changes are internal and transparent to system creators and developers.
However, some new APIs added to the Bluetooth User Library allow application
developers to use SSP features, and Licensees must implement some SSP specific
notifiers. </p>
 <p>The diagram below shows the interfaces and interface classes
required to implement SSP. </p>
 <p><strong> Dedicated
Bonding </strong> </p>
 <p>Dedicated bonding is performed by the Bluetooth Pairing
Server. Applications can use the <a href="GUID-8E97F127-DA49-3BB6-B274-348138B425DF.html"><span class="apiname">RBluetoothDedicatedBondingInitiator</span></a> API
to request bonding with a specified Bluetooth device. </p>
 <p><strong> Out of Band Data</strong> </p>
 <p>Out of Band pairing data can be passed to
the Bluetooth Pairing Server. The server can use the supplied data to pair
with the specified device. Applications can also use the <a href="GUID-C92BBABD-AE1B-325B-9791-95875272AAAC.html"><span class="apiname">RBluetoothOobData</span></a> API
to retrieve OOB data for the local device to be passed to remote devices. </p>
 <p><strong> Numeric Comparison Notifier </strong> </p>
 <p>The Bluetooth sub-system requires
a Numeric Comparison Notifier to be provided by the UI. The notifier must
handle <a href="GUID-D3F5500E-2BCD-3BB9-8B6B-5716C22FAB05.html"><span class="apiname">TBTNumericComparisonParams</span></a> and return a boolean
value which indicates the user's decision. </p>
 <p><strong> Passkey Entry Notifier </strong> </p>
 <p>The Bluetooth sub-system requires
a Passkey Entry Notifier to be provided by the UI. The notifier must handle <a href="GUID-F4DBF857-2192-3177-B431-8499907E41AF.html"><span class="apiname">TBTPasskeyDisplayParams</span></a> and <a href="GUID-EB94B14B-F836-3FA1-88CD-51FC0528D76A.html"><span class="apiname">TBTPasskeyDisplayUpdateParams</span></a>. </p>
 <p><strong> Data
Types </strong> </p>
 <p>SSP specific data is stored and manipulated using the following
types (significant functions and fields shown only). These types are used
in various device and service related APIs. They are defined in <span class="filepath">bt_sock.h</span> and <span class="filepath">btdevice.h</span>. </p>
 <p> <samp class="codeph">#include &lt;bt_sock.h&gt; </samp>  </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-3CF4FEFE-96AC-5CF3-A522-397754161A50"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-3CF4FEFE-96AC-5CF3-A522-397754161A50"><!-- --></a>
enum TBluetoothMitmProtection
    {
    EMitmNotRequired    = 0x0,   // No Man-in-the-Middle authentication is not required.
    EMitmDesired        = 0x1,      // Man-in-the-Middle authentication should be used where possible. 
    EMitmRequired        = 0x2      // Man-in-the-Middle authentication is required. 
    };
</pre>
 <p> <a href="GUID-C0341B1C-E358-3C7B-B673-37103E2AF0A3.html"><span class="apiname">TBTAccessRequirements</span></a>  </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-2EA4EA4A-AFC4-5BB2-851F-0891EC42FF6F"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-2EA4EA4A-AFC4-5BB2-851F-0891EC42FF6F"><!-- --></a>
class TBTAccessRequirements
    {
public:
       ...
    IMPORT_C void                      SetAuthentication( TBluetoothMitmProtection aPreference );
    IMPORT_C TBluetoothMitmProtection  MitmProtection() const;
                ...

    
private:
    enum TBTServiceSecuritySettings
        {
        EAuthenticate = 0x01,
        EAuthorise = 0x02,
        EEncrypt = 0x04,
        EDenied = 0x08,
        EMitm = 0x30,      // 2 bit field for MITM
        };
    
    enum TBTAccessRequirementsMitmProtection
        {
        EAccessRequirementsMitmUndefined = 0x00,
        EAccessRequirementsMitmNotRequired = 0x10,
        EAccessRequirementsMitmDesired = 0x20,
        EAccessRequirementsMitmRequired = 0x30
        };
    };</pre>
 <p> <a href="GUID-BC29B643-2CE8-30C1-BF41-4D2B5585DC81.html"><span class="apiname">TBTServiceSecurity</span></a>  </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-28168FA1-2CF7-59BE-B77B-484991491810"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-28168FA1-2CF7-59BE-B77B-484991491810"><!-- --></a>
class TBTServiceSecurity
    {
public:
    ...
    IMPORT_C void                     SetAuthentication( TBluetoothMitmProtection aPreference );
    IMPORT_C TBool                    AuthenticationRequired() const;
    IMPORT_C TBluetoothMitmProtection MitmProtection() const;
    ...
    
private:
    TBTAccessRequirements iSecurityRequirements;    // Whether the service requires authentication, authorisation, encryption or min passkey len.
    };

typedef TPckgBuf&lt;TBTServiceSecurity&gt; TBTServiceSecurityPckg;    // Package definition for securty settings
</pre>
 <p> <samp class="codeph">#include &lt;btdevice.h&gt; </samp>  </p>
 <p> <a href="GUID-7E0FA8C7-DEB4-3D86-901E-68DAC99DCA40.html"><span class="apiname">TBTDeviceSecurity</span></a>  </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-DCC63DB6-6D3F-5B32-836D-973E65305B13"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-DCC63DB6-6D3F-5B32-836D-973E65305B13"><!-- --></a>
class TBTDeviceSecurity
    {
public:

       // Enumeration to provide select MITM protection required. 

    enum TMitmRequired
        {
        EMitmUnspecified,      // No specific MITM protection requirements
        EMitmRequired          // Require the link is MITM protected 
        };
    
public:

    ...
    IMPORT_C void          SetNoAuthenticate(TBool aDecision);
    IMPORT_C void          SetMitmRequirements(TMitmRequired aDecision);
    ...
    IMPORT_C TBool         NoAuthenticate() const;
    IMPORT_C TMitmRequired MitmRequirements() const;
    ...

public:
    // Enumeration to assist in parsing of security settings.
    enum TBTDeviceSecuritySettings
        {
        ENoAuthenticate            = 0x01,        // Don't authenticate the link @deprecated
        ENoAuthorise            = 0x02,           // Don't authorise the connection
        EEncrypt                = 0x04,              // Encrypt the link
        EBanned                    = 0x08,              // Don't connect to the device
        EMitmProtectionRequired    = 0x10,  // Require the link is MITM protected
        };
    };
</pre>
 </div>

<div class="section" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E6541D2E-7881-5670-B0CF-F57AA64AC032"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E6541D2E-7881-5670-B0CF-F57AA64AC032"><!-- --></a><h2 class="sectiontitle">Implementing
SSP notifiers</h2> <p><strong>Introdution</strong> </p>
 <p>The
Bluetooth sub-system has no user interface. It uses the Symbian <a href="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-12-1-4-1-1-4-1-4-1.html">notifier
framework</a> for user interaction when pairing. The UI system must provide
a notifier, in plug-in form, for each user interaction required by SSP. The
notifier must receive data in a specified format from the Bluetooth sub-system,
display appropriate controls in a dialog on the screen, respond to the user's
input and send data back to the Bluetooth sub-system in a specified format. </p>
 <p>This
document assumes that you already have Bluetooth notifiers in your system.
It describes the key aspects of adding notifiers for SSP. The structures,
types and constants described below are defined in <span class="filepath">BTExtNotifiers.h</span>.
You can add notifiers to an existing plug-in or create a new plug-in. </p>
 <p>Notifiers
are typically implemented as sleeping dialogs. A sleeping dialog has its resources
allocated when its application (in this case the Uikon Server) is started.
A sleeping dialog can therefore be displayed (roused) safely under low memory
conditions. </p>
 <p><strong>Notes: </strong> </p>
 <ul>
<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-8F9A2CA6-0481-55EB-8458-076AA869CF1E"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-8F9A2CA6-0481-55EB-8458-076AA869CF1E"><!-- --></a><p>This document does not
describe how to implement an ECOM plug-in or a sleeping dialog. </p>
 </li>

<li id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-0BA5CB89-F09C-5150-82C5-2169503FF961"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-0BA5CB89-F09C-5150-82C5-2169503FF961"><!-- --></a><p>Customisation Kit Licensees
can find an example notifier implementation here: <span class="filepath">sf/mw/classicui/commonuisupport/uikon/examples/notifier1/</span>  </p>
 </li>

</ul>
 <p><strong>Numeric
Comparison Notifier</strong> </p>
 <p>A numeric comparison notifier is required
for SSP Man in the Middle (MITM) authentication when the remote device is
capable of displaying a number to the the user and accepting a yes or no response
from the user. The notifier must display an automatically generated number
and invite the user to confirm (yes or no) that the number is the same as
the number displayed on the remote device. The notifier must return the user's
response. </p>
 <p>The Bluetooth Security Manager uses the following code to
ask the notifier framework to display the Numeric Comparison Notifier </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-C797A612-4AD7-5DE1-854E-3398945A4957"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-C797A612-4AD7-5DE1-854E-3398945A4957"><!-- --></a>

// defined in header file(s)

TBTDevAddr                      iDevAddr ;
RNotifier                       iNotifier ;
TUint32                         iNumericValue ;
TBool                           iInternallyInitiated ;
TBTNumericComparisonParamsPckg  iNumericComparisonParamsPckg ;
TPckgBuf&lt;TBool&gt;                 iResultPckg ;
// 

void CBTNumericComparator::DoRequest()
   {
   // Start the RNotifier plugin that deals with authorisation.

   ...

   TBTDeviceName deviceName = KNullDesC ;

   iNumericComparisonParamsPckg = TBTNumericComparisonParams( iDevAddr, 
                                                              deviceName, 
                                                              iNumericValue, 
                                                              TBTNumericComparisonParams::ERemoteCanConfirm, 
                                                              iInternallyInitiated);

   iNotifier.StartNotifierAndGetResponse( iStatus, 
                                          KBTNumericComparisonNotifierUid, 
                                          iNumericComparisonParamsPckg, 
                                          iResultPckg);
   SetActive();
   }
</pre>
 <p>From the code above you can see that the Numeric Comparision
Notifier is identified by the UID<samp class="codeph">KBTNumericComparisonNotifierUid</samp> and
that it must handle data in <a href="GUID-D3F5500E-2BCD-3BB9-8B6B-5716C22FAB05.html"><span class="apiname">TBTNumericComparisonParams</span></a> (which
is packaged into <samp class="codeph">TBTNumericComparisonParamsPckg</samp> for inter-process
transfer). </p>
 <p>The code fragment below shows how to extract the numeric
comparison data within a notifier. </p>
 <p>NOTE: You will need to implement
all of the virtual functions in <a href="GUID-4E967403-417B-3340-B168-9FAF6565FEFF.html"><span class="apiname">MEikSrvNotifierBase2.</span></a>  </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-36408990-3292-531C-B15E-E88575CD0578"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-36408990-3292-531C-B15E-E88575CD0578"><!-- --></a>
class CNumericComparisonNotifier : public CEikDialog, public MEikSrvNotifierBase2
    {
public:

    ...

    // from MEikSrvNotifierBase2
    void StartL ( const TDesC8&amp; aBuffer, TInt aReplySlot, const RMessagePtr2&amp; aMessage ) ;
 
    ...

    void Complete( TBool aDecision, TInt aReason ) ;

private:
    TInt                iRepySlot ;
    TNotifierInfo       iInfo ;
    RMessage2           iMessage ;
    TBTNumeriComparisonParamsPckg     iNumericComparisonParamsPckg ;
    TBTDevAddr          iAddr ;
    TBTDeviceName       iName ;
    TUint32             iNumericalValue ;

    } ;



//--------------------------------

...

void CNumericComparisionNotifier::StartL( const TDesC8&amp; aBuffer, TInt aReplySlot, const RMessagePtr2&amp; aMessage )
    {

    iMessage = RMessage2( aMessage ) ;   // keep a copy ofthe message so that it can be completed later.
    iReplySlot = aReplySlot ;            // copy the reply slot too

    // Extract the comparison parameters from the buffer

    iNumericComparisonParamsPckg.Copy( aBuffer ) ; 

    iAddr           = iNumericComparisonParamsPckg().DeviceAddress() ;
    iName           = iNumericComparisonParamsPckg().DeviceName() ;
    iNumericalValue = iNumericComparisonParamsPckg().NumericalValue() ;

    ...

    RouseSleepingDialog() ; 

    }
        
</pre>
 <p>Your dialog must display <samp class="codeph">iNumericalValue</samp> and
ask the user if the number displayed is the same as the number displayed on
the other Bluetooth device. The user must be able to select 'Yes' or 'No'. </p>
 <p>The <samp class="codeph">StartL()</samp> function
above must return quickly so it must not wait for the user's response. Your
notifier must complete the message (<samp class="codeph">iMessage</samp>) as shown below
when the user enters a response. </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-7C313F8D-F521-541D-8294-686339633F43"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-7C313F8D-F521-541D-8294-686339633F43"><!-- --></a>
void CNumericComparisionNotifier::Complete( TBool aDecision, TInt aReason )
    {
    if ( aReason == KErrNone )
        {
        TInt err = iMessage.Write( iReplySlot, TPckgC&lt;TBool&gt;( aDecision ) ) ;
        iMessage.Complete( err ) ;
        }
     else
        {
        iMessage.Complete( aReason ) ;
        }
     }
</pre>
 <p><strong>Passkey
Notifier</strong> </p>
 <p>A passkey notifier is required for SSP MITM authentication
when the user must type a number on a remote device which has a keypad and
no display. The notifier displays the number that the user must type. In the
code below the notifier also displays a '*' character as the user types each
digit into the remote device. </p>
 <p>The Bluetooth Security Manager uses
the following code to ask the Notifier Framework to display the passkey notifier. </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-C9F126EB-D3F2-5F08-AF50-64123BB5455F"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-C9F126EB-D3F2-5F08-AF50-64123BB5455F"><!-- --></a>

// defined in header file(s)

TBTDevAddr                      iDevAddr ;
RNotifier                       iNotifier ;
TUint32                         iNumericValue ;   // the passkey number
TBool                           iInternallyInitiated ;
TBTPasskeyDisplayParamsPckg     iPasskeyDisplayParamsPckg ;
TBTDeviceNameUpdateParamsPckg   iDeviceNameUpdateParamsPckg;
TBuf8&lt;1&gt;                        iResultPckg ;

void CBTPasskeyEntry::DoRequest()
    {
    // Start the RNotifier plugin that deals with authorisation.

    ...

    TBTDeviceName deviceName ;    
    
    deviceName = KNullDesC ;

    iPasskeyDisplayParamsPckg = TBTPasskeyDisplayParams( iDevAddr, 
                                                         deviceName, 
                                                         iNumericValue, 
                                                         iInternallyInitiated ) ;

    iNotifier.StartNotifierAndGetResponse( iStatus, 
                                           KBTPasskeyDisplayNotifierUid, 
                                           iPasskeyDisplayParamsPckg, 
                                           iResultPckg ) ;
    SetActive() ;

    }

</pre>
 <p>From the code above you can see that the Passkey Notifier
is identified by the UID<samp class="codeph">KBTPasskeyNotifierUid</samp> and that it
must handle data in <a href="GUID-F4DBF857-2192-3177-B431-8499907E41AF.html"><span class="apiname">TBTPasskeyDisplayParams</span></a> (which is packaged
into <samp class="codeph">TBTPasskeyDisplayParamsPckg</samp> for inter-process transfer). </p>
 <p>As
the user enters passkey digits into the remote device the Security Manager
also uses <samp class="codeph">RNotifier::UpdateNotifierAndGetResponse()</samp> to send <a href="GUID-EB94B14B-F836-3FA1-88CD-51FC0528D76A.html"><span class="apiname">TBTPasskeyDisplayUpdateParams</span></a> (packaged
in <a href="GUID-D6CA0DDB-1CD0-32F1-BBB5-7E280E1C4779.html"><span class="apiname">TBTPasskeyDisplayUdateParamsPckg</span></a>) to the notifier. Your
notifier must use this information to reflect the key presses on the remote
device. </p>
 <p>The code fragment below shows how to extract the passkey data
within a notifier. </p>
 <p>NOTE: You will need to implement all of the virtual
functions in <a href="GUID-4E967403-417B-3340-B168-9FAF6565FEFF.html"><span class="apiname">MEikSrvNotifierBase2.</span></a>  </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-B38F7512-B091-5F93-86F1-EA740DAD7509"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-B38F7512-B091-5F93-86F1-EA740DAD7509"><!-- --></a>
class CPasskeyNotifier : public CEikDialog, public MEikSrvNotifierBase2
    {
public:

    ...

    // from MEikSrvNotifierBase2
    void   StartL( const TDesC8&amp; aBuffer, TInt aReplySlot, const RMessagePtr2&amp; aMessage ) ;
    TPtrC8 UpdateL( const TDesC8&amp; aBuffer ) ;  // new information 

    ...

private:
    TInt                            iRepySlot ;
    TNotifierInfo                   iInfo ;
    RMessage2                       iMessage ;
    TBTPasskeyDisplayParamsPckg     iPasskeyDisplayParamsPckg ;
    TBTDevAddr                      iAddr ;
    TBTDeviceName                   iName ;
    TUint32                         iNumericalValue ;   // the passkey number

    } ;

//--------------------------------

...

void CPasskeyNotifier::StartL( const TDesC8&amp; aBuffer, TInt aReplySlot, const RMessagePtr2&amp; aMessage )
    {

    iMessage = RMessage2(aMessage);  // keep a copy ofthe message so that it can be completed later.  
    iReplySlot = aReplySlot ;  // copy the reply slot too

    // Extract the comparison parameters from the buffer

    iPasskeyDisplayParamsPckg.Copy( aBuffer ) ;

    iAddr           = iPasskeyDisplayParamsPckg().DeviceAddress() ;
    iName           = iPasskeyDisplayParamsPckg().DeviceName() ;
    iNumericValue   = iPasskeyDisplayParamsPckg().NumericalValue() ;


    ...

    RouseSleepingDialog() ;  // display the passkey 

    ...

    }

void CPasskeyNotifier::UpdateL( const TDesC8&amp; aBuffer )
    {

    // extract the contents of the buffer

    TBTNotifierUpdateParamsPckg2 pckgRaw ;
    pckgRaw.Copy( aBuffer.Left( pckgRaw.MaxLength() ) ) ;

    // update the dialog to reflect the keys pressed on the remote device

    if ( pckgRaw().Type() == TBTNotifierUpdateParams2::EPasskeyDisplay )
        {
        TBTPasskeyDisplayUpdateParamsPckg pckg ;
        pckg.Copy( aBuffer ) ;
        HCIPasskeyEntryNotificationType keypressNotification = pckg().KeypressNotification() ;

        switch (keypressNotification)
            {
        case EPasskeyEntryStarted :
            {
            break ;
            }
        case EPasskeyDigitEntered :
            {
            // display '*'
            break ;
            }
        case EPasskeyDigitDeleted :
            {
            // remove '*', reposition cursor
            break ;
            }
        case EPasskeyCleared :
            {
            // clear display, reposition cursor
            break ;
            }
        case EPasskeyEntryCompleted :
            {
            // hide the dialog
            ExitSleepingDialog() ;
            break;
            }
        default :
            break ;
        }
    else if( pckgRaw().Type() == TBTNotifierUpdateParams2::EDeviceName )
        {
        // handle name update
        }
    return KNullDesC8() ;
    }



</pre>
 </div>

<div class="section" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E1A7D7D3-891E-5A90-926D-3F946A5448A3"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-E1A7D7D3-891E-5A90-926D-3F946A5448A3"><!-- --></a><h2 class="sectiontitle">Out of Band
(OOB) authentication</h2> <p><strong>Introduction</strong> </p>
 <p>Out
of Band authentication is achieved using a communication method other than
Bluetooth. Once OOB authentication has succeeded an encrypted Bluetooth channel
is opened between the two devices. </p>
 <p>The OOB API, <a href="GUID-C92BBABD-AE1B-325B-9791-95875272AAAC.html"><span class="apiname">RBluetoothOobData</span></a>,
allows an application handling OOB authentication to provide pairing information
for a remote device. </p>
 <p> <a href="GUID-C92BBABD-AE1B-325B-9791-95875272AAAC.html"><span class="apiname">RBluetoothOobData</span></a> allows
an application handling OOB authentication to retrieve pairing information
for the local device. </p>
 <p><strong>Using
the OOB API</strong> </p>
 <p>The OOB data API is provided by the Pairing Server
(part of the Security Manager). </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-B474C4DA-7FBE-5ABF-9124-BF1B3A899EE0"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-B474C4DA-7FBE-5ABF-9124-BF1B3A899EE0"><!-- --></a>

#include &lt;pairing.h&gt;

    RBluetoothPairingServer pairingServer ;
    RBluetoothOobData       OobData ;


    // Connect to the Pairing server 

    TInt err = pairingServer.connect() ;

    // Paring session

    err = OobData.Open( iPairingServer ) ;


    // Use the API pass hash and randomizer values to and from the pairing server.
   
    ...


    // Tidy up

    OobData.Close() ;
    PairingServer.Close() ;

</pre>
 <p>The API has three primary functions: </p>
 <p> <samp class="codeph">RefreshLocalOobData()</samp> -
This function causes the Bluetooth controller to generate new hash and randomizer
values for the local device. To retrieve the new values call <samp class="codeph">ReadLocalOobData()</samp>  </p>
 <p> <samp class="codeph">ReadLocalOobData()</samp> -
This function returns the hash and randomizer values that the Bluetooth controller
is currently using. </p>
 <p> <samp class="codeph">ProvideRemoteOobData()</samp> - Use
this function to pass OOB data about a remote device to the Bluetooth sub-system.
Three versions of the function are available which take slightly different
parameters. Information provided using one of these functions can be cleared
using <samp class="codeph">ClearRemoteOobData()</samp>. </p>
 </div>

<div class="section" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-6C20C226-C4CE-5937-93D2-C1A89F00004C"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-6C20C226-C4CE-5937-93D2-C1A89F00004C"><!-- --></a><h2 class="sectiontitle">Dedicated bonding</h2> <p><strong>Introduction</strong> </p>
 <p>Dedicated bonding is intended for applications
which bond with a specific Bluetooth device. </p>
 <p><strong>Using the dedicated bonding API</strong> </p>
 <pre class="codeblock" id="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-BA1AF395-EFB7-5E12-9E94-D83504876401"><a name="GUID-322A932E-5DC8-5CBB-BD3C-02F5CEDB060E__GUID-BA1AF395-EFB7-5E12-9E94-D83504876401"><!-- --></a>

#include &lt;pairing.h&gt;

    RBluetoothPairingServer             pairingServer ;
    RBluetoothDedicatedBondingInitiator bonder ;
    TBTDevAddr                          addr ;
    TRequstStatus                       status ;


    // Connect to the Pairing server 

    TInt err = pairingServer.connect() ;


    // Use the Bluetooth address of the remote device bonder.Start( pairingServer, addr, status ) ;


    // Wait for the request to complete

    User::WaitForRequest(status);


    // Close the connection with the bonder (Must be closed before bonding with another device)

    bonder.Close();

    pairingServer.Close() ;

          </pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-A035B592-F423-5980-8E7E-E726CF24CF3E.html">Using Bluetooth Security Manager</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>