<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="How to use TRAP"/>
<meta name="abstract" content="Provides code snippets to show you how to use TRAP."/>
<meta name="description" content="Provides code snippets to show you how to use TRAP."/>
<meta name="DC.Relation" scheme="URI" content="GUID-26D7BC6E-509C-51C5-9B86-437F3AEEB2EA.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-61DEE78D-4E78-5367-BC8A-F99D3B4E9D5A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-26D7BC6E-509C-51C5-9B86-437F3AEEB2EA.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>How to use TRAP</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2392072 id2392081 id2393700 id2393796 id2393804 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html" title="Provides a framework for accessing file systems.">User Library and File Server</a> &gt; <a href="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html" title="The User Library allows the applications and services that run on a phone to access the functionality provided by the Symbian platform Kernel.">User Library</a> &gt; <a href="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html" title="Memory is allocated to programs in chunks, the documentation in this set explains how to allocate, manage and release that memory.">Memory Management</a> &gt; <a href="GUID-61DEE78D-4E78-5367-BC8A-F99D3B4E9D5A.html" title="Provides an introduction to code construction and error management options.">More about Cleanup Support</a> &gt; <a href="GUID-26D7BC6E-509C-51C5-9B86-437F3AEEB2EA.html" title="Provides tutorials and an introduction to exception handling.">Exception Handling</a> &gt; </div>
<h1 class="topictitle1">How
to use TRAP</h1>
<div><p>Provides code snippets to show you how to use <samp class="codeph">TRAP</samp>.</p>

<div class="section" id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-0CE805F2-226D-4A8C-8CDF-51BF63281B10"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-0CE805F2-226D-4A8C-8CDF-51BF63281B10"><!-- --></a><h2 class="sectiontitle">Execute leaving functions under a trap harness</h2> <p>Functions
that leave, including functions that call other functions that can leave,
must be executed under a trap harness. </p>
 <p>If a call to <samp class="codeph">User::Leave()</samp> occurs
within the function, control will immediately be returned to the most recent <samp class="codeph">TRAP</samp>.
A variable is used with every trap to receive the error code specified in
a leave. </p>
 <p>If no leave occurs, then when the called function ends, execution
returns to the <samp class="codeph">TRAP</samp>, and the leave variable has the value <samp class="codeph">KErrNone</samp>. </p>
 <p>Typically
after a <samp class="codeph">TRAP</samp>, a function checks the leave variable to test
whether processing returned normally or by leaving, and acts appropriately.
Special mechanisms discussed later are provided to handle cleanup after the
exception. </p>
 <pre class="codeblock" id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-AE3B0F19-F632-5E4C-A14A-5AD804472BA3"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-AE3B0F19-F632-5E4C-A14A-5AD804472BA3"><!-- --></a>TInt E32Main() 
 {  
 testConsole.Title(); // write out title
 testConsole.Start(_LIT("Example")); // start a new "test"

 // The leave variable
 TInt r;
 // Perform example function. If it leaves,
 // the leave code is put in r
 TRAP(r,doExampleL()); 
 // Test the leave variable
 if (r) 
  testConsole.Printf(_LIT("Failed: leave code=%d"), r);

 testConsole.End(); // finish
 testConsole.Close(); // close it
 return KErrNone; // and return
 }</pre>
 <p><strong>Notes</strong> </p>
 <ul>
<li id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-DD570EB3-15DA-5615-930C-3CD7FD3A65F2"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-DD570EB3-15DA-5615-930C-3CD7FD3A65F2"><!-- --></a><p>It is not necessary
that all L functions be <em>directly</em> invoked by a trap harness. In most
cases, functions that can leave are called normally by other functions. It
is only necessary that somewhere above the function in the call chain is a
trap harness. </p>
 </li>

<li id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-E7231292-D852-5DF7-830D-7B2B92F8C3D3"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-E7231292-D852-5DF7-830D-7B2B92F8C3D3"><!-- --></a><p>It is not recommended
to call a function with an <samp class="codeph">LC</samp> suffix from inside a trap harness.
This is because if the function does not leave, the object that the function
created and pushed onto the cleanup stack will remain on the cleanup stack
on exiting from the trap harness. This causes a <samp class="codeph">E32USER-CBase 71</samp> panic,
unless the object is popped by the caller from within the trap harness, for
example: </p>
 <pre class="codeblock" id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-933B5F12-B729-5B0F-A021-FF999EFF6A79"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-933B5F12-B729-5B0F-A021-FF999EFF6A79"><!-- --></a>TRAPD(error, pointer = SomeClass::SomeFunctionLC(); CleanupStack::Pop(pointer));</pre>
 <p>In this code, if <samp class="codeph">SomeClass::SomeFunctionLC()</samp> leaves,
then <samp class="codeph">pointer</samp> is destroyed as part of leave processing. If
it does not leave then <samp class="codeph">CleanupStack::Pop(pointer)</samp> is called,
avoiding the panic. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-E21C113D-9931-5E85-9ED5-6F14BD28E042"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-E21C113D-9931-5E85-9ED5-6F14BD28E042"><!-- --></a><h2 class="sectiontitle">Using TRAPD</h2> <p>For
convenience, there is a <samp class="codeph">TRAPD</samp> form of the macro which defines
the variable to be used as the leave code. This saves a line of source code
in the majority of situations. </p>
 <pre class="codeblock" id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-EBC2B054-A961-54A5-BBB8-3C194F208C25"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-EBC2B054-A961-54A5-BBB8-3C194F208C25"><!-- --></a>TRAPD(leaveCode,SomeFunctionL()); // call a function
if (leaveCode!=KErrNone)          // check for error leave code
 {
 // some cleanup
 }</pre>
 </div>

<div class="section" id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-BB8DEAE9-D247-5AAE-80AD-A5FB193786BB"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-BB8DEAE9-D247-5AAE-80AD-A5FB193786BB"><!-- --></a><h2 class="sectiontitle">Trap harnesses
and function return values</h2> <p>Trap harnesses can be used when the
function being called returns a result. </p>
 <pre class="codeblock" id="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-3848F9FA-72A1-569D-B603-AB6FB4DA042B"><a name="GUID-3AD20E0C-F364-533F-9FBC-227478CA9982__GUID-3848F9FA-72A1-569D-B603-AB6FB4DA042B"><!-- --></a>TRAPD(leaveCode,value=GetSomethingL()); // get a value
if (leaveCode!=KErrNone) // check for error leave code
 {
 // some cleanup
 }
else { // didnâ€™t leave: value valid
 }</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-26D7BC6E-509C-51C5-9B86-437F3AEEB2EA.html" title="Provides tutorials and an introduction to exception handling.">Exception Handling</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>