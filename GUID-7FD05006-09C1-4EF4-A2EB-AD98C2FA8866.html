<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="GLib Event Loop"/>
<meta name="abstract" content="The GLib event loop manages all the sources of an event available for GLib. These events can come from different kinds of sources like file descriptors (plain file descriptors, sockets, or pipes), time-outs, or any kind of source that can be added."/>
<meta name="description" content="The GLib event loop manages all the sources of an event available for GLib. These events can come from different kinds of sources like file descriptors (plain file descriptors, sockets, or pipes), time-outs, or any kind of source that can be added."/>
<meta name="DC.Relation" scheme="URI" content="GUID-9057474B-1ADB-4761-879B-6A03B61E6E00.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-94D67092-5EB3-4D83-A164-CA628F2E2DB0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9057474B-1ADB-4761-879B-6A03B61E6E00.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-7FD05006-09C1-4EF4-A2EB-AD98C2FA8866"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>GLib Event Loop</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-7FD05006-09C1-4EF4-A2EB-AD98C2FA8866"><a name="GUID-7FD05006-09C1-4EF4-A2EB-AD98C2FA8866"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2381103 id2383355 id2383375 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html">Generic OS Services Guide</a> &gt; <a href="GUID-94D67092-5EB3-4D83-A164-CA628F2E2DB0.html" title="GLib is a general-purpose utility library, which provides many useful data types, macros, type conversions, string utilities, file utilities, a main loop abstraction, and so on. It works on many UNIX-like platforms, Windows, OS/2, and BeOS.">GLib</a> &gt; <a href="GUID-9057474B-1ADB-4761-879B-6A03B61E6E00.html">GLib Concepts</a> &gt; </div>
<h1 class="topictitle1">GLib
Event Loop</h1>
<div><p>The GLib event loop manages all the sources of an event available
for GLib. These events can come from different kinds of sources like file
descriptors (plain file descriptors, sockets, or pipes), time-outs, or any
kind of source that can be added.</p>

<p>To allow multiple independent sets of events to be handled in different
threads, each source is associated with a <samp class="codeph">GMainContext</samp>.</p>

<p>Each event source is given a priority. The default priority is <samp class="codeph">G_PRIORITY_DEFAULT</samp> and
its value is 0. Values less than 0 denote higher priority and values greater
than zero denote lower priority. The events from higher priority sources are
processed earlier than events from lower priority sources.</p>

<p>The <samp class="codeph">GMainLoop</samp> data type represents an event loop. <samp class="codeph">GMainContext</samp> is
a parameter to <samp class="codeph">GMainLoop</samp>. If <samp class="codeph">GMainContext</samp> is
passed as NULL, then a main loop with the default context is created. After
the sources are added to <samp class="codeph">GMainContext</samp> and a <samp class="codeph">GMainLoop</samp> variable
is created, <samp class="codeph">g_main_loop_run()</samp> is called. This checks continuously
for events from its sources and dispatches them. Finally when all the events
have been processed, <samp class="codeph">g_main_loop_quit()</samp> must be called to
return from <samp class="codeph">g_main_loop_run()</samp>.</p>

<div class="note"><span class="notetitle">Note:</span> Sources are associated with <samp class="codeph">GMainContext</samp> and not with <samp class="codeph">GMainLoop</samp>.
Events from sources will be checked and dispatched from all the <samp class="codeph">GMainLoop</samp> the <samp class="codeph">GMainContext</samp> is
associated with.</div>

<div class="section" id="GUID-7FD05006-09C1-4EF4-A2EB-AD98C2FA8866__GUID-FE1BB596-6331-4AB8-BC5A-C8ADE24ACE7B"><a name="GUID-7FD05006-09C1-4EF4-A2EB-AD98C2FA8866__GUID-FE1BB596-6331-4AB8-BC5A-C8ADE24ACE7B"><!-- --></a><h2 class="sectiontitle">Creating
an event loop</h2>              <p>GLib provides ready-made functions for adding
the following sources either to the default context or to a custom context:</p>
<ul>
<li><p>time-outs</p>
</li>

<li><p>I/O</p>
</li>

<li><p>child watch</p>
</li>

<li><p>idle source (events from idle sources are ready if none of the other
sources with priority &gt; G_PRIORITY_DEFAULT are ready) </p>
</li>

</ul>
<p>The following example code demonstrates the way to add a time-out
source to the default context. The program makes 10 calls to <samp class="codeph">timeout_callback()</samp>,
which at the 10th call, calls <samp class="codeph">g_main_loop_quit</samp> to make the
main loop return.</p>
<pre class="codeblock">#include &lt;glib.h&gt;
gboolean timeout_callback(gpointer data)
{
    static int i = 0;
    
    i++;
    g_print("timeout_callback called %d times\n", i);
    if (10 == i)
    {
        g_main_loop_quit( (GMainLoop*)data );
        return FALSE;
    }

    return TRUE;
}

int main()
{
    GMainLoop *loop;

    loop = g_main_loop_new ( NULL , FALSE );

    // add source to default context
    g_timeout_add (100 , timeout_callback , loop); 
    g_main_loop_run (loop);
    g_main_loop_unref(loop);

    return 0;
}
</pre>
<p>The following code demonstrates the method to add the time-out
source to a different context than the default context:</p>
<pre class="codeblock">#include &lt;glib.h&gt;
gboolean timeout_callback(gpointer data)
{
    static int i = 0;
    
    i++;
    g_print("timeout_callback called %d times\n",i);
    
    if(10 == i)
    {
        g_main_loop_quit((GMainLoop*)data);
        return FALSE;
    }
	
    return TRUE;
}

int main()
{
    GMainLoop *loop = NULL;
    GMainContext *context;
    GSource *source;
    int id;
		
    //create a new time-out source
    source = g_timeout_source_new(10);

    //create a context
    context = g_main_context_new();

    //attach source to context
    id = g_source_attach(source,context);
 
    //create a main loop with context
    loop = g_main_loop_new(context,FALSE);
	
    //set the callback for this source
    g_source_set_callback (source,timeout_callback,loop,NULL);
	
    g_main_loop_run (loop);
    
    g_main_loop_unref (loop);
     
    return 0;
}
</pre>
<p>The same process can be used for other default sources like
child watch, I/O, and idle source since they are GLib APIs that allow the
creation of a source directly.</p>
     </div>

<div class="section" id="GUID-7FD05006-09C1-4EF4-A2EB-AD98C2FA8866__GUID-76BB5D34-F4C9-4015-8A52-2CDAB37716A0"><a name="GUID-7FD05006-09C1-4EF4-A2EB-AD98C2FA8866__GUID-76BB5D34-F4C9-4015-8A52-2CDAB37716A0"><!-- --></a><h2 class="sectiontitle">Creating a
new source</h2><p>The previous section applies only to four types of sources
( time-outs, I/O, child watch, and idle source ), for which GLib provides
ready-made functions. The program below demonstrates the creation of a new
source.</p>
<pre class="codeblock">#include &lt;glib.h&gt;
gboolean callback(gpointer data)
{
    static int i = 0;
    i++;
    g_print ("timeout_callback called %d times\n",i);
    if (10 == i)
    {
        g_main_loop_quit((GMainLoop*)data);
        return FALSE;
    }

    return TRUE;
}

gboolean prepare(GSource *source,gint *timeout_)
{
    *timeout_ = -1;
    return TRUE;
}

gboolean check(GSource *source)
{
    return TRUE;
}

gboolean dispatch(GSource *source,GSourceFunc callback,gpointer user_data)
{
    if (callback(user_data))
        return TRUE;
    else
        return FALSE;
}

int main()
{
    GMainLoop *loop = NULL;
    GMainContext *context;
    GSource *source;
    int id;
	
    //create a variable of type GSourceFuncs
    GSourceFuncs SourceFuncs =
    {
        prepare,
        check,
        dispatch,
        NULL
    };
	
    //create a new source
    source = g_source_new (&amp;SourceFuncs, sizeof(GSource));
	
    //create a context
    context = g_main_context_new ();
	
    //attach source to context
    id = g_source_attach (source,context);
	
    //create a main loop with context
    loop = g_main_loop_new (context,FALSE);
 
    //set the callback for this source
    g_source_set_callback (source,callback,loop,NULL);
	
    g_main_loop_run (loop);
    g_main_loop_unref (loop);
	
    return 0;
}
</pre>
<p>The creation of a new source requires us to define at least
3 functions:</p>
<ul>
<li><p><strong><samp class="codeph">prepare()</samp></strong>: Called before all the file descriptors
are polled. If the source can determine that it is ready here (without waiting
for the results of the poll() call), it should return TRUE. It can also return
a time-out value which should be the maximum time-out (in milliseconds) which
should be passed to the poll() call. The actual time-out used will be -1 if
all sources returned -1, or it will be the minimum of all the timeout_values
returned which were &gt;= 0</p>
</li>

<li><p><strong><samp class="codeph">check()</samp></strong>: Called after all the file descriptors
are polled. The source should return TRUE if it is ready to be dispatched.</p>
<div class="note"><span class="notetitle">Note:</span> Time
may have passed since the previous prepare function was called, so the source
should be checked again.</div>
</li>

<li><p><strong><samp class="codeph">dispatch()</samp></strong> Called to dispatch the event source
after it has returned TRUE in either its prepare or check function. The dispatch
function is passed in a callback function and data. The callback function
may be NULL if the source was never connected to a callback using <samp class="codeph">g_source_set_callback()</samp>.
The dispatch function should call the callback function with <samp class="codeph">user_data</samp> and
the additional parameters that are needed for this type of event source.</p>
</li>

</ul>
</div>

<div class="section" id="GUID-7FD05006-09C1-4EF4-A2EB-AD98C2FA8866__GUID-675507D7-A769-48DA-8EE6-2AA271C0EC86"><a name="GUID-7FD05006-09C1-4EF4-A2EB-AD98C2FA8866__GUID-675507D7-A769-48DA-8EE6-2AA271C0EC86"><!-- --></a><h2 class="sectiontitle">Customizing
the main loop iteration</h2><p>Single iteration of <samp class="codeph">GMainContext</samp> can
be run in <samp class="codeph">g_main_context_iteration ()</samp>. When a more detailed
control of how the main loop runs is desired call the component function of <samp class="codeph">g_main_context
iteration()</samp> directly.</p>
<p>The component functions of <samp class="codeph">g_main_context
iteration()</samp> are listed below:</p>
<ul>
<li><p><samp class="codeph">g_main_context_prepare()</samp></p>
</li>

<li><p><samp class="codeph">g_main_context_query()</samp></p>
</li>

<li><p><samp class="codeph">g_main_context_check()</samp> </p>
</li>

</ul>
</div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-9057474B-1ADB-4761-879B-6A03B61E6E00.html">GLib Concepts</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>